!function(t){function e(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){window.devMode=/Chrome/.test(navigator.userAgent),i(1),i(227),window.libtess=i(251),window.QWebChannel=i(252),window.Events=i(30)},function(t,e,i){i(2),i(3),i(74),i(78),i(80);var r=i(30),n=i(82),o=i(92),s=new n("canvas",new o);window.engine=s,t.exports=s,i(108)(s),s.redraw(),r.listen(r.REDRAW,s.redraw.bind(s))},function(t,e){WorldWind={configuration:{gpuCacheSize:25e7},VERSION:"0.0.0",ABSOLUTE:"absolute",AFTER_REDRAW:"afterRedraw",BEFORE_REDRAW:"beforeRedraw",BEGAN:"began",CANCELLED:"cancelled",CHANGED:"changed",CLAMP_TO_GROUND:"clampToGround",EARTH_RADIUS:6371e3,EAST:"east",ENDED:"ended",FAILED:"failed",GREAT_CIRCLE:"greatCircle",LINEAR:"linear",MULTI_POINT:"multiPoint",NORTH:"north",NULL:"null",OFFSET_FRACTION:"fraction",OFFSET_INSET_PIXELS:"insetPixels",OFFSET_PIXELS:"pixels",POINT:"point",POLYLINE:"polyline",POLYGON:"polygon",POSSIBLE:"possible",RECOGNIZED:"recognized",REDRAW_EVENT_TYPE:"WorldWindRedraw",RELATIVE_TO_GLOBE:"relativeToGlobe",RELATIVE_TO_GROUND:"relativeToGround",RELATIVE_TO_SCREEN:"relativeToScreen",RHUMB_LINE:"rhumbLine",SOUTH:"south",WEST:"west"}},function(t,e,i){i(4),i(5),i(19),i(27),i(32),i(44),i(69)},function(t,e){String.prototype.format=String.prototype.f=function(){var t=arguments;return this.replace(/\{(\d+)\}/g,function(e,i){return t[i]?t[i]:e})}},function(t,e,i){window.WorldWind.Offset=i(6),window.WorldWind.Position=i(12)},function(t,e,i){var r,n;r=[i(7)],n=function(t){"use strict";var e=function(t,e,i,r){this.x=e,this.y=r,this.xUnits=t,this.yUnits=i};return e.prototype.clone=function(){return new e(this.xUnits,this.x,this.yUnits,this.y)},e.prototype.offsetForSize=function(e,i){var r,n;return r=this.xUnits==WorldWind.OFFSET_FRACTION?e*this.x:this.xUnits==WorldWind.OFFSET_INSET_PIXELS?e-this.x:this.x,n=this.yUnits==WorldWind.OFFSET_FRACTION?i*this.y:this.yUnits==WorldWind.OFFSET_INSET_PIXELS?i-this.y:this.y,new t(r,n)},e.prototype.toString=function(){return this.xUnits+" "+this.x+" "+this.yUnits+" "+this.y},e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(8),i(9),i(11)],n=function(t,e,i){"use strict";var r=function(t,e){this[0]=t,this[1]=e};return r.prototype=new Float64Array(2),r.prototype.set=function(t,e){return this[0]=t,this[1]=e,this},r.prototype.copy=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","copy","missingVector"));return this[0]=i[0],this[1]=i[1],this},r.prototype.equals=function(t){return this[0]===t[0]&&this[1]===t[1]},r.average=function(i,r){if(!i||i.length<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","average","missingArray"));if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","average","missingResult"));var n,o=i.length;r[0]=0,r[1]=0;for(var s=0,a=i.length;s<a;s++)n=i[s],r[0]+=n[0]/o,r[1]+=n[1]/o;return r},r.prototype.add=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","add","missingVector"));return this[0]+=i[0],this[1]+=i[1],this},r.prototype.subtract=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","subtract","missingVector"));return this[0]-=i[0],this[1]-=i[1],this},r.prototype.multiply=function(t){return this[0]*=t,this[1]*=t,this},r.prototype.divide=function(t){return this[0]/=t,this[1]/=t,this},r.prototype.mix=function(i,r){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","mix","missingVector"));var n=1-r,o=r;return this[0]=this[0]*n+i[0]*o,this[1]=this[1]*n+i[1]*o,this},r.prototype.negate=function(){return this[0]=-this[0],this[1]=-this[1],this},r.prototype.dot=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","dot","missingVector"));return this[0]*i[0]+this[1]*i[1]},r.prototype.magnitudeSquared=function(){return this.dot(this)},r.prototype.magnitude=function(){return Math.sqrt(this.magnitudeSquared())},r.prototype.normalize=function(){var t=this.magnitude(),e=1/t;return this[0]*=e,this[1]*=e,this},r.prototype.distanceToSquared=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","distanceToSquared","missingVector"));var r=this[0]-i[0],n=this[1]-i[1];return r*r+n*n},r.prototype.distanceTo=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","distanceTo","missingVector"));return Math.sqrt(this.distanceToSquared(i))},r.prototype.toVec3=function(){return new i(this[0],this[1],0)},r.prototype.swap=function(t){var e=this[0];return this[0]=t[0],t[0]=e,e=this[1],this[1]=t[1],t[1]=e,this},r.prototype.toString=function(){return"("+this[0]+", "+this[1]+")"},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r;r=function(){"use strict";var t={LEVEL_NONE:0,LEVEL_SEVERE:1,LEVEL_WARNING:2,LEVEL_INFO:3,setLoggingLevel:function(t){e=t},getLoggingLevel:function(){return e},log:function(i,r){r&&i>0&&i<=e&&(i===t.LEVEL_SEVERE?console.error(r):i===t.LEVEL_WARNING?console.warn(r):i===t.LEVEL_INFO?console.info(r):console.log(r))},makeMessage:function(t,e,i){var r=this.messageTable[i]?this.messageTable[i]:i;return t+"."+e+": "+r},logMessage:function(t,e,i,r){var n=this.makeMessage(e,i,r);return this.log(t,n),n},messageTable:{abstractInvocation:"The function called is abstract and must be overridden in a subclass.",indexOutOfRange:"The specified index is out of range.",invalidHeight:"The specified height is zero or negative.",invalidWidth:"The specified width is zero or negative.",invalidSize:"The specified size is zero or negative.",missingAltitudeMode:"The specified altitude mode is null or undefined.",missingAttributeName:"The specified DBase attribute file name is null or undefined.",missingArray:"The specified array is null, undefined or of insufficient length.",missingBoundaries:"The specified boundaries array is null or undefined.",missingBuffer:"The specified buffer descriptor is null or undefined.",missingColor:"The specified color is null or undefined.",missingDc:"The specified draw context is null or undefined.",missingDomElement:"The specified DOM element is null or undefined.",missingEntry:"The specified entry is null or undefined.",missingFont:"The specified font is null or undefined.",missingFrustum:"The specified frustum is null or undefined.",missingFunction:"The specified function is null or undefined.",missingGlContext:"The specified WebGL rendering context is null or undefined.",missingGlobe:"The specified globe is null or undefined.",missingImage:"The specified image is null or undefined.",missingIndices:"The specified indices array is null or undefined.",missingKey:"The specified key is null or undefined.",missingLevel:"The specified level is null or undefined.",missingLine:"The specified line is null or undefined.",missingList:"The specified list is null or undefined.",missingListener:"The specified listener is null or undefined",missingLocation:"The specified location is null or undefined.",missingMatrix:"The specified matrix is null or undefined.",missingNavigatorState:"The specified navigator state is null or undefined.",missingOffset:"The specified offset is null or undefined.",missingPath:"The specified path is null or undefined.",missingPlacename:"The specified place name is null or undefined.",missingPlane:"The specified plane is null or undefined.",missingPoint:"The specified point is null or undefined.",missingPoints:"The specified points array is null or undefined.",missingPosition:"The specified position is null or undefined.",missingPositions:"The specified positions array is null or undefined.",missingProgram:"The specified program is null or undefined.",missingProjection:"The specified projection is null or undefined.",missingRectangle:"The specified rectangle is null or undefined.",missingRenderable:"The specified renderable is null or undefined.",missingResource:"The specified resource is null or undefined.",missingResult:"The specified result variable is null or undefined.",missingResults:"The specified results array is null or undefined.",missingSector:"The specified sector is null or undefined.",missingShapeType:"The specified shape type is null or undefined.",missingSize:"The specified size is null or undefined.",missingText:"The specified text is null or undefined.",missingTexture:"The specified texture is null or undefined.",missingTile:"The specified tile is null or undefined.",missingType:"The specified type is null or undefined.",missingUrl:"The specified URL is null or undefined",missingVector:"The specified vector is null or undefined.",missingVertex:"The specified vertex is null or undefined.",missingViewport:"The specified viewport is null or undefined.",missingWorldWindow:"The specified World Window is null or undefined.",notYetImplemented:"This function is not yet implemented"}},e=1;return t}.call(e,i,e,t),!(void 0!==r&&(t.exports=r))},function(t,e,i){var r,n;r=[i(10)],n=function(t){"use strict";var e=function(e){t.call(this,"ArgumentError",e);var i;try{throw new Error}catch(t){i=t.stack}this.stack=i};return e.prototype=Object.create(t.prototype),e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r;r=function(){"use strict";var t=function(t,e){this.name=t,this.message=e};return t.prototype.toString=function(){var t=this.name+": "+this.message;return this.stack&&(t+="\n"+this.stack.toString()),t},t}.call(e,i,e,t),!(void 0!==r&&(t.exports=r))},function(t,e,i){var r,n;r=[i(8),i(9)],n=function(t,e){"use strict";var i=function(t,e,i){this[0]=t,this[1]=e,this[2]=i};return i.prototype=new Float64Array(3),i.ZERO=new i(0,0,0),i.average=function(i,r){if(!i||i.length<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","average","missingArray"));if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","average","missingResult"));var n,o=i.length;r[0]=0,r[1]=0,r[2]=0;for(var s=0,a=i.length;s<a;s++)n=i[s],r[0]+=n[0]/o,r[1]+=n[1]/o,r[2]+=n[2]/o;return r},i.averageOfBuffer=function(i,r){if(!i||i.length<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","averageBuffer","missingArray"));if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","averageBuffer","missingResult"));var n=i.length/3;r[0]=0,r[1]=0,r[2]=0;for(var o=0;o<n;o++)r[0]+=i[3*o]/n,r[1]+=i[3*o+1]/n,r[2]+=i[3*o+2]/n;return r},i.areColinear=function(r,n,o){if(!r||!n||!o)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","areColinear","missingVector"));var s=new i(r[0]-n[0],r[1]-n[1],r[2]-n[2]).normalize(),a=new i(o[0]-n[0],o[1]-n[1],o[2]-n[2]).normalize();return Math.abs(s.dot(a))>.999},i.computeTriangleNormal=function(r,n,o){if(!r||!n||!o)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","areColinear","missingVector"));var s=(n[1]-r[1])*(o[2]-r[2])-(n[2]-r[2])*(o[1]-r[1]),a=(n[2]-r[2])*(o[0]-r[0])-(n[0]-r[0])*(o[2]-r[2]),l=(n[0]-r[0])*(o[1]-r[1])-(n[1]-r[1])*(o[0]-r[0]),h=s*s+a*a+l*l;return 0===h?new i(s,a,l):(h=Math.sqrt(h),new i(s/h,a/h,l/h))},i.findThreeIndependentVertices=function(t,e){var r=e&&e>0?e:3;if(!t||t.length<3*r)return null;for(var n=new i(t[0],t[1],t[2]),o=null,s=null,a=r;a<t.length&&(o=new i(t[a],t[a+1],t[a+2]),o[0]===n[0]&&o[1]===n[1]&&o[2]===n[2]);a+=r)o=null;if(!o)return null;for(a+=r;a<t.length&&(s=new i(t[a],t[a+1],t[a+2]),s[0]===n[0]&&s[1]===n[1]&&s[2]===n[2]||s[0]===o[0]&&s[1]===o[1]&&s[2]===o[2]||i.areColinear(n,o,s));a+=r)s=null;return s?[n,o,s]:null},i.computeBufferNormal=function(t,e){var r=i.findThreeIndependentVertices(t,e);return r?i.computeTriangleNormal(r[0],r[1],r[2]):null},i.prototype.set=function(t,e,i){return this[0]=t,this[1]=e,this[2]=i,this},i.prototype.copy=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","copy","missingVector"));return this[0]=i[0],this[1]=i[1],this[2]=i[2],this},i.prototype.equals=function(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]},i.prototype.add=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","add","missingVector"));return this[0]+=i[0],this[1]+=i[1],this[2]+=i[2],this},i.prototype.subtract=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","subtract","missingVector"));return this[0]-=i[0],this[1]-=i[1],this[2]-=i[2],this},i.prototype.multiply=function(t){return this[0]*=t,this[1]*=t,this[2]*=t,this},i.prototype.divide=function(t){return this[0]/=t,this[1]/=t,this[2]/=t,this},i.prototype.multiplyByMatrix=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","multiplyByMatrix","missingMatrix"));var r=i[0]*this[0]+i[1]*this[1]+i[2]*this[2]+i[3],n=i[4]*this[0]+i[5]*this[1]+i[6]*this[2]+i[7],o=i[8]*this[0]+i[9]*this[1]+i[10]*this[2]+i[11],s=i[12]*this[0]+i[13]*this[1]+i[14]*this[2]+i[15];return this[0]=r/s,this[1]=n/s,this[2]=o/s,this},i.prototype.mix=function(i,r){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","mix","missingVector"));var n=1-r,o=r;return this[0]=this[0]*n+i[0]*o,this[1]=this[1]*n+i[1]*o,this[2]=this[2]*n+i[2]*o,this},i.prototype.negate=function(){return this[0]=-this[0],this[1]=-this[1],this[2]=-this[2],this},i.prototype.dot=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","dot","missingVector"));return this[0]*i[0]+this[1]*i[1]+this[2]*i[2]},i.prototype.cross=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","cross","missingVector"));var r=this[1]*i[2]-this[2]*i[1],n=this[2]*i[0]-this[0]*i[2],o=this[0]*i[1]-this[1]*i[0];return this[0]=r,this[1]=n,this[2]=o,this},i.prototype.magnitudeSquared=function(){return this.dot(this)},i.prototype.magnitude=function(){return Math.sqrt(this.magnitudeSquared())},i.prototype.normalize=function(){var t=this.magnitude(),e=1/t;return this[0]*=e,this[1]*=e,this[2]*=e,this},i.prototype.distanceToSquared=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","distanceToSquared","missingVector"));var r=this[0]-i[0],n=this[1]-i[1],o=this[2]-i[2];return r*r+n*n+o*o},i.prototype.distanceTo=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","distanceTo","missingVector"));return Math.sqrt(this.distanceToSquared(i))},i.prototype.swap=function(t){var e=this[0];return this[0]=t[0],t[0]=e,e=this[1],this[1]=t[1],t[1]=e,e=this[2],this[2]=t[2],t[2]=e,this},i.prototype.toString=function(){return"("+this[0]+", "+this[1]+", "+this[2]+")"},i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(13),i(9),i(14),i(8),i(17)],n=function(t,e,i,r,n){"use strict";var o=function(t,e,i){this.latitude=t,this.longitude=e,this.altitude=i};return o.ZERO=new o(0,0,0),o.fromRadians=function(e,i,r){return new o(e*t.RADIANS_TO_DEGREES,i*t.RADIANS_TO_DEGREES,r)},o.prototype.copy=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Position","copy","missingPosition"));return this.latitude=t.latitude,this.longitude=t.longitude,this.altitude=t.altitude,this},o.prototype.equals=function(t){return t&&t.latitude===this.latitude&&t.longitude===this.longitude&&t.altitude===this.altitude},o.interpolateGreatCircle=function(t,o,s,a){if(!o||!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateGreatCircle","missingPosition"));if(!a)throw new e(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateGreatCircle","missingResult"));var l=n.clamp(t,0,1);return a.altitude=n.interpolate(l,o.altitude,s.altitude),i.interpolateGreatCircle(l,o,s,a),a},o.interpolateRhumb=function(t,o,s,a){if(!o||!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateRhumb","missingPosition"));if(!a)throw new e(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateRhumb","missingResult"));var l=n.clamp(t,0,1);return a.altitude=n.interpolate(l,o.altitude,s.altitude),i.interpolateRhumb(l,o,s,a),a},o.interpolateLinear=function(t,o,s,a){if(!o||!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateLinear","missingPosition"));if(!a)throw new e(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateLinear","missingResult"));var l=n.clamp(t,0,1);return a.altitude=n.interpolate(l,o.altitude,s.altitude),i.interpolateLinear(l,o,s,a),a},o.prototype.toString=function(){return"("+this.latitude.toString()+"°, "+this.longitude.toString()+"°, "+this.altitude.toString()+")"},o}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[],n=function(){"use strict";var t={DEGREES_TO_RADIANS:Math.PI/180,RADIANS_TO_DEGREES:180/Math.PI,TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,normalizedDegrees:function(t){var e=t%360;return e>180?e-360:e<-180?360+e:e},normalizedDegreesLatitude:function(t){var e=t%180;return e>90?180-e:e<-90?-180-e:e},normalizedDegreesLongitude:function(t){var e=t%360;return e>180?e-360:e<-180?360+e:e},normalizedRadians:function(t){var e=t%this.TWO_PI;return e>Math.PI?e-this.TWO_PI:e<-Math.PI?this.TWO_PI+e:e},normalizedRadiansLatitude:function(t){var e=t%Math.PI;return e>this.HALF_PI?Math.PI-e:e<-this.HALF_PI?-Math.PI-e:e},normalizedRadiansLongitude:function(t){var e=t%this.TWO_PI;return e>Math.PI?e-this.TWO_PI:e<-Math.PI?this.TWO_PI+e:e},isValidLatitude:function(t){return t>=-90&&t<=90},isValidLongitude:function(t){return t>=-180&&t<=180},toString:function(t){return t.toString()+"°"},toDecimalDegreesString:function(t){return t.toString()+"°"},toDMSString:function(t){var e,i,r,n,o;return e=t<0?-1:1,i=e*t,r=Math.floor(i),i=60*(i-r),n=Math.floor(i),i=60*(i-n),o=Math.round(i),60==o&&(n++,o=0),60==n&&(r++,n=0),(e==-1?"-":"")+r+"° "+n+"’ "+o+"”"},toDMString:function(t){var e,i,r,n,o,s;return e=t<0?-1:1,i=e*t,r=Math.floor(i),i=60*(i-r),n=Math.floor(i),i=60*(i-n),o=Math.round(i),60==o&&(n++,o=0),60==n&&(r++,n=0),s=0==o?n:n+o/60,(e==-1?"-":"")+r+"° "+s+"’"}};return t}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(13),i(9),i(8),i(15),i(11),i(17)],n=function(t,e,i,r,n,o){"use strict";var s=function(t,e){this.latitude=t,this.longitude=e};return s.ZERO=new s(0,0),s.fromRadians=function(e,i){return new s(e*t.RADIANS_TO_DEGREES,i*t.RADIANS_TO_DEGREES)},s.prototype.copy=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","copy","missingLocation"));return this.latitude=t.latitude,this.longitude=t.longitude,this},s.prototype.set=function(t,e){return this.latitude=t,this.longitude=e,this},s.prototype.equals=function(t){return t&&t.latitude===this.latitude&&t.longitude===this.longitude},s.interpolateAlongPath=function(t,r,n,o,s){if(!n||!o)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateAlongPath","missingLocation"));if(!s)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateAlongPath","missingResult"));return t===WorldWind.GREAT_CIRCLE?this.interpolateGreatCircle(r,n,o,s):t&&t===WorldWind.RHUMB_LINE?this.interpolateRhumb(r,n,o,s):this.interpolateLinear(r,n,o,s)},s.interpolateGreatCircle=function(t,r,n,s){if(!r||!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateGreatCircle","missingLocation"));if(!s)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateGreatCircle","missingResult"));if(r.equals(n))return s.latitude=r.latitude,s.longitude=r.longitude,s;var a=o.clamp(t,0,1),l=this.greatCircleAzimuth(r,n),h=this.greatCircleDistance(r,n);return this.greatCircleLocation(r,l,a*h,s)},s.greatCircleAzimuth=function(r,n){if(!r||!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","greatCircleAzimuth","missingLocation"));var o,s,a,l=r.latitude*t.DEGREES_TO_RADIANS,h=n.latitude*t.DEGREES_TO_RADIANS,c=r.longitude*t.DEGREES_TO_RADIANS,u=n.longitude*t.DEGREES_TO_RADIANS;return l==h&&c==u?0:c==u?l>h?180:0:(s=Math.cos(h)*Math.sin(u-c),o=Math.cos(l)*Math.sin(h)-Math.sin(l)*Math.cos(h)*Math.cos(u-c),a=Math.atan2(s,o),isNaN(a)?0:a*t.RADIANS_TO_DEGREES)},s.greatCircleDistance=function(r,n){if(!r||!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","greatCircleDistance","missingLocation"));var o,s,a,l,h=r.latitude*t.DEGREES_TO_RADIANS,c=n.latitude*t.DEGREES_TO_RADIANS,u=r.longitude*t.DEGREES_TO_RADIANS,d=n.longitude*t.DEGREES_TO_RADIANS;return h==c&&u==d?0:(o=Math.sin((c-h)/2),s=Math.sin((d-u)/2),a=o*o+Math.cos(h)*Math.cos(c)*s*s,l=2*Math.asin(Math.sqrt(a)),isNaN(l)?0:l)},s.greatCircleLocation=function(r,n,o,s){if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","greatCircleLocation","missingLocation"));if(!s)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","greatCircleLocation","missingResult"));if(0==o)return s.latitude=r.latitude,s.longitude=r.longitude,s;var a,l,h=r.latitude*t.DEGREES_TO_RADIANS,c=r.longitude*t.DEGREES_TO_RADIANS,u=n*t.DEGREES_TO_RADIANS;return a=Math.asin(Math.sin(h)*Math.cos(o)+Math.cos(h)*Math.sin(o)*Math.cos(u)),l=c+Math.atan2(Math.sin(o)*Math.sin(u),Math.cos(h)*Math.cos(o)-Math.sin(h)*Math.sin(o)*Math.cos(u)),isNaN(a)||isNaN(l)?(s.latitude=r.latitude,s.longitude=r.longitude):(s.latitude=t.normalizedDegreesLatitude(a*t.RADIANS_TO_DEGREES),s.longitude=t.normalizedDegreesLongitude(l*t.RADIANS_TO_DEGREES)),s},s.interpolateRhumb=function(t,r,n,s){if(!r||!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateRhumb","missingLocation"));if(!s)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateRhumb","missingResult"));if(r.equals(n))return s.latitude=r.latitude,s.longitude=r.longitude,s;var a=o.clamp(t,0,1),l=this.rhumbAzimuth(r,n),h=this.rhumbDistance(r,n);return this.rhumbLocation(r,l,a*h,s)},s.rhumbAzimuth=function(r,n){if(!r||!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","rhumbAzimuth","missingLocation"));var s,a,l,h=r.latitude*t.DEGREES_TO_RADIANS,c=n.latitude*t.DEGREES_TO_RADIANS,u=r.longitude*t.DEGREES_TO_RADIANS,d=n.longitude*t.DEGREES_TO_RADIANS;return h==c&&u==d?0:(s=d-u,a=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(h/2+Math.PI/4)),o.fabs(s)>Math.PI&&(s=s>0?-(2*Math.PI-s):2*Math.PI+s),l=Math.atan2(s,a),isNaN(l)?0:l*t.RADIANS_TO_DEGREES)},s.rhumbDistance=function(r,n){if(!r||!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","rhumbDistance","missingLocation"));var s,a,l,h,c,u=r.latitude*t.DEGREES_TO_RADIANS,d=n.latitude*t.DEGREES_TO_RADIANS,p=r.longitude*t.DEGREES_TO_RADIANS,f=n.longitude*t.DEGREES_TO_RADIANS;return u==d&&p==f?0:(s=d-u,a=f-p,l=Math.log(Math.tan(d/2+Math.PI/4)/Math.tan(u/2+Math.PI/4)),h=s/l,(isNaN(l)||isNaN(h))&&(h=Math.cos(u)),o.fabs(a)>Math.PI&&(a=a>0?-(2*Math.PI-a):2*Math.PI+a),c=Math.sqrt(s*s+h*h*a*a),isNaN(c)?0:c)},s.rhumbLocation=function(r,n,s,a){if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","rhumbLocation","missingLocation"));if(!a)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","rhumbLocation","missingResult"));if(0==s)return a.latitude=r.latitude,a.longitude=r.longitude,a;var l,h,c=r.latitude*t.DEGREES_TO_RADIANS,u=r.longitude*t.DEGREES_TO_RADIANS,d=n*t.DEGREES_TO_RADIANS,p=c+s*Math.cos(d),f=Math.log(Math.tan(p/2+Math.PI/4)/Math.tan(c/2+Math.PI/4)),g=(p-c)/f;return(isNaN(f)||isNaN(g)||!isFinite(g))&&(g=Math.cos(c)),l=s*Math.sin(d)/g,o.fabs(p)>Math.PI/2&&(p=p>0?Math.PI-p:-Math.PI-p),h=o.fmod(u+l+Math.PI,2*Math.PI)-Math.PI,isNaN(p)||isNaN(h)?(a.latitude=r.latitude,a.longitude=r.longitude):(a.latitude=t.normalizedDegreesLatitude(p*t.RADIANS_TO_DEGREES),a.longitude=t.normalizedDegreesLongitude(h*t.RADIANS_TO_DEGREES)),a},s.interpolateLinear=function(t,r,n,s){if(!r||!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateLinear","missingLocation"));if(!s)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateLinear","missingResult"));if(r.equals(n))return s.latitude=r.latitude,s.longitude=r.longitude,s;var a=o.clamp(t,0,1),l=this.linearAzimuth(r,n),h=this.linearDistance(r,n);return this.linearLocation(r,l,a*h,s)},s.linearAzimuth=function(r,n){if(!r||!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","linearAzimuth","missingLocation"));var s,a,l,h=r.latitude*t.DEGREES_TO_RADIANS,c=n.latitude*t.DEGREES_TO_RADIANS,u=r.longitude*t.DEGREES_TO_RADIANS,d=n.longitude*t.DEGREES_TO_RADIANS;return h==c&&u==d?0:(s=d-u,a=c-h,o.fabs(s)>Math.PI&&(s=s>0?-(2*Math.PI-s):2*Math.PI+s),l=Math.atan2(s,a),isNaN(l)?0:l*t.RADIANS_TO_DEGREES)},s.linearDistance=function(r,n){if(!r||!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","linearDistance","missingLocation"));var s,a,l,h=r.latitude*t.DEGREES_TO_RADIANS,c=n.latitude*t.DEGREES_TO_RADIANS,u=r.longitude*t.DEGREES_TO_RADIANS,d=n.longitude*t.DEGREES_TO_RADIANS;return h==c&&u==d?0:(s=c-h,a=d-u,o.fabs(a)>Math.PI&&(a=a>0?-(2*Math.PI-a):2*Math.PI+a),l=Math.sqrt(s*s+a*a),isNaN(l)?0:l)},s.linearLocation=function(r,n,s,a){if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","linearLocation","missingLocation"));if(!a)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","linearLocation","missingResult"));if(0==s)return a.latitude=r.latitude,a.longitude=r.longitude,a;var l,h=r.latitude*t.DEGREES_TO_RADIANS,c=r.longitude*t.DEGREES_TO_RADIANS,u=n*t.DEGREES_TO_RADIANS,d=h+s*Math.cos(u);return o.fabs(d)>Math.PI/2&&(d=d>0?Math.PI-d:-Math.PI-d),l=o.fmod(c+s*Math.sin(u)+Math.PI,2*Math.PI)-Math.PI,isNaN(d)||isNaN(l)?(a.latitude=r.latitude,a.longitude=r.longitude):(a.latitude=t.normalizedDegreesLatitude(d*t.RADIANS_TO_DEGREES),a.longitude=t.normalizedDegreesLongitude(l*t.RADIANS_TO_DEGREES)),a},s.locationsCrossDateLine=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","locationsCrossDateline","missingLocation"));for(var r=null,n=0,s=t.length;n<s;n+=1){var a=t[n];if(null!=r&&o.signum(r.longitude)!=o.signum(a.longitude)){var l=Math.abs(r.longitude-a.longitude);if(l>180&&l<360)return!0}r=a}return!1},s.greatCircleArcExtremeLocations=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","greatCircleArcExtremeLocations","missingLocation"));for(var r=null,n=null,o=null,a=0,l=t.length;a<l;a+=1){var h=t[a];if(null!=o){var c=s.greatCircleArcExtremeForTwoLocations(o,h);if(null==c)continue;(null==r||r.latitude>c[0].latitude)&&(r=c[0]),(null==n||n.latitude<c[1].latitude)&&(n=c[1])}o=h}return[r,n]},s.greatCircleArcExtremeForTwoLocations=function(t,r){if(!t||!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","greatCircleArcExtremeForTwoLocations","missingLocation"));var n,a,l,h=null,c=null,u=90,d=-90,p=[t,r];for(n=0,a=p.length;n<a;n+=1)l=p[n],u>=l.latitude&&(u=l.latitude,h=l),d<=l.latitude&&(d=l.latitude,c=l);var f=s.greatCircleAzimuth(t,r),g=s.greatCircleDistance(t,r),m=s.greatCircleExtremeLocationsUsingAzimuth(t,f);for(n=0,a=m.length;n<a;n+=1){l=m[n];var E=s.greatCircleAzimuth(t,l),v=s.greatCircleDistance(t,l);o.signum(E)==o.signum(f)&&v>=0&&v<=g&&(u>=l.latitude&&(u=l.latitude,h=l),d<=l.latitude&&(d=l.latitude,c=l))}return[h,c]},s.greatCircleExtremeLocationsUsingAzimuth=function(r,n){if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","greatCircleArcExtremeLocationsUsingAzimuth","missingLocation"));var o=r.latitude,a=n*t.DEGREES_TO_RADIANS,l=-Math.tan(o)/Math.cos(a),h=Math.atan(l),c=h+Math.PI/2,u=h-Math.PI/2;return[s.greatCircleLocation(r,n,c,new s(0,0)),s.greatCircleLocation(r,n,u,new s(0,0))]},s.intersectionWithMeridian=function(t,e,i,o){var s=o.computePointFromLocation(t.latitude,t.longitude,new n(0,0,0)),a=o.computePointFromLocation(e.latitude,e.longitude,new n(0,0,0)),l=o.computePointFromLocation(90,i,new n(0,0,0)),h=o.computePointFromLocation(0,i,new n(0,0,0)),c=r.fromPoints(l,h,n.ZERO),u=new n(0,0,0);if(!c.intersectsSegmentAt(s,a,u))return null;var d=new WorldWind.Position(0,0,0);return o.computePositionFromPoint(u[0],u[1],u[2],d),d.latitude},s.poles={NONE:0,NORTH:1,SOUTH:2},s}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(16),i(8),i(11)],n=function(t,e,i,r){"use strict";var n=function(t,e,i,n){this.normal=new r(t,e,i),this.distance=n};return n.fromPoints=function(e,o,s){if(!e||!o||!s)throw new t(i.logMessage(i.LEVEL_SEVERE,"Plane","fromPoints","missingVector"));var a=new r(o[0],o[1],o[2]);a.subtract(e);var l=new r(s[0],s[1],s[2]);l.subtract(e),a.cross(l),a.normalize();var h=-a.dot(e);return new n(a[0],a[1],a[2],h)},n.prototype.dot=function(e){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Plane","dot","missingVector"));return this.normal.dot(e)+this.distance},n.prototype.distanceToPoint=function(t){return this.dot(t)},n.prototype.transformByMatrix=function(e){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Plane","transformByMatrix","missingMatrix"));var r=e[0]*this.normal[0]+e[1]*this.normal[1]+e[2]*this.normal[2]+e[3]*this.distance,n=e[4]*this.normal[0]+e[5]*this.normal[1]+e[6]*this.normal[2]+e[7]*this.distance,o=e[8]*this.normal[0]+e[9]*this.normal[1]+e[10]*this.normal[2]+e[11]*this.distance,s=e[12]*this.normal[0]+e[13]*this.normal[1]+e[14]*this.normal[2]+e[15]*this.distance;return this.normal[0]=r,this.normal[1]=n,this.normal[2]=o,this.distance=s,this},n.prototype.normalize=function(){var t=this.normal.magnitude();return 0===t?this:(this.normal.divide(t),this.distance/=t,this)},n.prototype.intersectsSegment=function(t,e){var i=this.dot(t),r=this.dot(e);return i*r<=0},n.prototype.intersectsSegmentAt=function(t,e,i){var r=this.dot(t),n=this.dot(e);if(0===r&&0===n)return i[0]=t[0],i[1]=t[1],i[2]=t[2],!0;if(r===n)return!1;var o=-r/(n-r),s=1-o;return i[0]=o*t[0]+s*e[0],i[1]=o*t[1]+s*e[1],i[2]=o*t[2]+s*e[2],r*n<=0},n.prototype.onSameSide=function(e,r){if(!e||!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"Plane","onSameSide","missingPoint"));var n=this.distanceToPoint(e),o=this.distanceToPoint(r);return n<0&&o<0?-1:n>0&&o>0?1:0},n.prototype.clip=function(n,o){if(!n||!o)throw new t(i.logMessage(i.LEVEL_SEVERE,"Plane","clip","missingPoint"));if(n.equals(o))return null;var s,a,l,h=e.fromSegment(n,o),c=this.normal.dot(h.direction);return 0===c?(s=this.dot(h.origin),0===s?[n,o]:null):(a=-this.dot(h.origin)/c,a<0||a>1?null:(l=h.pointAt(a,new r(0,0,0)),c>0?[l,o]:[n,l]))},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(11)],n=function(t,e,i){"use strict";var r=function(i,r){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"Line","constructor","Origin is null or undefined."));if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Line","constructor","Direction is null or undefined."));this.origin=i,this.direction=r};return r.fromSegment=function(n,o){if(!n||!o)throw new t(e.logMessage(e.LEVEL_SEVERE,"Line","fromSegment","missingPoint"));var s=new i(n[0],n[1],n[2]),a=new i(o[0]-n[0],o[1]-n[1],o[2]-n[2]);return new r(s,a)},r.prototype.pointAt=function(i,r){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Line","pointAt","missingResult."));return r[0]=this.origin[0]+this.direction[0]*i,r[1]=this.origin[1]+this.direction[1]*i,r[2]=this.origin[2]+this.direction[2]*i,r},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(13),i(9),i(16),i(8),i(18),i(11)],n=function(t,e,i,r,n,o){"use strict";var s={clamp:function(t,e,i){return t<e?e:t>i?i:t},interpolate:function(t,e,i){return(1-t)*e+t*i},cbrt:function(t){return"function"==typeof Math.cbrt?Math.cbrt(t):Math.pow(t,1/3)},computeEllipsoidalGlobeIntersection:function(t,i,n,o){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeEllipsoidalGlobeIntersection","missingLine"));if(!o)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeEllipsoidalGlobeIntersection","missingResult"));var s,a=t.direction[0],l=t.direction[1],h=t.direction[2],c=t.origin[0],u=t.origin[1],d=t.origin[2],p=i/n,f=p*p,g=i*i,m=a*a+f*l*l+h*h,E=2*(c*a+f*u*l+d*h),v=c*c+f*u*u+d*d-g,y=E*E-4*m*v;return!(y<0)&&(s=(-E-Math.sqrt(y))/(2*m),o[0]=c+a*s,o[1]=u+l*s,o[2]=d+h*s,!0)},computeTriangleIntersection:function(t,i,n,o,s){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriangleIntersection","missingLine"));if(!i||!n||!o)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriangleIntersection","missingVertex"));if(!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriangleIntersection","missingResult"));var a=t.direction[0],l=t.direction[1],h=t.direction[2],c=t.origin[0],u=t.origin[1],d=t.origin[2],p=1e-5,f=n[0]-i[0],g=n[1]-i[1],m=n[2]-i[2],E=o[0]-i[0],v=o[1]-i[1],y=o[2]-i[2],_=l*y-h*v,T=h*E-a*y,L=a*v-l*E,x=f*_+g*T+m*L;if(x>-p&&x<p)return!1;var b=1/x,S=c-i[0],w=u-i[1],M=d-i[2],R=b*(S*_+w*T+M*L);if(R<-p||R>1+p)return!1;var A=w*m-M*g,C=M*f-S*m,P=S*g-w*f,I=b*(a*A+l*C+h*P);if(I<-p||R+I>1+p)return!1;var D=b*(E*A+v*C+y*P);return!(D<0)&&(s[0]=c+a*D,s[1]=u+l*D,s[2]=d+h*D,!0)},computeIndexedTrianglesIntersection:function(t,i,n,a){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeIndexedTrianglesIntersection","missingLine"));if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeIndexedTrianglesIntersection","missingPoints"));
if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeIndexedTrianglesIntersection","missingIndices"));if(!a)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeIndexedTrianglesIntersection","missingResults"));for(var l=new o(0,0,0),h=new o(0,0,0),c=new o(0,0,0),u=new o(0,0,0),d=0,p=n.length;d<p;d+=3){var f=3*n[d],g=3*n[d+1],m=3*n[d+2];l[0]=i[f],l[1]=i[f+1],l[2]=i[f+2],h[0]=i[g],h[1]=i[g+1],h[2]=i[g+2],c[0]=i[m],c[1]=i[m+1],c[2]=i[m+2],s.computeTriangleIntersection(t,l,h,c,u)&&(a.push(u),u=new o(0,0,0))}return a.length>0},computeTriStripIntersections:function(t,i,n,s){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingLine"));if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingPoints"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingIndices"));if(!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingResults"));var a,l,h,c,u,d,p,f,g,m,E,v,y,_,T,L,x,b,S,w,M,R,A,C,P,I,D,N,O,V,G=t.direction[0],F=t.direction[1],k=t.direction[2],W=t.origin[0],B=t.origin[1],U=t.origin[2],j=1e-5;V=3*n[0],c=i[V++],u=i[V++],d=i[V],V=3*n[1],p=i[V++],f=i[V++],g=i[V];for(var K=2,z=n.length;K<z;K++)a=c,l=u,h=d,c=p,u=f,d=g,V=3*n[K],p=i[V++],f=i[V++],g=i[V],m=c-a,E=u-l,v=d-h,y=p-a,_=f-l,T=g-h,L=F*T-k*_,x=k*y-G*T,b=G*_-F*y,N=m*L+E*x+v*b,N>-j&&N<j||(O=1/N,S=W-a,w=B-l,M=U-h,P=O*(S*L+w*x+M*b),P<-j||P>1+j||(R=w*v-M*E,A=M*m-S*v,C=S*E-w*m,I=O*(G*R+F*A+k*C),I<-j||P+I>1+j||(D=O*(y*R+_*A+T*C),D>=0&&s.push(new o(W+G*D,B+F*D,U+k*D)))))},fabs:function(t){return t>=0?t:-t},fmod:function(t,e){return 0===e?0:t-Math.floor(t/e)*e},fract:function(t){return t-Math.floor(t)},mod:function(t,e){return(t%e+e)%e},max:function(t,e){return t>e?t:e},localCoordinateAxesAtPoint:function(t,i,n,o,s){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","localCoordinateAxesAtPoint","missingVector"));if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","localCoordinateAxesAtPoint","missingGlobe"));if(!n||!o||!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","localCoordinateAxesAtPoint","missingResult"));var a=t[0],l=t[1],h=t[2];i.surfaceNormalAtPoint(a,l,h,s),i.northTangentAtPoint(a,l,h,o),n.set(o[0],o[1],o[2]),n.cross(s),n.normalize(),o.set(s[0],s[1],s[2]),o.cross(n),o.normalize()},horizonDistanceForGlobeRadius:function(t,i){if(t<0)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","horizontalDistanceForGlobeRadius","The specified globe radius is negative."));return t>0&&i>0?Math.sqrt(i*(2*t+i)):0},perspectiveNearDistanceForFarDistance:function(t,i,n){if(t<0)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistanceForFarDistance","The specified distance is negative."));if(i<0)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistanceForFarDistance","The specified resolution is negative."));if(n<1)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistanceForFarDistance","The specified depth bits is negative."));var o=(1<<n)-1;return t/(o/(1-i/t)-o+1)},perspectiveNearDistance:function(t,i,n){if(t<=0)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistance","invalidWidth"));if(i<=0)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistance","invalidHeight"));if(n<0)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistance","The specified distance is negative."));var o=i/t;return 2*n/Math.sqrt(o*o+5)},perspectiveFrustumRectangle:function(t,i,o){if(t<=0)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveFrustumRectangle","invalidWidth"));if(i<=0)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveFrustumRectangle","invalidHeight"));if(o<0)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveFrustumRectangle","The specified distance is negative."));var s=o,a=o*i/t;return new n(-s/2,-a/2,s,a)},perspectivePixelSize:function(t,i,n){if(t<=0)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectivePixelSize","invalidWidth"));if(i<=0)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectivePixelSize","invalidHeight"));if(n<0)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectivePixelSize","The specified distance is negative."));var o=s.perspectiveFrustumRectangle(t,i,n).height;return o/i},boundingRectForUnitQuad:function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","boundingRectForUnitQuad","missingMatrix"));var i=t,o=i[3],s=i[7],a=i[0]+i[3],l=i[4]+i[7],h=i[1]+i[3],c=i[5]+i[7],u=i[0]+i[1]+i[3],d=i[4]+i[5]+i[7],p=Math.min(Math.min(o,a),Math.min(h,u)),f=Math.max(Math.max(o,a),Math.max(h,u)),g=Math.min(Math.min(s,l),Math.min(c,d)),m=Math.max(Math.max(s,l),Math.max(c,d));return new n(p,g,f-p,m-g)},isPowerOfTwo:function(t){return 0!=t&&0===(t&t-1)},signum:function(t){return t>0?1:t<0?-1:0},gudermannianInverse:function(e){return Math.log(Math.tan(Math.PI/4+e*t.DEGREES_TO_RADIANS/2))/Math.PI},epsg3857ToEpsg4326:function(e,i){var r=6378100,n=Math.PI/2-2*Math.atan(Math.exp(-i/r)),o=e/r;return[s.clamp(n*t.RADIANS_TO_DEGREES,-90,90),s.clamp(o*t.RADIANS_TO_DEGREES,-180,180)]},powerOfTwoFloor:function(t){var e=Math.floor(Math.log(t)/Math.log(2));return Math.pow(2,e)}};return s}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(8)],n=function(t){"use strict";var e=function(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r};return e.prototype.set=function(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r},e.prototype.getMinX=function(){return this.x},e.prototype.getMinY=function(){return this.y},e.prototype.getMaxX=function(){return this.x+this.width},e.prototype.getMaxY=function(){return this.y+this.height},e.prototype.containsPoint=function(t){return t[0]>=this.x&&t[0]<=this.x+this.width&&t[1]>=this.y&&t[1]<=this.y+this.height},e.prototype.intersects=function(t){return!(t.x+t.width<this.x)&&(!(t.x>this.x+this.width)&&(!(t.y+t.height<this.y)&&!(t.y>this.y+this.height)))},e.prototype.intersectsRectangles=function(t){if(t)for(var e=0;e<t.length;e++)if(this.intersects(t[e]))return!0;return!1},e.prototype.toString=function(){return this.x+", "+this.y+", "+this.width+", "+this.height},e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=i(20),n=i(8),o=i(26);r.prototype.retrieveCubeMapTextures=function(t,e){function i(i){if(s++,6===s){var n=new o(t,i);r.putResource(e.posX,n,n.size);var a=document.createEvent("Event");a.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(a)}}if(!e)return null;if(this.currentRetrievals[e.posX]||this.absentResourceList.isResourceAbsent(e.posX))return null;var r=this,n=[],s=0;return this.retrieveCubeMapTexture(e.posX,0,n,i),this.retrieveCubeMapTexture(e.negX,1,n,i),this.retrieveCubeMapTexture(e.posY,2,n,i),this.retrieveCubeMapTexture(e.negY,3,n,i),this.retrieveCubeMapTexture(e.posZ,4,n,i),this.retrieveCubeMapTexture(e.negZ,5,n,i),null},r.prototype.retrieveCubeMapTexture=function(t,e,i,r){var o=this,s=new Image;return this.currentRetrievals[t]||this.absentResourceList.isResourceAbsent(t)?null:(s.onload=function(){n.log(n.LEVEL_INFO,"Image retrieval succeeded: "+t),delete o.currentRetrievals[t],o.absentResourceList.unmarkResourceAbsent(t),i[e]=s,r(i)},s.onerror=function(){delete o.currentRetrievals[t],o.absentResourceList.markResourceAbsent(t),n.log(n.LEVEL_WARNING,"Image retrieval failed: "+t),i[e]=null,r(i)},s.crossOrigin="anonymous",s.src=t,this.currentRetrievals[t]=t,null)}},function(t,e,i){var r,n;r=[i(21),i(9),i(22),i(8),i(24),i(25)],n=function(t,e,i,r,n,o){"use strict";var s=function(i,o){if(!i||i<1)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","constructor","Specified cache capacity is undefined, 0 or negative."));if(!o||o<0||o>=i)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","constructor","Specified cache low-water value is undefined, negative or not less than the capacity."));this.entries=new n(i,o),this.cacheKeyPool=0,this.currentRetrievals={},this.absentResourceList=new t(3,6e4)};return Object.defineProperties(s.prototype,{capacity:{get:function(){return this.entries.capacity}},lowWater:{get:function(){return this.entries.lowWater}},usedCapacity:{get:function(){return this.entries.usedCapacity}},freeCapacity:{get:function(){return this.entries.freeCapacity}}}),s.prototype.generateCacheKey=function(){return"GpuResourceCache "+ ++this.cacheKeyPool},s.prototype.putResource=function(t,n,o){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","putResource","missingKey."));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","putResource","missingResource."));if(!o||o<1)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","putResource","The specified resource size is undefined or less than 1."));var s={resource:n};this.entries.putEntry(t instanceof i?t.key:t,s,o)},s.prototype.resourceForKey=function(t){var e=t instanceof i?this.entries.entryForKey(t.key):this.entries.entryForKey(t);return e?e.resource:null},s.prototype.containsResource=function(t){return this.entries.containsKey(t instanceof i?t.key:t)},s.prototype.removeResource=function(t){this.entries.removeEntry(t instanceof i?t.key:t)},s.prototype.clear=function(){this.entries.clear(!1)},s.prototype.retrieveTexture=function(t,e,n){if(!e)return null;if(e instanceof i){var s=new o(t,e.image,n);return this.putResource(e.key,s,s.size),s}if(this.currentRetrievals[e]||this.absentResourceList.isResourceAbsent(e))return null;var a=this,l=new Image;return l.onload=function(){r.log(r.LEVEL_INFO,"Image retrieval succeeded: "+e);var i=new o(t,l,n);a.putResource(e,i,i.size),delete a.currentRetrievals[e],a.absentResourceList.unmarkResourceAbsent(e);var s=document.createEvent("Event");s.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(s)},l.onerror=function(){delete a.currentRetrievals[e],a.absentResourceList.markResourceAbsent(e),r.log(r.LEVEL_WARNING,"Image retrieval failed: "+e)},this.currentRetrievals[e]=e,l.crossOrigin="anonymous",l.src=e,null},s}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[],n=function(){"use strict";var t=function(t,e){this.maxTrys=t,this.minCheckInterval=e,this.tryAgainInterval=6e4,this.possiblyAbsent={}};return t.prototype.isResourceAbsent=function(t){var e=this.possiblyAbsent[t];if(!e)return!1;if(e.permanent)return!0;var i=Date.now()-e.timeOfLastMark;return i>this.tryAgainInterval?(delete this.possiblyAbsent[t],!1):i<this.minCheckInterval||e.numTrys>this.maxTrys},t.prototype.markResourceAbsent=function(t){var e=this.possiblyAbsent[t];e||(e={timeOfLastMark:Date.now(),numTrys:0},this.possiblyAbsent[t]=e),e.numTrys=e.numTrys+1,e.timeOfLastMark=Date.now()},t.prototype.markResourceAbsentPermanently=function(t){var e=this.possiblyAbsent[t];e||(e={timeOfLastMark:Date.now(),numTrys:0},this.possiblyAbsent[t]=e),e.numTrys=e.numTrys+1,e.timeOfLastMark=Date.now(),e.permanent=!0},t.prototype.unmarkResourceAbsent=function(t){var e=this.possiblyAbsent[t];e&&delete this.possiblyAbsent[t]},t}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(23),i(8)],n=function(t,e,i){"use strict";var r=function(e){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"ImageSource","constructor","missingImage"));this.image=e,this.key="ImageSource "+ ++r.keyPool};return r.keyPool=0,r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(8)],n=function(t){"use strict";var e=function(t,e,i,r){this.red=t,this.green=e,this.blue=i,this.alpha=r};return e.WHITE=new e(1,1,1,1),e.BLACK=new e(0,0,0,1),e.RED=new e(1,0,0,1),e.GREEN=new e(0,1,0,1),e.BLUE=new e(0,0,1,1),e.CYAN=new e(0,1,1,1),e.YELLOW=new e(1,1,0,1),e.MAGENTA=new e(1,0,1,1),e.LIGHT_GRAY=new e(.75,.75,.75,1),e.MEDIUM_GRAY=new e(.5,.5,.5,1),e.DARK_GRAY=new e(.25,.25,.25,1),e.TRANSPARENT=new e(0,0,0,0),e.prototype.set=function(t,e,i,r){return this.red=t,this.green=e,this.blue=i,this.alpha=r,this},e.prototype.copy=function(e){if(!e)throw new ArgumentError(t.logMessage(t.LEVEL_SEVERE,"Color","copy","missingColor"));return this.red=e.red,this.green=e.green,this.blue=e.blue,this.alpha=e.alpha,this},e.prototype.clone=function(){return new e(this.red,this.green,this.blue,this.alpha)},e.prototype.premultipliedComponents=function(t){var e=this.alpha;return t[0]=this.red*e,t[1]=this.green*e,t[2]=this.blue*e,t[3]=e,t},e.colorFromByteArray=function(t){return new e(t[0]/255,t[1]/255,t[2]/255,t[3]/255)},e.colorFromBytes=function(t,i,r,n){return new e(t/255,i/255,r/255,n/255)},e.colorFromHex=function(t){var i=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),n=parseInt(t.substring(4,6),16),o=parseInt(t.substring(6,8),16);return e.colorFromBytes(i,r,n,o)},e.colorFromKmlHex=function(t){return t=t.split("").reverse().join(""),e.colorFromHex(t)},e.prototype.nextColor=function(){var t=Math.round(255*this.red),e=Math.round(255*this.green),i=Math.round(255*this.blue);return t<255?this.red=(t+1)/255:e<255?(this.red=0,this.green=(e+1)/255):i<255?(this.red=0,this.green=0,this.blue=(i+1)/255):(this.red=1/255,this.green=0,this.blue=0),this},e.prototype.equals=function(t){var e=Math.round(255*this.red),i=Math.round(255*this.green),r=Math.round(255*this.blue),n=Math.round(255*this.alpha),o=Math.round(255*t.red),s=Math.round(255*t.green),a=Math.round(255*t.blue),l=Math.round(255*t.alpha);return e===o&&i===s&&r===a&&n===l},e.prototype.equalsBytes=function(t){var e=Math.round(255*this.red),i=Math.round(255*this.green),r=Math.round(255*this.blue),n=Math.round(255*this.alpha);return e===t[0]&&i===t[1]&&r===t[2]&&n===t[3]},e.prototype.toByteString=function(){var t=Math.round(255*this.red),e=Math.round(255*this.green),i=Math.round(255*this.blue),r=Math.round(255*this.alpha);return"("+t+","+e+","+i+","+r+")"},e.prototype.toHexString=function(t){var e=Math.ceil(255*this.red).toString(16),i=Math.ceil(255*this.green).toString(16),r=Math.ceil(255*this.blue).toString(16),n=Math.ceil(255*this.alpha).toString(16),o="#";return o+=e.length<2?"0"+e:e,o+=i.length<2?"0"+i:i,o+=r.length<2?"0"+r:r,t&&(o+=n.length<2?"0"+n:n),o},e.prototype.toRGBAString=function(){var t=Math.floor(255*this.red),e=Math.floor(255*this.green),i=Math.floor(255*this.blue);return"rgba("+t+" ,"+e+" ,"+i+" ,"+this.alpha+")"},e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8)],n=function(t,e){"use strict";var i=function(i,r){if(!i||i<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","constructor","The specified capacity is undefined, zero or negative"));if(!r||r>=i||r<0)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","constructor","The specified low-water value is undefined, greater than or equal to the capacity, or less than 1"));this._capacity=i,this._lowWater=r,this.usedCapacity=0,this.freeCapacity=i,this.entries={},this.listeners=[]};return Object.defineProperties(i.prototype,{capacity:{get:function(){return this._capacity},set:function(i){if(!i||i<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","capacity","Specified cache capacity is undefined, 0 or negative."));var r=this._capacity;this._capacity=i,this._capacity<=this.lowWater&&(this._lowWater=.85*this._capacity),this._capacity<r&&this.makeSpace(0)}},lowWater:{get:function(){return this._lowWater},set:function(i){if(!i||i>=this._capacity||i<0)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","lowWater","Specified cache low-water value is undefined, negative or not less than the current capacity."));this._lowWater=i}}}),i.prototype.entryForKey=function(t){if(!t)return null;var e=this.entries[t];return e?(e.lastUsed=Date.now(),e.entry):null},i.prototype.putEntry=function(i,r,n){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","putEntry","missingKey."));if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","putEntry","missingEntry."));if(n<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","putEntry","The specified entry size is less than 1."));var o,s=this.entries[i];s&&this.removeEntry(i),this.usedCapacity+n>this._capacity&&this.makeSpace(n),this.usedCapacity+=n,this.freeCapacity=this._capacity-this.usedCapacity,o={key:i,entry:r,size:n,lastUsed:Date.now()},this.entries[i]=o},i.prototype.clear=function(t){if(t)for(var e in this.entries)this.entries.hasOwnProperty(e)&&this.removeCacheEntry(e);this.entries={},this.freeCapacity=this._capacity,this.usedCapacity=0},i.prototype.removeEntry=function(t){if(t){var e=this.entries[t];e&&this.removeCacheEntry(e)}},i.prototype.removeCacheEntry=function(t){delete this.entries[t.key],this.usedCapacity-=t.size,this.freeCapacity=this._capacity-this.usedCapacity;for(var e=0,i=this.listeners.length;e<i;e++)try{this.listeners[e].entryRemoved(t.key,t.entry)}catch(i){this.listeners[e].removalError(i,t.key,t.entry)}},i.prototype.containsKey=function(t){return t&&this.entries[t]},i.prototype.addCacheListener=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","addCacheListener","missingListener"));if("function"!=typeof i.entryRemoved||"function"!=typeof i.removalError)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","addCacheListener","The specified listener does not implement the required functions."));this.listeners.push(i)},i.prototype.removeCacheListener=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","removeCacheListener","missingListener"));var r=this.listeners.indexOf(i);r>-1&&this.listeners.splice(r,1)},i.prototype.makeSpace=function(t){var e=[];this.usedCapacity;for(var i in this.entries)this.entries.hasOwnProperty(i)&&e.push(this.entries[i]);e.sort(function(t,e){return t.lastUsed-e.lastUsed});for(var r=0,n=e.length;r<n&&(this.usedCapacity>this._lowWater||this.freeCapacity<t);r++)this.removeCacheEntry(e[r])},i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(17)],n=function(t,e,i){"use strict";var r=function(r,n,o){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Texture","constructor","missingGlContext"));if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Texture","constructor","missingImage"));o||(o=r.CLAMP_TO_EDGE);var s=r.createTexture(),a=i.isPowerOfTwo(n.width)&&i.isPowerOfTwo(n.height);this.originalImageWidth=n.width,this.originalImageHeight=n.height,o!==r.REPEAT||a||(n=this.resizeImage(n),a=!0),this.imageWidth=n.width,this.imageHeight=n.height,this.size=n.width*n.height*4,r.bindTexture(r.TEXTURE_2D,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,a?r.LINEAR_MIPMAP_LINEAR:r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,o);var l=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");l&&r.texParameteri(r.TEXTURE_2D,l.TEXTURE_MAX_ANISOTROPY_EXT,4),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),a&&r.generateMipmap(r.TEXTURE_2D),this.textureId=s,this.creationTime=new Date};return r.prototype.dispose=function(t){t.deleteTexture(this.textureId),delete this.textureId},r.prototype.bind=function(t){return t.currentGlContext.bindTexture(t.currentGlContext.TEXTURE_2D,this.textureId),t.frameStatistics.incrementTextureLoadCount(1),!0},r.prototype.resizeImage=function(t){var e=document.createElement("canvas");e.width=i.powerOfTwoFloor(t.width),e.height=i.powerOfTwoFloor(t.height);var r=e.getContext("2d");return r.drawImage(t,0,0,e.width,e.height),e},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e){var i=function(t,e){this.size=0,this.textureId=t.createTexture(),t.bindTexture(t.TEXTURE_CUBE_MAP,this.textureId),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);for(var i=0;i<e.length;i++){var r=t.TEXTURE_CUBE_MAP_POSITIVE_X+i,n=e[i];null!==n&&(t.texImage2D(r,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),this.size+=n.width*n.height*4)}t.bindTexture(t.TEXTURE_CUBE_MAP,null),this.creationTime=new Date};i.prototype.bind=function(t){return t.currentGlContext.bindTexture(t.currentGlContext.TEXTURE_CUBE_MAP,this.textureId),t.frameStatistics.incrementTextureLoadCount(1),!0},t.exports=i},function(t,e,i){var r,n,o=i(28),s=i(30);s.listen(s.BLOCK_NAVIGATION,function(t){r=t}),window.navigator.userAgent.indexOf("QtWebEngine/5.9.0")>-1&&(n=!0);var a=o.prototype.handleEvent;o.prototype.handleEvent=function(t){function e(e){try{e.call(i,t)}catch(t){console.error(t)}}var i=this;r&&!t.ctrlKey||(n?"pointerdown"===t.type?e(o.prototype.handleMouseDown):"pointermove"===t.type?e(o.prototype.handleMouseMove):"pointerup"===t.type?e(o.prototype.handleMouseUp):a.call(this,t):a.call(this,t))}},function(t,e,i){var r,n;r=[i(9),i(8),i(29)],n=function(t,e,i){"use strict";var r=function(i,n){function o(t){s.handleEvent(t)}if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"GestureRecognizer","constructor","missingTarget"));this.target=i,this.enabled=!0,this._state=WorldWind.POSSIBLE,this._nextState=null,this._clientX=0,this._clientY=0,this._clientStartX=0,this._clientStartY=0,this._translationX=0,this._translationY=0,this._translationWeight=.4,this._mouseButtonMask=0,this._touches=[],this._touchCentroidShiftX=0,this._touchCentroidShiftY=0,this._gestureCallbacks=[],this._canRecognizeWith=[],this._requiresFailureOf=[],this._requiredToFailBy=[],n&&this._gestureCallbacks.push(n),r.allRecognizers.push(this);var s=this;window.PointerEvent?(i.addEventListener("pointerdown",o,!1),window.addEventListener("pointermove",o,!1),window.addEventListener("pointercancel",o,!1),window.addEventListener("pointerup",o,!1)):(i.addEventListener("mousedown",o,!1),window.addEventListener("mousemove",o,!1),window.addEventListener("mouseup",o,!1),i.addEventListener("touchstart",o,!1),i.addEventListener("touchmove",o,!1),i.addEventListener("touchend",o,!1),i.addEventListener("touchcancel",o,!1))};return r.allRecognizers=[],Object.defineProperties(r.prototype,{state:{get:function(){return this._state},set:function(t){this.transitionToState(t)}},clientX:{get:function(){return this._clientX},set:function(t){this._clientX=t}},clientY:{get:function(){return this._clientY},set:function(t){this._clientY=t}},translationX:{get:function(){return this._translationX},set:function(t){this._translationX=t,this._clientStartX=this._clientX,this._touchCentroidShiftX=0}},translationY:{get:function(){return this._translationY},set:function(t){this._translationY=t,this._clientStartY=this._clientY,this._touchCentroidShiftY=0}},mouseButtonMask:{get:function(){return this._mouseButtonMask}},touchCount:{get:function(){return this._touches.length}},gestureCallbacks:{get:function(){return this._gestureCallbacks}}}),r.prototype.touch=function(i){if(i<0||i>=this._touches.length)throw new t(e.logMessage(e.LEVEL_SEVERE,"GestureRecognizer","touch","indexOutOfRange"));return this._touches[i]},r.prototype.recognizeSimultaneouslyWith=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"GestureRecognizer","recognizeSimultaneouslyWith","The specified gesture recognizer is null or undefined."));var r=this._canRecognizeWith.indexOf(i);r==-1&&(this._canRecognizeWith.push(i),i._canRecognizeWith.push(this))},r.prototype.canRecognizeSimultaneouslyWith=function(t){var e=this._canRecognizeWith.indexOf(t);return e!=-1},r.prototype.requireRecognizerToFail=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"GestureRecognizer","requireRecognizerToFail","The specified gesture recognizer is null or undefined"));var r=this._requiresFailureOf.indexOf(i);r==-1&&(this._requiresFailureOf.push(i),i._requiredToFailBy.push(this))},r.prototype.requiresRecognizerToFail=function(t){var e=this._requiresFailureOf.indexOf(t);return e!=-1},r.prototype.requiredToFailByRecognizer=function(t){var e=this._requiredToFailBy.indexOf(t);return e!=-1},r.prototype.reset=function(){this._state=WorldWind.POSSIBLE,this._nextState=null,this._clientX=0,this._clientY=0,this._clientStartX=0,this._clientStartY=0,this._translationX=0,this._translationY=0,this._mouseButtonMask=0,this._touches=[],this._touchCentroidShiftX=0,this._touchCentroidShiftY=0},r.prototype.prepareToRecognize=function(){},r.prototype.mouseDown=function(t){},r.prototype.mouseMove=function(t){},r.prototype.mouseUp=function(t){},r.prototype.touchStart=function(t){},r.prototype.touchMove=function(t){},r.prototype.touchCancel=function(t){},r.prototype.touchEnd=function(t){},r.prototype.transitionToState=function(t){this._nextState=null,t==WorldWind.FAILED?(this._state=t,this.updateRecognizersWaitingForFailure(),this.resetIfEventsEnded()):t==WorldWind.RECOGNIZED?(this.tryToRecognize(t),this._state==t&&(this.prepareToRecognize(),this.callGestureCallbacks(),this.resetIfEventsEnded())):t==WorldWind.BEGAN?(this.tryToRecognize(t),this._state==t&&(this.prepareToRecognize(),this.callGestureCallbacks())):t==WorldWind.CHANGED?(this._state=t,this.callGestureCallbacks()):t==WorldWind.CANCELLED?(this._state=t,this.callGestureCallbacks(),this.resetIfEventsEnded()):t==WorldWind.ENDED&&(this._state=t,this.callGestureCallbacks(),this.resetIfEventsEnded())},r.prototype.updateRecognizersWaitingForFailure=function(){for(var t=0,e=this._requiredToFailBy.length;t<e;t++){var i=this._requiredToFailBy[t];null!=i._nextState&&i.transitionToState(i._nextState)}},r.prototype.tryToRecognize=function(t){if(r.allRecognizers.some(this.canBePreventedByRecognizer,this))return void this.transitionToState(WorldWind.FAILED);if(r.allRecognizers.some(this.isWaitingForRecognizerToFail,this))return void(this._nextState=t);for(var e=r.allRecognizers.filter(this.canPreventRecognizer,this),i=0,n=e.length;i<n;i++)e[i].transitionToState(WorldWind.FAILED);this._state=t},r.prototype.canPreventRecognizer=function(t){return this!=t&&this.target==t.target&&t.state==WorldWind.POSSIBLE&&(this.requiredToFailByRecognizer(t)||!this.canRecognizeSimultaneouslyWith(t))},r.prototype.canBePreventedByRecognizer=function(t){return this!=t&&this.target==t.target&&t.state==WorldWind.RECOGNIZED&&(this.requiresRecognizerToFail(t)||!this.canRecognizeSimultaneouslyWith(t))},r.prototype.isWaitingForRecognizerToFail=function(t){return this!=t&&this.target==t.target&&t.state==WorldWind.POSSIBLE&&this.requiresRecognizerToFail(t)},r.prototype.callGestureCallbacks=function(){for(var t=0,e=this._gestureCallbacks.length;t<e;t++)this._gestureCallbacks[t](this)},r.prototype.handleEvent=function(t){if(this.enabled&&(!t.defaultPrevented||this.state!=WorldWind.POSSIBLE)){var i,r;try{if("mousedown"==t.type)this.handleMouseDown(t);else if("mousemove"==t.type)this.handleMouseMove(t);else if("mouseup"==t.type)this.handleMouseUp(t);else if("touchstart"==t.type)for(i=0,r=t.changedTouches.length;i<r;i++)this.handleTouchStart(t.changedTouches.item(i));else if("touchmove"==t.type)for(i=0,r=t.changedTouches.length;i<r;i++)this.handleTouchMove(t.changedTouches.item(i));else if("touchcancel"==t.type)for(i=0,r=t.changedTouches.length;i<r;i++)this.handleTouchCancel(t.changedTouches.item(i));else if("touchend"==t.type)for(i=0,r=t.changedTouches.length;i<r;i++)this.handleTouchEnd(t.changedTouches.item(i));else"pointerdown"==t.type&&"mouse"==t.pointerType?this.handleMouseDown(t):"pointermove"==t.type&&"mouse"==t.pointerType?this.handleMouseMove(t):"pointercancel"==t.type&&"mouse"==t.pointerType||("pointerup"==t.type&&"mouse"==t.pointerType?this.handleMouseUp(t):"pointerdown"==t.type&&"touch"==t.pointerType?this.handleTouchStart(t):"pointermove"==t.type&&"touch"==t.pointerType?this.handleTouchMove(t):"pointercancel"==t.type&&"touch"==t.pointerType?this.handleTouchCancel(t):"pointerup"==t.type&&"touch"==t.pointerType?this.handleTouchEnd(t):e.logMessage(e.LEVEL_INFO,"GestureRecognizer","handleEvent","Unrecognized event type: "+t.type))}catch(t){e.logMessage(e.LEVEL_SEVERE,"GestureRecognizer","handleEvent","Error handling event.\n"+t.toString())}}},r.prototype.handleMouseDown=function(t){if(!("mousedown"==t.type&&this._touches.length>0)){var e=1<<t.button;e&0!=this._mouseButtonMask||(0==this._mouseButtonMask&&(this._clientX=t.clientX,this._clientY=t.clientY,this._clientStartX=t.clientX,this._clientStartY=t.clientY,this._translationX=0,this._translationY=0),this._mouseButtonMask|=e,this.mouseDown(t))}},r.prototype.handleMouseMove=function(t){if(0!=this._mouseButtonMask&&(this._clientX!=t.clientX||this._clientY!=t._clientY)){var e=t.clientX-this._clientStartX,i=t.clientY-this._clientStartY,r=this._translationWeight;this._clientX=t.clientX,this._clientY=t.clientY,this._translationX=this._translationX*(1-r)+e*r,this._translationY=this._translationY*(1-r)+i*r,this.mouseMove(t)}},r.prototype.handleMouseUp=function(t){var e=1<<t.button;e&0==this._mouseButtonMask||(this._mouseButtonMask&=~e,this.mouseUp(t),0==this._mouseButtonMask&&this.resetIfEventsEnded())},r.prototype.handleTouchStart=function(t){var e=new i(t.identifier||t.pointerId,t.clientX,t.clientY);this._touches.push(e),1==this._touches.length?(this._clientX=t.clientX,this._clientY=t.clientY,this._clientStartX=t.clientX,this._clientStartY=t.clientY,this._translationX=0,this._translationY=0,this._touchCentroidShiftX=0,this._touchCentroidShiftY=0):this.touchesAddedOrRemoved(),this.touchStart(e)},r.prototype.handleTouchMove=function(t){var e=this.indexOfTouchWithId(t.identifier||t.pointerId);if(e!=-1){var i=this._touches[e];if(i.clientX!=t.clientX||i.clientY!=t.clientY){i.clientX=t.clientX,i.clientY=t.clientY;var r=this.touchCentroid(),n=r.clientX-this._clientStartX+this._touchCentroidShiftX,o=r.clientY-this._clientStartY+this._touchCentroidShiftY,s=this._translationWeight;this._clientX=r.clientX,this._clientY=r.clientY,this._translationX=this._translationX*(1-s)+n*s,this._translationY=this._translationY*(1-s)+o*s,this.touchMove(i)}}},r.prototype.handleTouchCancel=function(t){var e=this.indexOfTouchWithId(t.identifier||t.pointerId);if(e!=-1){var i=this._touches[e];this._touches.splice(e,1),this.touchesAddedOrRemoved(),this.touchCancel(i),this.resetIfEventsEnded()}},r.prototype.handleTouchEnd=function(t){var e=this.indexOfTouchWithId(t.identifier||t.pointerId);if(e!=-1){var i=this._touches[e];this._touches.splice(e,1),this.touchesAddedOrRemoved(),this.touchEnd(i),this.resetIfEventsEnded()}},r.prototype.resetIfEventsEnded=function(){this._state!=WorldWind.POSSIBLE&&0==this._mouseButtonMask&&0==this._touches.length&&this.reset()},r.prototype.touchesAddedOrRemoved=function(){this._touchCentroidShiftX+=this._clientX,this._touchCentroidShiftY+=this._clientY;var t=this.touchCentroid();this._clientX=t.clientX,this._clientY=t.clientY,this._touchCentroidShiftX-=this._clientX,this._touchCentroidShiftY-=this._clientY},r.prototype.touchCentroid=function(){for(var t=0,e=0,i=0,r=this._touches.length;i<r;i++){var n=this._touches[i];t+=n.clientX/r,e+=n.clientY/r}return{clientX:t,clientY:e}},r.prototype.indexOfTouchWithId=function(t){for(var e=0,i=this._touches.length;e<i;e++)if(this._touches[e].identifier==t)return e;return-1},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[],n=function(){"use strict";var t=function(t,e,i){this.identifier=t,this._clientX=e,this._clientY=i,this._clientStartX=e,this._clientStartY=i};return Object.defineProperties(t.prototype,{clientX:{get:function(){return this._clientX},set:function(t){this._clientX=t}},clientY:{get:function(){return this._clientY},set:function(t){this._clientY=t}},translationX:{get:function(){return this._clientX-this._clientStartX},set:function(t){this._clientStartX=this._clientX-t}},translationY:{get:function(){return this._clientY-this._clientStartY},set:function(t){this._clientStartY=this._clientY-t}}}),t}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=i(31);t.exports={ON_SCREEN_LOG:"on-screen-log",SHOW_WIZARD:"show-wizard",WIZARD_RESULT:"wizard-result",DELETE_MODE:"delete-mode",BLOCK_NAVIGATION:"block-navigation",SHOW_CONTEXT_MENU:"show-context-menu",START_DRAWING:"start-drawing",END_DRAWING:"end-drawing",SET_DRAW_MODE:"set-draw-mode",DRAW_MODE_CHANGED:"draw-mode-changed",
CHANGE_SPACE:"change-space",WAIT:"wait",TOOLTIP:"tooltip",NAVIGATOR_STATE_CHANGED:"navigator-state-changed",LOCATION_CHANGED:"location-changed",OBJECT_MOUSE_OVER:"object-mouse-over",OBJECT_MOUSE_CLICK:"object-mouse-click",CREATE_LAYER:"create-layer",CLEAR_LAYER:"clear-layer",HAS_LAYER:"has-layer",SET_LAYER_PROPERTY:"set-layer-property",GET_LAYER_CONTENTS:"get-layer-contents",DESTROY_LAYER:"destroy-layer",CREATE_GEO_JSON_OBJECT:"create-geo-json-object",CREATE_MODEL:"create-model",CREATE_ELLIPSE:"create-ellipse",CREATE_TEXT:"create-text",CREATE_BILLBOARD:"create-billboard",CREATE_FORM:"create-form",CREATE_BUTTON:"create-button",CREATE_BASE_LAYER_PICKER:"create-base-layer-picker",DESTROY_BASE_LAYER_PICKER:"destroy-base-layer-picker",GET_MAPS_KEYS:"get-maps-keys",GET_ELEVATIONS_KEYS:"get-elevations-keys",SET_ACTIVE_MAP:"set-active-map",SET_ACTIVE_ELEVATION:"set-active-elevation",CONTROLS:"controls",ROTATE_TO:"rotate-to",SET_LOCATION:"set-location",REDRAW:"redraw",SWITCH_GLOBE:"switch-globe",SWITCH_ATMOSPHERE:"switch-atmosphere",SWITCH_ATMOSPHERE_GROUND:"switch-atmosphere-ground",SWITCH_ATMOSPHERE_NIGHT:"switch-atmosphere-night",SWITCH_COMPASS:"switch-compass-gl",SWITCH_COMPASS_SVG:"switch-compass-svg",SWITCH_CONTROLS:"switch-controls",SWITCH_2D_PROJECTION:"switch-2d-projection",EDIT_OBJECT:"edit-object",DESTROY_OBJECT:"destroy-object",SEARCH_OBJECT:"search-object",GET_OBJECT:"get-object",GET_OBJECT_GEOMETRY:"get-object-geometry",GET_OBJECT_PROPERTIES:"get-object-properties",GET_OBJECT_PROPERTY:"get-object-property",SET_OBJECT_PROPERTIES:"set-object-properties",SET_OBJECT_GEOMETRY:"set-object-geometry",SHOW_FORM:"show-form",HIDE_FORM:"hide-form",TOGGLE_FORM:"toggle-form",FORM_BUTTON_GROUP_STATE_CHANGED:"form-button-group-state-changed",CHANGE_MAP:"change-map",CHANGE_ELEVATION_MODEL:"change-elevation-model",GET_OGC_LAYERS:"get-ogc-layers",_CHANGE_ELEVATION_MODEL:"inner-change-elevation-model",_CREATE_GROUND_MAP_LAYER:"inner-create-ground-map-layer",_DESTROY_GROUND_MAP_LAYER:"inner-destroy-ground-map-layer",_CREATE_WMS_MAP_LAYER:"inner-create-wms-map-layer",_CREATE_WMTS_MAP_LAYER:"inner-create-wmts-map-layer",_CREATE_TILE_MAP_LAYER:"inner-create-tile-map-layer",_DESTROY_MAP_LAYER:"inner-destroy-map-layer",_REQUEST_PICK:"inner-request-pick",_ADD_LAYER:"inner-add-layer",_REMOVE_LAYER:"inner-remove-layer",_INSERT_LAYER:"inner-insert-layer",_EDIT_OBJECT:"inner-edit-object",_BLOCK_NAVIGATOR_EVENTS_LISTENERS:"inner-block-navigator-events-listeners",_BLOCK_TILE_LOADING:"inner-block-tile-loading",_DISTANCE_FIELD_SETTINGS:"inner-distance-fields-settings",_ANCHOR_POINTS_COUNT:"inner-anchor-points-count",_FORCE_END_DRAWING:"inner-force-end-drawing",_GET_LAYER:"inner-get-layer",_SHOW_SEARCH_RESULT:"inner-show-search-result",_HIGHLIGHT_FOUND:"inner-highlight-found"},t.exports.post=r.post,t.exports.listen=r.listen},function(t,e){function i(t,e){var i=[];return n[t]&&n[t].forEach(function(t){try{i.push(t(e))}catch(t){console.error(t)}}),1===i.length?i[0]:i}function r(t,e){n[t]||(n[t]=[]),n[t].push(e)}var n={};t.exports={post:i,listen:r}},function(t,e,i){var r=i(33),n=i(12),o=i(36);r.prototype.currentState=function(){this.applyLimits();var t=this.worldWindow.globe,e=t.elevationAtLocation(this.lookAtLocation.latitude,this.lookAtLocation.longitude),i=new n(this.lookAtLocation.latitude,this.lookAtLocation.longitude,e),r=o.fromIdentity();return r.multiplyByLookAtModelview(i,this.range,this.heading,this.tilt,this.roll,t),this.currentStateForModelview(r)},r.prototype.handlePanOrDrag=function(t){this.handlePanOrDrag3D(t)}},function(t,e,i){var r,n;r=[i(13),i(40),i(35),i(28),i(16),i(14),i(8),i(36),i(37),i(34),i(41),i(12),i(42),i(43),i(7),i(11),i(17)],n=function(t,e,i,r,n,o,s,a,l,h,c,u,d,p,f,g,m){"use strict";var E=function(t){function i(t){t.preventDefault()}l.call(this,t),t.addEventListener("mousedown",i),t.addEventListener("touchstart",i),t.addEventListener("contextmenu",i),t.addEventListener("wheel",i),window.PointerEvent&&t.canvas.style.setProperty("touch-action","none"),this.lookAtLocation=new o(30,-110),this.range=1e7,this.enable2DLimits=!0;var r=this;this.primaryDragRecognizer=new e(t,function(t){r.handlePanOrDrag(t)}),this.secondaryDragRecognizer=new e(t,function(t){r.handleSecondaryDrag(t)}),this.secondaryDragRecognizer.button=2,this.panRecognizer=new h(t,function(t){r.handlePanOrDrag(t)}),this.pinchRecognizer=new c(t,function(t){r.handlePinch(t)}),this.rotationRecognizer=new d(t,function(t){r.handleRotation(t)}),this.tiltRecognizer=new p(t,function(t){r.handleTilt(t)}),t.addEventListener("wheel",function(t){r.handleWheelEvent(t)}),this.panRecognizer.recognizeSimultaneouslyWith(this.pinchRecognizer),this.panRecognizer.recognizeSimultaneouslyWith(this.rotationRecognizer),this.pinchRecognizer.recognizeSimultaneouslyWith(this.rotationRecognizer),this.panRecognizer.requireRecognizerToFail(this.tiltRecognizer),this.pinchRecognizer.requireRecognizerToFail(this.tiltRecognizer),this.rotationRecognizer.requireRecognizerToFail(this.tiltRecognizer),this.beginPoint=new f(0,0),this.lastPoint=new f(0,0),this.beginHeading=0,this.beginTilt=0,this.beginRange=0,this.lastRotation=0};return E.prototype=Object.create(l.prototype),E.prototype.currentState=function(){this.applyLimits();var t=this.worldWindow.globe,e=new u(this.lookAtLocation.latitude,this.lookAtLocation.longitude,0),i=a.fromIdentity();return i.multiplyByLookAtModelview(e,this.range,this.heading,this.tilt,this.roll,t),this.currentStateForModelview(i)},E.prototype.handlePanOrDrag=function(t){this.worldWindow.globe.is2D()?this.handlePanOrDrag2D(t):this.handlePanOrDrag3D(t)},E.prototype.handlePanOrDrag3D=function(e){var i=e.state,r=e.translationX,n=e.translationY;if(i==WorldWind.BEGAN)this.lastPoint.set(0,0);else if(i==WorldWind.CHANGED){var o=this.worldWindow.canvas,s=this.worldWindow.globe,a=m.max(s.equatorialRadius,s.polarRadius),l=m.max(1,this.range),h=m.perspectivePixelSize(o.clientWidth,o.clientHeight,l),c=(n-this.lastPoint[1])*h,u=-(r-this.lastPoint[0])*h,d=c/a*t.RADIANS_TO_DEGREES,p=u/a*t.RADIANS_TO_DEGREES,f=Math.sin(this.heading*t.DEGREES_TO_RADIANS),g=Math.cos(this.heading*t.DEGREES_TO_RADIANS);this.lookAtLocation.latitude+=d*g-p*f,this.lookAtLocation.longitude+=d*f+p*g,this.lastPoint.set(r,n),this.applyLimits(),this.worldWindow.redraw()}},E.prototype.handlePanOrDrag2D=function(t){var e=t.state,i=t.clientX,r=t.clientY,n=t.translationX,o=t.translationY;if(e==WorldWind.BEGAN)this.beginPoint.set(i,r),this.lastPoint.set(i,r);else if(e==WorldWind.CHANGED){var s=this.lastPoint[0],l=this.lastPoint[1],h=this.beginPoint[0]+n,c=this.beginPoint[1]+o;this.lastPoint.set(h,c);var u=this.currentState(),d=this.worldWindow.globe,p=u.rayFromScreenPoint(this.worldWindow.canvasCoordinates(s,l)),f=new g(0,0,0),m=new g(0,0,0),E=new g(0,0,0);if(!d.intersectsLine(p,f))return;if(p=u.rayFromScreenPoint(this.worldWindow.canvasCoordinates(h,c)),!d.intersectsLine(p,m))return;var v=a.fromIdentity();if(v.copy(u.modelview),v.multiplyByTranslation(m[0]-f[0],m[1]-f[1],m[2]-f[2]),v.extractEyePoint(p.origin),v.extractForwardVector(p.direction),!d.intersectsLine(p,E))return;var y=v.extractViewingParameters(E,this.roll,d,{});this.lookAtLocation.copy(y.origin),this.range=y.range,this.heading=y.heading,this.tilt=y.tilt,this.roll=y.roll,this.applyLimits(),this.worldWindow.redraw()}},E.prototype.handleSecondaryDrag=function(t){var e=t.state,i=t.translationX,r=t.translationY;if(e==WorldWind.BEGAN)this.beginHeading=this.heading,this.beginTilt=this.tilt;else if(e==WorldWind.CHANGED){var n=180*i/this.worldWindow.canvas.clientWidth,o=90*r/this.worldWindow.canvas.clientHeight;this.heading=this.beginHeading+n,this.tilt=this.beginTilt+o,this.applyLimits(),this.worldWindow.redraw()}},E.prototype.handlePinch=function(t){var e=t.state,i=t.scale;e==WorldWind.BEGAN?this.beginRange=this.range:e==WorldWind.CHANGED&&0!=i&&(this.range=this.beginRange/i,this.applyLimits(),this.worldWindow.redraw())},E.prototype.handleRotation=function(t){var e=t.state,i=t.rotation;e==WorldWind.BEGAN?this.lastRotation=0:e==WorldWind.CHANGED&&(this.heading-=i-this.lastRotation,this.lastRotation=i,this.applyLimits(),this.worldWindow.redraw())},E.prototype.handleTilt=function(t){var e=t.state,i=t.translationY;if(e==WorldWind.BEGAN)this.beginTilt=this.tilt;else if(e==WorldWind.CHANGED){var r=-90*i/this.worldWindow.canvas.clientHeight;this.tilt=this.beginTilt+r,this.applyLimits(),this.worldWindow.redraw()}},E.prototype.handleWheelEvent=function(t){var e;t.deltaMode==WheelEvent.DOM_DELTA_PIXEL?e=t.deltaY:t.deltaMode==WheelEvent.DOM_DELTA_LINE?e=40*t.deltaY:t.deltaMode==WheelEvent.DOM_DELTA_PAGE&&(e=400*t.deltaY);var i=1+e/1e3;this.range*=i,this.applyLimits(),this.worldWindow.redraw()},E.prototype.applyLimits=function(){if(this.lookAtLocation.latitude=m.clamp(this.lookAtLocation.latitude,-90,90),this.lookAtLocation.longitude=t.normalizedDegreesLongitude(this.lookAtLocation.longitude),this.range=m.clamp(this.range,1,Number.MAX_VALUE),this.heading=t.normalizedDegrees(this.heading),this.tilt=m.clamp(this.tilt,0,90),this.roll=t.normalizedDegrees(this.roll),this.worldWindow.globe.is2D()&&this.enable2DLimits){var e=2*Math.PI*this.worldWindow.globe.equatorialRadius;this.range=m.clamp(this.range,1,e),this.tilt=0}},E}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(28)],n=function(t){"use strict";var e=function(e,i){t.call(this,e,i),this.minNumberOfTouches=1,this.maxNumberOfTouches=Number.MAX_VALUE,this.interpretDistance=20};return e.prototype=Object.create(t.prototype),e.prototype.mouseDown=function(t){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},e.prototype.touchMove=function(t){this.state==WorldWind.POSSIBLE?this.shouldInterpret()&&(this.shouldRecognize()?this.state=WorldWind.BEGAN:this.state=WorldWind.FAILED):this.state!=WorldWind.BEGAN&&this.state!=WorldWind.CHANGED||(this.state=WorldWind.CHANGED)},e.prototype.touchEnd=function(t){0==this.touchCount&&(this.state==WorldWind.POSSIBLE?this.state=WorldWind.FAILED:this.state!=WorldWind.BEGAN&&this.state!=WorldWind.CHANGED||(this.state=WorldWind.ENDED))},e.prototype.touchCancel=function(t){0==this.touchCount&&(this.state==WorldWind.POSSIBLE?this.state=WorldWind.FAILED:this.state!=WorldWind.BEGAN&&this.state!=WorldWind.CHANGED||(this.state=WorldWind.CANCELLED))},e.prototype.prepareToRecognize=function(){this.translationX=0,this.translationY=0},e.prototype.shouldInterpret=function(){var t=this.translationX,e=this.translationY,i=Math.sqrt(t*t+e*e);return i>this.interpretDistance},e.prototype.shouldRecognize=function(){var t=this.touchCount;return 0!=t&&t>=this.minNumberOfTouches&&t<=this.maxNumberOfTouches},e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(36),i(15),i(8)],n=function(t,e,i,r){"use strict";var n=function(e,i,n,o,s,a){if(!(e&&i&&n&&o&&s&&a))throw new t(r.logMessage(r.LEVEL_SEVERE,"Frustum","constructor","missingPlane"));this._left=e,this._right=i,this._bottom=n,this._top=o,this._near=s,this._far=a,this._planes=[this._left,this._right,this._top,this._bottom,this._near,this._far]};return Object.defineProperties(n.prototype,{left:{get:function(){return this._left}},right:{get:function(){return this._right}},bottom:{get:function(){return this._bottom}},top:{get:function(){return this._top}},near:{get:function(){return this._near}},far:{get:function(){return this._far}}}),n.prototype.transformByMatrix=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Frustum","transformByMatrix","missingMatrix"));return this._left.transformByMatrix(e),this._right.transformByMatrix(e),this._bottom.transformByMatrix(e),this._top.transformByMatrix(e),this._near.transformByMatrix(e),this._far.transformByMatrix(e),this},n.prototype.normalize=function(){return this._left.normalize(),this._right.normalize(),this._bottom.normalize(),this._top.normalize(),this._near.normalize(),this._far.normalize(),this},n.unitFrustum=function(){return new n(new i(1,0,0,1),new i(-1,0,0,1),new i(0,1,1,1),new i(0,-1,0,1),new i(0,0,-1,1),new i(0,0,1,1))},n.fromProjectionMatrix=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Frustum","fromProjectionMatrix","missingMatrix"));var o,s,a,l,h,c,u,d,p,f,g;return o=e[12]+e[0],s=e[13]+e[1],a=e[14]+e[2],l=e[15]+e[3],h=Math.sqrt(o*o+s*s+a*a),c=new i(o/h,s/h,a/h,l/h),o=e[12]-e[0],s=e[13]-e[1],a=e[14]-e[2],l=e[15]-e[3],h=Math.sqrt(o*o+s*s+a*a),u=new i(o/h,s/h,a/h,l/h),o=e[12]+e[4],s=e[13]+e[5],a=e[14]+e[6],l=e[15]+e[7],h=Math.sqrt(o*o+s*s+a*a),p=new i(o/h,s/h,a/h,l/h),o=e[12]-e[4],s=e[13]-e[5],a=e[14]-e[6],l=e[15]-e[7],h=Math.sqrt(o*o+s*s+a*a),d=new i(o/h,s/h,a/h,l/h),o=e[12]+e[8],s=e[13]+e[9],a=e[14]+e[10],l=e[15]+e[11],h=Math.sqrt(o*o+s*s+a*a),f=new i(o/h,s/h,a/h,l/h),o=e[12]-e[8],s=e[13]-e[9],a=e[14]-e[10],l=e[15]-e[11],h=Math.sqrt(o*o+s*s+a*a),g=new i(o/h,s/h,a/h,l/h),new n(c,u,p,d,f,g)},n.prototype.containsPoint=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Frustum","containsPoint","missingPoint"));return!(this._far.dot(e)<=0)&&(!(this._left.dot(e)<=0)&&(!(this._right.dot(e)<=0)&&(!(this._top.dot(e)<=0)&&(!(this._bottom.dot(e)<=0)&&!(this._near.dot(e)<=0)))))},n.prototype.intersectsSegment=function(e,i){if(!e||!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"Frustum","containsPoint","missingPoint"));if(this.containsPoint(e)||this.containsPoint(i))return!0;if(e.equals(i))return!1;for(var n=0,o=this._planes.length;n<o;n++){if(this._planes[n].onSameSide(e,i)<0)return!1;if(null!=this._planes[n].clip(e,i))return!0}return!1},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(13),i(9),i(8),i(15),i(12),i(18),i(25),i(11),i(17)],n=function(t,e,i,r,n,o,s,a,l){"use strict";var h=function(t,e,i,r,n,o,s,a,l,h,c,u,d,p,f,g){this[0]=t,this[1]=e,this[2]=i,this[3]=r,this[4]=n,this[5]=o,this[6]=s,this[7]=a,this[8]=l,this[9]=h,this[10]=c,this[11]=u,this[12]=d,this[13]=p,this[14]=f,this[15]=g};return h.prototype=new Float64Array(16),h.fromIdentity=function(){return new h(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},h.principalAxesFromPoints=function(t,r,n,o){if(!t||t.length<1)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","principalAxesFromPoints","missingPoints"));if(!r||!n||!o)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","principalAxesFromPoints","An axis argument is null or undefined."));var s=h.fromIdentity();s.setToCovarianceOfPoints(t),s.eigensystemFromSymmetricMatrix(r,n,o),r.normalize(),n.normalize(),o.normalize()},h.prototype.set=function(t,e,i,r,n,o,s,a,l,h,c,u,d,p,f,g){return this[0]=t,this[1]=e,this[2]=i,this[3]=r,this[4]=n,this[5]=o,this[6]=s,this[7]=a,this[8]=l,this[9]=h,this[10]=c,this[11]=u,this[12]=d,this[13]=p,this[14]=f,this[15]=g,this},h.prototype.setToIdentity=function(){this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=1,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1},h.prototype.copy=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","copy","missingMatrix"));this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15]},h.prototype.equals=function(t){return t&&this[0]==t[0]&&this[1]==t[1]&&this[2]==t[2]&&this[3]==t[3]&&this[4]==t[4]&&this[5]==t[5]&&this[6]==t[6]&&this[7]==t[7]&&this[8]==t[8]&&this[9]==t[9]&&this[10]==t[10]&&this[11]==t[11]&&this[12]==t[12]&&this[13]==t[13]&&this[14]==t[14]&&this[15]==t[15]},h.prototype.columnMajorComponents=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","columnMajorComponents","missingResult"));return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t},h.prototype.setToTranslation=function(t,e,i){return this[0]=1,this[1]=0,this[2]=0,this[3]=t,this[4]=0,this[5]=1,this[6]=0,this[7]=e,this[8]=0,this[9]=0,this[10]=1,this[11]=i,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},h.prototype.setTranslation=function(t,e,i){return this[3]=t,this[7]=e,this[11]=i,this},h.prototype.setToScale=function(t,e,i){return this[0]=t,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=e,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=i,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},h.prototype.setScale=function(t,e,i){return this[0]=t,this[5]=e,this[10]=i,this},h.prototype.setToTransposeOfMatrix=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToTransposeOfMatrix","missingMatrix"));return this[0]=t[0],this[1]=t[4],this[2]=t[8],this[3]=t[12],this[4]=t[1],this[5]=t[5],this[6]=t[9],this[7]=t[13],this[8]=t[2],this[9]=t[6],this[10]=t[10],this[11]=t[14],this[12]=t[3],this[13]=t[7],this[14]=t[11],this[15]=t[15],this},h.prototype.setToMultiply=function(t,r){if(!t||!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToMultiply","missingMatrix"));var n=t,o=r;return this[0]=n[0]*o[0]+n[1]*o[4]+n[2]*o[8]+n[3]*o[12],this[1]=n[0]*o[1]+n[1]*o[5]+n[2]*o[9]+n[3]*o[13],this[2]=n[0]*o[2]+n[1]*o[6]+n[2]*o[10]+n[3]*o[14],this[3]=n[0]*o[3]+n[1]*o[7]+n[2]*o[11]+n[3]*o[15],this[4]=n[4]*o[0]+n[5]*o[4]+n[6]*o[8]+n[7]*o[12],this[5]=n[4]*o[1]+n[5]*o[5]+n[6]*o[9]+n[7]*o[13],this[6]=n[4]*o[2]+n[5]*o[6]+n[6]*o[10]+n[7]*o[14],this[7]=n[4]*o[3]+n[5]*o[7]+n[6]*o[11]+n[7]*o[15],this[8]=n[8]*o[0]+n[9]*o[4]+n[10]*o[8]+n[11]*o[12],this[9]=n[8]*o[1]+n[9]*o[5]+n[10]*o[9]+n[11]*o[13],this[10]=n[8]*o[2]+n[9]*o[6]+n[10]*o[10]+n[11]*o[14],this[11]=n[8]*o[3]+n[9]*o[7]+n[10]*o[11]+n[11]*o[15],this[12]=n[12]*o[0]+n[13]*o[4]+n[14]*o[8]+n[15]*o[12],this[13]=n[12]*o[1]+n[13]*o[5]+n[14]*o[9]+n[15]*o[13],this[14]=n[12]*o[2]+n[13]*o[6]+n[14]*o[10]+n[15]*o[14],this[15]=n[12]*o[3]+n[13]*o[7]+n[14]*o[11]+n[15]*o[15],this},h.prototype.setToCovarianceOfPoints=function(t){if(!t||t.length<1)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToCovarianceOfPoints","missingArray"));var r,n,o,s,l=0,h=0,c=0,u=0,d=0,p=0,f=0,g=new a(0,0,0);r=a.averageOfBuffer(t,new a(0,0,0));for(var m=0,E=t.length/3;m<E;m++)g[0]=t[3*m],g[1]=t[3*m+1],g[2]=t[3*m+2],n=g[0]-r[0],o=g[1]-r[1],s=g[2]-r[2],++l,h+=n*n,c+=o*o,u+=s*s,d+=n*o,p+=n*s,f+=o*s;return this[0]=h/l,this[1]=d/l,this[2]=p/l,this[3]=0,this[4]=d/l,this[5]=c/l,this[6]=f/l,this[7]=0,this[8]=p/l,this[9]=f/l,this[10]=u/l,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=0,this},h.prototype.multiplyByTranslation=function(t,e,i){return this.multiply(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},h.prototype.multiplyByRotation=function(e,i,r,n){var o=Math.cos(n*t.DEGREES_TO_RADIANS),s=Math.sin(n*t.DEGREES_TO_RADIANS);return this.multiply(o+(1-o)*e*e,(1-o)*e*i-s*r,(1-o)*e*r+s*i,0,(1-o)*e*i+s*r,o+(1-o)*i*i,(1-o)*i*r-s*e,0,(1-o)*e*r-s*i,(1-o)*i*r+s*e,o+(1-o)*r*r,0,0,0,0,1),this},h.prototype.multiplyByScale=function(t,e,i){return this.multiply(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},h.prototype.setToUnitYFlip=function(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=-1,this[6]=0,this[7]=1,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},h.prototype.multiplyByLocalCoordinateTransform=function(t,r){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByLocalCoordinateTransform","Origin vector is null or undefined"));if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByLocalCoordinateTransform","missingGlobe"));var n=new a(0,0,0),o=new a(0,0,0),s=new a(0,0,0);return l.localCoordinateAxesAtPoint(t,r,n,o,s),this.multiply(n[0],o[0],s[0],t[0],n[1],o[1],s[1],t[1],n[2],o[2],s[2],t[2],0,0,0,1),this},h.prototype.multiplyByTextureTransform=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByTextureTransform","missingTexture"));var r=t.originalImageWidth/t.imageWidth,n=t.originalImageHeight/t.imageHeight;return this.multiply(r,0,0,0,0,-n,0,n,0,0,1,0,0,0,0,1),this},h.prototype.extractTranslation=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","extractTranslation","missingResult"));return t[0]=this[3],t[1]=this[7],t[2]=this[11],t},h.prototype.extractRotationAngles=function(r){if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","extractRotationAngles","missingResult"));var n=Math.atan2(this[6],this[10]),o=Math.atan2(-this[2],Math.sqrt(this[0]*this[0]+this[1]*this[1])),s=Math.cos(n),a=Math.sin(n),l=Math.atan2(a*this[8]-s*this[4],s*this[5]-a*this[9]);return r[0]=n*t.RADIANS_TO_DEGREES,r[1]=o*t.RADIANS_TO_DEGREES,r[2]=l*t.RADIANS_TO_DEGREES,r},h.prototype.multiplyByFirstPersonModelview=function(r,n,o,s,h){if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByFirstPersonModelview","missingPosition"));if(!h)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByFirstPersonModelview","missingGlobe"));var c,u,d,p,f,g,m,E,v,y,_,T,L,x,b=new a(0,0,0),S=new a(0,0,0),w=new a(0,0,0),M=new a(0,0,0);return c=Math.cos(s*t.DEGREES_TO_RADIANS),u=Math.sin(s*t.DEGREES_TO_RADIANS),this.multiply(c,u,0,0,-u,c,0,0,0,0,1,0,0,0,0,1),c=Math.cos(o*t.DEGREES_TO_RADIANS),u=Math.sin(o*t.DEGREES_TO_RADIANS),this.multiply(1,0,0,0,0,c,u,0,0,-u,c,0,0,0,0,1),c=Math.cos(n*t.DEGREES_TO_RADIANS),u=Math.sin(n*t.DEGREES_TO_RADIANS),this.multiply(c,-u,0,0,u,c,0,0,0,0,1,0,0,0,0,1),h.computePointFromPosition(r.latitude,r.longitude,r.altitude,b),d=b[0],p=b[1],f=b[2],l.localCoordinateAxesAtPoint(b,h,S,w,M),g=S[0],m=S[1],E=S[2],v=w[0],y=w[1],_=w[2],T=M[0],L=M[1],x=M[2],this.multiply(g,m,E,-g*d-m*p-E*f,v,y,_,-v*d-y*p-_*f,T,L,x,-T*d-L*p-x*f,0,0,0,1),this},h.prototype.multiplyByLookAtModelview=function(t,r,n,o,s,a){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByLookAtModelview","missingPosition"));if(r<0)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByLookAtModelview","Range is less than zero"));if(!a)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByLookAtModelview","missingGlobe"));return this.multiplyByTranslation(0,0,-r),this.multiplyByFirstPersonModelview(t,n,o,s,a),this},h.prototype.setToPerspectiveProjection=function(t,r,n,o){if(t<=0)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","invalidWidth"));if(r<=0)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","invalidHeight"));if(n===o)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","Near and far distance are the same."));if(n<=0||o<=0)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","Near or far distance is less than or equal to zero."));var s=l.perspectiveFrustumRectangle(t,r,n),a=s.getMinX(),h=s.getMaxX(),c=s.getMinY(),u=s.getMaxY();return this[0]=2*n/(h-a),this[1]=0,this[2]=(h+a)/(h-a),this[3]=0,this[4]=0,this[5]=2*n/(u-c),this[6]=(u+c)/(u-c),this[7]=0,this[8]=0,this[9]=0,this[10]=-(o+n)/(o-n),this[11]=-2*n*o/(o-n),this[12]=0,this[13]=0,this[14]=-1,this[15]=0,this},h.prototype.setToScreenProjection=function(t,r){if(t<=0)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToScreenProjection","invalidWidth"));if(r<=0)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToScreenProjection","invalidHeight"));return this[0]=2/t,this[1]=0,this[2]=0,this[3]=-1,this[4]=0,this[5]=2/r,this[6]=0,this[7]=-1,this[8]=0,this[9]=0,this[10]=2,this[11]=-1,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},h.prototype.extractEyePoint=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","extractEyePoint","missingResult"));return t[0]=-(this[0]*this[3])-this[4]*this[7]-this[8]*this[11],t[1]=-(this[1]*this[3])-this[5]*this[7]-this[9]*this[11],t[2]=-(this[2]*this[3])-this[6]*this[7]-this[10]*this[11],t},h.prototype.extractForwardVector=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","extractForwardVector","missingResult"));return t[0]=-this[8],t[1]=-this[9],t[2]=-this[10],t},h.prototype.extractViewingParameters=function(r,o,s,a){if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","extractViewingParameters","The specified origin is null or undefined."));if(!s)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","extractViewingParameters","missingGlobe"));if(!a)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","extractViewingParameters","missingResult"));var l,c,u,d,p,f,g,m,E,v=new n(0,0,0),y=h.fromIdentity();return s.computePositionFromPoint(r[0],r[1],r[2],v),y.copy(this),y.multiplyByLocalCoordinateTransform(r,s),l=-y[11],c=y[10],u=Math.sqrt(y[2]*y[2]+y[6]*y[6]),d=Math.atan2(u,c)*t.RADIANS_TO_DEGREES,p=Math.cos(o*t.DEGREES_TO_RADIANS),f=Math.sin(o*t.DEGREES_TO_RADIANS),g=p*y[0]-f*y[4],m=f*y[5]-p*y[1],E=Math.atan2(m,g)*t.RADIANS_TO_DEGREES,a.origin=v,a.range=l,a.heading=E,a.tilt=d,a.roll=o,a},h.prototype.offsetProjectionDepth=function(t){return this[10]*=1+t,this},h.prototype.multiplyMatrix=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyMatrix","missingMatrix"));var r,n,o,s,a=this,l=t;return r=a[0],n=a[1],o=a[2],s=a[3],a[0]=r*l[0]+n*l[4]+o*l[8]+s*l[12],a[1]=r*l[1]+n*l[5]+o*l[9]+s*l[13],a[2]=r*l[2]+n*l[6]+o*l[10]+s*l[14],a[3]=r*l[3]+n*l[7]+o*l[11]+s*l[15],r=a[4],n=a[5],o=a[6],s=a[7],a[4]=r*l[0]+n*l[4]+o*l[8]+s*l[12],a[5]=r*l[1]+n*l[5]+o*l[9]+s*l[13],a[6]=r*l[2]+n*l[6]+o*l[10]+s*l[14],a[7]=r*l[3]+n*l[7]+o*l[11]+s*l[15],r=a[8],n=a[9],o=a[10],s=a[11],a[8]=r*l[0]+n*l[4]+o*l[8]+s*l[12],a[9]=r*l[1]+n*l[5]+o*l[9]+s*l[13],a[10]=r*l[2]+n*l[6]+o*l[10]+s*l[14],a[11]=r*l[3]+n*l[7]+o*l[11]+s*l[15],r=a[12],n=a[13],o=a[14],s=a[15],a[12]=r*l[0]+n*l[4]+o*l[8]+s*l[12],a[13]=r*l[1]+n*l[5]+o*l[9]+s*l[13],a[14]=r*l[2]+n*l[6]+o*l[10]+s*l[14],a[15]=r*l[3]+n*l[7]+o*l[11]+s*l[15],this},h.prototype.multiply=function(t,e,i,r,n,o,s,a,l,h,c,u,d,p,f,g){var m,E,v,y,_=this;return m=_[0],E=_[1],v=_[2],y=_[3],_[0]=m*t+E*n+v*l+y*d,_[1]=m*e+E*o+v*h+y*p,_[2]=m*i+E*s+v*c+y*f,_[3]=m*r+E*a+v*u+y*g,m=_[4],E=_[5],v=_[6],y=_[7],_[4]=m*t+E*n+v*l+y*d,_[5]=m*e+E*o+v*h+y*p,_[6]=m*i+E*s+v*c+y*f,_[7]=m*r+E*a+v*u+y*g,m=_[8],E=_[9],v=_[10],y=_[11],_[8]=m*t+E*n+v*l+y*d,_[9]=m*e+E*o+v*h+y*p,_[10]=m*i+E*s+v*c+y*f,_[11]=m*r+E*a+v*u+y*g,m=_[12],E=_[13],v=_[14],y=_[15],_[12]=m*t+E*n+v*l+y*d,_[13]=m*e+E*o+v*h+y*p,_[14]=m*i+E*s+v*c+y*f,_[15]=m*r+E*a+v*u+y*g,this},h.prototype.invertMatrix=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","invertMatrix","missingMatrix"));var r=[[],[],[],[]];r[0][0]=t[0],r[0][1]=t[1],r[0][2]=t[2],r[0][3]=t[3],r[1][0]=t[4],r[1][1]=t[5],r[1][2]=t[6],r[1][3]=t[7],r[2][0]=t[8],r[2][1]=t[9],r[2][2]=t[10],r[2][3]=t[11],r[3][0]=t[12],r[3][1]=t[13],r[3][2]=t[14],r[3][3]=t[15];var n,o,s=[],a=h.ludcmp(r,s);for(n=0;n<4;n+=1)a*=r[n][n];if(Math.abs(a)<1e-8)return null;var l=[[],[],[],[]],c=[];for(o=0;o<4;o+=1){for(n=0;n<4;n+=1)c[n]=0;for(c[o]=1,h.lubksb(r,s,c),n=0;n<4;n+=1)l[n][o]=c[n]}return this[0]=l[0][0],this[1]=l[0][1],this[2]=l[0][2],this[3]=l[0][3],this[4]=l[1][0],this[5]=l[1][1],this[6]=l[1][2],this[7]=l[1][3],this[8]=l[2][0],this[9]=l[2][1],this[10]=l[2][2],this[11]=l[2][3],this[12]=l[3][0],this[13]=l[3][1],this[14]=l[3][2],this[15]=l[3][3],this},h.lubksb=function(t,e,i){var r,n,o,s=-1;for(r=0;r<4;r+=1){var a=e[r];if(o=i[a],i[a]=i[r],s!=-1)for(n=s;n<=r-1;n+=1)o-=t[r][n]*i[n];else 0!=o&&(s=r);i[r]=o}for(r=3;r>=0;r-=1){for(o=i[r],n=r+1;n<4;n+=1)o-=t[r][n]*i[n];i[r]=o/t[r][r]}},h.ludcmp=function(t,e){var i,r,n,o,s,a,l,h,c=1e-20,u=[],d=1;for(r=0;r<4;r+=1){for(s=0,n=0;n<4;n+=1)(i=Math.abs(t[r][n]))>s&&(s=i);if(0==s)return 0;u[r]=1/s}for(n=0;n<4;n+=1){for(r=0;r<n;r+=1){for(a=t[r][n],o=0;o<r;o+=1)a-=t[r][o]*t[o][n];t[r][n]=a}for(s=0,l=-1,r=n;r<4;r+=1){for(a=t[r][n],o=0;o<n;o++)a-=t[r][o]*t[o][n];t[r][n]=a,(h=u[r]*Math.abs(a))>=s&&(s=h,l=r)}if(n!=l){for(o=0;o<4;o+=1)h=t[l][o],t[l][o]=t[n][o],t[n][o]=h;d=-d,u[l]=u[n]}if(e[n]=l,0==t[n][n]&&(t[n][n]=c),3!=n)for(h=1/t[n][n],r=n+1;r<4;r+=1)t[r][n]*=h}return d},h.prototype.invertOrthonormalMatrix=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","invertOrthonormalMatrix","missingMatrix"));var r=t;return this[0]=r[0],this[1]=r[4],this[2]=r[8],this[3]=0-r[0]*r[3]-r[4]*r[7]-r[8]*r[11],this[4]=r[1],this[5]=r[5],this[6]=r[9],this[7]=0-r[1]*r[3]-r[5]*r[7]-r[9]*r[11],this[8]=r[2],this[9]=r[6],this[10]=r[10],this[11]=0-r[2]*r[3]-r[6]*r[7]-r[10]*r[11],this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},h.prototype.eigensystemFromSymmetricMatrix=function(t,r,n){if(!t||!r||!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","eigensystemFromSymmetricMatrix","missingResult"));if(this[1]!=this[4]||this[2]!=this[8]||this[6]!=this[9])throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","eigensystemFromSymmetricMatrix","Matrix is not symmetric"));for(var o,s,a,h,c,u,d,p,f,g,m,E=1e-10,v=this[0],y=this[1],_=this[2],T=this[5],L=this[6],x=this[10],b=[[1,0,0],[0,1,0],[0,0,1]],S=32,w=0;w<S&&!(l.fabs(y)<E&&l.fabs(_)<E&&l.fabs(L)<E);w++){if(0!=y)for(o=.5*(T-v)/y,s=o*o,a=s+1,h=a!=s?(o<0?-1:1)*(Math.sqrt(a)-l.fabs(o)):.5/o,c=1/Math.sqrt(h*h+1),u=c*h,v-=h*y,T+=h*y,y=0,d=c*_-u*L,L=u*_+c*L,_=d,p=0;p<3;p++)d=c*b[p][0]-u*b[p][1],b[p][1]=u*b[p][0]+c*b[p][1],b[p][0]=d;if(0!=_)for(o=.5*(x-v)/_,s=o*o,a=s+1,h=a!=s?(o<0?-1:1)*(Math.sqrt(a)-l.fabs(o)):.5/o,c=1/Math.sqrt(h*h+1),u=c*h,v-=h*_,x+=h*_,_=0,d=c*y-u*L,L=u*y+c*L,y=d,p=0;p<3;p++)d=c*b[p][0]-u*b[p][2],b[p][2]=u*b[p][0]+c*b[p][2],b[p][0]=d;if(0!=L)for(o=.5*(x-T)/L,s=o*o,a=s+1,h=a!=s?(o<0?-1:1)*(Math.sqrt(a)-l.fabs(o)):.5/o,c=1/Math.sqrt(h*h+1),u=c*h,T-=h*L,x+=h*L,L=0,d=c*y-u*_,_=u*y+c*_,y=d,p=0;p<3;p++)d=c*b[p][1]-u*b[p][2],b[p][2]=u*b[p][1]+c*b[p][2],b[p][1]=d}f=0,g=1,m=2,v<T&&(d=v,v=T,T=d,d=f,f=g,g=d),T<x&&(d=T,T=x,x=d,d=g,g=m,m=d),v<T&&(d=v,v=T,T=d,d=f,f=g,g=d),t[0]=b[0][f],t[1]=b[1][f],t[2]=b[2][f],r[0]=b[0][g],r[1]=b[1][g],r[2]=b[2][g],n[0]=b[0][m],n[1]=b[1][m],n[2]=b[2][m],t.normalize(),r.normalize(),n.normalize(),t.multiply(v),r.multiply(T),n.multiply(x)},h.prototype.upper3By3=function(){var t=h.fromIdentity();return t[0]=this[0],t[1]=this[1],t[2]=this[2],t[4]=this[4],t[5]=this[5],t[6]=this[6],t[8]=this[8],t[9]=this[9],t[10]=this[10],t},h}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(36),i(38),i(12),i(39),i(11),i(17)],n=function(t,e,i,r,n,o,s,a){"use strict";var l=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"Navigator","constructor","missingWorldWindow"));this.worldWindow=i,this.heading=0,this.tilt=0,this.roll=0,this.nearDistance=1,this.farDistance=1e7};return l.prototype.currentState=function(){throw new o(e.logMessage(e.LEVEL_SEVERE,"Navigator","currentState","abstractInvocation"))},l.prototype.currentStateForModelview=function(o){if(!o)throw new t(e.logMessage(e.LEVEL_SEVERE,"Navigator","currentStateForModelview","missingMatrix"));var l,h,c=this.worldWindow.globe,u=a.max(c.equatorialRadius,c.polarRadius),d=o.extractEyePoint(new s(0,0,0)),p=c.computePositionFromPoint(d[0],d[1],d[2],new n(0,0,0)),f=this.worldWindow.viewport,g=this.worldWindow.depthBits,m=i.fromIdentity();return this.farDistance=a.horizonDistanceForGlobeRadius(u,p.altitude),this.farDistance+=1437568.7253136805,this.farDistance<1e3&&(this.farDistance=1e3),this.nearDistance=a.perspectiveNearDistanceForFarDistance(this.farDistance,10,g),l=p.altitude-c.elevationAtLocation(p.latitude,p.longitude),l>0&&(h=a.perspectiveNearDistance(f.width,f.height,l),this.nearDistance>h&&(this.nearDistance=h)),this.nearDistance<1&&(this.nearDistance=1),m.setToPerspectiveProjection(f.width,f.height,this.nearDistance,this.farDistance),new r(o,m,f,this.heading,this.tilt)},l}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(35),i(16),i(8),i(36),i(18),i(7),i(11),i(17)],n=function(t,e,i,r,n,o,s,a,l){"use strict";var h=function(t,i,r,o,s){this.modelview=t,this.projection=i,this.modelviewProjection=n.fromIdentity(),this.modelviewProjection.setToMultiply(i,t),this.viewport=r,this.heading=o,this.tilt=s,this.eyePoint=this.modelview.extractEyePoint(new a(0,0,0)),this.frustumInModelCoordinates=null;var h=n.fromIdentity();h.setToTransposeOfMatrix(this.modelview),this.frustumInModelCoordinates=e.fromProjectionMatrix(this.projection),this.frustumInModelCoordinates.transformByMatrix(h),this.frustumInModelCoordinates.normalize(),this.modelviewInv=n.fromIdentity(),
this.modelviewInv.invertOrthonormalMatrix(this.modelview),this.projectionInv=n.fromIdentity(),this.projectionInv.invertMatrix(this.projection),this.modelviewProjectionInv=n.fromIdentity(),this.modelviewProjectionInv.invertMatrix(this.modelviewProjection),this.modelviewNormalTransform=n.fromIdentity().setToTransposeOfMatrix(this.modelviewInv.upper3By3());var c=new a(-1,-1,-1),u=new a(1,1,-1),d=new a(-1,-1,1),p=new a(1,1,1);c.multiplyByMatrix(this.projectionInv),u.multiplyByMatrix(this.projectionInv),d.multiplyByMatrix(this.projectionInv),p.multiplyByMatrix(this.projectionInv);var f=l.fabs(u[0]-c[0]),g=l.fabs(p[0]-d[0]),m=-c[2],E=-d[2],v=(g-f)/(E-m),y=f-v*m;this.pixelSizeScale=v/r.width,this.pixelSizeOffset=y/r.height};return h.prototype.project=function(e,i){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","project","missingPoint"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","project","missingResult"));var n=e[0],o=e[1],s=e[2],a=this.modelviewProjection,l=a[0]*n+a[1]*o+a[2]*s+a[3],h=a[4]*n+a[5]*o+a[6]*s+a[7],c=a[8]*n+a[9]*o+a[10]*s+a[11],u=a[12]*n+a[13]*o+a[14]*s+a[15],d=this.viewport;return 0!=u&&(l/=u,h/=u,c/=u,!(c<-1||c>1)&&(l=.5*l+.5,h=.5*h+.5,c=.5*c+.5,l=l*d.width+d.x,h=h*d.height+d.y,i[0]=l,i[1]=h,i[2]=c,!0))},h.prototype.projectWithDepth=function(e,i,n){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","projectWithDepth","missingPoint"));if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","projectWithDepth","missingResult"));var o=e[0],s=e[1],a=e[2],h=this.modelview,c=h[0]*o+h[1]*s+h[2]*a+h[3],u=h[4]*o+h[5]*s+h[6]*a+h[7],d=h[8]*o+h[9]*s+h[10]*a+h[11],p=h[12]*o+h[13]*s+h[14]*a+h[15],f=this.projection,g=f[0]*c+f[1]*u+f[2]*d+f[3]*p,m=f[4]*c+f[5]*u+f[6]*d+f[7]*p,E=f[8]*c+f[9]*u+f[10]*d+f[11]*p,v=f[12]*c+f[13]*u+f[14]*d+f[15]*p,y=this.viewport;return 0!==v&&(g/=v,m/=v,E/=v,!(E<-1||E>1)&&(E=f[8]*c+f[9]*u+f[10]*d*(1+i)+f[11]*p,E/=v,E=l.clamp(E,-1,1),g=.5*g+.5,m=.5*m+.5,E=.5*E+.5,g=g*y.width+y.x,m=m*y.height+y.y,n[0]=g,n[1]=m,n[2]=E,!0))},h.prototype.unProject=function(e,i){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","unProject","missingPoint"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","unProject","missingResult"));var n=e[0],o=e[1],s=e[2],a=this.viewport;if(n=(n-a.x)/a.width,o=(o-a.y)/a.height,n=2*n-1,o=2*o-1,s=2*s-1,s<-1||s>1)return!1;var l=this.modelviewProjectionInv,h=l[0]*n+l[1]*o+l[2]*s+l[3],c=l[4]*n+l[5]*o+l[6]*s+l[7],u=l[8]*n+l[9]*o+l[10]*s+l[11],d=l[12]*n+l[13]*o+l[14]*s+l[15];return 0!==d&&(i[0]=h/d,i[1]=c/d,i[2]=u/d,!0)},h.prototype.convertPointToWindow=function(e,i){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToWindow","missingPoint"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToWindow","missingResult"));return i[0]=e[0],i[1]=this.viewport.height-e[1],i},h.prototype.convertPointToViewport=function(e,i){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToViewport","missingPoint"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToViewport","missingResult"));return i[0]=e[0],i[1]=this.viewport.height-e[1],i},h.prototype.rayFromScreenPoint=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","rayFromScreenPoint","missingPoint"));var n=this.convertPointToViewport(e,new a(0,0,0)),o=new a(0,0,0),s=new a(0,0,0);if(!this.unProject(n,o))return null;if(n[2]=1,!this.unProject(n,s))return null;var l=new a(this.eyePoint[0],this.eyePoint[1],this.eyePoint[2]),h=new a(s[0],s[1],s[2]);return h.subtract(o),h.normalize(),new i(l,h)},h.prototype.pixelSizeAtDistance=function(t){return this.pixelSizeScale*t+this.pixelSizeOffset},h}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(10)],n=function(t){"use strict";var e=function(e){t.call(this,"UnsupportedOperationError",e);var i;try{throw new Error}catch(t){i=t.stack}this.stack=i};return e.prototype=Object.create(t.prototype),e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(28)],n=function(t){"use strict";var e=function(e,i){t.call(this,e,i),this.button=0,this.interpretDistance=5};return e.prototype=Object.create(t.prototype),e.prototype.mouseMove=function(t){this.state==WorldWind.POSSIBLE?this.shouldInterpret()&&(this.shouldRecognize()?(this.translationX=0,this.translationY=0,this.state=WorldWind.BEGAN):this.state=WorldWind.FAILED):this.state!=WorldWind.BEGAN&&this.state!=WorldWind.CHANGED||(this.state=WorldWind.CHANGED)},e.prototype.mouseUp=function(t){0==this.mouseButtonMask&&(this.state==WorldWind.POSSIBLE?this.state=WorldWind.FAILED:this.state!=WorldWind.BEGAN&&this.state!=WorldWind.CHANGED||(this.state=WorldWind.ENDED))},e.prototype.touchStart=function(t){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},e.prototype.shouldInterpret=function(){var t=this.translationX,e=this.translationY,i=Math.sqrt(t*t+e*e);return i>this.interpretDistance},e.prototype.shouldRecognize=function(){var t=1<<this.button;return t==this.mouseButtonMask},e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(28)],n=function(t){"use strict";var e=function(e,i){t.call(this,e,i),this._scale=1,this._offsetScale=1,this.referenceDistance=0,this.interpretThreshold=20,this.weight=.4,this.pinchTouches=[]};return e.prototype=Object.create(t.prototype),Object.defineProperties(e.prototype,{scale:{get:function(){return this._scale*this._offsetScale}}}),e.prototype.reset=function(){t.prototype.reset.call(this),this._scale=1,this._offsetScale=1,this.referenceDistance=0,this.pinchTouches=[]},e.prototype.mouseDown=function(t){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},e.prototype.touchStart=function(t){this.pinchTouches.length<2&&2==this.pinchTouches.push(t)&&(this.referenceDistance=this.currentPinchDistance(),this._offsetScale*=this._scale,this._scale=1)},e.prototype.touchMove=function(t){if(2==this.pinchTouches.length)if(this.state==WorldWind.POSSIBLE)this.shouldRecognize()&&(this.state=WorldWind.BEGAN);else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED){var e=this.currentPinchDistance(),i=Math.abs(e/this.referenceDistance),r=this.weight;this._scale=this._scale*(1-r)+i*r,this.state=WorldWind.CHANGED}},e.prototype.touchEnd=function(t){var e=this.pinchTouches.indexOf(t);e!=-1&&this.pinchTouches.splice(e,1),0==this.touchCount&&(this.state==WorldWind.POSSIBLE?this.state=WorldWind.FAILED:this.state!=WorldWind.BEGAN&&this.state!=WorldWind.CHANGED||(this.state=WorldWind.ENDED))},e.prototype.touchCancel=function(t){var e=this.pinchTouches.indexOf(t);e!=-1&&this.pinchTouches.splice(e,1),0==this.touchCount&&(this.state==WorldWind.POSSIBLE?this.state=WorldWind.FAILED:this.state!=WorldWind.BEGAN&&this.state!=WorldWind.CHANGED||(this.state=WorldWind.CANCELLED))},e.prototype.prepareToRecognize=function(){this.referenceDistance=this.currentPinchDistance(),this._scale=1},e.prototype.shouldRecognize=function(){var t=this.currentPinchDistance();return Math.abs(t-this.referenceDistance)>this.interpretThreshold},e.prototype.currentPinchDistance=function(){var t=this.pinchTouches[0],e=this.pinchTouches[1],i=t.clientX-e.clientX,r=t.clientY-e.clientY;return Math.sqrt(i*i+r*r)},e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(13),i(28)],n=function(t,e){"use strict";var i=function(t,i){e.call(this,t,i),this._rotation=0,this._offsetRotation=0,this.referenceAngle=0,this.interpretThreshold=20,this.weight=.4,this.rotationTouches=[]};return i.prototype=Object.create(e.prototype),Object.defineProperties(i.prototype,{rotation:{get:function(){return this._rotation+this._offsetRotation}}}),i.prototype.reset=function(){e.prototype.reset.call(this),this._rotation=0,this._offsetRotation=0,this.referenceAngle=0,this.rotationTouches=[]},i.prototype.mouseDown=function(t){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},i.prototype.touchStart=function(t){this.rotationTouches.length<2&&2==this.rotationTouches.push(t)&&(this.referenceAngle=this.currentTouchAngle(),this._offsetRotation+=this._rotation,this._rotation=0)},i.prototype.touchMove=function(e){if(2==this.rotationTouches.length)if(this.state==WorldWind.POSSIBLE)this.shouldRecognize()&&(this.state=WorldWind.BEGAN);else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED){var i=this.currentTouchAngle(),r=t.normalizedDegrees(i-this.referenceAngle),n=this.weight;this._rotation=this._rotation*(1-n)+r*n,this.state=WorldWind.CHANGED}},i.prototype.touchEnd=function(t){var e=this.rotationTouches.indexOf(t);e!=-1&&this.rotationTouches.splice(e,1),0==this.touchCount&&(this.state==WorldWind.POSSIBLE?this.state=WorldWind.FAILED:this.state!=WorldWind.BEGAN&&this.state!=WorldWind.CHANGED||(this.state=WorldWind.ENDED))},i.prototype.touchCancel=function(t){var e=this.rotationTouches.indexOf(t);e!=-1&&(this.rotationTouches.splice(e,1),0==this.touchCount&&(this.state==WorldWind.POSSIBLE?this.state=WorldWind.FAILED:this.state!=WorldWind.BEGAN&&this.state!=WorldWind.CHANGED||(this.state=WorldWind.CANCELLED)))},i.prototype.prepareToRecognize=function(){this.referenceAngle=this.currentTouchAngle(),this._rotation=0},i.prototype.shouldRecognize=function(){var e=this.currentTouchAngle(),i=t.normalizedDegrees(e-this.referenceAngle);return Math.abs(i)>this.interpretThreshold},i.prototype.currentTouchAngle=function(){var e=this.rotationTouches[0],i=this.rotationTouches[1],r=e.clientX-i.clientX,n=e.clientY-i.clientY;return Math.atan2(n,r)*t.RADIANS_TO_DEGREES},i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(34)],n=function(t){"use strict";var e=function(e,i){t.call(this,e,i),this.maxTouchDistance=250,this.maxTouchDivergence=50};return e.LEFT=1,e.RIGHT=2,e.UP=4,e.DOWN=8,e.prototype=Object.create(t.prototype),e.prototype.shouldInterpret=function(){for(var t=0,e=this.touchCount;t<e;t++){var i=this.touch(t),r=i.translationX,n=i.translationY,o=Math.sqrt(r*r+n*n);if(o>this.interpretDistance)return!0}return!1},e.prototype.shouldRecognize=function(){var t=this.touchCount;if(t<2)return!1;var i=this.touch(0),r=this.touch(1),n=i.clientX-r.clientX,o=i.clientY-r.clientY,s=Math.sqrt(n*n+o*o);if(s>this.maxTouchDistance)return!1;var a=i.translationX-r.translationX,l=i.translationY-r.translationY,h=Math.sqrt(a*a+l*l);if(h>this.maxTouchDivergence)return!1;var c=e.UP|e.DOWN,u=this.touchDirection(i)&c,d=this.touchDirection(r)&c;return 0!=(u&d)},e.prototype.touchDirection=function(t){var i=t.translationX,r=t.translationY,n=0;return Math.abs(i)>Math.abs(r)?(n|=i<0?e.LEFT:0,n|=i>0?e.RIGHT:0):(n|=r<0?e.UP:0,n|=r>0?e.DOWN:0),n},e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=i(45),n=i(58),o=i(68),s=r.prototype.beginRendering;r.prototype.beginRendering=function(t,e){var i=this.currentSurfaceTiles[0];return i instanceof n||i instanceof o?i.beginRendering(t,e):s.call(this,t,e)};var a=r.prototype.renderTiles;r.prototype.renderTiles=function(t,e,i,r){this.currentSurfaceTiles=e,a.call(this,t,e,i,r)}},function(t,e,i){var r,n;r=[i(9),i(8),i(36),i(46),i(57)],n=function(t,e,i,r,n){"use strict";var o=function(){this.texMaskMatrix=i.fromIdentity(),this.texSamplerMatrix=i.fromIdentity(),this.isSurfaceShapeTileRendering=!1};return o.prototype.renderTiles=function(i,n,o,s){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfaceTileRenderer","renderTiles","Specified surface tiles array is null or undefined."));if(!(n.length<1)){var a,l,h,c,u=i.terrain,d=i.currentGlContext,p=0,f=1;if(u){this.isSurfaceShapeTileRendering=n[0]instanceof r,o*=i.surfaceOpacity,a=this.beginRendering(i,o),u.beginRendering(i);try{for(var g=0,m=u.surfaceGeometry.length;g<m;g++){l=u.surfaceGeometry[g],h=l.sector,u.beginRenderingTile(i,l);try{for(var E=0,v=n.length;E<v;E++)c=n[E],c.sector.overlaps(h)&&c.bind(i)&&(i.pickingMode?c.pickColor&&a.loadColor(d,c.pickColor):s&&c.opacity!=f&&(a.loadOpacity(d,o*c.opacity),f=c.opacity),this.applyTileState(i,l,c),u.renderTile(i,l),++p)}catch(t){console.log(t)}finally{u.endRenderingTile(i,l)}}}catch(t){console.log(t)}finally{u.endRendering(i),this.endRendering(i),i.frameStatistics.incrementRenderedTileCount(p)}}}},o.prototype.beginRendering=function(t,e){var i=t.currentGlContext,r=t.findAndBindProgram(n);return r.loadTexSampler(i,i.TEXTURE0),t.pickingMode&&!this.isSurfaceShapeTileRendering?r.loadModulateColor(i,!0):(r.loadModulateColor(i,!1),r.loadOpacity(i,e)),r},o.prototype.endRendering=function(t){var e=t.currentGlContext;e.bindTexture(e.TEXTURE_2D,null)},o.prototype.applyTileState=function(t,e,i){var r=t.currentGlContext,n=t.currentProgram,o=e.sector,s=o.deltaLatitude(),a=o.deltaLongitude(),l=i.sector,h=l.deltaLatitude(),c=l.deltaLongitude(),u=h>0?h:1,d=c>0?c:1,p=a/d,f=s/u,g=-(l.minLongitude-o.minLongitude)/d,m=-(l.minLatitude-o.minLatitude)/u;this.texMaskMatrix.set(p,0,0,g,0,f,0,m,0,0,1,0,0,0,0,1),this.texSamplerMatrix.setToUnitYFlip(),i.applyInternalTransform(t,this.texSamplerMatrix),this.texSamplerMatrix.multiplyMatrix(this.texMaskMatrix),n.loadTexSamplerMatrix(r,this.texSamplerMatrix),n.loadTexMaskMatrix(r,this.texMaskMatrix)},o}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(13),i(9),i(47),i(8),i(48),i(25),i(49)],n=function(t,e,i,r,n,o,s){"use strict";var a=function(t,e,i,r){s.call(this,t,e,i,r),this.surfaceShapes=[],this.sector=t,this.cacheKey=null,this.pickSequence=0,this.surfaceShapeStateKeys=[],this.prevSurfaceShapes=[],this.createCtx2D()};return a.prototype=Object.create(s.prototype),a.prototype.clearShapes=function(){var t=this.prevSurfaceShapes;this.prevSurfaceShapes=this.surfaceShapes,this.surfaceShapes=t,this.surfaceShapes.splice(0,this.surfaceShapes.length)},a.prototype.hasShapes=function(){return this.surfaceShapes.length>0},a.prototype.getShapes=function(){return this.surfaceShapes},a.prototype.setShapes=function(t){this.surfaceShapes=t},a.prototype.getSector=function(){return this.sector},a.prototype.addSurfaceShape=function(t){this.surfaceShapes.push(t),this.surfaceShapeStateKeys.push(t.stateKey)},a.prototype.addAllSurfaceShapes=function(t){for(var e=0,i=t.length;e<i;e+=1){var r=t[e];this.addAllSurfaceShapes(r)}},a.prototype.needsUpdate=function(t){var e,i,r,n;if(this.prevSurfaceShapes.length!=this.surfaceShapes.length)return!0;for(e=0,i=this.prevSurfaceShapes.length;e<i;e+=1)if(r=this.prevSurfaceShapes[e],this.surfaceShapes.indexOf(r)<0)return!0;for(e=0,i=this.surfaceShapes.length;e<i;e+=1)if(r=this.surfaceShapes[e],this.prevSurfaceShapes.indexOf(r)<0)return!0;for(e=0,i=this.surfaceShapes.length;e<i;e+=1)if(r=this.surfaceShapes[e],n=this.surfaceShapeStateKeys[e],n!=r.stateKey)return!0;return!this.hasTexture(t)},a.prototype.hasTexture=function(t){if(t.pickingMode)return!1;var e=t.gpuResourceCache;this.gpuCacheKey||(this.gpuCacheKey=this.getCacheKey());var i=e.resourceForKey(this.gpuCacheKey);return!!i},a.prototype.updateTexture=function(t){var e=t.currentGlContext,i=a.canvas;i.width=this.tileWidth,i.height=this.tileHeight;for(var r=a.ctx2D,n=this.tileWidth/this.sector.deltaLongitude(),s=-this.tileHeight/this.sector.deltaLatitude(),l=-this.sector.minLongitude*n,h=-this.sector.maxLatitude*s,c=0,u=this.surfaceShapes.length;c<u;c+=1){var d=this.surfaceShapes[c];this.surfaceShapeStateKeys[c]=d.stateKey,d.renderToTexture(t,r,n,s,l,h)}var p=new o(e,i),f=t.gpuResourceCache;return this.gpuCacheKey=this.getCacheKey(),f.putResource(this.gpuCacheKey,p,p.size),p},a.prototype.getCacheKey=function(){return this.cacheKey||(this.cacheKey="SurfaceShapeTile:"+this.tileKey+","+this.pickSequence.toString()),this.cacheKey},a.prototype.createCtx2D=function(){a.ctx2D||(a.canvas=document.createElement("canvas"),a.ctx2D=a.canvas.getContext("2d"))},a.canvas=null,a.ctx2D=null,a}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(13),i(9),i(14),i(8)],n=function(t,e,i,r){"use strict";var n=function(i,n,o){if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"Level","constructor","The specified tile delta is null or undefined"));if(!o)throw new e(r.logMessage(r.LEVEL_SEVERE,"Level","constructor","The specified parent level set is null or undefined"));this.levelNumber=i,this.tileDelta=n,this.parent=o,this.texelSize=n.latitude*t.DEGREES_TO_RADIANS/o.tileHeight,this.tileWidth=o.tileWidth,this.tileHeight=o.tileHeight,this.sector=o.sector};return n.prototype.isFirstLevel=function(){return this.parent.firstLevel()==this},n.prototype.isLastLevel=function(){return this.parent.lastLevel()==this},n.prototype.previousLevel=function(){return this.parent.level(this.levelNumber-1)},n.prototype.nextLevel=function(){return this.parent.level(this.levelNumber+1)},n.prototype.compare=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Level","compare","The specified level is null or undefined"));return this.levelNumber<t.levelNumber?-1:this.levelNumber>t.levelNumber?1:0},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(13),i(9),i(14),i(8),i(11),i(17)],n=function(t,e,i,r,n,o){"use strict";var s=function(t,e,i,r){this.minLatitude=t,this.maxLatitude=e,this.minLongitude=i,this.maxLongitude=r};return s.ZERO=new s(0,0,0,0),s.FULL_SPHERE=new s(-90,90,-180,180),s.prototype.copy=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Sector","copy","missingSector"));return this.minLatitude=t.minLatitude,this.maxLatitude=t.maxLatitude,this.minLongitude=t.minLongitude,this.maxLongitude=t.maxLongitude,this},s.prototype.isEmpty=function(){return this.minLatitude===this.maxLatitude&&this.minLongitude===this.maxLongitude},s.prototype.deltaLatitude=function(){return this.maxLatitude-this.minLatitude},s.prototype.deltaLongitude=function(){return this.maxLongitude-this.minLongitude},s.prototype.centroidLatitude=function(){return.5*(this.minLatitude+this.maxLatitude)},s.prototype.centroidLongitude=function(){return.5*(this.minLongitude+this.maxLongitude)},s.prototype.centroid=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Sector","centroid","missingResult"));return t.latitude=this.centroidLatitude(),t.longitude=this.centroidLongitude(),t},s.prototype.minLatitudeRadians=function(){return this.minLatitude*t.DEGREES_TO_RADIANS},s.prototype.maxLatitudeRadians=function(){return this.maxLatitude*t.DEGREES_TO_RADIANS},s.prototype.minLongitudeRadians=function(){return this.minLongitude*t.DEGREES_TO_RADIANS},s.prototype.maxLongitudeRadians=function(){return this.maxLongitude*t.DEGREES_TO_RADIANS},s.prototype.setToBoundingSector=function(t){if(!t||t.length<2)throw new e(r.logMessage(r.LEVEL_SEVERE,"Sector","setToBoundingSector","missingArray"));for(var i=90,n=-90,o=180,s=-180,a=0,l=t.length;a<l;a+=1){var h=t[a];h&&(i=Math.min(i,h.latitude),n=Math.max(n,h.latitude),o=Math.min(o,h.longitude),s=Math.max(s,h.longitude))}return this.minLatitude=i,this.maxLatitude=n,this.minLongitude=o,this.maxLongitude=s,this},s.splitBoundingSectors=function(t){if(!t||t.length<2)throw new e(r.logMessage(r.LEVEL_SEVERE,"Sector","splitBoundingSectors","missingArray"));for(var i=90,n=180,a=-90,l=-180,h=null,c=0,u=t.length;c<u;c+=1){var d=t[c],p=d.latitude;p<i&&(i=p),p>a&&(a=p);var f=d.longitude;if(f>=0&&f<n&&(n=f),f<=0&&f>l&&(l=f),null!=h){var g=h.longitude;o.signum(f)!=o.signum(g)&&Math.abs(f-g)<180&&(l=0,n=0)}h=d}return i===a&&n===l?null:[new s(i,a,n,180),new s(i,a,-180,l)]},s.prototype.intersects=function(t){return t&&this.minLongitude<=t.maxLongitude&&this.maxLongitude>=t.minLongitude&&this.minLatitude<=t.maxLatitude&&this.maxLatitude>=t.minLatitude},s.prototype.overlaps=function(t){return t&&this.minLongitude<t.maxLongitude&&this.maxLongitude>t.minLongitude&&this.minLatitude<t.maxLatitude&&this.maxLatitude>t.minLatitude},s.prototype.contains=function(t){return t&&this.minLatitude<=t.minLatitude&&this.maxLatitude>=t.maxLatitude&&this.minLongitude<=t.minLongitude&&this.maxLongitude>=t.maxLongitude},s.prototype.containsLocation=function(t,e){return this.minLatitude<=t&&this.maxLatitude>=t&&this.minLongitude<=e&&this.maxLongitude>=e},s.prototype.intersection=function(t){if(!t instanceof s)throw new e(r.logMessage(r.LEVEL_SEVERE,"Sector","intersection","missingSector"));return this.minLatitude<t.minLatitude&&(this.minLatitude=t.minLatitude),this.maxLatitude>t.maxLatitude&&(this.maxLatitude=t.maxLatitude),this.minLongitude<t.minLongitude&&(this.minLongitude=t.minLongitude),this.maxLongitude>t.maxLongitude&&(this.maxLongitude=t.maxLongitude),this.maxLatitude<this.minLatitude&&(this.maxLatitude=this.minLatitude),this.maxLongitude<this.minLongitude&&(this.maxLongitude=this.minLongitude),this},s.prototype.union=function(t){if(!t instanceof s)throw new e(r.logMessage(r.LEVEL_SEVERE,"Sector","union","missingSector"));return this.minLatitude>t.minLatitude&&(this.minLatitude=t.minLatitude),this.maxLatitude<t.maxLatitude&&(this.maxLatitude=t.maxLatitude),this.minLongitude>t.minLongitude&&(this.minLongitude=t.minLongitude),this.maxLongitude<t.maxLongitude&&(this.maxLongitude=t.maxLongitude),this},s}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(50)],n=function(t,e,i){"use strict";var r=function(t,e,r,n){i.call(this,t,e,r,n),this.gpuCacheKey=null};return r.prototype=Object.create(i.prototype),r.prototype.size=function(){return i.prototype.size.call(this)},r.prototype.bind=function(t){var e=t.gpuResourceCache.resourceForKey(this.gpuCacheKey);return!!e&&e.bind(t)},r.prototype.applyInternalTransform=function(t,e){},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(51),i(8),i(48),i(11),i(56)],n=function(t,e,i,r,n,o){"use strict";var s=function(e,r,n,o){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","constructor","missingSector"));if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","constructor","The specified level is null or undefined."));if(n<0||o<0)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","constructor","The specified row or column is less than zero."));this.sector=e,this.level=r,this.row=n,this.column=o,this.tileWidth=r.tileWidth,this.tileHeight=r.tileHeight,this.texelSize=r.texelSize,this.tileKey=r.levelNumber.toString()+"."+n.toString()+"."+o.toString(),this.extent=null,this.referencePoint=null,this.opacity=1,this.samplePoints=null,this.sampleElevations=null,this.updateTimestamp=null,this.updateVerticalExaggeration=null,this.updateGlobeStateKey=null};return s.prototype.isEqual=function(t){return!!t&&(!!t.tileKey&&this.tileKey==t.tileKey)},s.prototype.size=function(){return 828},s.prototype.distanceTo=function(e){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","distanceTo","missingVector"));for(var r,n,o,s=e[0],a=e[1],l=e[2],h=this.samplePoints,c=Number.POSITIVE_INFINITY,u=0,d=h.length;u<d;u+=3)r=s-h[u],n=a-h[u+1],o=l-h[u+2],c=Math.min(c,r*r+n*n+o*o);return Math.sqrt(c)},s.prototype.subdivide=function(e,n){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","subdivide","The specified level is null or undefined."));if(!n)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","subdivide","The specified tile factory is null or undefined."));var o,s,a,l=this.sector.minLatitude,h=this.sector.maxLatitude,c=this.sector.centroidLatitude(),u=this.sector.minLongitude,d=this.sector.maxLongitude,p=this.sector.centroidLongitude(),f=[];return o=2*this.row,s=2*this.column,a=new r(l,c,u,p),f.push(n.createTile(a,e,o,s)),o=2*this.row,s=2*this.column+1,a=new r(l,c,p,d),f.push(n.createTile(a,e,o,s)),o=2*this.row+1,s=2*this.column,a=new r(c,h,u,p),f.push(n.createTile(a,e,o,s)),o=2*this.row+1,s=2*this.column+1,a=new r(c,h,p,d),f.push(n.createTile(a,e,o,s)),f},s.prototype.subdivideToCache=function(e,r,n){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","subdivideToCache","The specified level is null or undefined."));if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","subdivideToCache","The specified tile factory is null or undefined."));var o=n?n.entryForKey(this.tileKey):null;return o||(o=this.subdivide(e,r),o&&n&&n.putEntry(this.tileKey,o,4*o[0].size())),o},s.prototype.mustSubdivide=function(t,e){var i=t.globe.equatorialRadius*this.texelSize,r=this.distanceTo(t.navigatorState.eyePoint),n=t.navigatorState.pixelSizeAtDistance(r);return i>Math.max(e*n,.5)},s.prototype.update=function(t){var e=t.globe.elevationTimestamp(),i=t.verticalExaggeration,r=t.globeStateKey;this.updateTimestamp==e&&this.updateVerticalExaggeration==i&&this.updateGlobeStateKey==r||(this.doUpdate(t),t.frameStatistics.incrementTileUpdateCount(1),this.updateTimestamp=e,this.updateVerticalExaggeration=i,this.updateGlobeStateKey=r)},s.prototype.doUpdate=function(t){var i=t.globe,r=t.verticalExaggeration,s=i.minAndMaxElevationsForSector(this.sector),a=s?s[0]*r:0,l=s?s[1]*r:0;a==l&&(a=l+10),this.extent||(this.extent=new e),this.extent.setToSector(this.sector,i,a,l),this.samplePoints||(this.sampleElevations=new Float64Array(9),this.samplePoints=new Float64Array(3*this.sampleElevations.length)),o.fillArray(this.sampleElevations,.5*(a+l)),i.computePointsForGrid(this.sector,3,3,this.sampleElevations,n.ZERO,this.samplePoints),this.referencePoint||(this.referencePoint=new n(0,0,0)),i.computePointFromPosition(this.sector.centroidLatitude(),this.sector.centroidLongitude(),0,this.referencePoint)},s.computeRow=function(t,e){var i=Math.floor((e+90)/t);return 90==e&&(i-=1),i},s.computeColumn=function(t,e){var i=Math.floor((e+180)/t);return 180==e&&(i-=1),i},s.computeLastRow=function(t,e){var i=Math.ceil((e+90)/t-1);return e+90<t&&(i=0),i},s.computeLastColumn=function(t,e){var i=Math.ceil((e+180)/t-1);return e+180<t&&(i=0),i},s.computeSector=function(e,n,o){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","computeSector","missingLevel"));if(n<0||o<0)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","computeSector","The specified row or column is less than zero."));var s=e.tileDelta.latitude,a=e.tileDelta.longitude,l=-90+n*s,h=-180+o*a,c=l+s,u=h+a;return new r(l,c,h,u)},s.createTilesForLevel=function(e,n,o){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","createTilesForLevel","missingLevel"));if(!n)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","createTilesForLevel","The specified tile factory is null or undefined"));if(!o)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","createTilesForLevel","missingResult"));for(var a,l,h,c=e.tileDelta.latitude,u=e.tileDelta.longitude,d=e.sector,p=s.computeRow(c,d.minLatitude),f=s.computeRow(c,d.maxLatitude),g=s.computeColumn(u,d.minLongitude),m=s.computeColumn(u,d.maxLongitude),E=-90+p*c,v=-180+g*u,y=E,_=p;_<=f;_+=1){l=y+c,a=v;for(var T=g;T<=m;T+=1){h=a+u;var L=new r(y,l,a,h),x=n.createTile(L,e,_,T);o.push(x),a=h}y=l}},s}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(53),i(35),i(8),i(36),i(52),i(15),i(48),i(11),i(17),i(56)],n=function(t,e,i,r,n,o,s,a,l,h,c){"use strict";var u=function(){this.center=new l(0,0,0),this.bottomCenter=new l(-.5,0,0),this.topCenter=new l(.5,0,0),this.r=new l(1,0,0),this.s=new l(0,1,0),this.t=new l(0,0,1),this.radius=Math.sqrt(3),this.tmp1=new l(0,0,0),this.tmp2=new l(0,0,0),this.tmp3=new l(0,0,0),this.scratchElevations=new Float64Array(9),this.scratchPoints=new Float64Array(3*this.scratchElevations.length)};return u.scratchMatrix=n.fromIdentity(),u.prototype.setToPoints=function(e){if(!e||e.length<3)throw new t(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","setToPoints","missingArray"));var i,o,s,a,h,c,u,d,p,f,g,m,E,v,y,_=+Number.MAX_VALUE,T=-Number.MAX_VALUE,L=+Number.MAX_VALUE,x=-Number.MAX_VALUE,b=+Number.MAX_VALUE,S=-Number.MAX_VALUE,w=this.r,M=this.s,R=this.t,A=new l(0,0,0);n.principalAxesFromPoints(e,w,M,R);for(var C=0,P=e.length/3;C<P;C++)A[0]=e[3*C],A[1]=e[3*C+1],A[2]=e[3*C+2],i=A.dot(w),_>i&&(_=i),T<i&&(T=i),o=A.dot(M),L>o&&(L=o),x<o&&(x=o),s=A.dot(R),b>s&&(b=s),S<s&&(S=s);return T===_&&(T=_+1),x===L&&(x=L+1),S===b&&(S=b+1),a=T-_,h=x-L,c=S-b,u=T+_,d=x+L,p=S+b,f=.5*w[0]*a,g=.5*w[1]*a,m=.5*w[2]*a,E=.5*(w[0]*u+M[0]*d+R[0]*p),v=.5*(w[1]*u+M[1]*d+R[1]*p),y=.5*(w[2]*u+M[2]*d+R[2]*p),this.center[0]=E,this.center[1]=v,this.center[2]=y,this.topCenter[0]=E+f,this.topCenter[1]=v+g,this.topCenter[2]=y+m,this.bottomCenter[0]=E-f,this.bottomCenter[1]=v-g,this.bottomCenter[2]=y-m,w.multiply(a),M.multiply(h),R.multiply(c),this.radius=.5*Math.sqrt(a*a+h*h+c*c),this},u.prototype.setToSector=function(e,i,n,o){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","setToSector","missingSector"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","setToSector","missingGlobe"));var s=this.scratchElevations,a=this.scratchPoints;c.fillArray(s,o),s[0]=s[2]=s[6]=s[8]=n,i.computePointsForGrid(e,3,3,s,l.ZERO,a);var u=12;this.tmp1.set(a[u],a[u+1],a[u+2]),h.localCoordinateAxesAtPoint(this.tmp1,i,this.r,this.s,this.t);for(var d=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],p=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],f=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],g=0,m=a.length;g<m;g+=3)this.tmp1.set(a[g],a[g+1],a[g+2]),this.adjustExtremes(this.r,d,this.s,p,this.t,f,this.tmp1);d[1]-d[0]<p[1]-p[0]&&this.swapAxes(this.r,d,this.s,p),p[1]-p[0]<f[1]-f[0]&&this.swapAxes(this.s,p,this.t,f),d[1]-d[0]<p[1]-p[0]&&this.swapAxes(this.r,d,this.s,p);var E=d[1]-d[0],v=p[1]-p[0],y=f[1]-f[0],_=d[1]+d[0],T=p[1]+p[0],L=f[1]+f[0],x=.5*(this.r[0]*_+this.s[0]*T+this.t[0]*L),b=.5*(this.r[1]*_+this.s[1]*T+this.t[1]*L),S=.5*(this.r[2]*_+this.s[2]*T+this.t[2]*L),w=.5*this.r[0]*E,M=.5*this.r[1]*E,R=.5*this.r[2]*E;return this.center.set(x,b,S),this.topCenter.set(x+w,b+M,S+R),this.bottomCenter.set(x-w,b-M,S-R),this.r.multiply(E),this.s.multiply(v),this.t.multiply(y),this.radius=.5*Math.sqrt(E*E+v*v+y*y),this},u.prototype.translate=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","translate","missingVector"));return this.bottomCenter.add(e),this.topCenter.add(e),this.center.add(e),this},u.prototype.distanceTo=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","distanceTo","missingPoint"));var i=this.center.distanceTo(e)-this.radius;return i>=0?i:-i},u.prototype.effectiveRadius=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","effectiveRadius","missingPlane"));var i=e.normal;return.5*(h.fabs(this.r.dot(i))+h.fabs(this.s.dot(i))+h.fabs(this.t.dot(i)))},u.prototype.intersectsFrustum=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","intersectsFrustum","missingFrustum"));return this.tmp1.copy(this.bottomCenter),this.tmp2.copy(this.topCenter),!(this.intersectionPoint(e.near)<0)&&(!(this.intersectionPoint(e.far)<0)&&(!(this.intersectionPoint(e.left)<0)&&(!(this.intersectionPoint(e.right)<0)&&(!(this.intersectionPoint(e.top)<0)&&!(this.intersectionPoint(e.bottom)<0)))))},u.prototype.intersectionPoint=function(t){var e=t.normal,i=.5*(Math.abs(this.s.dot(e))+Math.abs(this.t.dot(e)));return this.intersectsAt(t,i,this.tmp1,this.tmp2)},u.prototype.intersectsAt=function(t,e,i,r){var n=t.dot(i),o=n<=-e,s=t.dot(r),a=s<=-e;if(o&&a)return-1;if(o==a)return 0;this.tmp3.copy(i),this.tmp3.subtract(r);var l=(e+n)/t.normal.dot(this.tmp3);return this.tmp3.copy(r),this.tmp3.subtract(i),this.tmp3.multiply(l),this.tmp3.add(i),o?i.copy(this.tmp3):r.copy(this.tmp3),l},u.prototype.adjustExtremes=function(t,e,i,r,n,o,s){var a=s.dot(t);e[0]>a&&(e[0]=a),e[1]<a&&(e[1]=a);var l=s.dot(i);r[0]>l&&(r[0]=l),r[1]<l&&(r[1]=l);var h=s.dot(n);o[0]>h&&(o[0]=h),o[1]<h&&(o[1]=h)},u.prototype.swapAxes=function(t,e,i,r){t.swap(i);var n=e[0];e[0]=r[0],r[0]=n,n=e[1],e[1]=r[1],r[1]=n},u.prototype.render=function(t){var i=t.currentGlContext,r=u.scratchMatrix,n=t.findAndBindProgram(e);try{r.copy(t.navigatorState.modelviewProjection),r.multiply(this.r[0],this.s[0],this.t[0],this.center[0],this.r[1],this.s[1],this.t[1],this.center[1],this.r[2],this.s[2],this.t[2],this.center[2],0,0,0,1),r.multiplyByTranslation(-.5,-.5,-.5),n.loadModelviewProjection(i,r),i.disable(i.CULL_FACE),i.bindBuffer(i.ARRAY_BUFFER,t.unitCubeBuffer()),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.unitCubeElements()),i.enableVertexAttribArray(n.vertexPointLocation),i.vertexAttribPointer(n.vertexPointLocation,3,i.FLOAT,!1,0,0),n.loadColorComponents(i,0,1,0,.6),i.drawElements(i.LINES,24,i.UNSIGNED_SHORT,72),n.loadColorComponents(i,1,1,1,.3),
i.drawElements(i.TRIANGLES,36,i.UNSIGNED_SHORT,0)}finally{i.enable(i.CULL_FACE),i.bindBuffer(i.ARRAY_BUFFER,null),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null)}},u}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(10)],n=function(t){"use strict";var e=function(e){t.call(this,"NotYetImplementedError",e);var i;try{throw new Error}catch(t){i=t.stack}this.stack=i};return e.prototype=Object.create(t.prototype),e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(23),i(54),i(8)],n=function(t,e,i,r){"use strict";var n=function(t){var e="attribute vec4 vertexPoint;\nuniform mat4 mvpMatrix;\nvoid main() {gl_Position = mvpMatrix * vertexPoint;}",r="precision mediump float;\nuniform vec4 color;\nvoid main() {gl_FragColor = color;}";i.call(this,t,e,r),this.vertexPointLocation=this.attributeLocation(t,"vertexPoint"),this.mvpMatrixLocation=this.uniformLocation(t,"mvpMatrix"),this.colorLocation=this.uniformLocation(t,"color")};return n.key="WorldWindGpuBasicProgram",n.prototype=Object.create(i.prototype),n.prototype.loadModelviewProjection=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"BasicProgram","loadModelviewProjection","missingMatrix"));this.loadUniformMatrix(e,i,this.mvpMatrixLocation)},n.prototype.loadColor=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"BasicProgram","loadColor","missingColor"));this.loadUniformColor(e,i,this.colorLocation)},n.prototype.loadColorComponents=function(t,e,i,r,n){this.loadUniformColorComponents(t,e,i,r,n,this.colorLocation)},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(23),i(55),i(8)],n=function(t,e,i,r){"use strict";var n=function(e,n,o,s){if(!n||!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","constructor","The specified shader source is null or undefined."));var a,l,h;try{l=new i(e,e.VERTEX_SHADER,n),h=new i(e,e.FRAGMENT_SHADER,o)}catch(t){throw l&&l.dispose(e),h&&h.dispose(e),t}if(a=e.createProgram(),!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","constructor","Unable to create shader program."));if(e.attachShader(a,l.shaderId),e.attachShader(a,h.shaderId),s)for(var c=0,u=s.length;c<u;c++)e.bindAttribLocation(a,c,s[c]);if(!this.link(e,a)){var d=e.getProgramInfoLog(a);throw e.detachShader(a,l.shaderId),e.detachShader(a,h.shaderId),e.deleteProgram(a),l.dispose(e),h.dispose(e),new t(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","constructor","Unable to link shader program: "+d))}this.programId=a,this.attributeLocations={},this.uniformLocations={},this.vertexShader=l,this.fragmentShader=h,this.size=n.length+o.length,this.scratchArray=new Float32Array(16)};return n.prototype.dispose=function(t){this.programId&&(this.vertexShader&&t.detachShader(this.programId,this.vertexShader.shaderId),this.fragmentShader&&t.detachShader(this.programId,this.fragmentShader.shaderId),t.deleteProgram(this.programId),delete this.programId),this.vertexShader&&(this.vertexShader.dispose(t),delete this.vertexShader),this.fragmentShader&&(this.fragmentShader.dispose(t),delete this.fragmentShader),this.attributeLocations={},this.uniformLocations={}},n.prototype.attributeLocation=function(e,i){if(!i||0==i.length)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","attributeLocation","The specified attribute name is null, undefined or empty."));var n=this.attributeLocations[i];return n||(n=e.getAttribLocation(this.programId,i),this.attributeLocations[i]=n),n},n.prototype.uniformLocation=function(e,i){if(!i||0==i.length)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","uniformLocation","The specified uniform name is null, undefined or empty."));var n=this.uniformLocations[i];return n||(n=e.getUniformLocation(this.programId,i),this.uniformLocations[i]=n),n},n.prototype.link=function(t,e){return t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)},n.prototype.loadUniformMatrix=function(e,i,n){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","loadUniformMatrix","missingMatrix"));var o=i.columnMajorComponents(this.scratchArray);e.uniformMatrix4fv(n,!1,o)},n.prototype.loadUniformColor=function(e,i,n){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","loadUniformColor","missingColor"));var o=i.premultipliedComponents(this.scratchArray);e.uniform4f(n,o[0],o[1],o[2],o[3])},n.prototype.loadUniformColorComponents=function(t,e,i,r,n,o){t.uniform4f(o,e*n,i*n,r*n,n)},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8)],n=function(t,e){"use strict";var i=function(i,r,n){if(r!==i.VERTEX_SHADER&&r!==i.FRAGMENT_SHADER)throw new t(e.logMessage(e.LEVEL_SEVERE,"GpuShader","constructor","The specified shader type is unrecognized."));if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"GpuShader","constructor","The specified shader source is null or undefined."));var o=i.createShader(r);if(!o)throw new t(e.logMessage(e.LEVEL_SEVERE,"GpuShader","constructor","Unable to create shader of type "+(r==i.VERTEX_SHADER?"VERTEX_SHADER.":"FRAGMENT_SHADER.")));if(!this.compile(i,o,r,n)){var s=i.getShaderInfoLog(o);throw i.deleteShader(o),new t(e.logMessage(e.LEVEL_SEVERE,"GpuShader","constructor","Unable to compile shader: "+s))}this.shaderId=o};return i.prototype.compile=function(t,e,i,r){return t.shaderSource(e,r),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)},i.prototype.dispose=function(t){this.shaderId&&(t.deleteShader(this.shaderId),delete this.shaderId)},i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(16),i(8),i(18),i(11)],n=function(t,e,i,r,n){"use strict";var o={latLonRegex:/^(\-?\d+(\.\d+)?),\s*(\-?\d+(\.\d+)?)$/,suffixForMimeType:function(t){return"image/png"===t?"png":"image/jpeg"===t?"jpg":"application/bil16"===t?"bil":"application/bil32"===t?"bil":null},currentUrlSansFilePart:function(){for(var t=window.location.protocol,e=window.location.host,i=window.location.pathname,r=i.split("/"),n="",o=0,s=r.length;o<s-1;o++)r[o].length>0&&(n=n+"/"+r[o]);return t+"//"+e+n},worldwindlibLocation:function(){for(var t=document.getElementsByTagName("script"),e="/worldwind.",i=0;i<t.length;i++){var r=t[i].src.indexOf(e);if(r>=0)return t[i].src.substring(0,r)+"/"}return null},urlPath:function(t){if(!t)return"";for(var e=t.split("/"),i="",r=0,n=e.length;r<n;r++){var o=e[r];o&&0!==o.length&&o.indexOf(":")==-1&&"."!==o&&".."!==o&&"null"!==o&&"undefined"!==o&&(0!==i.length&&(i+="/"),i+=o)}return i},fillArray:function(t,e){if(t)for(var i=0,r=t.length;i<r;i++)t[i]=e},multiplyArray:function(t,e){if(t)for(var i=0,r=t.length;i<r;i++)t[i]*=e},jsonpCounter:0,jsonp:function(t,e,i){var r="gov_nasa_worldwind_jsonp_"+o.jsonpCounter++;window[r]=function(t){delete window[r],i(t)};var n=t+(t.indexOf("?")===-1?"?":"&");n+=e+"="+r;var s=document.createElement("script");s.async=!0,s.src=n;var a=document.getElementsByTagName("head")[0],l=function(){s.onload=void 0,s.onerror=void 0,a.removeChild(s)};s.onload=l,s.onerror=l,a.appendChild(s)},arrayEquals:function(t,e){return t.length==e.length&&t.every(function(t,i){return t===e[i]||t.equals&&t.equals(e[i])})},transformToBoolean:function(t){return 0!=t&&"0"!=t&&"false"!=t&&Boolean(t)},clone:function(t){var e,i={},r=Object.keys(t);for(e=0;e<r.length;e++)i[r[e]]=t[r[e]];return i},guid:function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},date:function(t){return new Date(t)}};return o}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(23),i(54),i(8)],n=function(t,e,i,r){"use strict";var n=function(t){var e="attribute vec4 vertexPoint;\nattribute vec4 vertexTexCoord;\nuniform mat4 mvpMatrix;\nuniform mat4 texSamplerMatrix;\nuniform mat4 texMaskMatrix;\nvarying vec2 texSamplerCoord;\nvarying vec2 texMaskCoord;\nvoid main() {\ngl_Position = mvpMatrix * vertexPoint;\ntexSamplerCoord = (texSamplerMatrix * vertexTexCoord).st;\ntexMaskCoord = (texMaskMatrix * vertexTexCoord).st;\n}",r="precision mediump float;\nuniform sampler2D texSampler;\nuniform float opacity;\nuniform vec4 color;\nuniform bool modulateColor;\nvarying vec2 texSamplerCoord;\nvarying vec2 texMaskCoord;\nbool isInsideTextureImage(const vec2 coord) {\n    return coord.x >= 0.0 && coord.x <= 1.0 && coord.y >= 0.0 && coord.y <= 1.0;\n}\nvoid main(void) {\nfloat mask = float(isInsideTextureImage(texMaskCoord));if (modulateColor) {\n    gl_FragColor = color * mask * floor(texture2D(texSampler, texSamplerCoord).a + 0.5);\n} else {\n    gl_FragColor = texture2D(texSampler, texSamplerCoord) * mask * opacity;\n}\n}";i.call(this,t,e,r),this.vertexPointLocation=this.attributeLocation(t,"vertexPoint"),this.vertexTexCoordLocation=this.attributeLocation(t,"vertexTexCoord"),this.mvpMatrixLocation=this.uniformLocation(t,"mvpMatrix"),this.colorLocation=this.uniformLocation(t,"color"),this.modulateColorLocation=this.uniformLocation(t,"modulateColor"),this.texSamplerMatrixLocation=this.uniformLocation(t,"texSamplerMatrix"),this.texMaskMatrixLocation=this.uniformLocation(t,"texMaskMatrix"),this.texSamplerLocation=this.uniformLocation(t,"texSampler"),this.opacityLocation=this.uniformLocation(t,"opacity"),this.vertexPointLocation=-1};return n.key="WorldWindGpuSurfaceTileRenderingProgram",n.prototype=Object.create(i.prototype),n.prototype.loadModelviewProjection=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadModelviewProjection","missingMatrix"));this.loadUniformMatrix(e,i,this.mvpMatrixLocation)},n.prototype.loadTexSamplerMatrix=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadTexSamplerMatrix","missingMatrix"));this.loadUniformMatrix(e,i,this.texSamplerMatrixLocation)},n.prototype.loadTexMaskMatrix=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadTexMaskMatrix","missingMatrix"));this.loadUniformMatrix(e,i,this.texMaskMatrixLocation)},n.prototype.loadTexSampler=function(t,e){t.uniform1i(this.texSamplerLocation,e-WebGLRenderingContext.TEXTURE0)},n.prototype.loadOpacity=function(t,e){t.uniform1f(this.opacityLocation,e)},n.prototype.loadColor=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadColor","missingColor"));this.loadUniformColor(e,i,this.colorLocation)},n.prototype.loadModulateColor=function(t,e){t.uniform1i(this.modulateColorLocation,e?1:0)},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=i(59),n=i(48),o=i(62),s=i(23),a=i(22),l=i(30),h=i(63).CharSDF,c=i(67),u=30,d=4,p=4,f=.24,g=.71,m=.001;l.listen(l._DISTANCE_FIELD_SETTINGS,function(t){g=t.buffer||g,m=t.smoothing||m});var E=function(t,e,i,o,l){this.color=o?s.colorFromHex(o):null,this.opacity=l.opacity||1;var g=new h(u,d,p,f,l.family||"sans-serif",l.weight||"normal"),m=g.draw(e),E=c.makeRGBAImageData(m),v=new a(E);i/=2;var y=Math.cos(t.latitude),_=new n(t.latitude-i,t.latitude+i,t.longitude-i/y,t.longitude+i/y);r.call(this,_,v)};E.prototype=Object.create(r.prototype),E.prototype.beginRendering=function(t){var e=t.currentGlContext,i=t.findAndBindProgram(o);return i.loadTexSampler(e,e.TEXTURE0),i.loadColor(e,this.color||s.TRANSPARENT),i.loadOpacity(e,this.opacity),i.loadRotation(e,-t.navigatorState.heading*Math.PI/180),i.loadTilt(e,t.navigatorState.tilt/90),i.loadScreenSize(e,[window.engine.canvas.width,window.engine.canvas.height]),i.loadVolume(e,.05),i},t.exports=E},function(t,e,i){var r,n;r=[i(9),i(8),i(60),i(61)],n=function(t,e,i,r){"use strict";var n=function(i,n){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfaceImage","constructor","missingSector"));if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfaceImage","constructor","missingImage"));r.call(this,i),this.enabled=!0,this._imageSource=n,this.opacity=1,this.displayName="Surface Image",this.imageSourceWasUpdated=!0};return n.prototype=Object.create(r.prototype),Object.defineProperties(n.prototype,{imageSource:{get:function(){return this._imageSource},set:function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfaceImage","imageSource","missingImage"));this._imageSource=i,this.imageSourceWasUpdated=!0}}}),n.prototype.bind=function(t){var e=t.gpuResourceCache.resourceForKey(this._imageSource);return e&&!this.imageSourceWasUpdated?e.bind(t):(e=t.gpuResourceCache.retrieveTexture(t.currentGlContext,this._imageSource),this.imageSourceWasUpdated=!1,e?e.bind(t):void 0)},n.prototype.applyInternalTransform=function(t,e){},n.prototype.render=function(t){if(this.enabled&&this.sector.overlaps(t.terrain.sector)){if(t.pickingMode&&(this.pickColor=t.uniquePickColor()),t.surfaceTileRenderer.renderTiles(t,[this],this.opacity*t.currentLayer.opacity),t.pickingMode){var e=new i(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,null,this.layer,!1);t.resolvePick(e)}t.currentLayer.inCurrentFrame=!0}},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[],n=function(){"use strict";var t=function(t,e,i,r,n){this.color=t,this.userObject=e,this.position=i,this.parentLayer=r,this.isTerrain=n,this.isOnTop=!1};return t}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(36),i(48),i(39)],n=function(t,e,i,r,n){"use strict";var o=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfaceTile","constructor","missingSector"));this.sector=i};return o.prototype.bind=function(t){throw new n(e.logMessage(e.LEVEL_SEVERE,"SurfaceTile","bind","abstractInvocation"))},o.prototype.applyInternalTransform=function(t,i){throw new n(e.logMessage(e.LEVEL_SEVERE,"SurfaceTile","applyInternalTransform","abstractInvocation"))},o}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=(i(23),i(54)),n=function(t){var e="attribute vec4 vertexPoint;\nattribute vec4 vertexTexCoord;\nuniform mat4 mvpMatrix;\nuniform mat4 texSamplerMatrix;\nvarying vec2 tx;\nvoid main() {\n    gl_Position = mvpMatrix * vertexPoint;\n    tx = (texSamplerMatrix * vertexTexCoord).xy;\n}",i="precision mediump float;\nuniform sampler2D distanceField;\nuniform float opacity;\nuniform vec4 color;\nuniform float rotation;\nuniform float tilt;\nuniform vec2 screen;\nuniform float volume;\nvarying vec2 tx;\nconst float buffer = 0.71;\nconst float smoothing = 0.001;\nconst vec2 zero = vec2(0.0);\nvec4 lookup(vec2 dtx) {\n    vec4 rgbd = texture2D(distanceField, tx + dtx);\n    rgbd.a = smoothstep(buffer - smoothing, buffer + smoothing, rgbd.a);\n    return rgbd;\n}\nvoid main(void) {\n   if (tx.x<0.0||tx.x>1.0||tx.y<0.0||tx.y>1.0)discard;    vec2 pixel = 0.5 - gl_FragCoord.xy / screen.xy;    float r = rotation + pixel.x * 0.9;\n    float t = tilt - pixel.y * 0.3;\n    vec2 dtx = vec2(sin(r), cos(r)) * volume * t;\n    vec4 c = lookup(dtx);\n    if (c.a == 1.0) {\n        c.rgb += color.rgb;        gl_FragColor = vec4(c.rgb, opacity);\n        return;\n    }\n    if (volume == 0.0) discard;    vec4 shadow = vec4(0.5, 0.5, 0.5, min(opacity, 0.4));\n    if (lookup(zero).a == 1.0) {\n        gl_FragColor = shadow;\n        return;\n    }\n}";r.call(this,t,e,i),this.vertexPointLocation=this.attributeLocation(t,"vertexPoint"),this.vertexTexCoordLocation=this.attributeLocation(t,"vertexTexCoord"),this.mvpMatrixLocation=this.uniformLocation(t,"mvpMatrix"),this.colorLocation=this.uniformLocation(t,"color"),this.texSamplerMatrixLocation=this.uniformLocation(t,"texSamplerMatrix"),this.texSamplerLocation=this.uniformLocation(t,"distanceField"),this.opacityLocation=this.uniformLocation(t,"opacity"),this.rotationLocation=this.uniformLocation(t,"rotation"),this.tiltLocation=this.uniformLocation(t,"tilt"),this.screenLocation=this.uniformLocation(t,"screen"),this.volumeLocation=this.uniformLocation(t,"volume")};n.key="DistanceFieldProgram2",n.prototype=Object.create(r.prototype),n.prototype.loadModelviewProjection=function(t,e){this.loadUniformMatrix(t,e,this.mvpMatrixLocation)},n.prototype.loadTexSamplerMatrix=function(t,e){this.loadUniformMatrix(t,e,this.texSamplerMatrixLocation)},n.prototype.loadTexMaskMatrix=function(t,e){},n.prototype.loadTexSampler=function(t,e){t.uniform1i(this.texSamplerLocation,e-WebGLRenderingContext.TEXTURE0)},n.prototype.loadOpacity=function(t,e){t.uniform1f(this.opacityLocation,e)},n.prototype.loadRotation=function(t,e){t.uniform1f(this.rotationLocation,e)},n.prototype.loadTilt=function(t,e){t.uniform1f(this.tiltLocation,e)},n.prototype.loadScreenSize=function(t,e){t.uniform2f(this.screenLocation,e[0],e[1])},n.prototype.loadVolume=function(t,e){t.uniform1f(this.volumeLocation,e)},n.prototype.loadColor=function(t,e){this.loadUniformColor(t,e,this.colorLocation)},n.prototype.loadOutlineColor=function(t,e){},n.prototype.loadOutlineDistance=function(t,e){},n.prototype.loadBuffer=function(t,e){},n.prototype.loadSmoothing=function(t,e){},t.exports=n},function(t,e,i){"use strict";t.exports={TinySDF:i(64),CharSDF:i(65),ImageSDF:i(66)}},function(t,e){function i(t,e,i,n,o,s,a){for(var l=0;l<e;l++){for(var h=0;h<i;h++)n[h]=t[h*e+l];for(r(n,o,s,a,i),h=0;h<i;h++)t[h*e+l]=o[h]}for(h=0;h<i;h++){for(l=0;l<e;l++)n[l]=t[h*e+l];for(r(n,o,s,a,e),l=0;l<e;l++)t[h*e+l]=Math.sqrt(o[l])}}function r(t,e,i,r,o){i[0]=0,r[0]=-n,r[1]=+n;for(var s=1,a=0;s<o;s++){for(var l=(t[s]+s*s-(t[i[a]]+i[a]*i[a]))/(2*s-2*i[a]);l<=r[a];)a--,l=(t[s]+s*s-(t[i[a]]+i[a]*i[a]))/(2*s-2*i[a]);a++,i[a]=s,r[a]=l,r[a+1]=+n}for(s=0,a=0;s<o;s++){for(;r[a+1]<s;)a++;e[s]=(s-i[a])*(s-i[a])+t[i[a]]}}var n=1e20,o=t.exports=function(t,e,i){this.radius=e||8,this.cutoff=i||.25,this.size=t,this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=t,this.ctx=this.canvas.getContext("2d"),this.gridOuter=new Float64Array(t*t),this.gridInner=new Float64Array(t*t),this.f=new Float64Array(t),this.d=new Float64Array(t),this.z=new Float64Array(t+1),this.v=new Int16Array(t),this.middle=Math.round(t/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))};o.prototype.clear=function(){this.ctx.clearRect(0,0,this.size,this.size)},o.prototype.sdfAlpha=function(){for(var t=this.ctx.getImageData(0,0,this.size,this.size),e=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var o=t.data[4*r+3]/255;this.gridOuter[r]=1===o?0:0===o?n:Math.pow(Math.max(0,.5-o),2),this.gridInner[r]=1===o?n:0===o?0:Math.pow(Math.max(0,o-.5),2)}for(i(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),i(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++){var s=this.gridOuter[r]-this.gridInner[r];e[r]=Math.max(0,Math.min(255,Math.round(255-255*(s/this.radius+this.cutoff))))}return e},o.prototype.makeRGBAImageData=function(t,e){for(var i=this.ctx.createImageData(e,e),r=i.data,n=0;n<t.length;n++)r[4*n+0]=t[n],r[4*n+1]=t[n],r[4*n+2]=t[n],r[4*n+3]=255;return i}},function(t,e,i){var r=i(64),n=t.exports=function(t,e,i,n,o,s){this.fontSize=t||24,this.buffer=void 0===e?3:e,r.call(this,this.fontSize+2*this.buffer,i,n),this.fontFamily=o||"sans-serif",this.fontWeight=s||"normal",this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.ctx.textAlign="center"};n.prototype=Object.create(r.prototype),n.prototype.draw=function(t){return this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.size/2,this.middle),this.sdfAlpha()}},function(t,e,i){var r=i(64),n=t.exports=function(t,e,i){r.call(this,t,e,i)};n.prototype=Object.create(r.prototype),n.prototype.draw=function(t){return this.ctx.clearRect(0,0,this.size,this.size),this.ctx.drawImage(t,0,0,this.size,this.size),this.sdfAlpha()}},function(t,e){function i(t,e){var i=document.createElement("canvas");i.width=e?e.width:Math.sqrt(t.length),i.height=e?e.height:Math.sqrt(t.length);var r=i.getContext("2d");e&&r.drawImage(e,0,0,e.width,e.height);for(var n=r.getImageData(0,0,i.width,i.height),o=n.data,s=0;s<t.length;s++)o[4*s+3]=t[s];return n}t.exports={makeRGBAImageData:i}},function(t,e,i){var r=i(59),n=i(48),o=i(62),s=i(23),a=i(22),l=i(63).ImageSDF,h=i(67),c=function(t,e,i){var o=1,s=1,c=this,u=new n(t.latitude-s/2,t.latitude+s/2,t.longitude-o/2,t.longitude+o/2);r.call(this,u,"images/point.png");var d=document.createElement("img");d.src=e,d.onload=function(){var t=new l(d.width).draw(d);c.imageSource=new a(h.makeRGBAImageData(t,d))},this.fakeVolume=.05*i};c.prototype=Object.create(r.prototype),c.prototype.beginRendering=function(t){var e=t.currentGlContext,i=t.findAndBindProgram(o);return i.loadTexSampler(e,e.TEXTURE0),i.loadColor(e,this.color||s.TRANSPARENT),i.loadOpacity(e,this.opacity),i.loadRotation(e,-t.navigatorState.heading*Math.PI/180),i.loadTilt(e,t.navigatorState.tilt/90),i.loadScreenSize(e,[window.engine.canvas.width,window.engine.canvas.height]),i.loadVolume(e,this.fakeVolume),i},t.exports=c},function(t,e,i){var r=i(70),n=(i(30),!1),o=r.prototype.retrieveTileImage;r.prototype.retrieveTileImage=function(t){n||o.call(this,t)}},function(t,e,i){var r,n;r=[i(21),i(13),i(9),i(71),i(72),i(73),i(8),i(24),i(48),i(50),i(17)],n=function(t,e,i,r,n,o,s,a,l,h,c){"use strict";var u=function(e,r,n,h,c,d,p){if(!e)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","constructor","missingSector"));if(!r)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","constructor","The specified level-zero delta is null or undefined."));if(!h)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","constructor","The specified image format is null or undefined."));if(!c)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","constructor","The specified cache path is null or undefined."));if(!n||n<1)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","constructor","The specified number of levels is not greater than zero."));if(!d||!p||d<1||p<1)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","constructor","The specified tile width or height is not greater than zero."));this.coverageSector=e,this.retrievalImageFormat=h,this.cachePath=c,this.displayName="Elevations",this.timestamp=Date.now(),this.minElevation=0,this.maxElevation=0,this.pixelIsPoint=!0,this.levels=new o(this.coverageSector,r,n,d,p),this.currentTiles=[],this.currentSector=new l(0,0,0,0),this.tileCache=new a(1e6,8e5),this.imageCache=new a(1e7,8e6),this.currentRetrievals=[],this.absentResourceList=new t(3,5e3),this.id=++u.idPool,this.stateKey="elevationModel "+this.id.toString()+" "};return u.idPool=0,u.prototype.minAndMaxElevationsForSector=function(t){if(!t)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","minAndMaxElevationsForSector","missingSector"));var r=this.levels.levelForTexelSize(t.deltaLatitude()*e.DEGREES_TO_RADIANS/64);if(this.assembleTiles(r,t,!1),0==this.currentTiles.length)return null;for(var n,o,a,l=Number.MAX_VALUE,h=-l,c=[],u=0,d=this.currentTiles.length;u<d;u++){if(n=this.currentTiles[u].image(),!n)return c[0]=this.minElevation,c[1]=this.maxElevation,c;o=n.minElevation,l>o&&(l=o),a=n.maxElevation,h<a&&(h=a)}return c[0]=l,c[1]=h,c},u.prototype.elevationAtLocation=function(t,e){return this.coverageSector.containsLocation(t,e)?this.pointElevationForLocation(t,e):0},u.prototype.elevationsForGrid=function(t,e,r,n,o){if(!t)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","elevationsForSector","missingSector"));if(!o)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","elevationsForSector","missingResult"));if(!e||!r||e<1||r<1)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","constructor","The specified number of latitudinal or longitudinal positions is less than one."));var a=this.levels.levelForTexelSize(n);return this.pixelIsPoint?this.pointElevationsForGrid(t,e,r,a,o):this.areaElevationsForGrid(t,e,r,a,o)},u.prototype.pointElevationForLocation=function(t,e){for(var i,r=this.levels.lastLevel(),n=r.tileDelta.latitude,o=r.tileDelta.longitude,s=h.computeRow(n,t),a=h.computeColumn(o,e),l=null,c=r.levelNumber;c>=0;c--){if(i=this.tileCache.entryForKey(c+"."+s+"."+a),i&&(l=i.image()))return l.elevationAtLocation(t,e);s=Math.floor(s/2),a=Math.floor(a/2)}return 0},u.prototype.pointElevationsForGrid=function(t,e,i,r,n){var o,s=0;if(this.assembleTiles(r,t,!0),0===this.currentTiles.length)return 0;this.currentTiles.sort(function(t,e){return t.level.levelNumber-e.level.levelNumber});for(var a=0,l=this.currentTiles.length;a<l;a++){var h=this.currentTiles[a],c=h.image();c?(c.elevationsForGrid(t,e,i,n),o=h.level.texelSize,s<o&&(s=o)):s=Number.MAX_VALUE}return s},u.prototype.areaElevationsForGrid=function(t,e,i,r,n){var o,s,a,l,h,c,u=t.minLatitude,d=t.maxLatitude,p=t.minLongitude,f=t.maxLongitude,g=t.deltaLatitude()/(e>1?e-1:1),m=t.deltaLongitude()/(i>1?i-1:1),E=0;for(h=0,o=u;h<e;h+=1,o+=g)for(h===e-1&&(o=d),c=0,s=p;c<i;c+=1,s+=m)c===i-1&&(s=f),this.coverageSector.containsLocation(o,s)&&(a=(s+180)/360,l=(o+90)/180,this.areaElevationForCoord(a,l,r.levelNumber,n,E)),E++;return r.texelSize},u.prototype.areaElevationForCoord=function(t,e,i,r,n){for(var o,s,a,l,h,u,d,p,f,g,m,E,v,y,_,T,L=new Float64Array(4),x=i;x>=0;x--)if(o=this.levels.level(x),s=Math.round(360*o.tileWidth/o.tileDelta.longitude),a=Math.round(180*o.tileHeight/o.tileDelta.latitude),l=1/(2*a),h=1-l,u=0,d=a-1,p=s*c.fract(t),f=a*c.clamp(e,l,h),g=c.mod(Math.floor(p-.5),s),m=c.mod(g+1,s),E=c.clamp(Math.floor(f-.5),u,d),v=c.clamp(E+1,u,d),y=c.fract(p-.5),_=c.fract(f-.5),T=x==i||0==x,this.lookupPixels(g,m,E,v,o,T,L))return void(r[n]=(1-y)*(1-_)*L[0]+y*(1-_)*L[1]+(1-y)*_*L[2]+y*_*L[3])},u.prototype.lookupPixels=function(t,e,i,r,n,o,s){var a,l,h,c,u=n.levelNumber,d=n.tileWidth,p=n.tileHeight,f=Math.floor(i/p),g=Math.floor(r/p),m=Math.floor(t/d),E=Math.floor(e/d);return f==g&&f==this.cachedRow&&m==E&&m==this.cachedCol?a=l=h=c=this.cachedImage:f==g&&m==E?(a=this.lookupImage(u,f,m,o),l=h=c=a,this.cachedRow=f,this.cachedCol=m,this.cachedImage=a):(a=this.lookupImage(u,f,m,o),l=this.lookupImage(u,f,E,o),h=this.lookupImage(u,g,m,o),c=this.lookupImage(u,g,E,o)),!!(a&&l&&h&&c)&&(s[0]=a.pixel(t%d,i%p),s[1]=l.pixel(e%d,i%p),s[2]=h.pixel(t%d,r%p),s[3]=c.pixel(e%d,r%p),!0)},u.prototype.lookupImage=function(t,e,i,r){var n=this.tileForLevel(t,e,i),o=n.image();return null==o&&r&&this.retrieveTileImage(n),o},u.prototype.createTile=function(t,e,i,r){var o=this.cachePath+"/"+e.levelNumber+"/"+i+"/"+i+"_"+r+".bil";return new n(t,e,i,r,o,this.imageCache)},u.prototype.assembleTiles=function(t,e,i){if(this.currentTiles=[],this.currentSector.copy(e),this.currentSector.intersection(this.coverageSector),!this.currentSector.isEmpty())for(var r=t.tileDelta.latitude,n=t.tileDelta.longitude,o=h.computeRow(r,this.currentSector.minLatitude),s=h.computeLastRow(r,this.currentSector.maxLatitude),a=h.computeColumn(n,this.currentSector.minLongitude),l=h.computeLastColumn(n,this.currentSector.maxLongitude),c=o;c<=s;c++)for(var u=a;u<=l;u++)this.addTileOrAncestor(t,c,u,i)},u.prototype.addTileOrAncestor=function(t,e,i,r){var n=this.tileForLevel(t.levelNumber,e,i);this.isTileImageInMemory(n)?this.addToCurrentTiles(n):(r&&this.retrieveTileImage(n),t.isFirstLevel()?this.currentTiles.push(n):this.addAncestor(t,e,i,r))},u.prototype.addAncestor=function(t,e,i,r){for(var n=null,o=Math.floor(e/2),s=Math.floor(i/2),a=t.levelNumber-1;a>=0;a--){if(n=this.tileForLevel(a,o,s),this.isTileImageInMemory(n))return void this.addToCurrentTiles(n);o=Math.floor(o/2),s=Math.floor(s/2)}this.addToCurrentTiles(n),r&&this.retrieveTileImage(n)},u.prototype.addToCurrentTiles=function(t){this.currentTiles.push(t)},u.prototype.tileForLevel=function(t,e,i){var r=t+"."+e+"."+i,n=this.tileCache.entryForKey(r);if(n)return n;var o=this.levels.level(t),s=h.computeSector(o,e,i);return n=this.createTile(s,o,e,i),this.tileCache.putEntry(r,n,n.size()),n},u.prototype.isTileImageInMemory=function(t){return this.imageCache.containsKey(t.imagePath)},u.prototype.resourceUrlForTile=function(t){return this.urlBuilder.urlForTile(t,this.retrievalImageFormat)},u.prototype.retrieveTileImage=function(t){if(this.currentRetrievals.indexOf(t.imagePath)<0){var e=this.resourceUrlForTile(t,this.retrievalImageFormat),i=new XMLHttpRequest,r=this;if(!e)return;i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){if(4===i.readyState){r.removeFromCurrentRetrievals(t.imagePath);var n=i.getResponseHeader("content-type");if(200===i.status)if(n===r.retrievalImageFormat||"text/plain"===n||"application/octet-stream"===n){s.log(s.LEVEL_INFO,"Elevations retrieval succeeded: "+e),r.loadElevationImage(t,i),r.absentResourceList.unmarkResourceAbsent(t.imagePath);var o=document.createEvent("Event");o.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(o)}else"text/xml"===n?(r.absentResourceList.markResourceAbsent(t.imagePath),s.log(s.LEVEL_WARNING,"Elevations retrieval failed ("+i.statusText+"): "+e+".\n "+String.fromCharCode.apply(null,new Uint8Array(i.response)))):(r.absentResourceList.markResourceAbsent(t.imagePath),s.log(s.LEVEL_WARNING,"Elevations retrieval failed: "+e+". Unexpected content type "+n));else r.absentResourceList.markResourceAbsent(t.imagePath),s.log(s.LEVEL_WARNING,"Elevations retrieval failed ("+i.statusText+"): "+e)}},i.onerror=function(){r.removeFromCurrentRetrievals(t.imagePath),r.absentResourceList.markResourceAbsent(t.imagePath),s.log(s.LEVEL_WARNING,"Elevations retrieval failed: "+e)},i.ontimeout=function(){r.removeFromCurrentRetrievals(t.imagePath),r.absentResourceList.markResourceAbsent(t.imagePath),s.log(s.LEVEL_WARNING,"Elevations retrieval timed out: "+e)},i.send(null),this.currentRetrievals.push(t.imagePath)}},u.prototype.removeFromCurrentRetrievals=function(t){var e=this.currentRetrievals.indexOf(t);e>-1&&this.currentRetrievals.splice(e,1)},u.prototype.loadElevationImage=function(t,e){var i=new r(t.imagePath,t.sector,t.tileWidth,t.tileHeight);"application/bil16"==this.retrievalImageFormat?(i.imageData=new Int16Array(e.response),i.size=2*i.imageData.length):"application/bil32"==this.retrievalImageFormat&&(i.imageData=new Float32Array(e.response),i.size=4*i.imageData.length),i.imageData&&(i.findMinAndMaxElevation(),this.imageCache.putEntry(t.imagePath,i,i.size),this.timestamp=Date.now())},u}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(17)],n=function(t,e,i){"use strict";var r=function(i,r,n,o){if(!i||i.length<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"ElevationImage","constructor","The specified image path is null, undefined or zero length."));if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"ElevationImage","constructor","missingSector"));this.sector=r,this.imagePath=i,this.imageWidth=n,this.imageHeight=o,this.size=this.imageWidth*this.imageHeight};return r.prototype.pixel=function(t,e){return t<0||t>=this.imageWidth?0:e<0||e>=this.imageHeight?0:(e=this.imageHeight-e-1,this.imageData[t+e*this.imageWidth])},r.prototype.elevationAtLocation=function(t,e){var r=this.sector.maxLatitude,n=this.sector.minLongitude,o=this.sector.deltaLatitude(),s=this.sector.deltaLongitude(),a=(this.imageWidth-1)*(e-n)/s,l=(this.imageHeight-1)*(r-t)/o,h=Math.floor(i.clamp(a,0,this.imageWidth-1)),c=Math.floor(i.clamp(h+1,0,this.imageWidth-1)),u=Math.floor(i.clamp(l,0,this.imageHeight-1)),d=Math.floor(i.clamp(u+1,0,this.imageHeight-1)),p=this.imageData,f=p[h+u*this.imageWidth],g=p[c+u*this.imageWidth],m=p[h+d*this.imageWidth],E=p[c+d*this.imageWidth],v=a-h,y=l-u;return(1-v)*(1-y)*f+v*(1-y)*g+(1-v)*y*m+v*y*E},r.prototype.elevationsForGrid=function(r,n,o,s){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"ElevationImage","elevationsForSector","missingSector"));if(n<1||o<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"ElevationImage","elevationsForSector","The specified number of sample points is less than 1."));if(!s)throw new t(e.logMessage(e.LEVEL_SEVERE,"ElevationImage","elevationsForSector","missingResult"));var a,l,h,c,u=this.sector.minLatitude,d=this.sector.maxLatitude,p=this.sector.minLongitude,f=this.sector.maxLongitude,g=d-u,m=f-p,E=r.minLatitude,v=r.maxLatitude,y=r.minLongitude,_=r.maxLongitude,T=(v-E)/(n>1?n-1:1),L=(_-y)/(o>1?o-1:1),x=0,b=this.imageData;for(c=0,a=E;c<n;c+=1,a+=T)if(c===n-1&&(a=v),a>=u&&a<=d){var S=(this.imageHeight-1)*(d-a)/g,w=Math.floor(i.clamp(S,0,this.imageHeight-1)),M=Math.floor(i.clamp(w+1,0,this.imageHeight-1)),R=S-w;
for(h=0,l=y;h<o;h+=1,l+=L){if(h===o-1&&(l=_),l>=p&&l<=f){var A=(this.imageWidth-1)*(l-p)/m,C=Math.floor(i.clamp(A,0,this.imageWidth-1)),P=Math.floor(i.clamp(C+1,0,this.imageWidth-1)),I=A-C,D=b[C+w*this.imageWidth],N=b[P+w*this.imageWidth],O=b[C+M*this.imageWidth],V=b[P+M*this.imageWidth];s[x]=(1-I)*(1-R)*D+I*(1-R)*N+(1-I)*R*O+I*R*V}x++}}else x+=o},r.prototype.minAndMaxElevationsForSector=function(t){var e=[];if(t)if(t.contains(this.sector))e[0]>this.minElevation&&(e[0]=this.minElevation),e[1]<this.maxElevation&&(e[1]=this.maxElevation);else{var r=this.sector.maxLatitude,n=this.sector.minLongitude,o=this.sector.deltaLatitude(),s=this.sector.deltaLongitude(),a=t.minLatitude,l=t.maxLatitude,h=t.minLongitude,c=t.maxLongitude,u=Math.floor((this.imageHeight-1)*(r-l)/o),d=Math.ceil((this.imageHeight-1)*(r-a)/o),p=Math.floor((this.imageWidth-1)*(h-n)/s),f=Math.ceil((this.imageWidth-1)*(c-n)/s);u=i.clamp(u,0,this.imageHeight-1),d=i.clamp(d,0,this.imageHeight-1),p=i.clamp(p,0,this.imageWidth-1),f=i.clamp(f,0,this.imageWidth-1);for(var g=this.imageData,m=Number.MAX_VALUE,E=-m,v=u;v<=d;v++)for(var y=p;y<=f;y++){var _=g[Math.floor(y+v*this.imageWidth)];m>_&&(m=_),E<_&&(E=_)}e[0]>m&&(e[0]=m),e[1]<E&&(e[1]=E)}else e[0]=this.minElevation,e[1]=this.maxElevation;return e},r.prototype.findMinAndMaxElevation=function(){if(this.imageData&&this.imageData.length>0){this.minElevation=Number.MAX_VALUE,this.maxElevation=-this.minElevation;for(var t=this.imageData,e=this.imageWidth*this.imageHeight,i=0;i<e;i++){var r=t[i];this.minElevation>r&&(this.minElevation=r),this.maxElevation<r&&(this.maxElevation=r)}}else this.minElevation=0,this.maxElevation=0},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(50)],n=function(t,e,i){"use strict";var r=function(r,n,o,s,a,l){if(!a||a.length<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"ElevationTile","constructor","The specified image path is null, undefined or zero length."));if(!l)throw new t(e.logMessage(e.LEVEL_SEVERE,"ElevationTile","constructor","The specified cache is null or undefined."));i.call(this,r,n,o,s),this.imagePath=a,this.memoryCache=l};return r.prototype=Object.create(i.prototype),r.prototype.size=function(){return i.prototype.size.call(this)+this.imagePath.length+8},r.prototype.image=function(){return this.memoryCache.entryForKey(this.imagePath)},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(47),i(14),i(8)],n=function(t,e,i,r){"use strict";var n=function(n,o,s,a,l){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","missingSector"));if(!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified level zero delta is null or undefined"));if(o.latitude<=0||o.longitude<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified level zero delta is less than or equal to zero."));if(s<1)throw new t(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified number of levels is less than one."));if(a<1||l<1)throw new t(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified tile width or tile height is less than one."));this.sector=n,this.levelZeroDelta=o,this.numLevels=s,this.tileWidth=a,this.tileHeight=l,this.levels=[];for(var h=0;h<s;h+=1){var c=Math.pow(2,h),u=o.latitude/c,d=o.longitude/c,p=new i(u,d),f=new e(h,p,this);this.levels[h]=f}};return n.prototype.level=function(t){return t<0||t>=this.levels.length?null:this.levels[t]},n.prototype.levelForTexelSize=function(t){var e=this.lastLevel();if(e.texelSize>=t)return e;for(var i=0,r=this.levels.length;i<r;i+=1){var n=this.levels[i];if(n.texelSize<=t)return n}return e},n.prototype.firstLevel=function(){return this.levels[0]},n.prototype.lastLevel=function(){return this.levels[this.levels.length-1]},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=i(75),n=i(77),o="vec4 applyProjection(vec4 blh) {\n    float lat = blh.x * DEGREES_TO_RADIANS;\n    float lon = blh.y * DEGREES_TO_RADIANS;\n    float alt = blh.z;\n    float cosLat = cos(lat);\n    float sinLat = sin(lat);\n    float cosLon = cos(lon);\n    float sinLon = sin(lon);\n    float rpm = GLOBE_EQUATORIAL_RADIUS / sqrt(1.0 - GLOBE_ECCENTRICITY_SQUARED * sinLat * sinLat);\n    return vec4(        (rpm + alt) * cosLat * sinLon,\n        (rpm * (1.0 - GLOBE_ECCENTRICITY_SQUARED) + alt) * sinLat,\n        (rpm + alt) * cosLat * cosLon,\n        1.0\n    );\n}\n",s=function(t){n.call(this,t,o)};s.prototype=Object.create(n.prototype),s.key="Wgs84ProjectionGpuProgram",r.prototype.shader=s},function(t,e,i){var r,n;r=[i(13),i(9),i(76),i(8),i(12),i(11),i(17)],n=function(t,e,i,r,n,o,s){"use strict";var a=function(){i.call(this,"WGS84",!1,null),this.is2D=!1,this.scratchPosition=new n(0,0,0)};return a.prototype=Object.create(i.prototype),Object.defineProperties(a.prototype,{stateKey:{get:function(){return"projection wgs84 "}}}),a.prototype.geographicToCartesian=function(i,n,o,s,a,l){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionWgs84","geographicToCartesian","missingGlobe"));var h=Math.cos(n*t.DEGREES_TO_RADIANS),c=Math.sin(n*t.DEGREES_TO_RADIANS),u=Math.cos(o*t.DEGREES_TO_RADIANS),d=Math.sin(o*t.DEGREES_TO_RADIANS),p=i.equatorialRadius/Math.sqrt(1-i.eccentricitySquared*c*c);return l[0]=(p+s)*h*d,l[1]=(p*(1-i.eccentricitySquared)+s)*c,l[2]=(p+s)*h*u,l},a.prototype.geographicToCartesianGrid=function(i,n,s,a,l,h,c,u){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionWgs84","geographicToCartesianGrid","missingGlobe"));var d,p,f,g,m,E,v,y,_=n.minLatitude*t.DEGREES_TO_RADIANS,T=n.maxLatitude*t.DEGREES_TO_RADIANS,L=n.minLongitude*t.DEGREES_TO_RADIANS,x=n.maxLongitude*t.DEGREES_TO_RADIANS,b=(T-_)/(s>1?s-1:1),S=(x-L)/(a>1?a-1:1),w=h?h:new o(0,0,0),M=0,R=0,A=new Float64Array(a),C=new Float64Array(a);for(p=0,g=L;p<a;p++,g+=S)p===a-1&&(g=x),A[p]=Math.cos(g),C[p]=Math.sin(g);for(d=0,f=_;d<s;d++,f+=b)for(d===s-1&&(f=T),v=Math.cos(f),y=Math.sin(f),m=i.equatorialRadius/Math.sqrt(1-i.eccentricitySquared*y*y),p=0;p<a;p++)E=l[M++],u[R++]=(m+E)*v*C[p]-w[0],u[R++]=(m*(1-i.eccentricitySquared)+E)*y-w[1],u[R++]=(m+E)*v*A[p]-w[2];return u},a.prototype.cartesianToGeographic=function(i,n,o,a,l,h){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionWgs84","cartesianToGeographic","missingGlobe"));var c,u,d,p,f,g,m,E,v,y,_,T,L,x,b,S=a,w=n,M=o,R=S*S+w*w,A=Math.sqrt(R),C=i.equatorialRadius,P=1/(C*C),I=i.eccentricitySquared,D=I*I,N=R*P,O=M*M*(1-I)*P,V=(N+O-D)/6,G=8*V*V*V+D*N*O;return G>0||0!=O?(G>0?(p=Math.sqrt(G),f=Math.sqrt(D*N*O),G>10*I?(g=s.cbrt((p+f)*(p+f)),d=V+.5*g+2*V*V/g):d=V+.5*s.cbrt((p+f)*(p+f))+.5*s.cbrt((p-f)*(p-f))):(p=Math.sqrt(-G),f=Math.sqrt(-8*V*V*V),g=Math.sqrt(D*N*O),m=2*Math.atan2(g,p+f)/3,d=-4*V*Math.sin(m)*Math.cos(Math.PI/6+m)),E=Math.sqrt(d*d+D*O),v=I*(d+E-O)/(2*E),y=(d+E)/(Math.sqrt(v*v+d+E)+v),_=y*A/(y+I),T=Math.sqrt(_*_+M*M),c=(y+I-1)*T/y,u=2*Math.atan2(M,T+_)):(p=Math.sqrt(1-I),f=Math.sqrt(I-N),L=Math.sqrt(I),c=-C*p*f/L,u=f/(L*f+p*Math.sqrt(N))),b=Math.sqrt(2),x=(b-1)*w<A+S?2*Math.atan2(w,A+S):A+w<(b+1)*S?.5*-Math.PI+2*Math.atan2(S,A-w):.5*Math.PI-2*Math.atan2(S,A+w),h.latitude=t.RADIANS_TO_DEGREES*u,h.longitude=t.RADIANS_TO_DEGREES*x,h.altitude=c,h},a.prototype.northTangentAtLocation=function(e,i,r,n){var o=Math.cos(i*t.DEGREES_TO_RADIANS),s=Math.cos(r*t.DEGREES_TO_RADIANS),a=Math.sin(i*t.DEGREES_TO_RADIANS),l=Math.sin(r*t.DEGREES_TO_RADIANS);return n[0]=-a*l,n[1]=o,n[2]=-a*s,n},a.prototype.northTangentAtPoint=function(t,e,i,r,n,s){return this.cartesianToGeographic(t,e,i,r,o.ZERO,this.scratchPosition),this.northTangentAtLocation(t,this.scratchPosition.latitude,this.scratchPosition.longitude,s)},a.prototype.surfaceNormalAtPoint=function(t,i,n,o,s){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionWgs84","surfaceNormalAtPoint","missingGlobe"));var a=t.equatorialRadius*t.equatorialRadius,l=t.polarRadius*t.polarRadius;return s[0]=i/a,s[1]=n/l,s[2]=o/a,s.normalize()},a}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(48),i(39)],n=function(t,e,i,r){"use strict";var n=function(t,e,i){this.displayName=t||"Geographic Projection",this.continuous=e,this.projectionLimits=i,this.is2D=!0};return n.prototype.geographicToCartesian=function(t,i,n,o,s,a){throw new r(e.logMessage(e.LEVEL_SEVERE,"GeographicProjection","geographicToCartesian","abstractInvocation"))},n.prototype.geographicToCartesianGrid=function(t,i,n,o,s,a,l,h){throw new r(e.logMessage(e.LEVEL_SEVERE,"GeographicProjection","geographicToCartesianGrid","abstractInvocation"))},n.prototype.cartesianToGeographic=function(t,i,n,o,s,a){throw new r(e.logMessage(e.LEVEL_SEVERE,"GeographicProjection","cartesianToGeographic","abstractInvocation"))},n.prototype.northTangentAtLocation=function(i,r,n,o){if(!o)throw new t(e.logMessage(e.LEVEL_SEVERE,"ProjectionEquirectangular","northTangentAtLocation","missingResult"));return o[0]=0,o[1]=1,o[2]=0,o},n.prototype.northTangentAtPoint=function(i,r,n,o,s,a){if(!a)throw new t(e.logMessage(e.LEVEL_SEVERE,"ProjectionEquirectangular","northTangentAtPoint","missingResult"));return a[0]=0,a[1]=1,a[2]=0,a},n.prototype.surfaceNormalAtPoint=function(i,r,n,o,s){if(!s)throw new t(e.logMessage(e.LEVEL_SEVERE,"GeographicProjection","surfaceNormalAtPoint","missingResult"));return s[0]=0,s[1]=0,s[2]=1,s},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=(i(9),i(23),i(54)),n=(i(8),"attribute vec4 vertexPoint;\nattribute vec4 vertexTexCoord;\nattribute vec4 normalVector;\nattribute float groundPoints;\nuniform float height;\nuniform vec3 referencePoint;\nuniform float minHeight;\nuniform mat4 mvpMatrix;\nuniform mat4 mvInverseMatrix;\nuniform mat4 texCoordMatrix;\nuniform bool applyLighting;\nvarying vec2 texCoord;\nvarying vec3 normalInterp;\nvarying float gradient;\nvarying vec3 vertPos;\nconst float PI = 3.141592653589;\nconst float DEGREES_TO_RADIANS = PI / 180.0;\nconst float GLOBE_EQUATORIAL_RADIUS = 6378137.0;\nconst float GLOBE_ECCENTRICITY_SQUARED = 0.00669437999013;\n"),o="void main() {   if (groundPoints > 0.0) {\n       gradient = 1.0;\n   } else {\n       gradient = 0.0;\n   }\n   vec4 point = vertexPoint;\n   gl_Position = mvpMatrix * point;\n   texCoord = (texCoordMatrix * vertexTexCoord).st;\n   if (applyLighting) {\n       vertPos = point.xyz;\n       normalInterp = normalVector.xyz;\n   }\n}",s="precision highp float;\nuniform float opacity;\nuniform vec4 color;\nuniform bool enableTexture;\nuniform bool modulateColor;\nuniform sampler2D textureSampler;\nuniform bool applyLighting;\nvarying vec2 texCoord;\nvarying vec3 normalInterp;\nvarying float gradient;\nvarying vec3 vertPos;\nconst vec3 lightPos = vec3(0.0, 0.0, 0.0);\nconst vec3 specColor = vec3(0.3, 0.3, 0.3);\nvoid main() {\n    vec3 ambientColor = color.xyz * 0.7;\n    gl_FragColor = color * opacity;\n    if (gradient < 0.99999) {\n       if (color.r + color.g + color.b < 0.1) {\n           gl_FragColor.rgb += gradient / 3.0;\n       } else {\n           gl_FragColor.rgb *= 1.0 - gradient / 2.0;\n       }\n    }\n}",a=function(t,e){var i=["vertexPoint","normalVector","vertexTexCoord","groundPoints"],a=n+e+o;r.call(this,t,a,s,i),this.vertexPointLocation=this.attributeLocation(t,"vertexPoint"),this.normalVectorLocation=this.attributeLocation(t,"normalVector"),this.vertexTexCoordLocation=this.attributeLocation(t,"vertexTexCoord"),this.groundPointsLocation=this.attributeLocation(t,"groundPoints"),this.mvpMatrixLocation=this.uniformLocation(t,"mvpMatrix"),this.mvInverseMatrixLocation=this.uniformLocation(t,"mvInverseMatrix"),this.colorLocation=this.uniformLocation(t,"color"),this.textureEnabledLocation=this.uniformLocation(t,"enableTexture"),this.modulateColorLocation=this.uniformLocation(t,"modulateColor"),this.textureUnitLocation=this.uniformLocation(t,"textureSampler"),this.textureMatrixLocation=this.uniformLocation(t,"texCoordMatrix"),this.opacityLocation=this.uniformLocation(t,"opacity"),this.applyLightingLocation=this.uniformLocation(t,"applyLighting"),this.heightLocation=this.uniformLocation(t,"height"),this.minHeightLocation=this.uniformLocation(t,"minHeight"),this.referencePointLocation=this.uniformLocation(t,"referencePoint")};a.prototype=Object.create(r.prototype),a.prototype.loadReferencePoint=function(t,e){t.uniform3f(this.referencePointLocation,e[0],e[1],e[2])},a.prototype.loadModelviewInverse=function(t,e){this.loadUniformMatrix(t,e,this.mvInverseMatrixLocation)},a.prototype.loadModelviewProjection=function(t,e){this.loadUniformMatrix(t,e,this.mvpMatrixLocation)},a.prototype.loadColor=function(t,e){this.loadUniformColor(t,e,this.colorLocation)},a.prototype.loadTextureEnabled=function(t,e){t.uniform1i(this.textureEnabledLocation,e?1:0)},a.prototype.loadModulateColor=function(t,e){t.uniform1i(this.modulateColorLocation,e?1:0)},a.prototype.loadTextureUnit=function(t,e){t.uniform1i(this.textureUnitLocation,e-t.TEXTURE0)},a.prototype.loadTextureMatrix=function(t,e){this.loadUniformMatrix(t,e,this.textureMatrixLocation)},a.prototype.loadOpacity=function(t,e){t.uniform1f(this.opacityLocation,e)},a.prototype.loadHeight=function(t,e){t.uniform1f(this.heightLocation,e)},a.prototype.loadMinHeight=function(t,e){t.uniform1f(this.minHeightLocation,e)},a.prototype.loadApplyLighting=function(t,e){t.uniform1i(this.applyLightingLocation,e)},t.exports=a},function(t,e,i){var r=i(79),n=i(77),o="const float ECC = sqrt(GLOBE_ECCENTRICITY_SQUARED);\nvec4 applyProjection(vec4 point) {\n    float sinLat = sin(point.x * DEGREES_TO_RADIANS);\n    float eccSinLat = ECC * sinLat;\n    float s = ((1.0 + sinLat) / (1.0 - sinLat)) * pow((1.0 - eccSinLat) / (1.0 + eccSinLat), ECC);\n    return vec4(        GLOBE_EQUATORIAL_RADIUS * point.y * DEGREES_TO_RADIANS,\n        0.5 * GLOBE_EQUATORIAL_RADIUS * log(s),\n        point.z,\n        1.0\n    );\n}\n",s=function(t){n.call(this,t,o)};s.prototype=Object.create(n.prototype),s.key="MercatorProjectionGpuProgram",r.prototype.shader=s},function(t,e,i){var r,n;r=[i(13),i(9),i(76),i(8),i(48),i(11),i(17)],n=function(t,e,i,r,n,o,s){"use strict";var a=function(){i.call(this,"Mercator",!0,new n(-78,78,-180,180))};return a.prototype=Object.create(i.prototype),a.prototype.geographicToCartesian=function(i,n,o,s,a,l){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesian","missingGlobe"));if(!l)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesian","missingResult"));n>this.projectionLimits.maxLatitude&&(n=this.projectionLimits.maxLatitude),n<this.projectionLimits.minLatitude&&(n=this.projectionLimits.minLatitude);var h=Math.sqrt(i.eccentricitySquared),c=Math.sin(n*t.DEGREES_TO_RADIANS),u=(1+c)/(1-c)*Math.pow((1-h*c)/(1+h*c),h);return l[0]=i.equatorialRadius*o*t.DEGREES_TO_RADIANS+(a?a[0]:0),l[1]=.5*i.equatorialRadius*Math.log(u),l[2]=s,l},Object.defineProperties(a.prototype,{stateKey:{get:function(){return"projection mercator "}}}),a.prototype.geographicToCartesianGrid=function(i,n,a,l,h,c,u,d){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","missingGlobe"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","missingSector"));if(!h||h.length<a*l)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!d)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","missingResult"));var p,f,g,m,E,v,y,_,T=i.equatorialRadius,L=Math.sqrt(i.eccentricitySquared),x=n.minLatitude*t.DEGREES_TO_RADIANS,b=n.maxLatitude*t.DEGREES_TO_RADIANS,S=n.minLongitude*t.DEGREES_TO_RADIANS,w=n.maxLongitude*t.DEGREES_TO_RADIANS,M=(b-x)/(a>1?a-1:1),R=(w-S)/(l>1?l-1:1),A=this.projectionLimits.minLatitude*t.DEGREES_TO_RADIANS,C=this.projectionLimits.maxLatitude*t.DEGREES_TO_RADIANS,P=c?c:new o(0,0,0),I=u?u[0]:0,D=0,N=0;for(p=0,g=x;p<a;p++,g+=M)for(p===a-1&&(g=b),E=s.clamp(g,A,C),v=Math.sin(E),y=(1+v)/(1-v)*Math.pow((1-L*v)/(1+L*v),L),_=T*Math.log(y)*.5-P[1],f=0,m=S;f<l;f++,m+=R)f===l-1&&(m=w),d[N++]=T*m-P[0]+I,d[N++]=_,d[N++]=h[D++]-P[2];return d},a.prototype.cartesianToGeographic=function(i,n,o,s,a,l){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","cartesianToGeographic","missingGlobe"));if(!l)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","cartesianToGeographic","missingResult"));var h=i.eccentricitySquared,c=h*h,u=c*h,d=u*h,p=Math.pow(Math.E,-o/i.equatorialRadius),f=Math.PI/2-2*Math.atan(p),g=h/2+5*c/24+u/12+13*d/360,m=7*c/48+29*u/240+811*d/11520,E=7*u/120+81*d/1120,v=4279*d/161280,y=f-m+v,_=g-3*E,T=2*m-8*v,L=4*E,x=8*v,b=Math.sin(2*f),S=y+b*(_+b*(T+b*(L+x*b)));return l.latitude=S*t.RADIANS_TO_DEGREES,l.longitude=(n-(a?a[0]:0))/i.equatorialRadius*t.RADIANS_TO_DEGREES,l.altitude=s,l},a}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=i(81),n=i(77),o="const float COEFFICIENT = GLOBE_EQUATORIAL_RADIUS * DEGREES_TO_RADIANS;\nvec4 applyProjection(vec4 point) {\n    return vec4(        COEFFICIENT * point.y,\n        COEFFICIENT * point.x,\n        point.z,\n        1.0\n    );\n}\n",s=function(t){n.call(this,t,o)};s.prototype=Object.create(n.prototype),s.key="EquirectangularProjectionGpuProgram",r.prototype.shader=s},function(t,e,i){var r,n;r=[i(13),i(9),i(76),i(8),i(11)],n=function(t,e,i,r,n){"use strict";var o=function(){i.call(this,"Equirectangular",!0,null)};return o.prototype=Object.create(i.prototype),Object.defineProperties(o.prototype,{stateKey:{get:function(){return"projection equirectangular "}}}),o.prototype.geographicToCartesian=function(i,n,o,s,a,l){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesian","missingGlobe"));if(!l)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesian","missingResult"));return l[0]=i.equatorialRadius*o*t.DEGREES_TO_RADIANS+(a?a[0]:0),l[1]=i.equatorialRadius*n*t.DEGREES_TO_RADIANS,l[2]=s,l},o.prototype.geographicToCartesianGrid=function(i,o,s,a,l,h,c,u){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","missingGlobe"));if(!o)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","missingSector"));if(!l||l.length<s*a)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!u)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","missingResult"));var d,p,f,g,m,E=i.equatorialRadius,v=o.minLatitude*t.DEGREES_TO_RADIANS,y=o.maxLatitude*t.DEGREES_TO_RADIANS,_=o.minLongitude*t.DEGREES_TO_RADIANS,T=o.maxLongitude*t.DEGREES_TO_RADIANS,L=(y-v)/(s>1?s-1:1),x=(T-_)/(a>1?a-1:1),b=h?h:new n(0,0,0),S=c?c[0]:0,w=0,M=0;for(d=0,f=v;d<s;d++,f+=L)for(d===s-1&&(f=y),m=E*f-b[1],p=0,g=_;p<a;p++,g+=x)p===a-1&&(g=T),u[M++]=E*g-b[0]+S,u[M++]=m,u[M++]=l[w++]-b[2];return u},o.prototype.cartesianToGeographic=function(i,n,o,s,a,l){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","cartesianToGeographic","missingGlobe"));if(!l)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","cartesianToGeographic","missingResult"));return l.latitude=o/i.equatorialRadius*t.RADIANS_TO_DEGREES,l.longitude=(n-(a?a[0]:0))/i.equatorialRadius*t.RADIANS_TO_DEGREES,l.altitude=s,l},o}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(94),i(83),i(85),i(86),i(91),i(93),i(20),i(8),i(33),i(38),i(95),i(18),i(48),i(104),i(106),i(88),i(7)],n=function(t,e,i,r,n,o,s,a,l,h,c,u,d,p,f,g,m,E){"use strict";var v=function(o,a){function c(t){m.handleContextLost(t)}function u(t){m.handleContextRestored(t)}function p(t){m.handleRedrawEvent(t)}if(!window.WebGLRenderingContext)throw new t(l.logMessage(l.LEVEL_SEVERE,"WorldWindow","constructor","The specified canvas does not support WebGL."));var f=document.getElementById(o);if(!f)throw new t(l.logMessage(l.LEVEL_SEVERE,"WorldWindow","constructor","The specified canvas name is not in the document."));var g=this.createContext(f);this.drawContext=new e(g),this.eventListeners={},this.redrawRequested=!0,this.redrawRequestId=null,this.canvas=f,this.depthBits=g.getParameter(g.DEPTH_BITS),this.viewport=new d(0,0,g.drawingBufferWidth,g.drawingBufferHeight),this.globe=new n(a||new i),this.layers=[],this.navigator=new h(this),this.verticalExaggeration=1,this.deepPicking=!1,this.subsurfaceMode=!1,this.surfaceOpacity=1,this.frameStatistics=new r,this.goToAnimator=new s(this),this._redrawCallbacks=[],this._orderedRenderingFilters=[function(t){m.declutter(t,1)},function(t){m.declutter(t,2)}],this.pixelScale=1;var m=this;this.canvas.addEventListener("webglcontextlost",c,!1),this.canvas.addEventListener("webglcontextrestored",u,!1),this.canvas.addEventListener(WorldWind.REDRAW_EVENT_TYPE,p,!1),window.addEventListener(WorldWind.REDRAW_EVENT_TYPE,p,!1),this.animationFrameLoop()};return Object.defineProperties(v.prototype,{orderedRenderingFilters:{get:function(){return this._orderedRenderingFilters}},redrawCallbacks:{get:function(){return this._redrawCallbacks}}}),v.prototype.canvasCoordinates=function(t,e){var i=this.canvas.getBoundingClientRect(),r=t-(i.left+this.canvas.clientLeft),n=e-(i.top+this.canvas.clientTop);return new E(r,n)},v.prototype.addEventListener=function(e,i){if(!e)throw new t(l.logMessage(l.LEVEL_SEVERE,"WorldWindow","addEventListener","missingType"));if(!i)throw new t(l.logMessage(l.LEVEL_SEVERE,"WorldWindow","addEventListener","missingListener"));var r=this,n=this.eventListeners[e];n||(n={listeners:[],callback:function(t){t.worldWindow=r;for(var e=0,i=n.listeners.length;e<i;e++)n.listeners[e](t)}},this.eventListeners[e]=n);var o=n.listeners.indexOf(i);o==-1&&(n.listeners.splice(0,0,i),1==n.listeners.length&&this.canvas.addEventListener(e,n.callback,!1))},v.prototype.removeEventListener=function(e,i){if(!e)throw new t(l.logMessage(l.LEVEL_SEVERE,"WorldWindow","removeEventListener","missingType"));if(!i)throw new t(l.logMessage(l.LEVEL_SEVERE,"WorldWindow","removeEventListener","missingListener"));var r=this.eventListeners[e];if(r){var n=r.listeners.indexOf(i);n!=-1&&(r.listeners.splice(n,1),0==r.listeners.length&&this.canvas.removeEventListener(e,r.callback,!1))}},v.prototype.redraw=function(){this.redrawRequested=!0},v.prototype.pick=function(e){if(!e)throw new t(l.logMessage(l.LEVEL_SEVERE,"WorldWindow","pick","missingPoint"));return this.drawContext.currentGlContext.isContextLost()?new u:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.pickPoint=e,this.drawFrame(),this.drawContext.objectsAtPickPoint)},v.prototype.pickTerrain=function(e){if(!e)throw new t(l.logMessage(l.LEVEL_SEVERE,"WorldWindow","pickTerrain","missingPoint"));return this.drawContext.currentGlContext.isContextLost()?new u:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.pickTerrainOnly=!0,this.drawContext.pickPoint=e,this.drawFrame(),this.drawContext.objectsAtPickPoint)},v.prototype.pickShapesInRegion=function(e){if(!e)throw new t(l.logMessage(l.LEVEL_SEVERE,"WorldWindow","pickShapesInRegion","missingRectangle"));return this.drawContext.currentGlContext.isContextLost()?new u:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.regionPicking=!0,this.drawContext.pickRectangle=new d(e.x,this.canvas.height-e.y,e.width,e.height),this.drawFrame(),this.drawContext.objectsAtPickPoint)},v.prototype.createContext=function(t){var e={antialias:!1,stencil:!0},i=t.getContext("webgl",e);i||(i=t.getContext("experimental-webgl",e));var r=i.getContextAttributes();return this.hasStencilBuffer=r.stencil,i},v.prototype.handleContextLost=function(t){l.log(l.LEVEL_INFO,"WebGL context event: "+t.statusMessage),t.preventDefault(),this.drawContext.contextLost(),window.cancelAnimationFrame(this.redrawRequestId)},v.prototype.handleContextRestored=function(t){l.log(l.LEVEL_INFO,"WebGL context event: "+t.statusMessage),this.drawContext.contextRestored(),this.redraw(),this.animationFrameLoop()},v.prototype.handleRedrawEvent=function(t){this.redraw()},v.prototype.animationFrameLoop=function(){function t(){e.animationFrameLoop()}this.redrawIfNeeded();var e=this;this.redrawRequestId=window.requestAnimationFrame(t)},v.prototype.redrawIfNeeded=function(){if(this.resize(),this.redrawRequested)try{this.redrawRequested=!1,this.drawContext.previousRedrawTimestamp=this.drawContext.timestamp,this.callRedrawCallbacks(WorldWind.BEFORE_REDRAW),this.resetDrawContext(),this.drawFrame()}catch(t){l.logMessage(l.LEVEL_SEVERE,"WorldWindow","redrawIfNeeded","Exception occurred during redrawing.\n"+t.toString())}finally{this.callRedrawCallbacks(WorldWind.AFTER_REDRAW),this.drawContext.redrawRequested&&(this.redrawRequested=!0)}},v.prototype.resize=function(){var t=this.drawContext.currentGlContext,e=t.canvas.clientWidth*this.pixelScale,i=t.canvas.clientHeight*this.pixelScale;t.canvas.width==e&&t.canvas.height==i||(t.canvas.width=e,t.canvas.height=i,t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),this.viewport=new d(0,0,t.drawingBufferWidth,t.drawingBufferHeight),this.redrawRequested=!0)},v.prototype.resetDrawContext=function(){this.globe.offset=0;var t=this.drawContext;t.reset(),t.globe=this.globe,t.layers=this.layers,t.navigatorState=this.navigator.currentState(),t.verticalExaggeration=this.verticalExaggeration,t.surfaceOpacity=this.surfaceOpacity,t.deepPicking=this.deepPicking,t.frameStatistics=this.frameStatistics,t.pixelScale=this.pixelScale,t.update()},v.prototype.drawFrame=function(){try{this.drawContext.frameStatistics.beginFrame(),this.beginFrame(),this.drawContext.globe.is2D()&&this.drawContext.globe.continuous?this.do2DContiguousRepaint():this.doNormalRepaint()}finally{this.endFrame(),this.drawContext.frameStatistics.endFrame()}},v.prototype.doNormalRepaint=function(){this.createTerrain(),this.clearFrame(),this.deferOrderedRendering=!1,this.drawContext.pickingMode?this.drawContext.makePickFrustum()&&(this.doPick(),this.resolvePick()):(this.doDraw(),this.subsurfaceMode&&this.hasStencilBuffer&&(this.redrawSurface(),this.drawScreenRenderables()))},v.prototype.do2DContiguousRepaint=function(){this.createTerrain2DContiguous(),this.clearFrame(),this.drawContext.pickingMode?this.drawContext.makePickFrustum()&&(this.pick2DContiguous(),this.resolvePick()):this.draw2DContiguous()},v.prototype.resolvePick=function(){this.drawContext.pickTerrainOnly?this.resolveTerrainPick():this.drawContext.regionPicking?this.resolveRegionPick():this.resolveTopPick()},v.prototype.beginFrame=function(){var t=this.drawContext.currentGlContext;t.enable(t.BLEND),t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.depthFunc(t.LEQUAL),this.drawContext.pickingMode&&(this.drawContext.makePickFramebuffer(),this.drawContext.bindFramebuffer(this.drawContext.pickFramebuffer))},v.prototype.endFrame=function(){var t=this.drawContext.currentGlContext;t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.blendFunc(t.ONE,t.ZERO),t.depthFunc(t.LESS),t.clearColor(0,0,0,1),this.drawContext.bindFramebuffer(null),this.drawContext.bindProgram(null)},v.prototype.clearFrame=function(){var t=this.drawContext,e=t.currentGlContext;e.clearColor(t.clearColor.red,t.clearColor.green,t.clearColor.blue,t.clearColor.alpha),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},v.prototype.doDraw=function(){this.drawContext.renderShapes=!0,this.subsurfaceMode&&this.hasStencilBuffer?(this.drawContext.currentGlContext.disable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawContext.currentGlContext.clear(this.drawContext.currentGlContext.DEPTH_BUFFER_BIT|this.drawContext.currentGlContext.STENCIL_BUFFER_BIT),this.drawContext.currentGlContext.enable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.ALWAYS,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE),this.drawOrderedRenderables(),this.drawContext.screenCreditController.drawCredits(this.drawContext))):(this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawOrderedRenderables(),this.drawScreenRenderables()),this.drawContext.screenCreditController.drawCredits(this.drawContext))},v.prototype.redrawSurface=function(){this.drawContext.currentGlContext.enable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.EQUAL,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.KEEP,this.drawContext.currentGlContext.KEEP,this.drawContext.currentGlContext.KEEP),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!1),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.drawContext.currentGlContext.disable(this.drawContext.currentGlContext.STENCIL_TEST)},v.prototype.doPick=function(){this.drawContext.terrain&&this.drawContext.terrain.pick(this.drawContext),this.drawContext.pickTerrainOnly||(this.subsurfaceMode&&this.hasStencilBuffer?(this.drawContext.currentGlContext.disable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawContext.currentGlContext.clear(this.drawContext.currentGlContext.DEPTH_BUFFER_BIT|this.drawContext.currentGlContext.STENCIL_BUFFER_BIT),this.drawContext.currentGlContext.enable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.ALWAYS,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE),this.drawOrderedRenderables(),this.drawContext.terrain.pick(this.drawContext),this.drawScreenRenderables())):(this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawOrderedRenderables(),this.drawScreenRenderables())))},v.prototype.createTerrain=function(){var t=this.drawContext;t.terrain=this.globe.tessellator.tessellate(t),t.frameStatistics.setTerrainTileCount(t.terrain?t.terrain.surfaceGeometry.length:0)},v.prototype.makeCurrent=function(t){var e=this.drawContext;switch(e.globe.offset=t,e.globeStateKey=e.globe.stateKey,t){case-1:e.terrain=this.terrainLeft;break;case 0:e.terrain=this.terrainCenter;break;case 1:e.terrain=this.terrainRight}},v.prototype.createTerrain2DContiguous=function(){var t=this.drawContext;this.terrainCenter=null,t.globe.offset=0,t.globeStateKey=t.globe.stateKey,t.globe.intersectsFrustum(t.navigatorState.frustumInModelCoordinates)&&(this.terrainCenter=t.globe.tessellator.tessellate(t)),this.terrainRight=null,t.globe.offset=1,t.globeStateKey=t.globe.stateKey,t.globe.intersectsFrustum(t.navigatorState.frustumInModelCoordinates)&&(this.terrainRight=t.globe.tessellator.tessellate(t)),this.terrainLeft=null,t.globe.offset=-1,t.globeStateKey=t.globe.stateKey,t.globe.intersectsFrustum(t.navigatorState.frustumInModelCoordinates)&&(this.terrainLeft=t.globe.tessellator.tessellate(t))},v.prototype.draw2DContiguous=function(){var t="";this.terrainCenter&&(t+=" 0 ",this.makeCurrent(0),this.deferOrderedRendering=this.terrainLeft||this.terrainRight,
this.doDraw()),this.terrainRight&&(t+=" 1 ",this.makeCurrent(1),this.deferOrderedRendering=this.terrainLeft||this.terrainLeft,this.doDraw()),this.deferOrderedRendering=!1,this.terrainLeft&&(t+=" -1 ",this.makeCurrent(-1),this.doDraw()),this.subsurfaceMode&&this.hasStencilBuffer&&(this.deferOrderedRendering=!0,this.terrainCenter&&(t+=" 0 ",this.makeCurrent(0),this.redrawSurface()),this.terrainRight&&(t+=" 1 ",this.makeCurrent(1),this.redrawSurface()),this.terrainLeft&&(t+=" -1 ",this.makeCurrent(-1),this.redrawSurface())),this.drawScreenRenderables()},v.prototype.pick2DContiguous=function(){this.terrainCenter&&(this.makeCurrent(0),this.deferOrderedRendering=this.terrainLeft||this.terrainRight,this.doPick()),this.terrainRight&&(this.makeCurrent(1),this.deferOrderedRendering=this.terrainLeft||this.terrainLeft,this.doPick()),this.deferOrderedRendering=!1,this.terrainLeft&&(this.makeCurrent(-1),this.doPick())},v.prototype.drawLayers=function(t){var e,i=Date.now(),r=this.drawContext,n=r.layers;r.accumulateOrderedRenderables=t;for(var o=0,s=n.length;o<s;o++)if(e=n[o]){r.currentLayer=e;try{e.render(r)}catch(t){l.log(l.LEVEL_SEVERE,"Error while rendering layer "+e.displayName+".\n"+t.toString())}}var a=Date.now();r.frameStatistics.layerRenderingTime=a-i},v.prototype.addLayer=function(t){this.layers.push(t)},v.prototype.removeLayer=function(t){if(t){for(var e=-1,i=0,r=this.layers.length;i<r;i++)if(this.layers[i]==t){e=i;break}e>=0&&this.layers.splice(e,1)}},v.prototype.insertLayer=function(t,e){e&&this.layers.splice(t,0,e)},v.prototype.drawSurfaceRenderables=function(){var t,e=this.drawContext;for(e.reverseSurfaceRenderables();t=e.popSurfaceRenderable();)try{t.renderSurface(e)}catch(t){l.logMessage(l.LEVEL_WARNING,"WorldWindow","drawSurfaceRenderables","Error while rendering a surface renderable.\n"+t.message)}},v.prototype.drawOrderedRenderables=function(){var t,e=Date.now(),i=this.drawContext;if(i.sortOrderedRenderables(),this._orderedRenderingFilters)for(var r=0;r<this._orderedRenderingFilters.length;r++)this._orderedRenderingFilters[r](this.drawContext);for(i.orderedRenderingMode=!0;t=i.popOrderedRenderable();)try{t.renderOrdered(i)}catch(t){l.logMessage(l.LEVEL_WARNING,"WorldWindow","drawOrderedRenderables","Error while rendering an ordered renderable.\n"+t.message)}i.orderedRenderingMode=!1,i.frameStatistics.orderedRenderingTime=Date.now()-e},v.prototype.drawScreenRenderables=function(){for(var t,e=this.drawContext;t=e.nextScreenRenderable();)try{t.renderOrdered(e)}catch(t){l.logMessage(l.LEVEL_WARNING,"WorldWindow","drawOrderedRenderables","Error while rendering a screen renderable.\n"+t.message)}},v.prototype.resolveTopPick=function(){if(0!=this.drawContext.objectsAtPickPoint.objects.length){var t=this.drawContext.objectsAtPickPoint,e=this.drawContext.readPickColor(this.drawContext.pickPoint),i=null,r=null;if(e){for(var n=0,o=t.objects.length;n<o;n++){var s=t.objects[n];if(s.isTerrain&&(r=s),s.color.equals(e)&&(s.isOnTop=!0,i=s,r))break}this.drawContext.deepPicking||(t.clear(),i&&t.add(i),r&&r!=i&&t.add(r))}else t.clear()}},v.prototype.resolveTerrainPick=function(){for(var t,e=this.drawContext.objectsAtPickPoint,i=0,r=e.objects.length;i<r;i++)if(t=e.objects[i],t.isTerrain){t.isOnTop=!0;break}},v.prototype.resolveRegionPick=function(){if(0!=this.drawContext.objectsAtPickPoint.objects.length)for(var t,e,i=this.drawContext.objectsAtPickPoint,r=this.drawContext.readPickColors(this.drawContext.pickRectangle),n=0,o=i.objects.length;n<o;n++)if(t=i.objects[n]){var s=t.color.toByteString();e=r[s],e?t.isOnTop=!0:t.userObject instanceof f&&(i.objects.splice(n,1),n-=1)}},v.prototype.callRedrawCallbacks=function(t){for(var e=0,i=this._redrawCallbacks.length;e<i;e++)try{this._redrawCallbacks[e](this,t)}catch(t){l.log(l.LEVEL_SEVERE,"Exception calling redraw callback.\n"+t.toString())}},v.prototype.goTo=function(t,e){this.goToAnimator.goTo(t,e)},v.prototype.declutter=function(e,i){if(!i)throw new t(l.logMessage(l.LEVEL_SEVERE,"WorldWindow","declutter","Group ID is null, undefined or 0."));for(var r=[],n=0;n<e.orderedRenderables.length;n++){var o=e.orderedRenderables[n].orderedRenderable;o.declutterGroup===i&&r.push(o)}for(var s=[],a=0;a<r.length;a++){var h=r[a],c=h.screenBounds;c&&c.intersectsRectangles(s)?h.targetVisibility=0:(h.targetVisibility=1,c&&s.push(c))}},v}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(14),i(48),i(70),i(84)],n=function(t,e,i,r){"use strict";var n=function(){i.call(this,e.FULL_SPHERE,new t(45,45),12,"application/bil16","EarthElevations256",256,256),this.displayName="Earth Elevation Model",this.minElevation=-11e3,this.maxElevation=8850,this.pixelIsPoint=!1,this.urlBuilder=new r("https://worldwind26.arc.nasa.gov/elev","GEBCO,aster_v2,USGS-NED","","1.3.0")};return n.prototype=Object.create(i.prototype),n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8)],n=function(t,e){"use strict";var i=function(i,r,n,o,s){if(!i||0===i.length)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsUrlBuilder","constructor","The WMS service address is missing."));if(!r||0===r.length)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsUrlBuilder","constructor","The WMS layer names are not specified."));this.serviceAddress=i,this.layerNames=r,this.styleNames=n?n:"",this.transparent=!0,this.wmsVersion=o&&o.length>0?o:"1.3.0",this.isWms130OrGreater=this.wmsVersion>="1.3.0",this.crs="EPSG:4326",this.timeString=s};return i.prototype.urlForTile=function(r,n){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","missingTile"));if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","The image format is null or undefined."));var o=r.sector,s=i.fixGetMapString(this.serviceAddress);return s.search(/service=wms/i)<0&&(s+="service=WMS"),s+="&request=GetMap",s=s+"&version="+this.wmsVersion,s=s+"&transparent="+(this.transparent?"TRUE":"FALSE"),s=s+"&layers="+this.layerNames,s=s+"&styles="+this.styleNames,s=s+"&format="+n,s=s+"&width="+r.tileWidth,s=s+"&height="+r.tileHeight,this.timeString&&(s=s+"&time="+this.timeString),this.isWms130OrGreater?(s=s+"&crs="+this.crs,s+="&bbox=","CRS:84"===this.crs?(s=s+o.minLongitude+","+o.minLatitude+",",s=s+o.maxLongitude+","+o.maxLatitude):(s=s+o.minLatitude+","+o.minLongitude+",",s=s+o.maxLatitude+","+o.maxLongitude)):(s=s+"&srs="+this.crs,s+="&bbox=",s=s+o.minLongitude+","+o.minLatitude+",",s=s+o.maxLongitude+","+o.maxLatitude),s=s.replace(" ","%20")},i.fixGetMapString=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsUrlBuilder","fixGetMapString","The specified service address is null or undefined."));var r=i.indexOf("?");return r<0?i+="?":r!==i.length-1&&(r=i.search(/&$/),r<0&&(i+="&")),i},i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[],n=function(){"use strict";var t=function(){this.frameCount=0,this.frameTimeCumulative=0,this.frameTimeBase=0,this.frameTimeExtremes=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],this.frameTime=0,this.tessellationTime=0,this.layerRenderingTime=0,this.orderedRenderingTime=0,this.terrainTileCount=0,this.imageTileCount=0,this.renderedTileCount=0,this.tileUpdateCount=0,this.textureLoadCount=0,this.vboLoadCount=0,this.frameTimeAverage=0,this.frameRateAverage=0,this.frameTimeMin=0,this.frameTimeMax=0};return t.prototype.beginFrame=function(){this.frameTime=Date.now(),this.tessellationTime=0,this.layerRenderingTime=0,this.orderedRenderingTime=0,this.terrainTileCount=0,this.imageTileCount=0,this.renderedTileCount=0,this.tileUpdateCount=0,this.textureLoadCount=0,this.vboLoadCount=0,++this.frameCount},t.prototype.endFrame=function(){var t=Date.now();this.frameTime=t-this.frameTime,this.frameTimeCumulative+=this.frameTime,this.frameTimeExtremes[0]=Math.min(this.frameTimeExtremes[0],this.frameTime),this.frameTimeExtremes[1]=Math.max(this.frameTimeExtremes[1],this.frameTime),t-this.frameTimeBase>2e3&&(this.frameTimeAverage=this.frameTimeCumulative/this.frameCount,this.frameRateAverage=1e3*this.frameCount/(t-this.frameTimeBase),this.frameTimeMin=this.frameTimeExtremes[0],this.frameTimeMax=this.frameTimeExtremes[1],this.frameCount=0,this.frameTimeCumulative=0,this.frameTimeBase=t,this.frameTimeExtremes=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY])},t.prototype.incrementRenderedTileCount=function(t){this.renderedTileCount+=t},t.prototype.setTerrainTileCount=function(t){this.terrainTileCount=t},t.prototype.incrementImageTileCount=function(t){this.imageTileCount=t},t.prototype.incrementTileUpdateCount=function(t){this.tileUpdateCount+=t},t.prototype.incrementTextureLoadCount=function(t){this.textureLoadCount+=t},t.prototype.incrementVboLoadCount=function(t){this.vboLoadCount+=t},t}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(13),i(9),i(51),i(70),i(16),i(14),i(8),i(12),i(75),i(48),i(87),i(11),i(17)],n=function(t,e,i,r,n,o,s,a,l,h,c,u,d){"use strict";var p=function(t,i){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","constructor","Elevation model is null or undefined."));this.elevationModel=t,this.equatorialRadius=6378137,this.polarRadius=6356752.3,this.eccentricitySquared=.00669437999013,this.tessellator=new c,this._projection=i||new l,this._offset=0,this.offsetVector=new u(0,0,0),this.id=++p.idPool,this._stateKey="globe "+this.id.toString()+" "};return p.idPool=0,Object.defineProperties(p.prototype,{stateKey:{get:function(){return this._stateKey+this.elevationModel.stateKey+"offset "+this.offset.toString()+" "+this.projection.stateKey}},continuous:{get:function(){return this.projection.continuous}},projection:{get:function(){return this._projection},set:function(t){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","projection","missingProjection"));this.projection!=t&&(this.tessellator=new c),this._projection=t}},projectionLimits:{get:function(){return this._projection.projectionLimits}},offset:{get:function(){return this._offset},set:function(t){this._offset=t,this.offsetVector[0]=2*t*Math.PI*this.equatorialRadius}}}),p.prototype.is2D=function(){return this.projection.is2D},p.prototype.computePointFromPosition=function(t,i,r,n){if(!n)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","computePointFromPosition","missingResult"));return this.projection.geographicToCartesian(this,t,i,r,this.offsetVector,n)},p.prototype.computePointFromLocation=function(t,i,r){if(!r)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","computePointFromLocation","missingResult"));return this.computePointFromPosition(t,i,0,r)},p.prototype.computePointsForGrid=function(t,i,r,n,o,a){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","computePointsFromPositions","missingSector"));if(i<1||r<1)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","computePointsFromPositions","Number of latitude or longitude locations is less than one."));var l=i*r;if(!n||n.length<l)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","computePointsFromPositions","Elevations array is null, undefined or insufficient length."));if(!a||a.length<l)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","computePointsFromPositions","Result array is null, undefined or insufficient length."));return this.projection.geographicToCartesianGrid(this,t,i,r,n,o,this.offsetVector,a)},p.prototype.computePositionFromPoint=function(t,i,r,n){if(!n)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","computePositionFromPoint","missingResult"));return this.projection.cartesianToGeographic(this,t,i,r,this.offsetVector,n),this.continuous&&(n.longitude<-180?n.longitude+=360:n.longitude>180&&(n.longitude-=360)),n},p.prototype.radiusAt=function(e,i){var r=Math.sin(e*t.DEGREES_TO_RADIANS),n=this.equatorialRadius/Math.sqrt(1-this.eccentricitySquared*r*r);return n*Math.sqrt(1+(this.eccentricitySquared*this.eccentricitySquared-2*this.eccentricitySquared)*r*r)},p.prototype.surfaceNormalAtLocation=function(i,r,n){if(!n)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","surfaceNormalAtLocation","missingResult"));if(this.is2D())return n[0]=0,n[1]=0,n[2]=1,n;var o=Math.cos(i*t.DEGREES_TO_RADIANS),a=Math.cos(r*t.DEGREES_TO_RADIANS),l=Math.sin(i*t.DEGREES_TO_RADIANS),h=Math.sin(r*t.DEGREES_TO_RADIANS),c=this.equatorialRadius*this.equatorialRadius,u=this.polarRadius*this.polarRadius;return n[0]=o*h/c,n[1]=(1-this.eccentricitySquared)*l/u,n[2]=o*a/c,n.normalize()},p.prototype.surfaceNormalAtPoint=function(t,i,r,n){if(!n)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","surfaceNormalAtPoint","missingResult"));if(this.projection.surfaceNormalAtPoint)return this.projection.surfaceNormalAtPoint(this,t,i,r,n);if(this.is2D())return n[0]=0,n[1]=0,n[2]=1,n;var o=this.equatorialRadius*this.equatorialRadius,a=this.polarRadius*this.polarRadius;return n[0]=t/o,n[1]=i/a,n[2]=r/o,n.normalize()},p.prototype.northTangentAtLocation=function(t,i,r){if(!r)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","northTangentAtLocation","missingResult"));return this.projection.northTangentAtLocation(this,t,i,r)},p.prototype.northTangentAtPoint=function(t,i,r,n){if(!n)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","northTangentAtPoint","missingResult"));return this.projection.northTangentAtPoint(this,t,i,r,this.offsetVector,n)},p.prototype.intersectsFrustum=function(t){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","intersectsFrustum","missingFrustum"));if(this.is2D()){var r=new i;return r.setToSector(h.FULL_SPHERE,this,this.elevationModel.minElevation,this.elevationModel.maxElevation),r.intersectsFrustum(t)}return!(t.far.distance<=this.equatorialRadius)&&(!(t.left.distance<=this.equatorialRadius)&&(!(t.right.distance<=this.equatorialRadius)&&(!(t.top.distance<=this.equatorialRadius)&&(!(t.bottom.distance<=this.equatorialRadius)&&!(t.near.distance<=this.equatorialRadius)))))},p.prototype.intersectsLine=function(t,i){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","intersectWithRay","missingLine"));if(!i)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","intersectsLine","missingResult"));if(this.is2D()){var r,n=t.direction[0],o=t.direction[1],a=t.direction[2],l=t.origin[0],h=t.origin[1],c=t.origin[2];return(0!=a||0==c)&&(r=-c/a,!(r<0)&&(i[0]=l+n*r,i[1]=h+o*r,i[2]=c+a*r,!0))}return d.computeEllipsoidalGlobeIntersection(t,this.equatorialRadius,this.polarRadius,i)},p.prototype.elevationTimestamp=function(){return this.elevationModel.timestamp},p.prototype.minElevation=function(){return this.elevationModel.minElevation},p.prototype.maxElevation=function(){return this.elevationModel.maxElevation},p.prototype.minAndMaxElevationsForSector=function(t){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","minAndMaxElevationsForSector","missingSector"));return this.elevationModel.minAndMaxElevationsForSector(t)},p.prototype.elevationAtLocation=function(t,e){return this.elevationModel.elevationAtLocation(t,e)},p.prototype.elevationsForGrid=function(t,i,r,n,o){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","elevationsForSector","missingSector"));if(i<=0||r<=0)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","elevationsForSector","numLat or numLon is less than 1"));if(!o||o.length<i*r)throw new e(s.logMessage(s.LEVEL_SEVERE,"Globe","elevationsForSector","missingArray"));return this.elevationModel.elevationsForGrid(t,i,r,n,o)},p}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(53),i(86),i(54),i(47),i(73),i(14),i(8),i(36),i(24),i(38),i(52),i(60),i(12),i(18),i(48),i(88),i(89),i(90),i(50),i(17),i(56)],n=function(t,e,i,r,n,o,s,a,l,h,c,u,d,p,f,g,m,E,v,y,_,T){"use strict";var L=function(){this.numRowsTilesInTopLevel=4,this.numColumnsTilesInTopLevel=8,this.maximumSubdivisionDepth=15,this.tileWidth=32,this.tileHeight=32,this.detailControl=40,this.levels=new o(g.FULL_SPHERE,new s(180/this.numRowsTilesInTopLevel,360/this.numColumnsTilesInTopLevel),this.maximumSubdivisionDepth,this.tileWidth,this.tileHeight),this.topLevelTiles={},this.currentTiles=new v(this),this.tileCache=new h(5e6,4e6),this.elevationTimestamp=void 0,this.lastModelViewProjection=void 0,this.vertexPointLocation=-1,this.vertexTexCoordLocation=-1,this.texCoords=null,this.texCoordVboCacheKey="global_tex_coords",this.indices=null,this.indicesVboCacheKey="global_indices",this.baseIndices=null,this.baseIndicesOffset=null,this.numBaseIndices=null,this.indicesNorth=null,this.indicesNorthOffset=null,this.numIndicesNorth=null,this.indicesSouth=null,this.indicesSouthOffset=null,this.numIndicesSouth=null,this.indicesWest=null,this.indicesWestOffset=null,this.numIndicesWest=null,this.indicesEast=null,this.indicesEastOffset=null,this.numIndicesEast=null,this.indicesLoresNorth=null,this.indicesLoresNorthOffset=null,this.numIndicesLoresNorth=null,this.indicesLoresSouth=null,this.indicesLoresSouthOffset=null,this.numIndicesLoresSouth=null,this.indicesLoresWest=null,this.indicesLoresWestOffset=null,this.numIndicesLoresWest=null,this.indicesLoresEast=null,this.indicesLoresEastOffset=null,this.numIndicesLoresEast=null,this.outlineIndicesOffset=null,this.numOutlineIndices=null,this.wireframeIndicesOffset=null,this.numWireframeIndices=null,this.scratchMatrix=l.fromIdentity(),this.scratchElevations=null,this.scratchPrevElevations=null,this.corners={},this.tiles=[]};return L.prototype.tessellate=function(e){if(!e)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tessellator","tessellate","missingDC"));var i=e.globe.elevationTimestamp();if(this.lastGlobeStateKey===e.globeStateKey&&this.lastVerticalExaggeration===e.verticalExaggeration&&this.elevationTimestamp===i&&this.lastModelViewProjection&&e.navigatorState.modelviewProjection.equals(this.lastModelViewProjection))return this.lastTerrain;var r=e.navigatorState;this.lastModelViewProjection=r.modelviewProjection,this.lastGlobeStateKey=e.globeStateKey,this.elevationTimestamp=i,this.lastVerticalExaggeration=e.verticalExaggeration,this.currentTiles.removeAllTiles(),this.topLevelTiles[e.globeStateKey]&&0!=this.topLevelTiles[e.globeStateKey].length||this.createTopLevelTiles(e),this.corners={},this.tiles=[];for(var n=0,o=this.topLevelTiles[e.globeStateKey].length;n<o;n+=1){var s=this.topLevelTiles[e.globeStateKey][n];s.update(e),this.isTileVisible(e,s)&&this.addTileOrDescendants(e,s)}return this.refineNeighbors(e),this.finishTessellating(e),this.lastTerrain=0===this.currentTiles.length?null:new m(e.globe,this,this.currentTiles,e.verticalExaggeration),this.lastTerrain},L.prototype.createTile=function(e,i,r,n){if(!e)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tile","constructor","missingSector"));if(!i)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tile","constructor","The specified level is null or undefined."));if(r<0||n<0)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tile","constructor","The specified row or column is less than zero."));return new E(e,i,r,n)},L.prototype.beginRendering=function(t){var e=t.currentProgram;if(!e)return void a.logMessage(a.LEVEL_INFO,"Tessellator","beginRendering","Current Program is empty");this.buildSharedGeometry(),this.cacheSharedGeometryVBOs(t);var i=t.currentGlContext,r=t.gpuResourceCache;if(this.vertexPointLocation=e.attributeLocation(i,"vertexPoint"),this.vertexTexCoordLocation=e.attributeLocation(i,"vertexTexCoord"),i.enableVertexAttribArray(this.vertexPointLocation),this.vertexTexCoordLocation>=0){var n=r.resourceForKey(this.texCoordVboCacheKey);i.bindBuffer(i.ARRAY_BUFFER,n),i.vertexAttribPointer(this.vertexTexCoordLocation,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(this.vertexTexCoordLocation)}var o=r.resourceForKey(this.indicesVboCacheKey);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,o)},L.prototype.endRendering=function(t){var e=t.currentGlContext;e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.vertexPointLocation>=0&&e.disableVertexAttribArray(this.vertexPointLocation),this.vertexTexCoordLocation>=0&&e.disableVertexAttribArray(this.vertexTexCoordLocation)},L.prototype.beginRenderingTile=function(e,i){if(!i)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tessellator","beginRenderingTile","missingTile"));var r=e.currentGlContext,n=e.gpuResourceCache;this.scratchMatrix.setToMultiply(e.navigatorState.modelviewProjection,i.transformationMatrix),e.currentProgram.loadModelviewProjection(r,this.scratchMatrix);var o=e.globeStateKey+i.tileKey,s=n.resourceForKey(o);s?i.pointsVboStateKey!=i.pointsStateKey?(r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferSubData(r.ARRAY_BUFFER,0,i.points),i.pointsVboStateKey=i.pointsStateKey):e.currentGlContext.bindBuffer(r.ARRAY_BUFFER,s):(s=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,i.points,r.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(o,s,4*i.points.length),i.pointsVboStateKey=i.pointsStateKey),r.vertexAttribPointer(this.vertexPointLocation,3,r.FLOAT,!1,0,0)},L.prototype.endRenderingTile=function(t,e){},L.prototype.renderTile=function(e,i){if(!i)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tessellator","renderTile","missingTile"));var r=e.currentGlContext,n=r.TRIANGLE_STRIP;r.drawElements(n,this.numBaseIndices,r.UNSIGNED_SHORT,2*this.baseIndicesOffset);var o,s=i.level;o=i.neighborLevel(WorldWind.NORTH),o&&o.compare(s)<0?r.drawElements(n,this.numIndicesLoresNorth,r.UNSIGNED_SHORT,2*this.indicesLoresNorthOffset):r.drawElements(n,this.numIndicesNorth,r.UNSIGNED_SHORT,2*this.indicesNorthOffset),o=i.neighborLevel(WorldWind.SOUTH),o&&o.compare(s)<0?r.drawElements(n,this.numIndicesLoresSouth,r.UNSIGNED_SHORT,2*this.indicesLoresSouthOffset):r.drawElements(n,this.numIndicesSouth,r.UNSIGNED_SHORT,2*this.indicesSouthOffset),o=i.neighborLevel(WorldWind.WEST),o&&o.compare(s)<0?r.drawElements(n,this.numIndicesLoresWest,r.UNSIGNED_SHORT,2*this.indicesLoresWestOffset):r.drawElements(n,this.numIndicesWest,r.UNSIGNED_SHORT,2*this.indicesWestOffset),o=i.neighborLevel(WorldWind.EAST),o&&o.compare(s)<0?r.drawElements(n,this.numIndicesLoresEast,r.UNSIGNED_SHORT,2*this.indicesLoresEastOffset):r.drawElements(n,this.numIndicesEast,r.UNSIGNED_SHORT,2*this.indicesEastOffset)},L.prototype.renderWireframeTile=function(e,i){if(!i)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tessellator","renderWireframeTile","missingTile"));var r=e.currentGlContext;this.vertexTexCoordLocation>=0&&r.disableVertexAttribArray(this.vertexTexCoordLocation),r.drawElements(r.LINES,this.numWireframeIndices,r.UNSIGNED_SHORT,2*this.wireframeIndicesOffset)},L.prototype.renderTileOutline=function(e,i){if(!i)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tessellator","renderTileOutline","missingTile"));var r=e.currentGlContext;this.vertexTexCoordLocation>=0&&r.disableVertexAttribArray(this.vertexTexCoordLocation),r.drawElements(r.LINE_LOOP,this.numOutlineIndices,r.UNSIGNED_SHORT,2*this.outlineIndicesOffset)},L.prototype.pick=function(e,i,r){if(!e)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tessellator","pick","missingDc"));if(!i)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tessellator","pick","missingList"));for(var n=null,o=r||this,s=new p(0,0,0),l=[],h=0,c=i.length;h<c;h++){var u=i[h];u.extent.intersectsFrustum(e.pickFrustum)&&l.push(u)}if(e.pickTerrainOnly||(n=e.uniquePickColor(),this.drawPickTiles(e,l,n)),!e.regionPicking){var f=e.navigatorState.rayFromScreenPoint(e.pickPoint),g=this.computeNearestIntersection(f,l);g&&(e.globe.computePositionFromPoint(g[0],g[1],g[2],s),s.altitude=e.globe.elevationAtLocation(s.latitude,s.longitude),e.addPickedObject(new d(n,o,s,null,!0)))}},L.prototype.drawPickTiles=function(t,i,r){var n=t.currentGlContext;try{t.findAndBindProgram(e),t.currentProgram.loadColor(n,r),this.beginRendering(t);for(var o=0,s=i.length;o<s;o++){var a=i[o];this.beginRenderingTile(t,a),this.renderTile(t,a),this.endRenderingTile(t,a)}}finally{this.endRendering(t)}},L.prototype.computeNearestIntersection=function(t,e){for(var i=[],r=0,n=e.length;r<n;r++)this.computeIntersections(t,e[r],i);if(0==i.length)return null;var o,s=Number.POSITIVE_INFINITY;for(r=0,n=i.length;r<n;r++){var a=t.origin.distanceToSquared(i[r]);s>a&&(s=a,o=r)}return i[o]},L.prototype.computeIntersections=function(t,e,i){var r,n,o=e.level,s=e.points,a=i.length;t.origin.subtract(e.referencePoint),this.buildSharedGeometry(e),n=this.baseIndices,_.computeTriStripIntersections(t,s,n,i),r=e.neighborLevel(WorldWind.SOUTH),n=r&&r.compare(o)<0?this.indicesLoresSouth:this.indicesSouth,_.computeTriStripIntersections(t,s,n,i),r=e.neighborLevel(WorldWind.WEST),n=r&&r.compare(o)<0?this.indicesLoresWest:this.indicesWest,_.computeTriStripIntersections(t,s,n,i),r=e.neighborLevel(WorldWind.EAST),n=r&&r.compare(o)<0?this.indicesLoresEast:this.indicesEast,_.computeTriStripIntersections(t,s,n,i),r=e.neighborLevel(WorldWind.NORTH),n=r&&r.compare(o)<0?this.indicesLoresNorth:this.indicesNorth,_.computeTriStripIntersections(t,s,n,i),t.origin.add(e.referencePoint);for(var l=a,h=i.length;l<h;l++)i[l].add(e.referencePoint)},L.prototype.createTopLevelTiles=function(t){this.topLevelTiles[t.globeStateKey]=[],y.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles[t.globeStateKey])},L.prototype.addTileOrDescendants=function(t,e){return this.tileMeetsRenderCriteria(t,e)?void this.addTile(t,e):void this.addTileDescendants(t,e)},L.prototype.addTileDescendants=function(t,e){for(var i=e.level.nextLevel(),r=e.subdivideToCache(i,this,this.tileCache),n=0;n<r.length;n+=1){var o=r[n];o.update(t),this.levels.sector.intersects(o.sector)&&this.isTileVisible(t,o)&&this.addTileOrDescendants(t,o)}},L.prototype.addTile=function(t,e){var i=this.tiles.length;this.tiles.push(e);var r,n=e.sector,o=[n.maxLatitude,n.maxLongitude].toString(),s=[n.minLatitude,n.maxLongitude].toString(),a=[n.maxLatitude,n.minLongitude].toString(),l=[n.minLatitude,n.minLongitude].toString();r=this.corners[l],r?r.sw=i:this.corners[l]={sw:i},r=this.corners[a],r?r.nw=i:this.corners[a]={nw:i},r=this.corners[s],r?r.se=i:this.corners[s]={se:i},r=this.corners[o],r?r.ne=i:this.corners[o]={ne:i}},L.prototype.refineNeighbors=function(t){for(var e={},i=0,r=this.tiles.length;i<r;i+=1){var n,o,i,r,s=this.tiles[i],a=s.level.levelNumber,l=s.sector,h=[l.maxLatitude,l.maxLongitude].toString(),c=[l.minLatitude,l.maxLongitude].toString(),u=[l.maxLatitude,l.minLongitude].toString(),d=[l.minLatitude,l.minLongitude].toString();n=this.corners[h],n.hasOwnProperty("se")&&(o=n.se,this.tiles[o].level.levelNumber<a-1&&(e[o]||(e[o]=!0))),n.hasOwnProperty("nw")&&(o=n.nw,this.tiles[o].level.levelNumber<a-1&&(e[o]||(e[o]=!0))),n=this.corners[c],n.hasOwnProperty("ne")&&(o=n.ne,this.tiles[o].level.levelNumber<a-1&&(e[o]||(e[o]=!0))),n.hasOwnProperty("sw")&&(o=n.sw,this.tiles[o].level.levelNumber<a-1&&(e[o]||(e[o]=!0))),n=this.corners[u],n.hasOwnProperty("ne")&&(o=n.ne,this.tiles[o].level.levelNumber<a-1&&(e[o]||(e[o]=!0))),n.hasOwnProperty("sw")&&(o=n.sw,this.tiles[o].level.levelNumber<a-1&&(e[o]||(e[o]=!0))),n=this.corners[d],n.hasOwnProperty("se")&&(o=n.se,this.tiles[o].level.levelNumber<a-1&&(e[o]||(e[o]=!0))),n.hasOwnProperty("nw")&&(o=n.nw,this.tiles[o].level.levelNumber<a-1&&(e[o]||(e[o]=!0)))}var p=[],f=[];for(i=0,r=this.tiles.length;i<r;i+=1)s=this.tiles[i],e[i]?p.push(s):f.push(s);if(p.length>0){for(this.tiles=[],this.corners={},i=0,r=f.length;i<r;i+=1)s=f[i],this.addTile(t,s);for(i=0,r=p.length;i<r;i+=1){var s=p[i];this.addTileDescendants(t,s)}this.refineNeighbors(t)}},L.prototype.finishTessellating=function(t){for(var e=0,i=this.tiles.length;e<i;e+=1){var r=this.tiles[e];this.setNeighbors(r),this.regenerateTileGeometryIfNeeded(t,r),this.currentTiles.addTile(r)}},L.prototype.setNeighbors=function(t){var e=t.sector,i=[e.maxLatitude,e.maxLongitude].toString(),r=[e.minLatitude,e.maxLongitude].toString(),n=[e.maxLatitude,e.minLongitude].toString(),o=[e.minLatitude,e.minLongitude].toString(),s=this.corners[i],a=this.corners[r],l=this.corners[n],h=this.corners[o],c=-1,u=-1,d=-1,p=-1;s.hasOwnProperty("se")?c=s.se:l.hasOwnProperty("sw")&&(c=l.sw),a.hasOwnProperty("ne")?u=a.ne:h.hasOwnProperty("nw")&&(u=h.nw),s.hasOwnProperty("nw")?d=s.nw:a.hasOwnProperty("sw")&&(d=a.sw),l.hasOwnProperty("ne")?p=l.ne:h.hasOwnProperty("se")&&(p=h.se),t.setNeighborLevel(WorldWind.NORTH,c>=0?this.tiles[c].level:null),t.setNeighborLevel(WorldWind.SOUTH,u>=0?this.tiles[u].level:null),t.setNeighborLevel(WorldWind.EAST,d>=0?this.tiles[d].level:null),t.setNeighborLevel(WorldWind.WEST,p>=0?this.tiles[p].level:null)},L.prototype.isTileVisible=function(t,e){return!(t.globe.projectionLimits&&!e.sector.overlaps(t.globe.projectionLimits))&&e.extent.intersectsFrustum(t.navigatorState.frustumInModelCoordinates)},L.prototype.tileMeetsRenderCriteria=function(t,e){var i=this.detailControl;return(e.sector.minLatitude>=75||e.sector.maxLatitude<=-75)&&(i*=2),e.level.isLastLevel()||!e.mustSubdivide(t,i)},L.prototype.regenerateTileGeometryIfNeeded=function(t,e){var i=t.globeStateKey+e.stateKey+t.verticalExaggeration;e.points&&e.pointsStateKey==i||(this.regenerateTileGeometry(t,e),e.pointsStateKey=i)},L.prototype.regenerateTileGeometry=function(t,e){var i=e.tileHeight+1,r=e.tileWidth+1,n=e.referencePoint,o=this.scratchElevations;o||(o=new Float64Array(i*r),this.scratchElevations=o),e.points||(e.points=new Float32Array(i*r*3)),T.fillArray(o,0),t.globe.elevationsForGrid(e.sector,i,r,e.texelSize,o),this.mustAlignNeighborElevations(t,e)&&this.alignNeighborElevations(t,e,o),T.multiplyArray(o,t.verticalExaggeration),t.globe.computePointsForGrid(e.sector,i,r,o,n,e.points),e.transformationMatrix.setTranslation(n[0],n[1],n[2])},L.prototype.mustAlignNeighborElevations=function(t,e){var i=e.level,r=e.neighborLevel(WorldWind.NORTH),n=e.neighborLevel(WorldWind.SOUTH),o=e.neighborLevel(WorldWind.EAST),s=e.neighborLevel(WorldWind.WEST);return r&&r.compare(i)<0||n&&n.compare(i)<0||o&&o.compare(i)<0||s&&s.compare(i)<0},L.prototype.alignNeighborElevations=function(t,e,i){var r,n,o,s,a=e.tileHeight+1,l=e.tileWidth+1,h=e.level,c=Math.floor(a/2)+1,u=Math.floor(l/2)+1,d=h.previousLevel(),p=this.scratchPrevElevations;if(p||(p=new Float64Array(c*u),this.scratchPrevElevations=p),T.fillArray(p,0),t.globe.elevationsForGrid(e.sector,c,u,d.texelSize,p),r=e.neighborLevel(WorldWind.NORTH),r&&r.compare(h)<0)for(o=(a-1)*l,s=(c-1)*u,n=0;n<u;n++,o+=2,s+=1)i[o]=p[s],n<u-1&&(i[o+1]=.5*(p[s]+p[s+1]));if(r=e.neighborLevel(WorldWind.SOUTH),r&&r.compare(h)<0)for(o=0,s=0,n=0;n<u;n++,o+=2,s+=1)i[o]=p[s],n<u-1&&(i[o+1]=.5*(p[s]+p[s+1]));if(r=e.neighborLevel(WorldWind.EAST),r&&r.compare(h)<0)for(o=l-1,s=u-1,n=0;n<c;n++,o+=2*l,s+=u)i[o]=p[s],n<c-1&&(i[o+l]=.5*(p[s]+p[s+u]));if(r=e.neighborLevel(WorldWind.WEST),r&&r.compare(h)<0)for(o=0,s=0,n=0;n<c;n++,o+=2*l,s+=u)i[o]=p[s],n<c-1&&(i[o+l]=.5*(p[s]+p[s+u]))},L.prototype.buildSharedGeometry=function(){var t=this.levels.tileWidth,e=this.levels.tileHeight;this.texCoords||this.buildTexCoords(t,e),this.indices||this.buildIndices(t,e)},L.prototype.buildTexCoords=function(t,e){for(var i=t+1,r=e+1,n=1/t,o=1/e,s=new Float32Array(i*r*2),a=0,l=0,h=0;l<r;l++,h+=o){l==r-1&&(h=1);for(var c=0,u=0;c<i;c++,u+=n)c==i-1&&(u=1),s[a++]=u,s[a++]=h}this.texCoords=s},L.prototype.buildIndices=function(t,e){for(var i,r=e+1,n=t+1,o=2*(r-3)*(n-2)+2*(r-3),s=[],a=0,l=1;l<n-2;l+=1){for(var h=1;h<r-1;h+=1)i=l+h*n,s[a++]=i,s[a++]=i+1;s[a++]=i+1,i=l+1+1*n,s[a++]=i}for(this.baseIndicesOffset=s.length-o,this.baseIndices=new Uint16Array(s.slice(this.baseIndicesOffset)),this.numBaseIndices=o,o=2*n-2,h=r-1,l=n-1,i=l+h*n,s[a++]=i,l=n-2;l>0;l-=1)i=l+h*n,s[a++]=i,s[a++]=i-n;for(l=0,i=l+h*n,s[a++]=i,this.indicesNorthOffset=s.length-o,this.indicesNorth=new Uint16Array(s.slice(this.indicesNorthOffset)),this.numIndicesNorth=o,o=2*n-2,h=0,l=0,i=l+h*n,s[a++]=i,l=1;l<n-1;l+=1)i=l+h*n,s[a++]=i,s[a++]=i+n;for(l=n-1,i=l+h*n,s[a++]=i,this.indicesSouthOffset=s.length-o,this.indicesSouth=new Uint16Array(s.slice(this.indicesSouthOffset)),this.numIndicesSouth=o,o=2*r-2,l=0,h=r-1,i=l+h*n,s[a++]=i,h=r-2;h>0;h-=1)i=l+h*n,s[a++]=i,s[a++]=i+1;for(h=0,i=l+h*n,s[a++]=i,this.indicesWestOffset=s.length-o,this.indicesWest=new Uint16Array(s.slice(this.indicesWestOffset)),this.numIndicesWest=o,o=2*r-2,l=n-1,h=0,i=l+h*n,s[a++]=i,h=1;h<r-1;h+=1)i=l+h*n,s[a++]=i,s[a++]=i-1;for(h=r-1,i=l+h*n,s[a++]=i,this.indicesEastOffset=s.length-o,this.indicesEast=new Uint16Array(s.slice(this.indicesEastOffset)),this.numIndicesEast=o,
o=2*n-2,h=r-1,l=n-1,i=l+h*n,s[a++]=i,l=n-2;l>0;l-=1)i=(l+1&-2)+h*n,s[a++]=i,i=l+(h-1)*n,s[a++]=i;for(l=0,i=l+h*n,s[a++]=i,this.indicesLoresNorthOffset=s.length-o,this.indicesLoresNorth=new Uint16Array(s.slice(this.indicesLoresNorthOffset)),this.numIndicesLoresNorth=o,o=2*n-2,h=0,l=0,i=l+h*n,s[a++]=i,l=1;l<n-1;l+=1)i=(l&-2)+h*n,s[a++]=i,i=l+(h+1)*n,s[a++]=i;for(l=n-1,i=l+h*n,s[a++]=i,this.indicesLoresSouthOffset=s.length-o,this.indicesLoresSouth=new Uint16Array(s.slice(this.indicesLoresSouthOffset)),this.numIndicesLoresSouth=o,o=2*r-2,l=0,h=r-1,i=l+h*n,s[a++]=i,h=r-2;h>0;h-=1)i=l+(h+1&-2)*n,s[a++]=i,i=l+1+h*n,s[a++]=i;for(h=0,i=l+h*n,s[a++]=i,this.indicesLoresWestOffset=s.length-o,this.indicesLoresWest=new Uint16Array(s.slice(this.indicesLoresWestOffset)),this.numIndicesLoresWest=o,o=2*r-2,l=n-1,h=0,i=l+h*n,s[a++]=i,h=1;h<r-1;h+=1)i=l+(h&-2)*n,s[a++]=i,i=l-1+h*n,s[a++]=i;h=r-1,i=l+h*n,s[a++]=i,this.indicesLoresEastOffset=s.length-o,this.indicesLoresEast=new Uint16Array(s.slice(this.indicesLoresEastOffset)),this.numIndicesLoresEast=o;var c=this.buildWireframeIndices(t,e),u=this.buildOutlineIndices(t,e);s=s.concat(c),this.wireframeIndicesOffset=s.length-this.numWireframeIndices,s=s.concat(u),this.outlineIndicesOffset=s.length-this.numOutlineIndices,this.indices=new Uint16Array(s)},L.prototype.buildWireframeIndices=function(t,e){var i,r,n,o=e+1,s=t+1,a=2*t*o+2*e*s,l=[],h=s,c=0;for(r=0;r<o;r+=1)for(i=0;i<t;i+=1)n=i+r*h,l[c]=n,l[c+1]=n+1,c+=2;for(i=0;i<s;i+=1)for(r=0;r<e;r+=1)n=i+r*h,l[c]=n,l[c+1]=n+h,c+=2;return this.numWireframeIndices=a,l},L.prototype.buildOutlineIndices=function(t,e){var i,r,n,o=e+1,s=t+1,a=2*(o-2)+2*s+1,l=[],h=0;for(r=0,i=0;i<s;i+=1)n=i+r*s,l[h]=n,h+=1;for(i=s-1,r=1;r<o;r+=1)n=i+r*s,l[h]=n,h+=1;for(r=o-1,i=s-1;i>=0;i-=1)n=i+r*s,l[h]=n,h+=1;for(i=0,r=o-1;r>=0;r-=1)n=i+r*s,l[h]=n,h+=1;return this.numOutlineIndices=a,l},L.prototype.cacheSharedGeometryVBOs=function(t){var e=t.currentGlContext,i=t.gpuResourceCache,r=i.resourceForKey(this.texCoordVboCacheKey);r||(r=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,this.texCoords,e.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(this.texCoordVboCacheKey,r,4*this.texCoords.length/2));var n=i.resourceForKey(this.indicesVboCacheKey);n||(n=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(this.indicesVboCacheKey,n,2*this.indices.length))},L}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(11)],n=function(t,e,i){"use strict";var r=function(t,e,i,r){this.globe=t,this.verticalExaggeration=r,this.sector=i.sector,this.tessellator=e,this.surfaceGeometry=i.tileArray,this.stateKey=t.stateKey+" ve "+r.toString()};return r.scratchPoint=new i(0,0,0),r.prototype.surfacePoint=function(i,n,o,s){if(!s)throw new t(e.logMessage(e.LEVEL_SEVERE,"Terrain","surfacePoint","missingResult"));for(var a=0,l=this.surfaceGeometry.length;a<l;a++)if(this.surfaceGeometry[a].sector.containsLocation(i,n)){if(this.surfaceGeometry[a].surfacePoint(i,n,s),o){var h=this.globe.surfaceNormalAtPoint(s[0],s[1],s[2],r.scratchPoint);s[0]+=h[0]*o,s[1]+=h[1]*o,s[2]+=h[2]*o}return s}var c=o+this.globe.elevationAtLocation(i,n)*this.verticalExaggeration;return this.globe.computePointFromPosition(i,n,c,s),s},r.prototype.surfacePointForMode=function(i,r,n,o,s){if(!s)throw new t(e.logMessage(e.LEVEL_SEVERE,"Terrain","surfacePointForMode","missingResult"));if(o||(o=WorldWind.ABSOLUTE),o===WorldWind.CLAMP_TO_GROUND)return this.surfacePoint(i,r,0,s);if(o===WorldWind.RELATIVE_TO_GROUND)return this.surfacePoint(i,r,n,s);var a=n*this.verticalExaggeration;return this.globe.computePointFromPosition(i,r,a,s),s},r.prototype.beginRendering=function(t){this.globe&&this.globe.tessellator&&this.globe.tessellator.beginRendering(t)},r.prototype.endRendering=function(t){this.globe&&this.globe.tessellator&&this.globe.tessellator.endRendering(t)},r.prototype.beginRenderingTile=function(i,r){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Terrain","beginRenderingTile","missingTile"));this.globe&&this.globe.tessellator&&this.globe.tessellator.beginRenderingTile(i,r)},r.prototype.endRenderingTile=function(t,e){},r.prototype.renderTile=function(i,r){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Terrain","renderTile","missingTile"));this.globe&&this.globe.tessellator&&this.globe.tessellator.renderTile(i,r)},r.prototype.pick=function(t){this.globe&&this.globe.tessellator&&this.globe.tessellator.pick(t,this.surfaceGeometry,this)},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(36),i(50)],n=function(t,e,i,r){"use strict";var n=function(t,e,n,o){r.call(this,t,e,n,o),this.transformationMatrix=i.fromIdentity(),this.points=null,this.pointsStateKey=null,this.pointsVboStateKey=null,this.neighborMap={},this.neighborMap[WorldWind.NORTH]=null,this.neighborMap[WorldWind.SOUTH]=null,this.neighborMap[WorldWind.EAST]=null,this.neighborMap[WorldWind.WEST]=null,this._stateKey=null,this._elevationTimestamp=null,this.scratchArray=[]};return n.prototype=Object.create(r.prototype),Object.defineProperties(n.prototype,{stateKey:{get:function(){return this._stateKey||(this._stateKey=this.computeStateKey()),this._stateKey}}}),n.prototype.neighborLevel=function(t){return this.neighborMap[t]},n.prototype.setNeighborLevel=function(t,e){this.neighborMap[t]=e,this._stateKey=null},n.prototype.surfacePoint=function(i,r,n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"TerrainTile","surfacePoint","missingResult"));var o,s,a,l,h,c,u,d,p,f,g=this.sector,m=g.minLatitude,E=g.maxLatitude,v=g.minLongitude,y=g.maxLongitude,_=this.tileWidth,T=this.tileHeight;o=(r-v)/(y-v)*_,s=(i-m)/(E-m)*T,a=o<_?Math.floor(o):_-1,l=s<T?Math.floor(s):T-1,h=_+1,c=this.points,u=this.scratchArray,d=3*(a+l*h);for(var L=0;L<6;L++)u[L]=c[d+L];d=3*(a+(l+1)*h);for(var x=6;x<12;x++)u[x]=c[d+(x-6)];return p=o<_?o-Math.floor(o):1,f=s<T?s-Math.floor(s):1,p>f?(n[0]=u[0]+p*(u[3]-u[0])+f*(u[6]-u[0]),n[1]=u[1]+p*(u[4]-u[1])+f*(u[7]-u[1]),n[2]=u[2]+p*(u[5]-u[2])+f*(u[8]-u[2])):(n[0]=u[9]+(1-p)*(u[6]-u[9])+(1-f)*(u[3]-u[9]),n[1]=u[10]+(1-p)*(u[7]-u[10])+(1-f)*(u[4]-u[10]),n[2]=u[11]+(1-p)*(u[8]-u[11])+(1-f)*(u[5]-u[11])),n[0]+=this.referencePoint[0],n[1]+=this.referencePoint[1],n[2]+=this.referencePoint[2],n},n.prototype.update=function(t){r.prototype.update.call(this,t);var e=t.globe.elevationTimestamp();this._elevationTimestamp!=e&&(this._elevationTimestamp=e,this._stateKey=null)},n.prototype.computeStateKey=function(){var t=[];return t.push(this._elevationTimestamp),t.push(this.neighborMap[WorldWind.NORTH]?this.neighborMap[WorldWind.NORTH].compare(this.level):0),t.push(this.neighborMap[WorldWind.SOUTH]?this.neighborMap[WorldWind.SOUTH].compare(this.level):0),t.push(this.neighborMap[WorldWind.EAST]?this.neighborMap[WorldWind.EAST].compare(this.level):0),t.push(this.neighborMap[WorldWind.WEST]?this.neighborMap[WorldWind.WEST].compare(this.level):0),t.join(".")},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(48)],n=function(t,e,i){"use strict";var r=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"TerrainTileList","TerrainTileList","missingTessellator"));this.tessellator=i,this.sector=null,this.tileArray=[]};return Object.defineProperties(r.prototype,{length:{get:function(){return this.tileArray.length}}}),r.prototype.addTile=function(r){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"TerrainTileList","addTile","missingTile"));this.tileArray.indexOf(r)==-1&&(this.tileArray.push(r),this.sector?this.sector.union(r.sector):(this.sector=new i(0,0,0,0),this.sector.copy(r.sector)))},r.prototype.removeAllTiles=function(){this.tileArray=[],this.sector=null},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(86),i(81),i(92)],n=function(t,e,i){"use strict";var r=function(){t.call(this,new i,new e)};return r.prototype=Object.create(t.prototype),r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(70),i(14),i(8),i(48)],n=function(t,e,i,r,n){"use strict";var o=function(){e.call(this,n.FULL_SPHERE,new i(45,45),1," "," ",150,150),this.displayName="Zero Elevations",this.timestamp=Date.now(),this.minElevation=0,this.maxElevation=0};return o.prototype=Object.create(e.prototype),o.prototype.minAndMaxElevationsForSector=function(t){return[0,0]},o.prototype.elevationAtLocation=function(t,e){return 0},o.prototype.elevationsForGrid=function(e,i,n,o,s){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"ZeroElevationModel","elevationsForSector","missingSector"));if(i<=0||n<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"ZeroElevationModel","elevationsForSector","numLat or numLon is less than 1"));if(!s||s.length<i*n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ZeroElevationModel","elevationsForSector","missingArray"));for(var a=0,l=s.length;a<l;a++)s[a]=0;return 0},o}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(14),i(8),i(12),i(11)],n=function(t,e,i,r){"use strict";var n=function(t){if(!t)throw new ArgumentError(e.logMessage(e.LEVEL_SEVERE,"GoToAnimator","constructor","missingWorldWindow"));this.wwd=t,this.animationFrequency=20,this.travelTime=3e3,this.cancelled=!1};return n.prototype.cancel=function(){this.cancelled=!0},n.prototype.goTo=function(n,o){if(!n)throw new ArgumentError(e.logMessage(e.LEVEL_SEVERE,"GoToAnimator","goTo","missingPosition"));this.completionCallback=o,this.cancelled=!1,this.targetPosition=new i(n.latitude,n.longitude,n.altitude||this.wwd.navigator.range),this.startPosition=new i(this.wwd.navigator.lookAtLocation.latitude,this.wwd.navigator.lookAtLocation.longitude,this.wwd.navigator.range),this.startTime=Date.now();var s,a=this.travelTime,l=t.greatCircleDistance(this.startPosition,this.targetPosition),h=this.wwd.globe.computePointFromLocation(this.startPosition.latitude,this.startPosition.longitude,new r(0,0,0)),c=this.wwd.globe.computePointFromLocation(this.targetPosition.latitude,this.targetPosition.longitude,new r(0,0,0));this.maxAltitude=h.distanceTo(c);var u=this.wwd.navigator.currentState().pixelSizeAtDistance(this.startPosition.altitude)*this.wwd.canvas.clientWidth/this.wwd.globe.equatorialRadius;l<=2*u&&(this.maxAltitude=this.startPosition.altitude),this.maxAltitudeReachedTime=this.maxAltitude<=this.wwd.navigator.range?Date.now():null,this.maxAltitude>this.startPosition.altitude?(s=Math.max(0,this.maxAltitude-this.startPosition.altitude),s+=Math.abs(this.targetPosition.altitude-this.maxAltitude)):s=Math.abs(this.targetPosition.altitude-this.startPosition.altitude);var d=Math.max(l,s/this.wwd.globe.equatorialRadius);if(0!==d){d<2*u&&(a=Math.min(d/u*this.travelTime,this.travelTime)),a=Math.max(1,a),this.panVelocity=l/a,this.rangeVelocity=s/a;var p=this,f=function(){return p.cancelled?void(p.completionCallback&&p.completionCallback(p)):void(p.update()?setTimeout(f,p.animationFrequency):p.completionCallback&&p.completionCallback(p))};setTimeout(f,this.animationFrequency)}},n.prototype.update=function(){var t=new i(this.wwd.navigator.lookAtLocation.latitude,this.wwd.navigator.lookAtLocation.longitude,this.wwd.navigator.range),e=this.updateRange(t);return e=this.updateLocation(t)||e,this.wwd.redraw(),e},n.prototype.updateRange=function(t){var e,i,r=!1;return this.maxAltitudeReachedTime?(i=Date.now()-this.maxAltitudeReachedTime,this.maxAltitude>this.targetPosition.altitude?(e=this.maxAltitude-this.rangeVelocity*i,e=Math.max(e,this.targetPosition.altitude)):(e=this.maxAltitude+this.rangeVelocity*i,e=Math.min(e,this.targetPosition.altitude)),this.wwd.navigator.range=e,r=Math.abs(this.wwd.navigator.range-this.targetPosition.altitude)>1):(i=Date.now()-this.startTime,e=Math.min(this.startPosition.altitude+this.rangeVelocity*i,this.maxAltitude),Math.abs(this.wwd.navigator.range-e)<1&&(this.maxAltitudeReachedTime=Date.now()),this.wwd.navigator.range=e,r=!0),r},n.prototype.updateLocation=function(e){var i=Date.now()-this.startTime,r=t.greatCircleDistance(this.startPosition,e),n=t.greatCircleDistance(e,this.targetPosition),o=t.greatCircleAzimuth(e,this.targetPosition),s=this.panVelocity*i,a=Math.min(s-r,n),l=t.greatCircleLocation(e,o,a,new t(0,0)),h=!1;return this.wwd.navigator.lookAtLocation.latitude=l.latitude,this.wwd.navigator.lookAtLocation.longitude=l.longitude,a<1/this.wwd.globe.equatorialRadius&&(h=!0),!h},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(23),i(85),i(96),i(97),i(35),i(86),i(54),i(20),i(99),i(8),i(36),i(38),i(95),i(15),i(12),i(18),i(100),i(48),i(104),i(106),i(45),i(107),i(7),i(11),i(17)],n=function(t,e,i,r,n,o,s,a,l,h,c,u,d,p,f,g,m,E,v,y,_,T,L,x,b,S){"use strict";var w=function(i){if(!i)throw new t(c.logMessage(c.LEVEL_SEVERE,"Texture","constructor","missingGlContext"));this.currentGlContext=i,this.canvas2D=document.createElement("canvas"),this.ctx2D=this.canvas2D.getContext("2d"),this.clearColor=e.TRANSPARENT,this.gpuResourceCache=new l(WorldWind.configuration.gpuCacheSize,.8*WorldWind.configuration.gpuCacheSize),this.surfaceTileRenderer=new T,this.surfaceShapeTileBuilder=new _,this.surfaceShapeTileController=new n,this.screenCreditController=new E,this.textSupport=new L,this.currentFramebuffer=null,this.currentProgram=null,this.surfaceRenderables=[],this.orderedRenderingMode=!1,this.orderedRenderables=[],this.screeRenderables=[],this.orderedRenderablesCounter=0,this.timestamp=Date.now(),this.previousRedrawTimestamp=this.timestamp,this.redrawRequested=!1,this.globe=null,this.globeStateKey=null,this.layers=null,this.currentLayer=null,this.navigatorState=null,this.eyePosition=new g(0,0,0),this.screenProjection=u.fromIdentity(),this.terrain=null,this.verticalExaggeration=1,this.fadeTime=500,this.surfaceOpacity=1,this.frameStatistics=null,this.pickingMode=!1,this.pickTerrainOnly=!1,this.deepPicking=!1,this.regionPicking=!1,this.pickPoint=null,this.pickRectangle=null,this.pickFramebuffer=null,this.pickFrustum=null,this.pickColor=new e(0,0,0,1),this.objectsAtPickPoint=new p,this.pixelScale=1};return w.unitCubeKey="DrawContextUnitCubeKey",w.unitCubeElementsKey="DrawContextUnitCubeElementsKey",w.unitQuadKey="DrawContextUnitQuadKey",w.unitQuadKey3="DrawContextUnitQuadKey3",w.prototype.reset=function(){this.screenCreditController.clear(),this.surfaceRenderables=[],this.orderedRenderingMode=!1,this.orderedRenderables=[],this.screenRenderables=[],this.orderedRenderablesCounter=0;var t=this.timestamp;this.timestamp=Date.now(),this.timestamp===t&&++this.timestamp,this.redrawRequested=!1,this.globe=null,this.globeStateKey=null,this.layers=null,this.currentLayer=null,this.navigatorState=null,this.terrain=null,this.verticalExaggeration=1,this.frameStatistics=null,this.accumulateOrderedRenderables=!0,this.pickingMode=!1,this.pickTerrainOnly=!1,this.deepPicking=!1,this.regionPicking=!1,this.pickPoint=null,this.pickRectangle=null,this.pickFrustum=null,this.pickColor=new e(0,0,0,1),this.objectsAtPickPoint.clear()},w.prototype.update=function(){var t=this.currentGlContext,e=this.navigatorState.eyePoint;this.globeStateKey=this.globe.stateKey,this.globe.computePositionFromPoint(e[0],e[1],e[2],this.eyePosition),this.screenProjection.setToScreenProjection(t.drawingBufferWidth,t.drawingBufferHeight)},w.prototype.contextLost=function(){this.gpuResourceCache.clear(),this.pickFramebuffer=null,this.currentFramebuffer=null,this.currentProgram=null},w.prototype.contextRestored=function(){this.gpuResourceCache.clear()},w.prototype.bindFramebuffer=function(t){this.currentFramebuffer!=t&&(this.currentGlContext.bindFramebuffer(this.currentGlContext.FRAMEBUFFER,t?t.framebufferId:null),this.currentFramebuffer=t)},w.prototype.bindProgram=function(t){this.currentProgram!=t&&(this.currentGlContext.useProgram(t?t.programId:null),this.currentProgram=t)},w.prototype.findAndBindProgram=function(e){if(!e)throw new t(c.logMessage(c.LEVEL_SEVERE,"DrawContext","findAndBindProgram","The specified program constructor is null or undefined."));var i=this.gpuResourceCache.resourceForKey(e.key);if(i)this.bindProgram(i);else try{i=new e(this.currentGlContext),this.bindProgram(i),this.gpuResourceCache.putResource(e.key,i,i.size)}catch(t){c.log(c.LEVEL_SEVERE,"Error attempting to create GPU program.")}return i},w.prototype.addSurfaceRenderable=function(t){t&&this.surfaceRenderables.push(t)},w.prototype.peekSurfaceRenderable=function(){return this.surfaceRenderables.length>0?this.surfaceRenderables[this.surfaceRenderables.length-1]:null},w.prototype.popSurfaceRenderable=function(){return this.surfaceRenderables.length>0?this.surfaceRenderables.pop():null},w.prototype.reverseSurfaceRenderables=function(){this.surfaceRenderables.reverse()},w.prototype.addOrderedRenderable=function(t,e){if(t){var i={orderedRenderable:t,insertionOrder:this.orderedRenderablesCounter++,eyeDistance:e||t.eyeDistance,globeStateKey:this.globeStateKey};this.globe.continuous&&(i.globeOffset=this.globe.offset),0===i.eyeDistance?this.screenRenderables.push(i):this.orderedRenderables.push(i)}},w.prototype.addOrderedRenderableToBack=function(t){if(t){var e={orderedRenderable:t,insertionOrder:this.orderedRenderablesCounter++,eyeDistance:Number.MAX_VALUE,globeStateKey:this.globeStateKey};this.globe.continuous&&(e.globeOffset=this.globe.offset),this.orderedRenderables.push(e)}},w.prototype.peekOrderedRenderable=function(){return this.orderedRenderables.length>0?this.orderedRenderables[this.orderedRenderables.length-1].orderedRenderable:null},w.prototype.popOrderedRenderable=function(){if(this.orderedRenderables.length>0){var t=this.orderedRenderables.pop();return this.globeStateKey=t.globeStateKey,this.globe.continuous&&(this.globe.offset=t.globeOffset),t.orderedRenderable}return null},w.prototype.nextScreenRenderable=function(){if(this.screenRenderables.length>0){var t=this.screenRenderables.shift();return this.globeStateKey=t.globeStateKey,this.globe.continuous&&(this.globe.offset=t.globeOffset),t.orderedRenderable}return null},w.prototype.sortOrderedRenderables=function(){this.orderedRenderables.sort(function(t,e){var i=t.eyeDistance,r=e.eyeDistance;if(i<r)return-1;if(i>r)return 1;var n=t.insertionOrder,o=e.insertionOrder;return n>o?-1:n<o?1:0})},w.prototype.readPickColor=function(t){var i=this.navigatorState.convertPointToViewport(t,new x(0,0)),r=new Uint8Array(4);return this.currentGlContext.readPixels(i[0],i[1],1,1,this.currentGlContext.RGBA,this.currentGlContext.UNSIGNED_BYTE,r),this.clearColor.equalsBytes(r)?null:e.colorFromByteArray(r)},w.prototype.readPickColors=function(t){var i,r=this.currentGlContext,n=new Uint8Array(t.width*t.height*4),o={},s=new e(0,0,0,0),a=r.getParameter(r.PACK_ALIGNMENT);r.pixelStorei(r.PACK_ALIGNMENT,1),this.currentGlContext.readPixels(t.x,t.y,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,n),r.pixelStorei(r.PACK_ALIGNMENT,a);for(var l=0,h=t.width*t.height;l<h;l++){var c=4*l;i=e.colorFromBytes(n[c],n[c+1],n[c+2],n[c+3]),i.equals(this.clearColor)||i.equals(s)||(o[i.toByteString()]=i)}return o},w.prototype.resolvePick=function(t){if(t.userObject instanceof y||!this.deepPicking||this.regionPicking)this.addPickedObject(t);else{var e=this.readPickColor(this.pickPoint);if(!e)return null;t.color.equals(e)&&this.addPickedObject(t)}},w.prototype.addPickedObject=function(t){t&&this.objectsAtPickPoint.add(t)},w.prototype.uniquePickColor=function(){var t=this.pickColor.nextColor().clone();return t.equals(this.clearColor)?t.nextColor():t},w.prototype.makePickFramebuffer=function(){var t=this.currentGlContext,e=t.drawingBufferWidth,i=t.drawingBufferHeight;return this.pickFramebuffer&&this.pickFramebuffer.width==e&&this.pickFramebuffer.height==i||(this.pickFramebuffer=new r(t,e,i,!0)),this.pickFramebuffer},w.prototype.makePickFrustum=function(){if(!this.pickPoint&&!this.pickRectangle)return!1;var t,e,i,r,n,s,a,l,h,c,u,d,p,g,E,v,y,_,T,L,w,M,R=new b(0,0,0),A=2,C=new b(0,0,0),P=this.pickRectangle,I=this.navigatorState.viewport;P||(M=this.navigatorState.convertPointToViewport(this.pickPoint,new x(0,0)),P=new m(M[0]-A,M[1]-A,2*A,2*A));var D=P.x,N=P.x+P.width,O=P.y,V=P.y+P.height;return!(N<0||V<0||D>I.x+I.width||O>I.y+I.height)&&(P.x=S.clamp(D,I.x,I.x+I.width),P.y=S.clamp(O,I.y,I.y+I.height),P.width=S.clamp(N,I.x,I.x+I.width)-P.x,P.height=S.clamp(V,I.y,I.y+I.height)-P.y,this.pickRectangle=P,C[0]=P.x,C[1]=P.y,C[2]=0,this.navigatorState.unProject(C,t=new b(0,0,0)),C[0]=P.x,C[1]=P.y,C[2]=1,this.navigatorState.unProject(C,e=new b(0,0,0)),C[0]=P.x+P.width,C[1]=P.y,C[2]=0,this.navigatorState.unProject(C,i=new b(0,0,0)),C[0]=P.x+P.width,C[1]=P.y,C[2]=1,this.navigatorState.unProject(C,r=new b(0,0,0)),C[0]=P.x,C[1]=P.y+P.height,C[2]=0,this.navigatorState.unProject(C,n=new b(0,0,0)),C[0]=P.x,C[1]=P.y+P.height,C[2]=1,this.navigatorState.unProject(C,s=new b(0,0,0)),C[0]=P.x+P.width,C[1]=P.y+P.height,C[2]=0,this.navigatorState.unProject(C,a=new b(0,0,0)),C[0]=P.x+P.width,C[1]=P.y+P.height,C[2]=1,this.navigatorState.unProject(C,l=new b(0,0,0)),w=new b(s[0]-t[0],s[1]-t[1],s[2]-t[2]),R.set(n[0]-e[0],n[1]-e[1],n[2]-e[2]),h=w.cross(R),E=new f(h[0],h[1],h[2],-h.dot(t)),E.normalize(),w=new b(a[0]-r[0],a[1]-r[1],a[2]-r[2]),R.set(l[0]-i[0],l[1]-i[1],l[2]-i[2]),c=w.cross(R),v=new f(c[0],c[1],c[2],-c.dot(i)),v.normalize(),w=new b(s[0]-a[0],s[1]-a[1],s[2]-a[2]),R.set(l[0]-n[0],l[1]-n[1],l[2]-n[2]),u=w.cross(R),y=new f(u[0],u[1],u[2],-u.dot(n)),y.normalize(),w=new b(r[0]-t[0],r[1]-t[1],r[2]-t[2]),R.set(e[0]-i[0],e[1]-i[1],e[2]-i[2]),d=w.cross(R),_=new f(d[0],d[1],d[2],-d.dot(i)),_.normalize(),w=new b(n[0]-i[0],n[1]-i[1],n[2]-i[2]),R.set(a[0]-t[0],a[1]-t[1],a[2]-t[2]),p=w.cross(R),T=new f(p[0],p[1],p[2],-p.dot(t)),T.normalize(),w=new b(l[0]-e[0],l[1]-e[1],l[2]-e[2]),R.set(s[0]-r[0],s[1]-r[1],s[2]-r[2]),g=w.cross(R),L=new f(g[0],g[1],g[2],-g.dot(e)),L.normalize(),this.pickFrustum=new o(E,v,_,y,T,L),!0)},w.prototype.isSmall=function(t,e){if(!t)return!1;var i=this.navigatorState.eyePoint.distanceTo(t.center),r=this.navigatorState.pixelSizeAtDistance(i);return 2*t.radius<e*r},w.prototype.unitCubeBuffer=function(){var t=this.gpuResourceCache.resourceForKey(w.unitCubeKey);if(!t){var e=this.currentGlContext,i=new Float32Array(24),r=0;i[r++]=0,i[r++]=1,i[r++]=0,i[r++]=0,i[r++]=0,i[r++]=0,i[r++]=1,i[r++]=1,i[r++]=0,i[r++]=1,i[r++]=0,i[r++]=0,i[r++]=0,i[r++]=1,i[r++]=1,i[r++]=0,i[r++]=0,i[r++]=1,i[r++]=1,i[r++]=1,i[r++]=1,i[r++]=1,i[r++]=0,i[r]=1,t=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(w.unitCubeKey,t,4*i.length)}return t},w.prototype.unitCubeElements=function(){var t=this.gpuResourceCache.resourceForKey(w.unitCubeElementsKey);if(!t){var e=this.currentGlContext,i=new Int16Array(60),r=0;i[r++]=1,i[r++]=0,i[r++]=3,i[r++]=3,i[r++]=0,i[r++]=2,i[r++]=4,i[r++]=5,i[r++]=6,i[r++]=6,i[r++]=5,i[r++]=7,i[r++]=5,i[r++]=1,i[r++]=7,i[r++]=7,i[r++]=1,i[r++]=3,i[r++]=6,i[r++]=2,i[r++]=4,i[r++]=4,i[r++]=2,i[r++]=0,i[r++]=4,i[r++]=0,i[r++]=5,i[r++]=5,i[r++]=0,i[r++]=1,i[r++]=7,i[r++]=3,i[r++]=6,i[r++]=6,i[r++]=3,i[r++]=2,i[r++]=0,i[r++]=1,i[r++]=1,i[r++]=3,i[r++]=3,i[r++]=2,i[r++]=2,i[r++]=0,i[r++]=4,i[r++]=5,i[r++]=5,i[r++]=7,i[r++]=7,i[r++]=6,i[r++]=6,i[r++]=4,i[r++]=0,i[r++]=4,i[r++]=5,i[r++]=1,i[r++]=2,i[r++]=6,i[r++]=7,i[r]=3,t=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(w.unitCubeElementsKey,t,2*i.length)}return t},w.prototype.unitQuadBuffer=function(){var t=this.gpuResourceCache.resourceForKey(w.unitQuadKey);if(!t){var e=this.currentGlContext,i=new Float32Array(8);i[0]=0,i[1]=1,i[2]=0,i[3]=0,i[4]=1,i[5]=1,i[6]=1,i[7]=0,t=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(w.unitQuadKey,t,4*i.length)}return t},w.prototype.unitQuadBuffer3=function(){var t=this.gpuResourceCache.resourceForKey(w.unitQuadKey3);if(!t){var e=this.currentGlContext,i=new Float32Array(12);i[0]=0,i[1]=1,i[2]=0,i[3]=0,i[4]=0,i[5]=0,i[6]=1,i[7]=1,i[8]=0,i[9]=1,i[10]=0,i[11]=0,t=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(w.unitQuadKey3,t,4*i.length)}return t},w.prototype.surfacePointForMode=function(e,i,r,n,o){if(!o)throw new t(c.logMessage(c.LEVEL_SEVERE,"DrawContext","surfacePointForMode","missingResult"));if(this.terrain)this.terrain.surfacePointForMode(e,i,r,n,o);else{var s=r+this.globe.elevationAtLocation(e,i)*this.verticalExaggeration;this.globe.computePointFromPosition(e,i,s,o)}return o},w}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[],n=function(){"use strict";var t=function(){this.objects=[]};return t.prototype.hasNonTerrainObjects=function(){return this.objects.length>1||1===this.objects.length&&null==this.terrainObject()},t.prototype.terrainObject=function(){for(var t=0,e=this.objects.length;t<e;t++)if(this.objects[t].isTerrain)return this.objects[t];return null},t.prototype.add=function(t){if(t)if(t.isTerrain){for(var e=this.objects.length,i=0,r=this.objects.length;i<r;i++)if(this.objects[i].isTerrain){e=i;break}this.objects[e]=t}else this.objects.push(t)},t.prototype.clear=function(){this.objects=[]},t.prototype.topPickedObject=function(){var t=this.objects.length;if(t>1)for(var e=0;e<t;e++)if(this.objects[[e].isOnTop])return this.objects[e];return t>0?this.objects[0]:null},t}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(17)],n=function(t,e){"use strict";var i=function(i,r,n,o){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"FramebufferTexture","constructor","missingGlContext"));if(r<0||n<0)throw new t(e.logMessage(e.LEVEL_SEVERE,"FramebufferTexture","constructor","The framebuffer width or height is less than zero."));this.width=r,this.height=n,this.depth=o,this.size=r*n*4+(o?r*n*2:0),this.framebufferId=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this.framebufferId),this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,r,n,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.texture,0),this.depthBuffer=null,o&&(this.depthBuffer=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this.depthBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,r,n),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,this.depthBuffer));var s=i.checkFramebufferStatus(i.FRAMEBUFFER);s!=i.FRAMEBUFFER_COMPLETE&&(e.logMessage(e.LEVEL_WARNING,"FramebufferTexture","constructor","Error creating framebuffer: "+s),this.framebufferId=null,this.texture=null,this.depthBuffer=null),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindTexture(i.TEXTURE_2D,null)};return i.prototype.bind=function(t){return this.texture&&t.currentGlContext.bindTexture(gl.TEXTURE_2D,this.texture),!!this.texture},i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(98),i(73),i(14),i(8),i(24),i(48),i(50)],n=function(t,e,i,r,n,o,s,a){"use strict";var l=function(){this.tileWidth=256,this.tileHeight=256,this.detailControl=1.75,this.levels=new i(s.FULL_SPHERE,new r(45,45),16,this.tileWidth,this.tileHeight),this.topLevelTiles=[],this.currentTiles=[],this.currentTimestamp=null,this.currentGlobeStateKey=null,this.tileCache=new o(5e5,4e5),this.key="FramebufferTileController "+ ++l.keyPool};return l.keyPool=0,l.prototype.selectTiles=function(e,i){if(!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"FramebufferTileController","selectTiles","missingSector"));this.assembleTiles(e);for(var r=[],o=0,s=this.currentTiles.length;o<s;o++){var a=this.currentTiles[o];a.sector.overlaps(i)&&(a.selected=!0,r.push(a))}return r},l.prototype.render=function(t){if(0!=this.currentTiles.length){for(var e=[],i=0,r=this.currentTiles.length;i<r;i++){var n=this.currentTiles[i];n.selected&&e.push(n)}t.surfaceTileRenderer.renderTiles(t,e,1);var o=t.currentGlContext,s=t.currentFramebuffer;try{for(o.clearColor(0,0,0,0),i=0,r=e.length;i<r;i++)n=e[i],n.selected=!1,n.bindFramebuffer(t),o.clear(o.COLOR_BUFFER_BIT)}finally{t.bindFramebuffer(s)}}},l.prototype.assembleTiles=function(t){var e=t.timestamp,i=t.globeStateKey;this.currentTimestamp==e&&this.currentGlobeStateKey==i||(this.doAssembleTiles(t),this.currentTimestamp=e,this.currentGlobeStateKey=i)},l.prototype.doAssembleTiles=function(t){if(this.currentTiles=[],t.terrain){0==this.topLevelTiles.length&&this.createTopLevelTiles();for(var e=0,i=this.topLevelTiles.length;e<i;e++){var r=this.topLevelTiles[e];r.update(t),this.isTileVisible(t,r)&&this.addTileOrDescendants(t,r)}}},l.prototype.createTile=function(t,i,r,n){var o=this.key+" "+i.levelNumber+"."+r+"."+n;return new e(t,i,r,n,o)},l.prototype.createTopLevelTiles=function(){a.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles)},l.prototype.addTileOrDescendants=function(t,e){if(this.tileMeetsRenderingCriteria(t,e))return void this.addTile(e);for(var i=e.subdivideToCache(e.level.nextLevel(),this,this.tileCache),r=0,n=i.length;r<n;r++){var o=i[r];o.update(t),this.isTileVisible(t,o)&&this.addTileOrDescendants(t,o)}},l.prototype.addTile=function(t){this.currentTiles.push(t)},l.prototype.isTileVisible=function(t,e){return!(t.globe.projectionLimits&&!e.sector.overlaps(t.globe.projectionLimits))&&(t.pickingMode?e.extent.intersectsFrustum(t.pickFrustum):e.extent.intersectsFrustum(t.navigatorState.frustumInModelCoordinates))},l.prototype.tileMeetsRenderingCriteria=function(t,e){var i=this.detailControl;return(e.sector.minLatitude>=75||e.sector.maxLatitude<=-75)&&(i*=1.2),e.level.isLastLevel()||!e.mustSubdivide(t,i)},l}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(96),i(8),i(36),i(18),i(49)],n=function(t,e,i,r,n,o){"use strict";var s=function(e,n,s,a,l){if(!l||l.length<1)throw new t(i.logMessage(i.LEVEL_SEVERE,"FramebufferTile","constructor","The specified cache name is null, undefined or zero length."));o.call(this,e,n,s,a),this.gpuCacheKey=l,this.textureTransform=r.fromIdentity().setToUnitYFlip(),this.mustClear=!0};return s.prototype=Object.create(o.prototype),s.prototype.clearFramebuffer=function(t){this.mustClear=!0},s.prototype.bindFramebuffer=function(t){var e=t.gpuResourceCache.resourceForKey(this.gpuCacheKey);return e||(e=this.createFramebuffer(t)),t.bindFramebuffer(e),this.mustClear&&(this.doClearFramebuffer(t),this.mustClear=!1),!0},s.prototype.createFramebuffer=function(t){var i=new e(t.currentGlContext,this.tileWidth,this.tileHeight,!1);return t.gpuResourceCache.putResource(this.gpuCacheKey,i,i.size),i},s.prototype.doClearFramebuffer=function(t){var e=t.currentGlContext;e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},s.prototype.applyInternalTransform=function(t,e){e.multiplyMatrix(this.textureTransform)},s}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(8)],n=function(t){"use strict";var e=function(t){this.displayName=t?t:"Layer",this.enabled=!0,this.pickEnabled=!0,this.opacity=1,this.minActiveAltitude=-Number.MAX_VALUE,this.maxActiveAltitude=Number.MAX_VALUE,this.inCurrentFrame=!1,this.time=null};return e.prototype.refresh=function(){},e.prototype.render=function(t){this.inCurrentFrame=!1,this.enabled&&(t.pickingMode&&!this.pickEnabled||this.withinActiveAltitudes(t)&&this.isLayerInView(t)&&this.doRender(t))},e.prototype.doRender=function(t){},e.prototype.withinActiveAltitudes=function(t){var e=t.eyePosition;
return!!e&&(e.altitude>=this.minActiveAltitude&&e.altitude<=this.maxActiveAltitude)},e.prototype.isLayerInView=function(t){return!0},e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(102),i(23),i(101),i(8),i(36),i(6),i(60),i(103),i(11),i(17)],n=function(t,e,i,r,n,o,s,a,l,h,c){"use strict";var u=function(){this.imageUrls=[],this.stringCredits=[],this.imageCreditSize=64,this.margin=5,this.opacity=.5,this.creditFont=new r(14)};return u.scratchMatrix=o.fromIdentity(),u.imageTransform=o.fromIdentity(),u.texCoordMatrix=o.fromIdentity(),u.prototype.clear=function(){this.imageUrls=[],this.stringCredits=[]},u.prototype.addImageCredit=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"ScreenCreditController","addImageCredit","missingUrl"));this.imageUrls.indexOf(e)===-1&&this.imageUrls.push(e)},u.prototype.addStringCredit=function(e,r){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"ScreenCreditController","addStringCredit","missingText"));if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"ScreenCreditController","addStringCredit","missingColor"));this.stringCredits.indexOf(e)===-1&&this.stringCredits.push({text:e,color:r||i.WHITE})},u.prototype.drawCredits=function(t){if((0!==this.imageUrls.length||0!==this.stringCredits.length)&&!t.pickingMode&&t.timestamp!=this.lastFrameTimestamp){this.lastFrameTimestamp=t.timestamp,this.beginDrawingCredits(t);for(var e,i=t.navigatorState.viewport.width-(this.margin+this.imageCreditSize),r=0,n=0;n<this.imageUrls.length;n++)e=this.drawImageCredit(t,this.imageUrls[n],i,this.margin),e>0&&(i-=this.margin+this.imageCreditSize,r=c.max(e,r));for(var o=r+this.margin,s=0;s<this.stringCredits.length;s++)this.drawStringCredit(t,this.stringCredits[s],o),o+=this.margin+15;this.endDrawingCredits(t)}},u.prototype.beginDrawingCredits=function(t){var i,r=t.currentGlContext;t.findAndBindProgram(e),i=t.currentProgram,r.bindBuffer(r.ARRAY_BUFFER,t.unitQuadBuffer3()),r.vertexAttribPointer(i.vertexPointLocation,3,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,t.unitQuadBuffer()),r.vertexAttribPointer(i.vertexTexCoordLocation,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(i.vertexPointLocation),r.enableVertexAttribArray(i.vertexTexCoordLocation),i.loadTextureUnit(r,r.TEXTURE0),i.loadModulateColor(r,!1)},u.prototype.endDrawingCredits=function(t){var e=t.currentGlContext,i=t.currentProgram;e.disableVertexAttribArray(i.vertexPointLocation),e.disableVertexAttribArray(i.vertexTexCoordLocation),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindTexture(e.TEXTURE_2D,null),e.enable(e.DEPTH_TEST)},u.prototype.drawImageCredit=function(t,e,r,n){var o,s,a,l,h,c;return(l=t.gpuResourceCache.resourceForKey(e))?(o=l.imageWidth,s=l.imageHeight,a=o<=this.imageCreditSize&&this.imageHeight<=this.imageCreditSize?1:o>=s?this.imageCreditSize/o:this.imageCreditSize/s,u.imageTransform.setTranslation(r,n,0),u.imageTransform.setScale(a*o,a*s,1),h=t.currentGlContext,c=t.currentProgram,u.scratchMatrix.copy(t.screenProjection),u.scratchMatrix.multiplyMatrix(u.imageTransform),c.loadModelviewProjection(h,u.scratchMatrix),c.loadTextureEnabled(h,!0),c.loadColor(h,i.WHITE),c.loadOpacity(h,this.opacity),u.texCoordMatrix.setToIdentity(),u.texCoordMatrix.multiplyByTextureTransform(l),c.loadTextureMatrix(h,u.texCoordMatrix),l.bind(t)&&h.drawArrays(h.TRIANGLE_STRIP,0,4),s):(t.gpuResourceCache.retrieveTexture(t.currentGlContext,e),0)},u.prototype.drawStringCredit=function(t,e,i){var r,n,o,s,a,l,h;return s=e.text+this.creditFont.toString(),o=t.gpuResourceCache.resourceForKey(s),o||(o=t.textSupport.createTexture(t,e.text,this.creditFont,!1),t.gpuResourceCache.putResource(s,o,o.size)),r=o.imageWidth,n=o.imageHeight,h=t.navigatorState.viewport.width-(r+this.margin),u.imageTransform.setTranslation(h,i,0),u.imageTransform.setScale(r,n,1),a=t.currentGlContext,l=t.currentProgram,u.scratchMatrix.copy(t.screenProjection),u.scratchMatrix.multiplyMatrix(u.imageTransform),l.loadModelviewProjection(a,u.scratchMatrix),l.loadTextureEnabled(a,!0),l.loadColor(a,e.color),l.loadOpacity(a,this.opacity),u.texCoordMatrix.setToIdentity(),u.texCoordMatrix.multiplyByTextureTransform(o),l.loadTextureMatrix(a,u.texCoordMatrix),o.bind(t)&&a.drawArrays(a.TRIANGLE_STRIP,0,4),!0},u}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(23),i(8)],n=function(t,e,i){"use strict";var r=function(e,r,n,o,s,a){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Font","constructor","missingSize"));if(e<=0)throw new t(i.logMessage(i.LEVEL_SEVERE,"Font","constructor","invalidSize"));this._size=e,this.style=r||"normal",this.variant=n||"normal",this.weight=o||"normal",this.family=s||"sans-serif",this.horizontalAlignment=a||"center"};return Object.defineProperties(r.prototype,{size:{get:function(){return this._size},set:function(t){this._fontString=null,this._size=t}},style:{get:function(){return this._style},set:function(t){this._fontString=null,this._style=t}},variant:{get:function(){return this._variant},set:function(t){this._fontString=null,this._variant=t}},weight:{get:function(){return this._weight},set:function(t){this._fontString=null,this._weight=t}},family:{get:function(){return this._family},set:function(t){this._fontString=null,this._family=t}},horizontalAlignment:{get:function(){return this._horizontalAlignment},set:function(t){this._toString=null,this._horizontalAlignment=t}},fontString:{get:function(){return this._fontString||(this._fontString=this._style+" "+this.variant+" "+this._weight+" "+this._size.toString()+"px "+this._family),this._fontString}}}),r.prototype.toString=function(){return this._toString&&this._fontString||(this._toString=this.fontString+" "+this.horizontalAlignment),this._toString},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(23),i(54),i(8)],n=function(t,e,i,r){"use strict";var n=function(t){var e="attribute vec4 vertexPoint;\nattribute vec4 vertexTexCoord;\nattribute vec4 normalVector;\nuniform mat4 mvpMatrix;\nuniform mat4 mvInverseMatrix;\nuniform mat4 texCoordMatrix;\nuniform bool applyLighting;\nvarying vec2 texCoord;\nvarying vec4 normal;\nvoid main() {gl_Position = mvpMatrix * vertexPoint;\ntexCoord = (texCoordMatrix * vertexTexCoord).st;\nif (applyLighting) {normal = mvInverseMatrix * normalVector;}\n}",r="precision mediump float;\nuniform float opacity;\nuniform vec4 color;\nuniform bool enableTexture;\nuniform bool modulateColor;\nuniform sampler2D textureSampler;\nuniform bool applyLighting;\nvarying vec2 texCoord;\nvarying vec4 normal;\nvoid main() {\nvec4 textureColor = texture2D(textureSampler, texCoord);\nfloat ambient = 0.15; vec4 lightDirection = vec4(0, 0, 1, 0);\nif (enableTexture && !modulateColor)\n    gl_FragColor = textureColor * color * opacity;\nelse if (enableTexture && modulateColor)\n    gl_FragColor = color * floor(textureColor.a + 0.5);\nelse\n    gl_FragColor = color * opacity;\nif (gl_FragColor.a == 0.0) {discard;}\nif (applyLighting) {\n    vec4 n = normal * (gl_FrontFacing ? 1.0 : -1.0);\n    gl_FragColor.rgb *= clamp(ambient + dot(lightDirection, n), 0.0, 1.0);\n}\n}",n=["vertexPoint","normalVector","vertexTexCoord"];i.call(this,t,e,r,n),this.vertexPointLocation=this.attributeLocation(t,"vertexPoint"),this.normalVectorLocation=this.attributeLocation(t,"normalVector"),this.vertexTexCoordLocation=this.attributeLocation(t,"vertexTexCoord"),this.mvpMatrixLocation=this.uniformLocation(t,"mvpMatrix"),this.mvInverseMatrixLocation=this.uniformLocation(t,"mvInverseMatrix"),this.colorLocation=this.uniformLocation(t,"color"),this.textureEnabledLocation=this.uniformLocation(t,"enableTexture"),this.modulateColorLocation=this.uniformLocation(t,"modulateColor"),this.textureUnitLocation=this.uniformLocation(t,"textureSampler"),this.textureMatrixLocation=this.uniformLocation(t,"texCoordMatrix"),this.opacityLocation=this.uniformLocation(t,"opacity"),this.applyLightingLocation=this.uniformLocation(t,"applyLighting")};return n.key="WorldWindGpuBasicTextureProgram",n.prototype=Object.create(i.prototype),n.prototype.loadModelviewInverse=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"BasicTextureProgram","loadModelviewInverse","missingMatrix"));this.loadUniformMatrix(e,i,this.mvInverseMatrixLocation)},n.prototype.loadModelviewProjection=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"BasicTextureProgram","loadModelviewProjection","missingMatrix"));this.loadUniformMatrix(e,i,this.mvpMatrixLocation)},n.prototype.loadColor=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"BasicTextureProgram","loadColor","missingColor"));this.loadUniformColor(e,i,this.colorLocation)},n.prototype.loadTextureEnabled=function(t,e){t.uniform1i(this.textureEnabledLocation,e?1:0)},n.prototype.loadModulateColor=function(t,e){t.uniform1i(this.modulateColorLocation,e?1:0)},n.prototype.loadTextureUnit=function(t,e){t.uniform1i(this.textureUnitLocation,e-t.TEXTURE0)},n.prototype.loadTextureMatrix=function(t,e){this.loadUniformMatrix(t,e,this.textureMatrixLocation)},n.prototype.loadOpacity=function(t,e){t.uniform1f(this.opacityLocation,e)},n.prototype.loadApplyLighting=function(t,e){t.uniform1i(this.applyLightingLocation,e)},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(8),i(39)],n=function(t,e){"use strict";var i=function(){this.displayName="Renderable",this.enabled=!0,this.pickDelegate=null,this.userProperties={}};return i.prototype.render=function(i){throw new e(t.logMessage(t.LEVEL_SEVERE,"Renderable","render","abstractInvocation"))},i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(10),i(13),i(9),i(14),i(8),i(52),i(60),i(103),i(48),i(105),i(39),i(17)],n=function(t,e,i,r,n,o,s,a,l,h,c,u){"use strict";var d=function(t){a.call(this),this._displayName="Surface Shape",this._attributes=t?t:new h(null),this._highlightAttributes=null,this._highlighted=!1,this._enabled=!0,this._pathType=WorldWind.GREAT_CIRCLE,this._maximumNumEdgeIntervals=d.DEFAULT_NUM_EDGE_INTERVALS,this._polarThrottle=d.DEFAULT_POLAR_THROTTLE,this._sector=null,this.pickDelegate=null,this._sectors=[],this._locations=null,this._boundaries=null,this._interiorGeometry=null,this._outlineGeometry=null,this._isInteriorInhibited=!1,this.stateKeyInvalid=!0,this._attributesStateKey=null,this.isPrepared=!1,this.layer=null,this.pickColor=null};return d.prototype=Object.create(a.prototype),Object.defineProperties(d.prototype,{stateKey:{get:function(){if(this._attributesStateKey){var t=null;this._highlighted?this._highlightAttributes&&(t=this._highlightAttributes.stateKey):this._attributes&&(t=this._attributes.stateKey),t!=this._attributesStateKey&&(this._attributesStateKey=t,this.stateKeyInvalid=!0)}else this._highlighted?this._highlightAttributes&&(this._attributesStateKey=this._highlightAttributes.stateKey):this._attributes&&(this._attributesStateKey=this._attributes.stateKey),this._attributesStateKey&&(this.stateKeyInvalid=!0);return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey()),this._stateKey}},displayName:{get:function(){return this._displayName},set:function(t){this.stateKeyInvalid=!0,this._displayName=t}},attributes:{get:function(){return this._attributes},set:function(t){this.stateKeyInvalid=!0,this._attributes=t,this._attributesStateKey=t.stateKey}},highlightAttributes:{get:function(){return this._highlightAttributes},set:function(t){this.stateKeyInvalid=!0,this._highlightAttributes=t}},highlighted:{get:function(){return this._highlighted},set:function(t){this.stateKeyInvalid=!0,this._highlighted=t}},enabled:{get:function(){return this._enabled},set:function(t){this.stateKeyInvalid=!0,this._enabled=t}},pathType:{get:function(){return this._pathType},set:function(t){this.stateKeyInvalid=!0,this._pathType=t}},maximumNumEdgeIntervals:{get:function(){return this._maximumNumEdgeIntervals},set:function(t){this.stateKeyInvalid=!0,this._maximumNumEdgeIntervals=t}},polarThrottle:{get:function(){return this._polarThrottle},set:function(t){this.stateKeyInvalid=!0,this._polarThrottle=t}},sector:{get:function(){return this._sector}}}),d.staticStateKey=function(t){return t.stateKeyInvalid=!1,t.highlighted&&t._highlightAttributes?t._attributesStateKey=t._highlightAttributes.stateKey:t._attributes?t._attributesStateKey=t._attributes.stateKey:t._attributesStateKey=null,"dn "+t.displayName+" at "+(t._attributesStateKey?t._attributesStateKey:"null")+" hi "+t.highlighted+" en "+t.enabled+" pt "+t.pathType+" ne "+t.maximumNumEdgeIntervals+" po "+t.polarThrottle+" se ["+t.sector.minLatitude+","+t.sector.maxLatitude+","+t.sector.minLongitude+","+t.sector.maxLongitude+"]"},d.prototype.computeStateKey=function(){return d.staticStateKey(this)},d.prototype.area=function(t,e){throw new o(n.logMessage(n.LEVEL_SEVERE,"SurfaceShape","area","notYetImplemented"))},d.prototype.computeBoundaries=function(e){throw new t(n.logMessage(n.LEVEL_SEVERE,"SurfaceShape","computeBoundaries","abstractInvocation"))},d.prototype.render=function(t){this.enabled&&(this.layer=t.currentLayer,this.prepareBoundaries(t),t.surfaceShapeTileBuilder.insertSurfaceShape(this))},d.prototype.interpolateLocations=function(t){var e,i,r,n=t[0],o=n,s=!0,a=!0,l=0,h=!0;for(this._locations=[n],i=1,r=t.length;i<r;i+=1)e=o,a=s,o=t[i],s=o.latitude==n.latitude&&o.longitude==n.longitude,h=!0,(s||a)&&(l+=1,l>2&&(h=!1)),h&&this.interpolateEdge(e,o,this._locations),this._locations.push(o),e=o;this._isInteriorInhibited||e.latitude==n.latitude&&e.longitude==n.longitude||(this.interpolateEdge(e,n,this._locations),this._locations.push(n))},d.prototype.interpolateEdge=function(t,e,i){var n,o,s=r.greatCircleDistance(t,e),a=Math.round(this._maximumNumEdgeIntervals*s/Math.PI);if(a>0){n=1/a,o=t;for(var l=this.throttledStep(n,o);l<1;l+=this.throttledStep(n,o))o=new r(0,0),r.interpolateAlongPath(this._pathType,l,t,e,o),i.push(o)}},d.prototype.throttledStep=function(t,i){var r=Math.cos(i.latitude*e.DEGREES_TO_RADIANS);r*=r;var n=this._polarThrottle/(1+this._polarThrottle);return t*(1-n+n*r)},d.prototype.prepareBoundaries=function(t){this.isPrepared||(this._boundaries||this.computeBoundaries(t),this._locations||this.interpolateLocations(this._boundaries),this.prepareGeometry(t),this.prepareSectors(),this.isPrepared=!0)},d.prototype.computeSectors=function(t){return this._sectors&&this._sectors.length>0?this._sectors:(this.prepareBoundaries(t),this._sectors)},d.prototype.prepareSectors=function(){var t=this._boundaries;if(t){this._sector=new l(-90,90,-180,180),this._sector.setToBoundingSector(t);var e=this.containsPole(t);if(e!=r.poles.NONE?(e==r.poles.NORTH?this._sector=new l(this._sector.minLatitude,90,-180,180):this._sector=new l(-90,this._sector.maxLatitude,-180,180),this._sectors=[this._sector]):r.locationsCrossDateLine(t)?this._sectors=l.splitBoundingSectors(t):this._sector.isEmpty()||(this._sectors=[this._sector]),this._sectors&&this._pathType===WorldWind.GREAT_CIRCLE)for(var i=0,n=this._sectors.length;i<n;i+=1){var o=this._sectors[i],s=r.greatCircleArcExtremeLocations(t),a=Math.min(o.minLatitude,s[0].latitude),h=Math.max(o.maxLatitude,s[1].latitude);this._sectors[i]=new l(a,h,o.minLongitude,o.maxLongitude)}}},d.prototype.prepareGeometry=function(t){var e;this._interiorGeometry=[],this._outlineGeometry=[];var i=this._locations,n=this.containsPole(i);if(n!=r.poles.NONE){var o=this.cutAlongDateLine(i,n,t.globe);this._interiorGeometry.push(o),e=this.repeatAroundDateline(i),this._outlineGeometry.push(e[0]),e.length>1&&this._outlineGeometry.push(e[1])}else r.locationsCrossDateLine(i)?(e=this.repeatAroundDateline(i),this._interiorGeometry.push(e[0]),this._interiorGeometry.push(e[1]),this._outlineGeometry.push(e[0]),this._outlineGeometry.push(e[1])):(this._interiorGeometry.push(i),this._outlineGeometry.push(i))},d.prototype.containsPole=function(t){for(var e=!1,i=90,n=-90,o=t[0],s=1,a=t.length;s<a;s+=1){var l=t[s];r.locationsCrossDateLine([o,l])&&(e=!e),i=Math.min(i,l.latitude),n=Math.max(n,l.latitude),o=l}var h=t[0];return r.locationsCrossDateLine([h,o])&&(e=!e),e?i>0?r.poles.NORTH:n<0?r.poles.SOUTH:Math.abs(n)>=Math.abs(i)?r.poles.NORTH:r.poles.SOUTH:r.poles.NONE},d.prototype.cutAlongDateLine=function(t,e,i){if(e==r.poles.NONE)return t;for(var n=[],o=e==r.poles.NORTH?90:-90,s=t[t.length-1],a=0,l=t.length;a<l;a+=1){var h=t[a];if(n.push(s),r.locationsCrossDateLine([s,h])){var c=r.intersectionWithMeridian(s,h,180,i),d=u.signum(s.longitude),p=c,f=180*d,g=-f;n.push(new r(p,f)),n.push(new r(o,f)),n.push(new r(o,g)),n.push(new r(p,g))}s=h}return n.push(s),n},d.prototype.repeatAroundDateline=function(t){var e=0,i=!1,n=[],o=t[0];n.push(o);for(var s=1,a=t.length;s<a;s+=1){var l=t[s];r.locationsCrossDateLine([o,l])&&(0==e&&(e=o.longitude<0?-360:360),i=!i),i?n.push(new r(l.latitude,l.longitude+e)):n.push(l),o=l}var h=[n];if(0!=e){var c=n;for(n=[],s=0,a=c.length;s<a;s+=1){var u=c[s];n.push(new r(u.latitude,u.longitude-e))}h.push(n)}return h},d.prototype.resetPickColor=function(){this.pickColor=null},d.prototype.renderToTexture=function(t,e,i,r,n,o){var a,l,h,c,u=[],d=t.pickingMode,p=this._highlighted?this._highlightAttributes||this._attributes:this._attributes;if(d&&!this.pickColor&&(this.pickColor=t.uniquePickColor()),!this._isInteriorInhibited&&p.drawInterior)for(e.fillStyle=d?this.pickColor.toRGBAString():p.interiorColor.toRGBAString(),a=0,l=this._interiorGeometry.length;a<l;a+=1)if(h=0,c=2*this._outlineGeometry[a].length,u.splice(0,u.length),this.transformPath(this._interiorGeometry[a],i,r,n,o,u)){for(e.beginPath(),e.moveTo(u[h++],u[h++]);h<c;)e.lineTo(u[h++],u[h++]);e.closePath(),e.fill()}if(p.drawOutline&&p.outlineWidth>0){e.lineWidth=4*p.outlineWidth,e.strokeStyle=d?this.pickColor.toRGBAString():p.outlineColor.toRGBAString();this._attributes.outlineStipplePattern,this._attributes.outlineStippleFactor;for(a=0,l=this._outlineGeometry.length;a<l;a+=1)if(u.splice(0,u.length),this.transformPath(this._outlineGeometry[a],i,r,n,o,u)){var f=u[0],g=u[1],m=f,E=g,v=f,y=g,_=!0,T=!0,L=0;for(h=2,c=u.length;h<c;)m=v,E=y,_=T,v=u[h++],y=u[h++],T=v==f&&y==g,(_||T)&&(L+=1,L>2)||(e.beginPath(),e.moveTo(m,E),e.lineTo(v,y),e.stroke())}}if(d){var x=new s(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,null,this.layer,!1);t.resolvePick(x)}},d.prototype.transformPath=function(t,e,i,r,n,o){var s,a,l,h,c,u,d,p,f,g,m,E,v,y,_,T,L,x,b,S,w=4;for(x=0,L=t[0],c=L.longitude*e+r,u=L.latitude*i+n,T=!0,f=m=s=l=c,g=E=a=h=u,o[x++]=l,o[x++]=h,b=1,S=t.length;b<S;b+=1)L=t[b],d=l,p=h,l=L.longitude*e+r,h=L.latitude*i+n,T=l==c&&h==u,v=l-s,y=h-a,_=v*v+y*y,(T||_>=w)&&(f=Math.min(f,l),m=Math.max(m,l),g=Math.min(g,h),E=Math.max(E,h),o[x-2]==d&&o[x-1]==p||(o[x++]=d,o[x++]=p),o[x++]=l,o[x++]=h,s=l,a=h);return m-f>=2||E-g>=2},d.DEFAULT_NUM_EDGE_INTERVALS=128,d.DEFAULT_POLAR_THROTTLE=10,d}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(23),i(22)],n=function(t,e){"use strict";var i=function(e){this._drawInterior=!e||e._drawInterior,this._drawOutline=!e||e._drawOutline,this._enableLighting=!!e&&e._enableLighting,this._interiorColor=e?e._interiorColor:t.WHITE,this._outlineColor=e?e._outlineColor:t.RED,this._outlineWidth=e?e._outlineWidth:1,this._outlineStippleFactor=e?e._outlineStippleFactor:0,this._outlineStipplePattern=e?e._outlineStipplePattern:61680,this._imageSource=e?e._imageSource:null,this._depthTest=!e||e._depthTest,this._drawVerticals=!!e&&e._drawVerticals,this._applyLighting=!!e&&e._applyLighting,this.stateKeyInvalid=!0};return i.prototype.computeStateKey=function(){return"di "+this._drawInterior+" do "+this._drawOutline+" el "+this._enableLighting+" ic "+this._interiorColor.toHexString(!0)+" oc "+this._outlineColor.toHexString(!0)+" ow "+this._outlineWidth+" osf "+this._outlineStippleFactor+" osp "+this._outlineStipplePattern+" is "+(this._imageSource?this.imageSource instanceof e?this.imageSource.key:this.imageSource:"null")+" dt "+this._depthTest+" dv "+this._drawVerticals+" li "+this._applyLighting},Object.defineProperties(i.prototype,{stateKey:{get:function(){return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey(),this.stateKeyInvalid=!1),this._stateKey}},drawInterior:{get:function(){return this._drawInterior},set:function(t){this._drawInterior=t,this.stateKeyInvalid=!0}},drawOutline:{get:function(){return this._drawOutline},set:function(t){this._drawOutline=t,this.stateKeyInvalid=!0}},enableLighting:{get:function(){return this._enableLighting},set:function(t){this._enableLighting=t,this.stateKeyInvalid=!0}},interiorColor:{get:function(){return this._interiorColor},set:function(t){this._interiorColor=t,this.stateKeyInvalid=!0}},outlineColor:{get:function(){return this._outlineColor},set:function(t){this._outlineColor=t,this.stateKeyInvalid=!0}},outlineWidth:{get:function(){return this._outlineWidth},set:function(t){this._outlineWidth=t,this.stateKeyInvalid=!0}},outlineStipplePattern:{get:function(){return this._outlineStipplePattern},set:function(t){this._outlineStipplePattern=t,this.stateKeyInvalid=!0}},outlineStippleFactor:{get:function(){return this._outlineStippleFactor},set:function(t){this._outlineStippleFactor=t,this.stateKeyInvalid=!0}},imageSource:{get:function(){return this._imageSource},set:function(t){this._imageSource=t,this.stateKeyInvalid=!0}},depthTest:{get:function(){return this._depthTest},set:function(t){this._depthTest=t,this.stateKeyInvalid=!0}},drawVerticals:{get:function(){return this._drawVerticals},set:function(t){this._drawVerticals=t,this.stateKeyInvalid=!0}},applyLighting:{get:function(){return this._applyLighting},set:function(t){this._applyLighting=t,this.stateKeyInvalid=!0}}}),i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(94),i(86),i(54),i(47),i(73),i(14),i(8),i(36),i(24),i(38),i(52),i(60),i(18),i(48),i(104),i(46),i(88),i(89),i(90),i(49),i(50)],n=function(t,e,i,r,n,o,s,a,l,h,c,u,d,p,f,g,m,E,v,y,_,T){"use strict";var L=function(){this.numRowsTilesInTopLevel=4,this.numColumnsTilesInTopLevel=8,this.maximumSubdivisionDepth=15,this.tileWidth=256,this.tileHeight=256,this.levels=new o(f.FULL_SPHERE,new s(180/this.numRowsTilesInTopLevel,360/this.numColumnsTilesInTopLevel),this.maximumSubdivisionDepth,this.tileWidth,this.tileHeight),this.surfaceShapes=[],this.surfaceShapeTiles=[],this.topLevelTiles=[],this.sector=new f(-90,90,-180,180),this.detailControl=1.25,this.tileCache=new h(5e5,4e5)};return L.prototype.clear=function(){this.surfaceShapeTiles.splice(0,this.surfaceShapeTiles.length),this.surfaceShapes.splice(0,this.surfaceShapes.length)},L.prototype.insertSurfaceShape=function(t){this.surfaceShapes.push(t)},L.prototype.doRender=function(t){if(t.pickingMode){for(var e=0,i=this.surfaceShapes.length;e<i;e+=1)this.surfaceShapes[e].resetPickColor();L.pickSequence+=1;var r=this.surfaceShapeTiles,n=this.topLevelTiles;this.surfaceShapeTiles=[],this.topLevelTiles=[],this.buildTiles(t),t.deepPicking?this.doDeepPickingRender(t):t.surfaceTileRenderer.renderTiles(t,this.surfaceShapeTiles,1),this.surfaceShapeTiles=r,this.topLevelTiles=n}else this.buildTiles(t),t.surfaceTileRenderer.renderTiles(t,this.surfaceShapeTiles,1)},L.prototype.doDeepPickingRender=function(t){var e,i,r,n,o,s,a,l,h,c=[];for(o=0,s=t.objectsAtPickPoint.objects.length;o<s;o+=1)a=t.objectsAtPickPoint.objects[o],a.userObject instanceof g&&(l=a.userObject,c.indexOf(l)<0&&(c.push(l),t.objectsAtPickPoint.objects.splice(o,1),o-=1,s-=1));if(!(c.length<=0)){var u=[];for(r=0,n=c.length;r<n;r+=1){for(l=c[r],e=0,i=this.surfaceShapeTiles.length;e<i;e+=1)h=this.surfaceShapeTiles[e],h.setShapes([l]),h.updateTexture(t);t.surfaceTileRenderer.renderTiles(t,this.surfaceShapeTiles,1);var p=t.readPickColor(t.pickPoint);p&&l.pickColor.equals(p)&&(a=new d(l.pickColor.clone(),l.pickDelegate?l.pickDelegate:l,null,l.layer,!1),u.push(a))}for(o=0,s=t.objectsAtPickPoint.objects.length;o<s;o+=1)a=t.objectsAtPickPoint.objects[o],a.userObject instanceof g&&(t.objectsAtPickPoint.objects.splice(o,1),o-=1,s-=1);for(o=0,s=u.length;o<s;o+=1)a=u[o],t.objectsAtPickPoint.objects.push(a)}},L.prototype.buildTiles=function(e){if(!e)throw new t(a.logMessage(a.LEVEL_SEVERE,"SurfaceShapeTileBuilder","buildTiles","missingDc"));if(this.surfaceShapes&&!(this.surfaceShapes.length<1)){this.assembleTiles(e),this.surfaceShapes.splice(0,this.surfaceShapes.length);for(var i=0,r=this.surfaceShapeTiles.length;i<r;i+=1){var n=this.surfaceShapeTiles[i];n.clearShapes()}}},L.prototype.assembleTiles=function(t){var e,i,r,n,o,s,a;this.topLevelTiles.length<1&&this.createTopLevelTiles();var l={};for(i=0,r=this.surfaceShapes.length;i<r;i+=1){var h=this.surfaceShapes[i],c=h.computeSectors(t);if(c)for(s=0,a=c.length;s<a;s+=1){var u=c[s];for(n=0,o=this.topLevelTiles.length;n<o;n+=1)if(e=this.topLevelTiles[n],e.sector.intersects(u)){var d=e.tileKey;l[d]=e,e.addSurfaceShape(h)}}}for(var p in l)l.hasOwnProperty(p)&&(e=l[p],this.addTileOrDescendants(t,this.levels,null,e))},L.prototype.addTileOrDescendants=function(t,e,i,r){if(!this.intersectsFrustum(t,r))return void r.clearShapes();if(null!=i&&this.addIntersectingShapes(t,i,r),r.hasShapes()){if(this.meetsRenderCriteria(t,e,r))return void this.addTile(t,r);for(var n=e.level(r.level.levelNumber+1),o=t.pickingMode?r.subdivide(n,this):r.subdivideToCache(n,this,this.tileCache),s=0,a=o.length;s<a;s+=1){var l=o[s];this.addTileOrDescendants(t,e,r,l)}r.clearShapes()}},L.prototype.addIntersectingShapes=function(t,e,i){if(e.hasShapes()&&i.sector.intersects(e.sector))if(i.getSector().contains(e.sector))i.addAllSurfaceShapes(e.getShapes());else for(var r=e.getShapes(),n=0,o=r.length;n<o;n+=1){var s=r[n],a=s.computeSectors(t);if(a)for(var l=0,h=a.length;l<h;l+=1){var c=a[l];if(i.getSector().intersects(c)){i.addSurfaceShape(s);break}}}},L.prototype.addTile=function(t,e){t.pickingMode&&(e.pickSequence=L.pickSequence),e.needsUpdate(t)&&e.updateTexture(t),this.surfaceShapeTiles.push(e)},L.prototype.createTile=function(t,e,i,r){return new m(t,e,i,r)},L.prototype.createTopLevelTiles=function(){T.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles)},L.prototype.intersectsFrustum=function(t,e){return!(t.globe.projectionLimits&&!e.sector.overlaps(t.globe.projectionLimits))&&(e.update(t),e.extent.intersectsFrustum(t.pickingMode?t.pickFrustum:t.navigatorState.frustumInModelCoordinates))},L.prototype.meetsRenderCriteria=function(t,e,i){return i.level.levelNumber==e.lastLevel().levelNumber||!i.mustSubdivide(t,this.detailControl)},L.pickSequence=0,L}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(102),i(23),i(8),i(36),i(25),i(7)],n=function(t,e,i,r,n,o,s){"use strict";var a=function(){this.canvas2D=document.createElement("canvas"),this.ctx2D=this.canvas2D.getContext("2d"),this.lineSpacing=.15,this.strokeStyle="rgba(0, 0, 0, 0.5)",this.strokeWidth=4};return a.prototype.textSize=function(t,e,i){if(0===t.length)return new s(0,0);this.ctx2D.font=e.fontString;for(var r=t.split("\n"),n=r.length*(e.size*(1+this.lineSpacing)),o=0,a=0;a<r.length;a++)o=Math.max(o,this.ctx2D.measureText(r[a]).width);return i&&(o+=this.strokeWidth,n+=this.strokeWidth),new s(o,n)},a.prototype.createTexture=function(t,e,r,n){var s=t.currentGlContext,a=this.ctx2D,l=this.canvas2D,h=this.textSize(e,r,n),c=e.split("\n"),u=n?this.strokeWidth/2:0,d=t.pixelScale;l.width=Math.ceil(h[0])*d,l.height=Math.ceil(h[1])*d,a.scale(d,d),a.font=r.fontString,a.textBaseline="top",a.textAlign=r.horizontalAlignment,a.fillStyle=i.WHITE.toHexString(!1),a.strokeStyle=this.strokeStyle,a.lineWidth=this.strokeWidth,a.lineCap="round",a.lineJoin="round","left"===r.horizontalAlignment?a.translate(u,0):"right"===r.horizontalAlignment?a.translate(h[0]-u,0):a.translate(h[0]/2,0);for(var p=0;p<c.length;p++)n&&a.strokeText(c[p],0,0),a.fillText(c[p],0,0),a.translate(0,r.size*(1+this.lineSpacing)+u);return new o(s,l)},a.prototype.getMaxLineHeight=function(t){return this.textSize("_É",t,0)[1]},a.prototype.wrap=function(e,i,n,o){if(!e)throw new t(r.logMessage(r.WARNING,"TextSupport","wrap","missing text"));var s,a=e.split("\n"),l="";for(s=0;s<a.length;s++)a[s]=this.wrapLine(a[s],i,o);var h=0,c=!1,u=this.getMaxLineHeight(o);for(s=0;s<a.length&&!c;s++){for(var d=a[s].split("\n"),p=0;p<d.length&&!c;p++)n<=0||h+u<=n?(l+=d[p],h+=u+this.lineSpacing,p<d.length-1&&(l+="\n")):c=!0;s<a.length-1&&!c&&(l+="\n")}return c&&(l.length>0&&(l=l.substring(0,l.length-1)),l+="..."),l},a.prototype.wrapLine=function(t,e,i){var r="",n=t.trim(),o=this.textSize(n,i,0);if(o[0]>e){for(var s="",a=0,l=n.indexOf(" ",a+1);a<n.length;){l==-1&&(l=n.length);var h=n.substring(a,l),c=s+h;this.textSize(c,i,0)[0]<=e?s+=h:0!=s.length?(r+=s,r+="\n",s="",s+=h.trim()):s+=h.trim(),a=l,a<n.length-1&&(l=n.indexOf(" ",a+1))}r+=s}else r+=n;return r},a}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=[i(109),i(110),i(112),i(171),i(172),i(173),i(207),i(223),i(224),i(226)];t.exports=function(t){r.forEach(function(e){e(t)})}},function(t,e,i){var r,n=i(30),o=["up","down","left","right"];t.exports=function(t){n.listen(n.CONTROLS,function(e){function i(){function i(){n[l?"longitude":"latitude"]+=a*o,t.redraw()}var o=.07*t.navigator.range/1e6,a="up"===s||"right"===s?1:-1,l="left"===s||"right"===s;e.value?(clearInterval(r),r=setInterval(i,25)):clearInterval(r)}var n=t.navigator.lookAtLocation,s=e.parameter;o.indexOf(s)>-1?i():(t.navigator[s]=e.value,t.redraw())})}},function(t,e,i){var r=i(111),n=i(30);t.exports=function(t){function e(t,e){o(n.LOCATION_CHANGED,t,e)}function i(t,e){o(n.NAVIGATOR_STATE_CHANGED,t,e)}function o(t,e,i){if(n.post(n._BLOCK_TILE_LOADING),!s){var r={};r[i]=e,n.post(t,r)}}r(t.navigator,"heading",i),r(t.navigator,"tilt",i),r(t.navigator,"range",i),r(t.navigator.lookAtLocation,"latitude",e),r(t.navigator.lookAtLocation,"longitude",e);var s;n.listen(n._BLOCK_NAVIGATOR_EVENTS_LISTENERS,function(e){s=e,s||t.drawContext.pickingMode||(o(n.LOCATION_CHANGED,t.navigator.lookAtLocation.latitude,"latitude"),o(n.LOCATION_CHANGED,t.navigator.lookAtLocation.longitude,"longitude"),o(n.NAVIGATOR_STATE_CHANGED,t.navigator.heading,"heading"),o(n.NAVIGATOR_STATE_CHANGED,t.navigator.tilt,"tilt"),o(n.NAVIGATOR_STATE_CHANGED,t.navigator.range,"range"))})}},function(t,e){t.exports=function(t,e,i){function r(){return s}function n(t){return o=s,o!==t&&i(t,e),s=t}var o=t[e],s=o;Object.defineProperty(t,e,{get:r,set:n})}},function(t,e,i){function r(t){var e=y(t.id);e&&(t.hasOwnProperty("visible")&&(e.enabled=t.visible),t.hasOwnProperty("opacity")&&(e.opacity=t.opacity)),D.post(D.REDRAW)}function n(t){return O.hasOwnProperty(v(t))}function o(t){var e=y(t);e&&(e.removeAllRenderables(),S.redraw())}function s(t){var e=V.hasOwnProperty(t);return e&&(V[t].forEach(function(t){t.layer.removeRenderable(t)}),delete V[t],S.redraw()),e}function a(t){function e(t){var e=A.create(t);e&&e.forEach(function(t){i.push(t)})}var i=[];return"Feature"===t.type?e(t):"FeatureCollection"===t.type&&t.features.forEach(function(t){e(t)}),S.redraw(),i}function l(t){var e=V[t];return e.length?e[0].source:null}function h(t){return _(t,"properties")}function c(t){var e=l(t.id);if(e){var i={};return i[t.property]=e.properties[t.property],i}}function u(t){return _(t,"geometry")}function d(t){var e=V[t.id];e&&t.geometry&&(e.source.geometry=t.geometry,e.update(),S.redraw())}function p(t){var e=V[t.id];if(e&&t.properties){for(var i in t.properties)t.properties.hasOwnProperty(i)&&(e.source.properties[i]=t.properties[i]);e.update(),S.redraw()}}function f(t,e){D.listen(t,function(t){var i=e.create(t,E);i&&E(i)})}function g(t){S.removeLayer(y(t)),S.redraw()}function m(t){var e=new M(t);return O[v(t)]=e,S.addLayer(e),e}function E(t){t&&(t.forEach(function(t){var e=t.source.properties.layer||"default",i=y(e);i||(i=m(e)),t.source.id&&(V.hasOwnProperty(t.source.id)||(V[t.source.id]=[]),V[t.source.id].push(t)),t.layer=i,i.addRenderable(t)}),D.post(D.REDRAW))}function v(t){return"layer-"+t}function y(t){return O[v(t)]}function _(t,e){var i=l(t);if(i)return i[e]}function T(t){return y(t).renderables.map(function(t){return t.source.id})}function L(){N.forEach(function(t){t.forEach(function(t){var e=t.attributes;e&&(e.oldOutlineColor&&e.outlineColor&&(e.outlineColor=e.oldOutlineColor,
delete e.oldOutlineColor),e.oldInteriorColor&&e.interiorColor&&(e.interiorColor=e.oldInteriorColor,delete e.oldInteriorColor),e._oldImageSource&&e._imageSource&&(e._imageSource=e._oldImageSource,delete e._oldImageSource),e._labelAttributes&&e._labelAttributes.oldColor&&(e._labelAttributes.color=e._labelAttributes.oldColor,delete e._labelAttributes.oldColor)),t.oldColor&&t.color&&(t.color=t.oldColor,delete t.oldColor)})}),window.removeEventListener("mousedown",L),D.post(D.REDRAW)}function x(t,e,i){L();var r=N[t],n=r[0].referencePosition||r[0].position;if(i&&D.post(D.ROTATE_TO,n),e){var o=R.colorFromHex(e);r.forEach(function(t){var e=t.attributes;e&&(e.outlineColor&&(e.oldOutlineColor=e.outlineColor,e.outlineColor=o),e.interiorColor&&(e.oldInteriorColor=e.interiorColor,e.interiorColor=o),e._imageSource&&(e._oldImageSource=e._imageSource,e._imageSource=e._whiteImageSource,e._imageColor=o),e._labelAttributes&&(e._labelAttributes.oldColor=e._labelAttributes.color,e._labelAttributes.color=o)),t.color&&(t.oldColor=t.color,t.color=o)}),D.post(D.REDRAW),window.addEventListener("mousedown",L)}return n}function b(t){function e(t){V.hasOwnProperty(t)&&N.push(V[t])}return D.post(D.HIDE_FORM,"search-form"),w=t.color,L(),N=[],"number"==typeof t?e(t):t.id?e(t.id):t.ids&&t.ids.forEach(e),1===N.length?x(0,t.color||"ffff00ff",t.rotate):void D.post(D._SHOW_SEARCH_RESULT,N.map(function(t){return t[0].source.id}))}var S,w,M=i(113),R=i(23),A=i(114),C=i(161),P=i(154),I=i(170),D=i(30),N=[],O={},V={};t.exports=function(t){S=t},f(D.CREATE_GEO_JSON_OBJECT,{create:a}),f(D.CREATE_MODEL,C),f(D.CREATE_TEXT,P),f(D.CREATE_BILLBOARD,I),D.listen(D.GET_OBJECT,l),D.listen(D.GET_OBJECT_PROPERTIES,h),D.listen(D.GET_OBJECT_PROPERTY,c),D.listen(D.GET_OBJECT_GEOMETRY,u),D.listen(D.SET_OBJECT_PROPERTIES,p),D.listen(D.SET_OBJECT_GEOMETRY,d),D.listen(D.DESTROY_OBJECT,s),D.listen(D.SEARCH_OBJECT,b),D.listen(D.CREATE_LAYER,m),D.listen(D.CLEAR_LAYER,o),D.listen(D.DESTROY_LAYER,g),D.listen(D.HAS_LAYER,n),D.listen(D.GET_LAYER_CONTENTS,T),D.listen(D.SET_LAYER_PROPERTY,r),D.listen(D._GET_LAYER,y),D.listen(D._HIGHLIGHT_FOUND,function(t){x(t,w,!0)})},function(t,e,i){var r,n;r=[i(9),i(99),i(8)],n=function(t,e,i){"use strict";var r=function(t){e.call(this,t),this.renderables=[]};return r.prototype=Object.create(e.prototype),r.prototype.addRenderable=function(e){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"RenderableLayer","addRenderable","missingRenderable"));this.renderables.push(e)},r.prototype.addRenderables=function(e){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"RenderableLayer","addRenderables","The renderables array is null or undefined."));for(var r=0,n=e.length;r<n;r++)this.addRenderable(e[r])},r.prototype.removeRenderable=function(t){var e=this.renderables.indexOf(t);e>=0&&this.renderables.splice(e,1)},r.prototype.removeAllRenderables=function(){this.renderables=[]},r.prototype.doRender=function(t){for(var e=t.orderedRenderables.length,r=0,n=this.renderables.length;r<n;r++)try{this.renderables[r].render(t)}catch(t){i.logMessage(i.LEVEL_SEVERE,"RenderableLayer","doRender","Error while rendering shape "+this.renderables[r].displayName+".\n"+t.toString())}t.orderedRenderables.length>e&&(this.inCurrentFrame=!0)},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){function r(t){var e=t.geometry.type.split("Multi"),i=n[e.pop()];if(i){var r=i.create(t,!e.length);return Array.isArray(r)&&r.forEach(function(t){t.allShapesInSign=r,t.surfacePrimitive&&(t.surfacePrimitive.allShapesInSign=r)}),r}}var n={LineString:i(115),Polygon:i(136),Point:i(154),GeometryCollection:i(160)};t.exports={create:r}},function(t,e,i){function r(t,e){function i(t,i){var r=(e.properties.width||10)*(i.widthMultiplier||1);return n(new a(t,null,null,r),e)}function r(t){return n(new c(t,null),e)}var o=e&&e.properties&&"coco"===e.properties.api;return o&&e.properties.pen?l.create(t,e.properties.pen).map(i):o?i(t,e.geometry.properties||{}):r(t)}function n(t,e){return t.source=e,o(t),t.update=o.bind(null,t),t}function o(t){var e=t.source.geometry.properties||{};t.enabled=e.visible!==!1,t.extrude=e.extrude||!1,s.fill(t,e)}var s=i(116),a=i(118),l=i(128),h=i(134),c=i(135),u=i(117),d={outline:"ffffffff",interior:"ffffffaf",outlineHover:"ffffffff",interiorHover:"ffffff7f",legacy:!0};t.exports={create:h(r,u.geoJsonCoordinatesToPositions,d)}},function(t,e,i){function r(t,e){var i=new o(t);return i.outlineColor=a.extractColor(e,e.color?s.WHITE:"stroke",1),i.interiorColor=a.extractColor(e,e.color?s.WHITE:"fill",1),i.drawOutline=!1!==e.outline,i.drawInterior=!1!==e.interior,i.drawVerticals=e.verticals||!1,i}function n(t,e){var i=new o(t);return i.outlineColor=a.extractColor(e,e.color?null:"stroke",1),i.interiorColor=a.extractColor(e,e.color?null:"fill",1),i}var o=i(105),s=i(23),a=i(117);t.exports={createDefaultAttributes:r,createHighlightAttributes:n,fill:function(t,e){t.attributes=r(null,e),t.highlightAttributes=n(t.attributes,e),t.update&&t.update()}}},function(t,e,i){function r(t,e,i){if(!t)return p.WHITE;var r=t[e||"color"],n=p.colorFromHex(r||"ffffff");return(t.opacity||0===t.opacity)&&(n.alpha=t.opacity),isNaN(n.alpha)&&(n.alpha=i||1),n}function n(t){var e=[t.latitude,t.longitude];return t.altitude&&e.push(t.altitude),e}function o(t,e){return t.map(function(t){return null!==e&&(t[2]=e),a(t)})}function s(t){return new u(l(t),h(t))}function a(t){return new d(l(t),h(t),c(t)||10)}function l(t){return Array.isArray(t)?t[0]:t.lat?t.lat:t.latitude}function h(t){return Array.isArray(t)?t[1]:t.lon?t.lon:t.longitude}function c(t){return Array.isArray(t)?t[2]:t.alt?t.alt:t.altitude}var u=i(14),d=i(12),p=i(23);t.exports={geoJsonCoordinatesToPositions:o,position:a,location:s,array:n,extractColor:r}},function(t,e,i){function r(t){if(t.length>2){var e=t[0],i=t[t.length-1];return e.latitude===i.latitude&&e.longitude===i.longitude}}var n=i(119),o=i(51),s=(i(14),i(60)),a=(i(12),i(11)),l=i(121),h=(i(122),i(126)),c=i(127),u=i(117),d=i(124),p=function(t,e,i,r){this._positions=t,this.minHeight=Number.MAX_VALUE,this.height=t[0].altitude,this.width=r/111200/2,n.call(this,e,i)};p.prototype=Object.create(n.prototype),p.prototype.positionsAsArray=function(){return this._positions},p.prototype.makeSurfacePrimitive=function(){var t=new l(this._positions,this._attributes);return t._highlightAttributes=this._highlightAttributes,t},p.prototype.doMakeOrderedRenderable=function(t){function e(e){return t.surfacePointForMode(e.latitude,e.longitude,e.altitude,WorldWind.RELATIVE_TO_GROUND,new a(0,0,0)).subtract(i)}var i=this.currentData.referencePoint;t.surfacePointForMode(this.referencePosition.latitude,this.referencePosition.longitude,this.referencePosition.altitude,this._altitudeMode,i),this.currentData.transformationMatrix.setToTranslation(i[0],i[1],i[2]);var r=this.getElevationAtReferencePoint(t);if(this.currentData.array&&r===this.elevationAtReferencePoint)return this;this.elevationAtReferencePoint=r;var n=this.makeTessellatedPositions(t);return n=this.makePolygonalLine(n),n=this.makeLineWithSides(n,t),this.currentData.groundPoints=c.pointsAsFloat32array(n.map(function(t){return[t.altitude]}),1),n=n.map(e),this.currentData.array=c.pointsAsFloat32array(n,3),this.currentData.drawInterior=this.activeAttributes.drawInterior,this.currentData.drawVerticals=this.activeAttributes.drawVerticals,this.resetExpiration(this.currentData),this.currentData.fillVbo=!0,this.currentData.extent=new o,this.currentData.extent.setToPoints(this.currentData.array),this.currentData.extent.translate(i),this},p.prototype.makeLineWithSides=function(t,e){function i(e){var i=t[e];r.minHeight>i.altitude-r.height&&(r.minHeight=i.altitude-r.height),n.push(i),n.push(h.clampedToGround(i))}for(var r=this,n=[],o=t.length-1,s=o;s>=0;s-=2)i(s);for(s=0;s<t.length;s+=2)i(s);return i(o),t.concat(n)},p.prototype.extrudePolyline=function(t){function e(e){if(e>=0&&e<t.length)return t[e]}function i(t,e,i){e=e/180*Math.PI,h.push([t[0]+Math.cos(e)*i*l,t[1]+Math.sin(e)*i*l/Math.cos(t[0]/180*Math.PI)])}function n(t,e){return d.lineDirection(t,e)}function o(t,e,i){return d.pointShiftDirection(t,e,i)}function s(t){return d.invertDirection(t)}for(var a=r(t),l=this.width,h=[],c=t.length-2,u=0;u<=c;u++){var p=e(a&&0===u?c:u-1),f=e(u),g=e(u+1),m=e(a&&u===c?1:u+2),E=n(p,f),v=n(f,g),y=n(g,m),_=o(E,v,!0),T=s(_),L=o(v,y,!1),x=s(L);i(f,_,1),i(f,T,1),i(g,L,1),i(g,x,1)}return h},p.prototype.makePolygonalLine=function(t){var e=t.map(u.array);e=this.extrudePolyline(e);for(var i=[],r=0;r+1<e.length;r+=2){var n=u.position(e[r]),o=u.position(e[r+1]),s=this.heightFactor;n.altitude=t[0].altitude+s,o.altitude=t[0].altitude+s,i.push(n),i.push(o)}return i},p.prototype.makeTessellatedPositions=function(t){var e,i,r,n=[],o=t.navigatorState,s=new a(0,0,0),l=new a(0,0,0),h=this._positions[0];n.push(h),t.surfacePointForMode(h.latitude,h.longitude,h.altitude,this._altitudeMode,s);for(var c=1,u=this._positions.length;c<u;c++)e=this._positions[c],t.surfacePointForMode(e.latitude,e.longitude,e.altitude,this._altitudeMode,l),i=o.eyePoint.distanceTo(s),r=o.pixelSizeAtDistance(i),s.distanceTo(l)<8*r?n.push(e):this.makeSegment(t,h,e,s,l,n,i,r),h=e,s.copy(l);return n},p.prototype.doRenderOrdered=function(t){var e=t.currentGlContext,i=t.currentProgram;if(this.applyMvpMatrix(t),c.createOrLoadVBO(t,this.currentData,"capVboKey","array"),e.vertexAttribPointer(i.vertexPointLocation,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(i.groundPointsLocation),c.createOrLoadVBO(t,this.currentData,"groundPointsVboCacheKey","groundPoints"),e.vertexAttribPointer(i.groundPointsLocation,1,e.FLOAT,!1,0,0),t.pickingMode)var r=t.uniquePickColor();c.loadShaderVariables(t,this.activeAttributes.outlineColor,r,this.layer.opacity),e.drawArrays(e.TRIANGLE_STRIP,0,this.currentData.array.length/3),this.currentData.fillVbo=!1,t.pickingMode&&t.resolvePick(new s(r,this.pickDelegate||this,null,t.currentLayer,!1))},t.exports=p},function(t,e,i){var r=i(120),n=i(11),o=(i(102),i(14)),s=i(12),a=function(t,e){r.call(this,t),this.highlightAttributes=e,this.updateReferencePosition(),this.scratchPoint=new n(0,0,0),this.expiryTime=0,this.surfaceFallbackEyeDistance=15e3,this.heightFactor=.5*Math.random(),this.update()};a.prototype=Object.create(r.prototype),a.prototype.makeSegment=function(t,e,i,r,n,a){var l,h,c,u,d,p,f=t.navigatorState,g=f.eyePoint,m=new o(0,0),E=0;if(c=o.greatCircleDistance(e,i),this._altitudeMode!==WorldWind.CLAMP_TO_GROUND&&(E=.5*(e.altitude+i.altitude)),l=c*(t.globe.equatorialRadius+E*t.verticalExaggeration),!(l<=0)){for(h=o.greatCircleAzimuth(e,i),u=0,d=0;u<1;){var v=20*f.pixelSizeAtDistance(this.scratchPoint.distanceTo(g));if(v=v<20?20:v,d+=v,l<d||l-d<1e-9)break;u=d/l,p=u*c,o.greatCircleLocation(e,h,p,m),m.altitude=(1-u)*e.altitude+u*i.altitude,a.push(new s(m.latitude,m.longitude,m.altitude)),t.surfacePointForMode(m.latitude,m.longitude,m.altitude,WorldWind.CLAMP_TO_GROUND,this.scratchPoint)}a.push(i)}},a.prototype.update=function(){this.surfacePrimitive=this.makeSurfacePrimitive(),this.surfacePrimitive.source=this.source},a.prototype.updateReferencePosition=function(){var t=this.positionsAsArray();this.referencePosition=t.length>0?t[0]:null},a.prototype.positionsAsArray=function(){throw new Error("not implemented")},a.prototype.makeSurfacePrimitive=function(){throw new Error("not implemented")},a.prototype.updateEyeDistance=function(t){if(!(this.expiryTime&&this.expiryTime>Date.now())){var e=Number.MAX_VALUE,i=this.scratchPoint;this.positionsAsArray().forEach(function(r){t.surfacePointForMode(r.latitude,r.longitude,r.altitude,this._altitudeMode,i),e=Math.min(e,t.navigatorState.eyePoint.distanceTo(i))}),this.distanceToEye=e}},a.prototype.getElevationAtReferencePoint=function(t){return t.globe.elevationAtLocation(this.referencePosition.latitude,this.referencePosition.longitude)},a.prototype.render=function(t){return this.updateEyeDistance(t),this.distanceToEye>this.surfaceFallbackEyeDistance?this.surfacePrimitive.render(t):void r.prototype.render.call(this,t)},a.prototype.mustGenerateGeometry=function(t){var e=this.expiryTime<Date.now();return e&&(this.expiryTime=Date.now()+5e3*(5+Math.random())),e},a.prototype.beginDrawing=function(t){var e=t.currentGlContext;e.disable(e.CULL_FACE),t.findAndBindProgram(t.globe.projection.shader),e.enableVertexAttribArray(t.currentProgram.vertexPointLocation);var i=!t.pickMode&&this.activeAttributes.applyLighting;i&&t.currentProgram.loadModelviewInverse(e,t.navigatorState.modelviewNormalTransform)},a.prototype.endDrawing=function(t){var e=t.currentGlContext,i=t.currentProgram;i.vertexPointLocation>-1&&e.disableVertexAttribArray(i.vertexPointLocation),i.normalVectorLocation>-1&&e.disableVertexAttribArray(i.normalVectorLocation),i.groundPointsLocation>-1&&e.disableVertexAttribArray(i.groundPointsLocation),e.depthMask(!0),e.lineWidth(1),e.getParameter(e.POLYGON_OFFSET_FACTOR),e.getParameter(e.POLYGON_OFFSET_UNITS),e.enable(e.CULL_FACE)},t.exports=a},function(t,e,i){var r,n;r=[i(9),i(8),i(36),i(24),i(103),i(105),i(39),i(11)],n=function(t,e,i,r,n,o,s,a){"use strict";var l=function(t){n.call(this),this._attributes=t?t:new o(null),this._highlightAttributes=null,this.highlighted=!1,this._altitudeMode=WorldWind.ABSOLUTE,this.referencePosition=null,this.shapeDataCache=new r(3,2),this.currentData=null,this.activeAttributes=null,this.expirationInterval=2e3,this.useSurfaceShapeFor2D=!1,this.scratchMatrix=i.fromIdentity()};return l.prototype=Object.create(n.prototype),Object.defineProperties(l.prototype,{attributes:{get:function(){return this._attributes},set:function(t){this._attributes=t,this.surfaceShape&&(this.surfaceShape.attributes=this._attributes)}},highlightAttributes:{get:function(){return this._highlightAttributes},set:function(t){this._highlightAttributes=t,this.surfaceShape&&(this.surfaceShape.highlightAttributes=this._highlightAttributes)}},altitudeMode:{get:function(){return this._altitudeMode},set:function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"AbstractShape","altitudeMode","missingAltitudeMode"));this._altitudeMode=i,this.reset()}}}),l.prototype.reset=function(){this.shapeDataCache.clear(!1),this.surfaceShape=null},l.prototype.updateSurfaceShape=function(){this.surfaceShape.displayName=this.displayName,this.surfaceShape.highlighted=this.highlighted,this.surfaceShape.enabled=this.enabled,this.surfaceShape.pathType=this.pathType,this.surfaceShape.pickDelegate=this.pickDelegate?this.pickDelegate:this},l.prototype.createSurfaceShape=function(){return null},l.prototype.render=function(t){if(this.enabled&&t.accumulateOrderedRenderables){if(t.globe.is2D()&&this.useSurfaceShapeFor2D&&(this.surfaceShape||(this.surfaceShape=this.createSurfaceShape(),this.surfaceShape&&(this.surfaceShape.attributes=this._attributes,this.surfaceShape.highlightAttributes=this._highlightAttributes)),this.surfaceShape))return this.updateSurfaceShape(),void this.surfaceShape.render(t);if((t.terrain||this.altitudeMode==WorldWind.ABSOLUTE)&&(this.establishCurrentData(t),(!t.globe.projectionLimits||this.isWithinProjectionLimits(t))&&(!this.currentData.extent||this.intersectsFrustum(t))&&(this.determineActiveAttributes(t),this.activeAttributes))){var e=this.makeOrderedRenderable(t);if(e){if(!this.intersectsFrustum(t))return;if(t.isSmall(this.currentData.extent,1))return;e.layer=t.currentLayer,t.addOrderedRenderable(e,this.currentData.eyeDistance)}}}},l.prototype.renderOrdered=function(t){this.currentData=this.shapeDataCache.entryForKey(t.globeStateKey),this.beginDrawing(t);try{this.doRenderOrdered(t)}finally{this.endDrawing(t)}},l.prototype.makeOrderedRenderable=function(t){var e=this.doMakeOrderedRenderable(t);return this.currentData.verticalExaggeration=t.verticalExaggeration,e},l.prototype.doMakeOrderedRenderable=function(t){throw new s(e.logMessage(e.LEVEL_SEVERE,"AbstractShape","makeOrderedRenderable","abstractInvocation"))},l.prototype.doRenderOrdered=function(t){throw new s(e.logMessage(e.LEVEL_SEVERE,"AbstractShape","doRenderOrdered","abstractInvocation"))},l.prototype.beginDrawing=function(t){},l.prototype.endDrawing=function(t){},l.prototype.intersectsFrustum=function(t){return!this.currentData||!this.currentData.extent||(t.pickingMode?this.currentData.extent.intersectsFrustum(t.pickFrustum):this.currentData.extent.intersectsFrustum(t.navigatorState.frustumInModelCoordinates))},l.prototype.establishCurrentData=function(t){this.currentData=this.shapeDataCache.entryForKey(t.globeStateKey),this.currentData||(this.currentData=this.createShapeDataObject(),this.resetExpiration(this.currentData),this.shapeDataCache.putEntry(t.globeStateKey,this.currentData,1)),this.currentData.isExpired=!this.isShapeDataCurrent(t,this.currentData)},l.prototype.createShapeDataObject=function(){return{transformationMatrix:i.fromIdentity(),referencePoint:new a(0,0,0)}},l.prototype.resetExpiration=function(t){t.expiryTime=Date.now()+this.expirationInterval+1e3*Math.random()},l.prototype.isShapeDataCurrent=function(t,e){return e.verticalExaggeration===t.verticalExaggeration&&e.expiryTime>Date.now()},l.prototype.determineActiveAttributes=function(t){this.highlighted&&this._highlightAttributes?this.activeAttributes=this.highlightAttributes:this.activeAttributes=this._attributes},l.prototype.isWithinProjectionLimits=function(t){return!0},l.prototype.applyMvpMatrix=function(t){this.scratchMatrix.copy(t.navigatorState.modelviewProjection),this.scratchMatrix.multiplyMatrix(this.currentData.transformationMatrix),t.currentProgram.loadModelviewProjection(t.currentGlContext,this.scratchMatrix)},l.prototype.applyMvpMatrixForOutline=function(t){this.scratchMatrix.copy(t.navigatorState.projection),this.scratchMatrix.offsetProjectionDepth(-.001),this.scratchMatrix.multiplyMatrix(t.navigatorState.modelview),this.scratchMatrix.multiplyMatrix(this.currentData.transformationMatrix),t.currentProgram.loadModelviewProjection(t.currentGlContext,this.scratchMatrix)},l}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(105),i(104)],n=function(t,e,i,r){"use strict";var n=function(i,n){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfacePolyline","constructor","The specified locations array is null or undefined."));r.call(this,n),this._boundaries=i,this._isInteriorInhibited=!0};return n.prototype=Object.create(r.prototype),n.staticStateKey=function(t){var e=r.staticStateKey(t);return e},n.prototype.computeStateKey=function(){return n.staticStateKey(this)},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){function r(t){for(var e in I)I.hasOwnProperty(e)&&h(t,I[e])}function n(t,e){var i=e.color+"_"+e.width+"_"+e.lineJoin+"_"+e.miterLimit;I.hasOwnProperty(i)||(I[i]={segments:[],width:e.width,lineJoin:e.lineJoin,miterLimit:e.miterLimit,color:e.color,key:i});var r=I[i];r.segments=r.segments.concat(t)}function o(t,e){var i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function s(t,e,i){return t.surfacePointForMode(e.latitude,e.longitude,0,WorldWind.RELATIVE_TO_GROUND,i)}function a(t,e){if(e){var i=[];if(e.latitude){var r=t.globe.elevationAtLocation(e.latitude,e.longitude);t.globe.computePointFromPosition(e.latitude,e.longitude,r,P)}else P=e;var n=t.navigatorState,o=n.frustumInModelCoordinates;if(o.containsPoint(P)&&!A.isHorizonOccluded(t,P)&&n.project(P,i))return i}}function l(){var t=D.clientHeight,e=D.clientWidth;_=t,N.setAttribute("width",e),N.setAttribute("height",t),N.setAttribute("viewBox","0 0 "+e+" "+t)}function h(t,e){c(t);try{d(t,e)}finally{u(t)}}function c(t){var e=t.currentGlContext;t.findAndBindProgram(M);var i=t.currentProgram;e.bindBuffer(e.ARRAY_BUFFER,t.unitQuadBuffer()),e.enableVertexAttribArray(i.vertexPointLocation),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)}function u(t){var e=t.currentGlContext;e.disableVertexAttribArray(t.currentProgram.vertexPointLocation),e.bindBuffer(e.ARRAY_BUFFER,null)}function d(t,e){var i=t.currentGlContext,r=t.currentProgram,n=w.fromIdentity(),o=t.navigatorState.viewport.width,s=t.navigatorState.viewport.height;n.setScale(o,s,1);var a=p(t,e);a&&(i.vertexAttribPointer(r.vertexPointLocation,4,i.FLOAT,!1,0,0),V.copy(t.screenProjection),V.multiplyMatrix(n),r.loadModelviewProjection(i,V),r.loadColor(i,e.color),r.loadOpacity(i,e.opacity),r.loadAspectRatio(i,o/s),i.drawArrays(i.TRIANGLES,0,a))}function p(t,e){var i=t.currentGlContext,r=y(t,e),n=new Float32Array(4*r.length),o=0;return r.forEach(function(t){n[o]=t[0],n[o+1]=t[1],n[o+2]=t[2],n[o+3]=t[3],o+=4}),i.bindBuffer(i.ARRAY_BUFFER,i.createBuffer()),i.bufferData(i.ARRAY_BUFFER,n,i.STATIC_DRAW),r.length}function f(t,e){if(e>=0&&e<t.length)return t[e]}function g(t,e){return R.lineDirection(t,e)}function m(t,e,i){return R.pointShiftDirection(t,e,i)}function E(t){return R.invertDirection(t)}function v(t,e){return R.angleBetweenDirections(t,e)}function y(t,e){function i(e,i,r){h.push([e[0]/t.navigatorState.viewport.width,e[1]/t.navigatorState.viewport.height,i,r])}function r(t,e,r,n){i(t,0,0),i(t,e,1),i(t,r,n)}function n(t,e,i){var n=Math.min(e,i),o=Math.max(e,i);o-n>180&&(n+=360,n^=o,o^=n,n^=o);for(var s=n;s<o;s+=10){var a=s+10;a=a>o?o:a,r(t,s,a,1)}}function o(t,e,o,s){if("round"===l)n(t,e,o,1);else if(null!==l){var a=v(e,o);a>90&&(a=180-a),a<-90&&(a=-180-a);var h=R.deg2rad(a),c=Math.cos(h);if("bevel"===l&&r(t,e,o,c),"miter"===l){var u=2;if(1/c>u){var d=s?1:-1;d+Math.sign(h)===0&&(d*=-1);var p=Math.tan(Math.PI/2-h)*(1/Math.cos(h)-u);p=Math.sqrt(p*p+u*u);var f=o-d*R.rad2deg(Math.acos(u/p));r(t,e,f,p),i(t,0,0),i(t,o,u),i(t,f,p)}else r(t,e,o,1/c)}}}function s(t,e,i,r,n,s,a){var l=v(t,e);if(Math.abs(l)>s){var h=m(e,t);l>s&&o(i,r,h,a),l<-s&&o(i,n,E(h),a)}}function a(t){for(var e=t.length-2,r=0;r<=e;r++){var n=f(t,r-1),o=f(t,r),a=f(t,r+1),l=f(t,r+2),h=g(n,o),c=g(o,a),u=g(a,l),d=m(h,c,!0),p=E(d),v=m(c,u,!1),y=E(v);r!==e&&s(u,c,a,d,y,45,!0),i(o,d,1),i(o,p,1),i(a,v,1),i(o,p,1),i(a,v,1),i(a,y,1),0!==r&&s(c,h,o,v,p,45,!1)}}var l=e.lineJoin,h=[];return e.segments.forEach(a),h}var _,T=i(103),L=i(23),x=(i(6),i(12)),b=i(14),S=i(11),w=i(36),M=i(123),R=i(124),A=i(125),C=(i(30),8),P=new x(0,0,0),I={},D=document.getElementById("canvas"),N=document.getElementById("overlaySvg");l(),window.addEventListener("resize",l),engine._redrawCallbacks.push(function(t,e){e===WorldWind.BEFORE_REDRAW?I={}:e===WorldWind.AFTER_REDRAW&&r(t.drawContext)});var O=function(t,e,i,r,n){T.call(this),this.enabled=!0,this.positions=t,this.expirationPeriod=2e3,this.tessellated=null,this.timestamp=null,this.properties={opacity:1,color:e?L.colorFromHex(e+"ff"):L.WHITE,width:i||1,lineJoin:r||null,miterLimit:n||3}};O.prototype=Object.create(T.prototype),O.prototype.makeTessellatedPositionsIfNeeded=function(t){function e(t){return r.pixelSizeAtDistance(r.eyePoint.distanceTo(t))}if(!(Date.now()-this.timestamp<this.expirationPeriod)){this.tessellated=[],this.timestamp=Date.now();var i,r=t.navigatorState,n=this.positions[0],o=new S(0,0,0),a=new S(0,0,0);s(t,n,o);for(var l=1;l<this.positions.length;l++){i=this.positions[l],s(t,i,a);var h=t.globe.radiusAt(i.latitude,i.longitude),c=b.greatCircleDistance(n,i),u=c*h,d=0;if(0===this.tessellated.length&&this.tessellated.push(n),u>e(a)*C)for(var p=o;d<u;){d+=e(p)*C;var f=new x(0,0,0);b.interpolateGreatCircle(d/u,n,i,f),this.tessellated.push(f),s(t,f,p)}else this.tessellated.push(i);this.tessellated[this.tessellated.length-1].isLast=!0,n=i}}},O.prototype.render=function(t){function e(e){var r=a(t,e);if(r){if(l.length>0){var n=l[l.length-1],s=o(n,r);if(!e.isLast&&s<C/2)return}l.push(r)}else i()}function i(){l.length>=2&&s.push(l),l=[]}var r=this.positions;if(!(!this.enabled||this.opacity<=0||t.pickingMode||!Array.isArray(r)||r.length<2)){(!this.tessellated||Date.now()-this.timestamp>this.expirationPeriod)&&this.makeTessellatedPositionsIfNeeded(t);for(var s=[],l=[],h=0;h<this.tessellated.length;h++)e(this.tessellated[h]);i(),n(s,this.properties)}},t.exports=O;var V=w.fromIdentity()},function(t,e,i){var r=(i(9),i(23),i(54)),n=(i(8),"attribute vec4 vertexPoint;\nuniform mat4 mvpMatrix;\nuniform float aspectRatio;\nvarying float join;\nconst float width = 0.002;\nvoid main() {\n   vec4 p = vertexPoint;\n   float angle = p.z / 180.0 * 3.1416;\n   float shift = p.w;\n   p.z = 0.0;\n   p.w = 1.0;\n   join = 1.0;\n   if (shift > 0.0) {\n       join = 0.0;\n       p.x += cos(angle) * width * shift;\n       p.y += sin(angle) * width * shift * aspectRatio;\n   }\n   gl_Position = mvpMatrix * p;\n}"),o="precision mediump float;\nuniform float opacity;\nvarying float distance;\nvarying float join;\nuniform vec4 color;\nvoid main() {\n   gl_FragColor = color;\n   if (opacity == 0.0) {discard;}\n}",s=function(t){var e=["vertexPoint"];r.call(this,t,n,o,e),this.vertexPointLocation=this.attributeLocation(t,"vertexPoint"),this.mvpMatrixLocation=this.uniformLocation(t,"mvpMatrix"),this.colorLocation=this.uniformLocation(t,"color"),this.opacityLocation=this.uniformLocation(t,"opacity"),this.aspectRatioLocation=this.uniformLocation(t,"aspectRatio")};s.prototype=Object.create(r.prototype),s.key="ScreenSpaceLineGpuProgram",s.prototype.loadModelviewProjection=function(t,e){this.loadUniformMatrix(t,e,this.mvpMatrixLocation)},s.prototype.loadColor=function(t,e){this.loadUniformColor(t,e,this.colorLocation)},s.prototype.loadOpacity=function(t,e){t.uniform1f(this.opacityLocation,e)},s.prototype.loadAspectRatio=function(t,e){t.uniform1f(this.aspectRatioLocation,e)},t.exports=s},function(t,e){function i(t){return t<-180?t+360:t>180?t-360:t}function r(t,e){return i(e-t)}function n(t){return t>0?t-180:t+180}function o(t,e){if(!t||!e)return null;var i=e[0]-t[0],r=e[1]-t[1];return l(Math.atan2(r,i))}function s(t,e,n){function s(){t*=Math.PI/180,e*=Math.PI/180;var i=Math.cos(t)+Math.cos(e),r=Math.sin(t)+Math.sin(e);return o([0,0],[i,r])}var a;return a=null!=n&&Math.abs(r(e,t))>45?(n?e:t)+90:null===t?e+90:null===e?t+90:s()+90,i(a)}function a(t){return t/180*Math.PI}function l(t){return t/Math.PI*180}t.exports={lineDirection:o,pointShiftDirection:s,invertDirection:n,angleBetweenDirections:r,normalizeAngle:i,deg2rad:a,rad2deg:l}},function(t,e){function i(t,e){if(t.navigatorState.eyePoint.distanceTo(e)<1e5)return!1;if("WGS84"!==t.globe.projection.displayName)return!1;var i=t.navigatorState.eyePoint,r=t.globe.equatorialRadius,n=t.globe.equatorialRadius,o=t.globe.polarRadius,s=i[0]/r,a=i[1]/n,l=i[2]/o,h=s*s+a*a+l*l-1,c=e[0]/r,u=e[1]/n,d=e[2]/o,p=c-s,f=u-a,g=d-l,m=p*p+f*f+g*g,E=-(p*s+f*a+g*l),v=E>h&&E*E/m>h;return v}t.exports={isHorizonOccluded:i}},function(t,e,i){function r(t,e){return s.globe.elevationAtLocation(t,e)}function n(t,e,i){var n=r(t,e);return new o(t,e,i+n)}var o=i(12),s=i(1);t.exports={elevationAtPosition:function(t){return r(t.latitude,t.longitude)},terrainRelativePosition:function(t){return n(t.latitude,t.longitude,t.altitude)},terrainRelative:n,elevationAtLocation:r,clampedToGround:function(t){return new o(t.latitude,t.longitude,0)}}},function(t,e){function i(t,e,i,r,n,o){var s=t.currentGlContext,a=t.currentProgram.vertexPointLocation,l=3,h=s.FLOAT,c=!1;return s.vertexAttribPointer(a,l,h,c,n,o||0),s.drawArrays(e,r||0,i),s}t.exports={glDrawTriangleStrip:function(t,e,r,n,o){i(t,t.currentGlContext.TRIANGLE_STRIP,e,r,n,o)},glDrawLineStrip:function(t,e,r,n,o){i(t,t.currentGlContext.LINE_STRIP,e,r,n,o)},loadShaderVariables:function(t,e,i,r){var n=t.currentGlContext,o=t.currentProgram,s=e.alpha*r;n.depthMask(s>=1||t.pickingMode),o.loadTextureEnabled(n,!1),o.loadApplyLighting(n,!1),o.loadColor(n,t.pickingMode?i:e),o.loadOpacity(n,t.pickingMode?s>0?1:0:s)},createOrLoadVBO:function(t,e,i,r){e[i]||(e[i]=t.gpuResourceCache.generateCacheKey());var n=t.currentGlContext,o=e[i],s=t.gpuResourceCache.resourceForKey(o),a=e[r];s||(s=n.createBuffer(),t.gpuResourceCache.putResource(o,s,4*a.length),e.fillVbo=!0),n.bindBuffer(n.ARRAY_BUFFER,s),e.fillVbo&&(n.bufferData(n.ARRAY_BUFFER,a,n.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1))},pointsAsFloat32array:function(t,e){for(var i=t.length,r=new Float32Array(i*e),n=0;n<t.length;n++){var o=t[n],s=e*n;r[s]=o[0],e>1&&(r[s+1]=o[1]),e>2&&(r[s+2]=o[2])}return r}}},function(t,e,i){function r(t,e,i){for(var r=o.distance(t,e),n=o.azimuth(t,e),a=0;;){var l=i.currentPen();if(l.length<10)throw new Error("pen length must be greater than 10 meters");var h=l.length/r,c=h-i.remainDistance/r,u=o.lerp(a,t,e);if(a+c>1){i.remainDistance+=r-a*r,i.remainPoints.push(u);break}var d=o.lerp(a+c,t,e);s[l.type].handle(i,u,d,n),i.nextPen(),a+=c}i.enclosingSegment&&(i.remainPoints.push(e),i.paths.push(i.remainPoints))}function n(t){function e(){o.remainDistance=0,o.remainPoints=[],n=n===t.length-1?0:n+1}function i(){return r?t[n]:t}var r=Array.isArray(t),n=0,o={paths:[],remainDistance:0,remainPoints:[],nextPen:e,currentPen:i};return o}var o=i(129),s={comb:i(130),dash:i(131),cross:i(132),space:i(133)};t.exports={create:function(t,e){for(var i=n(e),o=0;o<t.length-1;o++)i.enclosingSegment=o===t.length-2,r(t[o],t[o+1],i);return i.paths}}},function(t,e,i){function r(t){return new s(0,0,t.altitude)}function n(t){return a.globe.radiusAt(t.latitude,t.longitude)}var o=i(14),s=i(12),a=i(1);t.exports={turn:function(t,e,i){return o.greatCircleLocation(t,e,i/n(t),r(t))},lerp:function(t,e,i){return o.interpolateGreatCircle(t,e,i,r(e))},distance:function(t,e){return o.greatCircleDistance(t,e)*n(t)},azimuth:function(t,e){return o.greatCircleAzimuth(t,e)}}},function(t,e,i){function r(t,e,i,r){var o=t.currentPen(),s=o.left?-90:90,a=n.turn(i,r+s,o.comb),l=t.remainDistance?t.remainPoints:[];l=l.concat([e,i,a]),t.paths.push(l)}var n=i(129);t.exports={handle:r}},function(t,e){function i(t,e,i){var r=[e,i];t.remainDistance&&(r=t.remainPoints.concat(r)),t.paths.push(r)}t.exports={handle:i}},function(t,e,i){function r(t,e,i,r){function o(e){var i=n.turn(l,r+135*e,a/2),o=n.turn(i,r-45*e,a);t.paths.push([i,o])}function s(t){for(var e=.5,i=0;i<t.length-1;i++){var r=n.distance(t[i],t[i+1])/a;if(e-r<0)return n.lerp(e,t[i],t[i+1]);e-=r}}var a=t.currentPen().length,l=t.remainDistance?s(t.remainPoints.concat([e,i])):n.lerp(.5,e,i);o(1),o(-1)}var n=i(129);t.exports={handle:r}},function(t,e){function i(t,e,i,r){}t.exports={handle:i}},function(t,e){t.exports=function(t,e,i){return function(r,n){function o(i,n){var o=r.properties.altitude||0,a=e(i,o),l=t(a,r,n);Array.isArray(l)?l.forEach(function(t){s.push(t)}):s.push(l)}r.properties||(r.properties=i||{});var s=[];return n?o(r.geometry.coordinates):r.geometry.coordinates.forEach(o),s}}},function(t,e,i){var r,n;r=[i(120),i(9),i(102),i(51),i(23),i(14),i(8),i(36),i(60),i(12),i(105),i(121),i(7),i(11)],n=function(t,e,i,r,n,o,s,a,l,h,c,u,d,p){"use strict";var f=function(i,r){if(!i)throw new e(s.logMessage(s.LEVEL_SEVERE,"Path","constructor","missingPositions"));t.call(this,r),this._positions=i,this._pathType=WorldWind.GREAT_CIRCLE,this._terrainConformance=10,this._numSubSegments=10,this.referencePosition=this.determineReferencePosition(this._positions),this.scratchPoint=new p(0,0,0)};return f.prototype=Object.create(t.prototype),Object.defineProperties(f.prototype,{positions:{get:function(){return this._positions},set:function(t){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Path","constructor","missingPositions"));this._positions=t,this.referencePosition=this.determineReferencePosition(this._positions),this.reset()}},followTerrain:{get:function(){return this._followTerrain},set:function(t){this._followTerrain=t,this.reset()}},terrainConformance:{get:function(){return this._terrainConformance},set:function(t){this._terrainConformance=t,this.reset()}},numSubSegments:{get:function(){return this._numSubSegments},set:function(t){this._numSubSegments=t>=0?t:0,this.reset()}},pathType:{get:function(){return this._pathType},set:function(t){this._pathType=t,this.reset()}},extrude:{get:function(){return this._extrude},set:function(t){this._extrude=t,this.reset()}}}),f.prototype.determineReferencePosition=function(t){return t.length>0?t[0]:null},f.prototype.mustGenerateGeometry=function(t){return!this.currentData.tessellatedPoints||(this.currentData.drawInterior!==this.activeAttributes.drawInterior||this.currentData.drawVerticals!==this.activeAttributes.drawVerticals||(!this.followTerrain&&this.currentData.numSubSegments!==this.numSubSegments||(!(!this.followTerrain||this.currentData.terrainConformance===this.terrainConformance)||this.altitudeMode!==WorldWind.ABSOLUTE&&this.currentData.isExpired)));
},f.prototype.createSurfaceShape=function(){return new u(this.positions,null)},f.prototype.doMakeOrderedRenderable=function(t){if(!this.referencePosition)return null;if(!this.mustGenerateGeometry(t))return this;var e=this.currentData.referencePoint;t.surfacePointForMode(this.referencePosition.latitude,this.referencePosition.longitude,this.referencePosition.altitude,this._altitudeMode,e),this.currentData.transformationMatrix.setToTranslation(e[0],e[1],e[2]);var i=this.makeTessellatedPositions(t);if(i.length<2)return null;var n=this.computeRenderedPath(t,i);return this.currentData.tessellatedPoints=n,this.currentData.drawInterior=this.activeAttributes.drawInterior,this.currentData.drawVerticals=this.activeAttributes.drawVerticals,this.currentData.numSubSegments=this.numSubSegments,this.currentData.terrainConformance=this.terrainConformance,this.resetExpiration(this.currentData),this.currentData.fillVbo=!0,this.currentData.extent||(this.currentData.extent=new r),this.currentData.extent.setToPoints(n),this.currentData.extent.translate(this.currentData.referencePoint),this},f.prototype.makeTessellatedPositions=function(t){var e,i,r,n=[],o=t.navigatorState,s=this.mustDrawVerticals(t),a=new p(0,0,0),l=new p(0,0,0),h=this._positions[0];s&&(this.currentData.verticalIndices=new Int16Array(2*this.positions.length),this.currentData.verticalIndices[0]=0,this.currentData.verticalIndices[1]=1),n.push(h),t.surfacePointForMode(h.latitude,h.longitude,h.altitude,this._altitudeMode,a);for(var c=1,u=this._positions.length;c<u;c++)if(e=this._positions[c],t.surfacePointForMode(e.latitude,e.longitude,e.altitude,this._altitudeMode,l),i=o.eyePoint.distanceTo(a),r=o.pixelSizeAtDistance(i),a.distanceTo(l)<8*r&&this.altitudeMode!==WorldWind.ABSOLUTE?n.push(e):this.makeSegment(t,h,e,a,l,n),h=e,a.copy(l),s){var d=2*(n.length-1);this.currentData.verticalIndices[2*c]=d,this.currentData.verticalIndices[2*c+1]=d+1}return n},f.prototype.makeSegment=function(t,e,i,r,n,s){var a,l,c,u,d,p,f=t.navigatorState,g=f.eyePoint,m=new o(0,0),E=0;if(this._pathType===WorldWind.LINEAR&&!this._followTerrain)return void(r.equals(n)||s.push(i));if(c=this._pathType===WorldWind.LINEAR?o.linearDistance(e,i):this._pathType===WorldWind.RHUMB_LINE?o.rhumbDistance(e,i):o.greatCircleDistance(e,i),this._altitudeMode!==WorldWind.CLAMP_TO_GROUND&&(E=.5*(e.altitude+i.altitude)),a=c*(t.globe.equatorialRadius+E*t.verticalExaggeration),!(a<=0)){for(l=this._pathType===WorldWind.LINEAR?o.linearAzimuth(e,i):this._pathType===WorldWind.RHUMB_LINE?o.rhumbAzimuth(e,i):o.greatCircleAzimuth(e,i),this.scratchPoint.copy(r),u=0,d=0;u<1&&(d+=this._followTerrain?this._terrainConformance*f.pixelSizeAtDistance(this.scratchPoint.distanceTo(g)):a/this._numSubSegments,!(a<d||a-d<1e-9));)u=d/a,p=u*c,this._pathType===WorldWind.LINEAR?o.linearLocation(e,l,p,m):this._pathType===WorldWind.RHUMB_LINE?o.rhumbLocation(e,l,p,m):o.greatCircleLocation(e,l,p,m),m.altitude=(1-u)*e.altitude+u*i.altitude,s.push(new h(m.latitude,m.longitude,m.altitude)),this._followTerrain&&t.surfacePointForMode(m.latitude,m.longitude,m.altitude,WorldWind.CLAMP_TO_GROUND,this.scratchPoint);s.push(i)}},f.prototype.computeRenderedPath=function(t,e){var i,r,n,o,s=this.mustDrawInterior(t)||this.mustDrawVerticals(t),a=Number.MAX_VALUE,l=t.navigatorState.eyePoint,h=(s?2:1)*e.length,c=new Float32Array(3*h),u=s?6:3,d=new p(0,0,0);i=this._followTerrain&&this.altitudeMode!==WorldWind.CLAMP_TO_GROUND?WorldWind.RELATIVE_TO_GROUND:this.altitudeMode;for(var f=0,g=e.length;f<g;f++)r=e[f],t.surfacePointForMode(r.latitude,r.longitude,r.altitude,i,d),o=d.distanceToSquared(l),o<a&&(a=o),d.subtract(this.currentData.referencePoint),n=u*f,c[n]=d[0],c[n+1]=d[1],c[n+2]=d[2],s&&(t.surfacePointForMode(r.latitude,r.longitude,0,WorldWind.CLAMP_TO_GROUND,d),o=d.distanceToSquared(l),o<a&&(a=o),d.subtract(this.currentData.referencePoint),c[n+3]=d[0],c[n+4]=d[1],c[n+5]=d[2]);return this.currentData.pointBufferHasExtrusionPoints=s,this.currentData.eyeDistance=Math.sqrt(a),c},f.prototype.mustDrawInterior=function(t){return this.activeAttributes.drawInterior&&this._extrude&&this._altitudeMode!==WorldWind.CLAMP_TO_GROUND},f.prototype.mustDrawVerticals=function(t){return this.activeAttributes.drawOutline&&this.activeAttributes.drawVerticals&&this.altitudeMode!==WorldWind.CLAMP_TO_GROUND},f.prototype.doRenderOrdered=function(t){var e,i,r,n,o,s,a=t.currentGlContext,h=t.currentProgram,c=this.currentData,u=c.tessellatedPoints.length/3;if(this.applyMvpMatrix(t),c.vboCacheKey||(c.vboCacheKey=t.gpuResourceCache.generateCacheKey()),e=t.gpuResourceCache.resourceForKey(c.vboCacheKey),e||(e=a.createBuffer(),t.gpuResourceCache.putResource(this.currentData.vboCacheKey,e,4*c.tessellatedPoints.length),c.fillVbo=!0),a.bindBuffer(a.ARRAY_BUFFER,e),c.fillVbo&&(a.bufferData(a.ARRAY_BUFFER,c.tessellatedPoints,a.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1)),h.loadTextureEnabled(a,!1),t.pickingMode&&(n=t.uniquePickColor()),this.mustDrawInterior(t)&&(r=this.activeAttributes.interiorColor,i=r.alpha*t.currentLayer.opacity,i<1&&!t.pickingMode&&a.depthMask(!1),h.loadColor(a,t.pickingMode?n:r),h.loadOpacity(a,t.pickingMode?i>0?1:0:i),a.vertexAttribPointer(h.vertexPointLocation,3,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,u)),this.activeAttributes.drawOutline&&((this.mustDrawVerticals(t)&&this.mustDrawInterior(t)||this.altitudeMode===WorldWind.CLAMP_TO_GROUND)&&this.applyMvpMatrixForOutline(t),r=this.activeAttributes.outlineColor,i=r.alpha*t.currentLayer.opacity,i<1&&!t.pickingMode&&a.depthMask(!1),h.loadColor(a,t.pickingMode?n:r),h.loadOpacity(a,t.pickingMode?1:i),a.lineWidth(this.activeAttributes.outlineWidth),this.currentData.pointBufferHasExtrusionPoints?(o=24,s=u/2):(o=12,s=u),a.vertexAttribPointer(h.vertexPointLocation,3,a.FLOAT,!1,o,0),a.drawArrays(a.LINE_STRIP,0,s),this.mustDrawVerticals(t)&&(c.verticalIndicesVboCacheKey||(c.verticalIndicesVboCacheKey=t.gpuResourceCache.generateCacheKey()),e=t.gpuResourceCache.resourceForKey(c.verticalIndicesVboCacheKey),e||(e=a.createBuffer(),t.gpuResourceCache.putResource(c.verticalIndicesVboCacheKey,e,4*c.verticalIndices.length),c.fillVbo=!0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),c.fillVbo&&(a.bufferData(a.ELEMENT_ARRAY_BUFFER,c.verticalIndices,a.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1)),a.vertexAttribPointer(h.vertexPointLocation,3,a.FLOAT,!1,0,0),a.drawElements(a.LINES,c.verticalIndices.length,a.UNSIGNED_SHORT,0))),c.fillVbo=!1,t.pickingMode){var d=new l(n,this.pickDelegate?this.pickDelegate:this,null,t.currentLayer,!1);t.resolvePick(d)}},f.prototype.beginDrawing=function(t){var e=t.currentGlContext;this.mustDrawInterior(t)&&e.disable(e.CULL_FACE),t.findAndBindProgram(i),e.enableVertexAttribArray(t.currentProgram.vertexPointLocation)},f.prototype.endDrawing=function(t){var e=t.currentGlContext;e.disableVertexAttribArray(t.currentProgram.vertexPointLocation),e.depthMask(!0),e.lineWidth(1),e.enable(e.CULL_FACE)},f}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){function r(t,e,i){var r=e&&e.properties&&"coco"===e.properties.api,o=r?new h(t):new l(t,null);return o.altitudeMode=WorldWind.RELATIVE_TO_GROUND,o.source=e,n(o),o.update=n.bind(null,o),o}function n(t){var e=t.source.geometry.properties||t.source.properties;t.extrude=e.extrude||!0,t.enabled=e.visible!==!1,s.fill(t,e),t.attributes.drawOutline=!1,t.highlightAttributes.drawOutline=!1}function o(t,e){return t.map(function(t){return c.geoJsonCoordinatesToPositions(t,e)})}var s=i(116),a=i(134),l=i(137),h=i(140),c=i(117),u={outline:"ffffffff",interior:"ffffffff",outlineHover:"ffffffff",interiorHover:"ffffff7f",altitude:3e3};t.exports={create:a(r,o,u)}},function(t,e,i){var r,n;r=[i(120),i(9),i(102),i(51),i(23),i(22),i(14),i(8),i(36),i(60),i(12),i(105),i(138),i(7),i(11),i(139)],n=function(t,e,i,r,n,o,s,a,l,h,c,u,d,p,f,g){"use strict";var m=function(i,r){if(!i)throw new e(a.logMessage(a.LEVEL_SEVERE,"Polygon","constructor","missingBoundaries"));t.call(this,r),i.length>0&&i[0].latitude&&(i=[i],this._boundariesSpecifiedSimply=!0),this._boundaries=i,this._textureCoordinates=null,this.referencePosition=this.determineReferencePosition(this._boundaries),this._extrude=!1,this.scratchPoint=new f(0,0,0)};return m.prototype=Object.create(t.prototype),Object.defineProperties(m.prototype,{boundaries:{get:function(){return this._boundariesSpecifiedSimply?this._boundaries[0]:this._boundaries},set:function(t){if(!t)throw new e(a.logMessage(a.LEVEL_SEVERE,"Polygon","boundaries","missingBoundaries"));t.length>0&&t[0].latitude&&(t=[t],this._boundariesSpecifiedSimply=!0),this._boundaries=t,this.referencePosition=this.determineReferencePosition(this._boundaries),this.reset()}},textureCoordinates:{get:function(){return this._textureCoordinates},set:function(t){this._textureCoordinates=t,this.reset()}},extrude:{get:function(){return this._extrude},set:function(t){this._extrude=t,this.reset()}}}),m.prototype.determineReferencePosition=function(t){return t.length>0&&t[0].length>2?t[0][0]:null},m.prototype.mustGenerateGeometry=function(t){return!this.currentData.boundaryPoints||(this.currentData.drawInterior!==this.activeAttributes.drawInterior||this.altitudeMode!==WorldWind.ABSOLUTE&&this.currentData.isExpired)},m.prototype.hasCapTexture=function(){return this.textureCoordinates&&this.capImageSource()},m.prototype.capImageSource=function(){return this.activeAttributes.imageSource?"string"==typeof this.activeAttributes.imageSource||this.activeAttributes.imageSource instanceof o?this.activeAttributes.imageSource:Array.isArray(this.activeAttributes.imageSource)&&this.activeAttributes.imageSource[0]&&("string"==typeof this.activeAttributes.imageSource[0]||this.activeAttributes.imageSource instanceof o)?this.activeAttributes.imageSource[0]:null:null},m.prototype.hasSideTextures=function(){return this.activeAttributes.imageSource&&Array.isArray(this.activeAttributes.imageSource)&&this.activeAttributes.imageSource.length>1},m.prototype.sideImageSource=function(t){if(0===t||2===this.activeAttributes.imageSource.length)return this.activeAttributes.imageSource[1];var e=this.activeAttributes.imageSource.length-1;return t=Math.min(t+1,e),this.activeAttributes.imageSource[t]},m.prototype.createSurfaceShape=function(){return new d(this.boundaries,null)},m.prototype.doMakeOrderedRenderable=function(t){if(!this.referencePosition)return null;if(!this.activeAttributes.drawInterior&&!this.activeAttributes.drawOutline)return null;if(!this.mustGenerateGeometry(t))return this;var e=this.currentData,i=e.referencePoint;t.surfacePointForMode(this.referencePosition.latitude,this.referencePosition.longitude,this.referencePosition.altitude,this._altitudeMode,i),e.transformationMatrix.setToTranslation(i[0],i[1],i[2]);for(var n=[],o=0;o<this._boundaries.length;o++)n[o]=this._boundaries[o].slice(0),n[o].push(this._boundaries[o][0]);var s=this.computeBoundaryPoints(t,n);if(this.activeAttributes.drawInterior){var a=this.tessellatePolygon(t,s);if(a){e.capTriangles=new Float32Array(a.length);for(var l=0,h=a.length;l<h;l++)e.capTriangles[l]=a[l]}}if(e.boundaryPoints=s,e.drawInterior=this.activeAttributes.drawInterior,this.resetExpiration(e),e.refreshBuffers=!0,e.extent||(e.extent=new r),1===s.length)e.extent.setToPoints(s[0]);else{var c=[];for(o=0;o<s.length;o++)for(var u=0;u<s[o].length;u++)c.push(s[o][u]);e.extent.setToPoints(c)}return e.extent.translate(e.referencePoint),this},m.prototype.computeBoundaryPoints=function(t,e){for(var i,r,n,o,s=Number.MAX_VALUE,a=t.navigatorState.eyePoint,l=[],h=this._extrude?6:3,c=new f(0,0,0),u=0;u<e.length;u++){i=(this._extrude?2:1)*e[u].length,l[u]=new Float32Array(3*i);for(var d=0,p=e[u].length;d<p;d++)r=e[u][d],t.surfacePointForMode(r.latitude,r.longitude,r.altitude,this.altitudeMode,c),o=c.distanceToSquared(a),o<s&&(s=o),c.subtract(this.currentData.referencePoint),n=h*d,l[u][n]=c[0],l[u][n+1]=c[1],l[u][n+2]=c[2],this._extrude&&(t.surfacePointForMode(r.latitude,r.longitude,0,WorldWind.CLAMP_TO_GROUND,c),o=c.distanceToSquared(a),o<s&&(s=o),c.subtract(this.currentData.referencePoint),l[u][n+3]=c[0],l[u][n+4]=c[1],l[u][n+5]=c[2])}return this.currentData.eyeDistance=Math.sqrt(s),l},m.prototype.tessellatePolygon=function(t,e){var i,r,n=[],o=0,s=this._extrude?6:3,l=this.hasCapTexture();this.polygonTessellator||(this.polygonTessellator=new libtess.GluTesselator,this.polygonTessellator.gluTessCallback(libtess.gluEnum.GLU_TESS_VERTEX_DATA,function(t,e){e[e.length]=t[0],e[e.length]=t[1],e[e.length]=t[2],l&&(e[e.length]=t[3],e[e.length]=t[4])}),this.polygonTessellator.gluTessCallback(libtess.gluEnum.GLU_TESS_COMBINE,function(t,e,i){var r=[t[0],t[1],t[2]];if(l)for(var n=3;n<=4;n++){for(var o=0,s=0;s<4;s++)i[s]>0&&(o+=i[s]*e[s][n]);r[n]=o}return r}),this.polygonTessellator.gluTessCallback(libtess.gluEnum.GLU_TESS_ERROR,function(t){o=t,a.logMessage(a.LEVEL_WARNING,"Polygon","tessellatePolygon","Tessellation error "+t+".")})),r=f.computeBufferNormal(e[0],s),r||(r=new f(0,0,0),t.globe.surfaceNormalAtLocation(this.referencePosition.latitude,this.referencePosition.longitude,r)),this.polygonTessellator.gluTessNormal(r[0],r[1],r[2]),this.currentData.capNormal=r,this.polygonTessellator.gluTessBeginPolygon(n);for(var h=0;h<e.length;h++){var c=0;this.polygonTessellator.gluTessBeginContour();for(var u=e[h],d=0;d<u.length;d+=s)i=[u[d],u[d+1],u[d+2]],l&&(c<this.textureCoordinates[h].length?(i[3]=this.textureCoordinates[h][c][0],i[4]=this.textureCoordinates[h][c][1]):(i[3]=this.textureCoordinates[h][0][0],i[4]=this.textureCoordinates[h][1][1]),++c),this.polygonTessellator.gluTessVertex(i,i);this.polygonTessellator.gluTessEndContour()}return this.polygonTessellator.gluTessEndPolygon(),0===o?n:null},m.prototype.mustDrawVerticals=function(t){return this._extrude&&this.activeAttributes.drawOutline&&this.activeAttributes.drawVerticals&&this.altitudeMode!==WorldWind.CLAMP_TO_GROUND},m.prototype.doRenderOrdered=function(t){var e,i=this.currentData;if(t.pickingMode&&(e=t.uniquePickColor()),this.activeAttributes.drawInterior&&i.capTriangles&&i.capTriangles.length>0&&this.drawCap(t,e),this._extrude&&this.activeAttributes.drawInterior&&this.drawSides(t,e),this.activeAttributes.drawOutline&&this.drawOutline(t,e),i.refreshBuffers=!1,t.pickingMode){var r=new h(e,this.pickDelegate?this.pickDelegate:this,null,t.currentLayer,!1);t.resolvePick(r)}},m.prototype.drawCap=function(t,e){var i,r,n,o,s,a,l=t.currentGlContext,h=t.currentProgram,c=this.currentData,u=c.refreshBuffers,d=!!this.hasCapTexture(),p=this.activeAttributes.applyLighting,f=c.capTriangles.length/(d?5:3);h.loadTextureEnabled(l,!1),this.applyMvpMatrix(t),c.capVboCacheKey||(c.capVboCacheKey=t.gpuResourceCache.generateCacheKey()),i=t.gpuResourceCache.resourceForKey(c.capVboCacheKey),i||(i=l.createBuffer(),t.gpuResourceCache.putResource(c.capVboCacheKey,i,4*c.capTriangles.length),u=!0),l.bindBuffer(l.ARRAY_BUFFER,i),u&&(a=p?this.makeCapBufferWithNormals():c.capTriangles,l.bufferData(l.ARRAY_BUFFER,a,l.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1)),n=this.activeAttributes.interiorColor,r=n.alpha*t.currentLayer.opacity,l.depthMask(r>=1||t.pickingMode),h.loadColor(l,t.pickingMode?e:n),h.loadOpacity(l,t.pickingMode?r>0?1:0:r),o=12+(d?8:0)+(p?12:0),d&&!t.pickingMode&&(this.activeTexture=t.gpuResourceCache.resourceForKey(this.capImageSource()),this.activeTexture||(this.activeTexture=t.gpuResourceCache.retrieveTexture(t.currentGlContext,this.capImageSource())),s=this.activeTexture&&this.activeTexture.bind(t),s&&(h.loadTextureEnabled(l,!0),l.enableVertexAttribArray(h.vertexTexCoordLocation),l.vertexAttribPointer(h.vertexTexCoordLocation,2,l.FLOAT,!1,o,12),h.loadTextureUnit(l,l.TEXTURE0),h.loadModulateColor(l,t.pickingMode))),p&&!t.pickingMode&&(h.loadApplyLighting(l,!0),l.enableVertexAttribArray(h.normalVectorLocation),l.vertexAttribPointer(h.normalVectorLocation,3,l.FLOAT,!1,o,o-12)),l.vertexAttribPointer(h.vertexPointLocation,3,l.FLOAT,!1,o,0),l.drawArrays(l.TRIANGLES,0,f)},m.prototype.makeCapBufferWithNormals=function(){for(var t=this.currentData,e=t.capNormal,i=this.hasCapTexture()?5:3,r=i+3,n=t.capTriangles.length/i,o=t.capTriangles,s=new Float32Array(n*r),a=0,l=0;l<n;l++){for(var h=0;h<i;h++)s[a++]=o[l*i+h];s[a++]=e[0],s[a++]=e[1],s[a++]=e[2]}return s},m.prototype.drawSides=function(t,e){var i,r,n,o,s,a,l=t.currentGlContext,h=t.currentProgram,c=this.currentData,u=c.refreshBuffers,d=this.hasSideTextures(),p=this.activeAttributes.applyLighting,f=3+(d?2:0)+(p?3:0),g=4*f;a=0;for(var m=0;m<c.boundaryPoints.length;m++)a+=c.boundaryPoints[m].length/6-1;if(c.sidesVboCacheKey||(c.sidesVboCacheKey=t.gpuResourceCache.generateCacheKey()),i=t.gpuResourceCache.resourceForKey(c.sidesVboCacheKey),!i||u?(s=this.makeSidesBuffer(a),c.numSideVertices=s.length/f,i||(i=l.createBuffer()),t.gpuResourceCache.putResource(c.sidesVboCacheKey,i,4*s.length),l.bindBuffer(l.ARRAY_BUFFER,i),l.bufferData(l.ARRAY_BUFFER,s,l.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1)):l.bindBuffer(l.ARRAY_BUFFER,i),n=this.activeAttributes.interiorColor,r=n.alpha*t.currentLayer.opacity,l.depthMask(r>=1||t.pickingMode),h.loadColor(l,t.pickingMode?e:n),h.loadOpacity(l,t.pickingMode?r>0?1:0:r),d&&!t.pickingMode){this.activeTexture=t.gpuResourceCache.resourceForKey(this.capImageSource()),this.activeTexture||(this.activeTexture=t.gpuResourceCache.retrieveTexture(t.currentGlContext,this.capImageSource())),p?(h.loadApplyLighting(l,!0),l.enableVertexAttribArray(h.normalVectorLocation)):h.loadApplyLighting(l,!1);for(var E=0;E<a;E++){var v=this.sideImageSource(E),y=t.gpuResourceCache.resourceForKey(v),_=6*E*g;v&&!y&&(y=t.gpuResourceCache.retrieveTexture(t.currentGlContext,v)),o=y&&y.bind(t),o?(h.loadTextureEnabled(l,!0),h.loadTextureUnit(l,l.TEXTURE0),l.enableVertexAttribArray(h.vertexTexCoordLocation),l.vertexAttribPointer(h.vertexTexCoordLocation,2,l.FLOAT,!1,g,_+12)):(h.loadTextureEnabled(l,!1),l.disableVertexAttribArray(h.vertexTexCoordLocation)),p&&l.vertexAttribPointer(h.normalVectorLocation,3,l.FLOAT,!1,g,_+20),l.vertexAttribPointer(h.vertexPointLocation,3,l.FLOAT,!1,g,_),l.drawArrays(l.TRIANGLES,0,6)}}else h.loadTextureEnabled(l,!1),p&&!t.pickingMode?(h.loadApplyLighting(l,!0),l.enableVertexAttribArray(h.normalVectorLocation),l.vertexAttribPointer(h.normalVectorLocation,3,l.FLOAT,!1,g,g-12)):h.loadApplyLighting(l,!1),l.vertexAttribPointer(h.vertexPointLocation,3,l.FLOAT,!1,g,0),l.drawArrays(l.TRIANGLES,0,c.numSideVertices)},m.prototype.makeSidesBuffer=function(t){var e,i,r,n,o,s,a,l,h,c,u,d=this.currentData,g=this.hasSideTextures(),m=this.activeAttributes.applyLighting,E=3+(g?2:0)+(m?3:0);r=2*t*3*E,e=new Float32Array(r),i=0,n=new f(0,0,0),o=new f(0,0,0),s=new f(0,0,0),a=new f(0,0,0),g?(l=new p(0,1),h=new p(0,0),c=new p(1,1),u=new p(1,0)):l=h=c=u=null;for(var v=0;v<d.boundaryPoints.length;v++)for(var y,_=d.boundaryPoints[v],T=0;T<_.length-6;T+=6)n[0]=_[T],n[1]=_[T+1],n[2]=_[T+2],o[0]=_[T+3],o[1]=_[T+4],o[2]=_[T+5],s[0]=_[T+6],s[1]=_[T+7],s[2]=_[T+8],a[0]=_[T+9],a[1]=_[T+10],a[2]=_[T+11],y=m?f.computeTriangleNormal(n,o,s):null,this.addVertexToBuffer(n,l,y,e,i),i+=E,this.addVertexToBuffer(o,h,y,e,i),i+=E,this.addVertexToBuffer(s,c,y,e,i),i+=E,this.addVertexToBuffer(o,h,y,e,i),i+=E,this.addVertexToBuffer(a,u,y,e,i),i+=E,this.addVertexToBuffer(s,c,y,e,i),i+=E;return e},m.prototype.addVertexToBuffer=function(t,e,i,r,n){r[n++]=t[0],r[n++]=t[1],r[n++]=t[2],e&&(r[n++]=e[0],r[n++]=e[1]),i&&(r[n++]=i[0],r[n++]=i[1],r[n]=i[2])},m.prototype.drawOutline=function(t,e){var i,r,n,o,s,a,l=t.currentGlContext,h=t.currentProgram,c=this.currentData,u=c.refreshBuffers;h.loadTextureEnabled(l,!1),h.loadApplyLighting(l,!1),this.hasCapTexture()&&l.disableVertexAttribArray(h.vertexTexCoordLocation),this.activeAttributes.applyLighting&&l.disableVertexAttribArray(h.normalVectorLocation),c.boundaryVboCacheKeys||(this.currentData.boundaryVboCacheKeys=[]),this.applyMvpMatrixForOutline(t),h.loadTextureEnabled(l,!1),l.disableVertexAttribArray(h.vertexTexCoordLocation);for(var d=0;d<c.boundaryPoints.length;d++)i=c.boundaryPoints[d].length/3,c.boundaryVboCacheKeys[d]||(c.boundaryVboCacheKeys[d]=t.gpuResourceCache.generateCacheKey()),r=t.gpuResourceCache.resourceForKey(c.boundaryVboCacheKeys[d]),r||(r=l.createBuffer(),t.gpuResourceCache.putResource(c.boundaryVboCacheKeys[d],r,12*i),u=!0),l.bindBuffer(l.ARRAY_BUFFER,r),u&&(l.bufferData(l.ARRAY_BUFFER,c.boundaryPoints[d],l.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1)),o=this.activeAttributes.outlineColor,n=o.alpha*t.currentLayer.opacity,l.depthMask(n>=1||t.pickingMode),h.loadColor(l,t.pickingMode?e:o),h.loadOpacity(l,t.pickingMode?1:n),l.lineWidth(this.activeAttributes.outlineWidth),this._extrude?(s=24,a=i/2):(s=12,a=i),l.vertexAttribPointer(h.vertexPointLocation,3,l.FLOAT,!1,s,0),l.drawArrays(l.LINE_STRIP,0,a),this.mustDrawVerticals(t)&&(l.vertexAttribPointer(h.vertexPointLocation,3,l.FLOAT,!1,0,0),l.drawArrays(l.LINES,0,i-2))},m.prototype.beginDrawing=function(t){var e=t.currentGlContext;this.activeAttributes.drawInterior&&e.disable(e.CULL_FACE),t.findAndBindProgram(i),e.enableVertexAttribArray(t.currentProgram.vertexPointLocation);var r=!t.pickMode&&this.activeAttributes.applyLighting;r&&t.currentProgram.loadModelviewInverse(e,t.navigatorState.modelviewNormalTransform)},m.prototype.endDrawing=function(t){var e=t.currentGlContext;e.disableVertexAttribArray(t.currentProgram.vertexPointLocation),e.disableVertexAttribArray(t.currentProgram.normalVectorLocation),e.depthMask(!0),e.lineWidth(1),e.enable(e.CULL_FACE)},m}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(105),i(104)],n=function(t,e,i,r){"use strict";var n=function(i,n){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfacePolygon","constructor","The specified boundary array is null or undefined."));r.call(this,n);var o=null;if(i.length>0&&void 0!==i[0].latitude)o=i.slice(0),o.push(i[0]),this._boundariesSpecifiedSimply=!0;else if(i.length>1){var s=null;o=[];for(var a=0;a<i.length;a++){for(var l=i[a][0],h=0;h<i[a].length;h++)o.push(i[a][h]);o.push(l),s?o.push(s):s=o[o.length-1]}}else 1===i.length&&(o=i[0].slice(0),o.push(i[0][0]));this._boundaries=o};return n.prototype=Object.create(r.prototype),Object.defineProperties(n.prototype,{}),n.staticStateKey=function(t){var e=r.staticStateKey(t);return e},n.prototype.computeStateKey=function(){return n.staticStateKey(this)},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){/*
	 * @license
	 * Copyright 2000, Silicon Graphics, Inc. All Rights Reserved.
	 * Copyright 2014, Google Inc. All Rights Reserved.
	 *
	 * Permission is hereby granted, free of charge, to any person obtaining a copy
	 * of this software and associated documentation files (the "Software"), to
	 * deal in the Software without restriction, including without limitation the
	 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
	 * sell copies of the Software, and to permit persons to whom the Software is
	 * furnished to do so, subject to the following conditions:
	 *
	 * The above copyright notice including the dates of first publication and
	 * either this permission notice or a reference to http://oss.sgi.com/projects/FreeB/
	 * shall be included in all copies or substantial portions of the Software.
	 *
	 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
	 * SILICON GRAPHICS, INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
	 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
	 * IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
	 *
	 * Original Code. The Original Code is: OpenGL Sample Implementation,
	 * Version 1.2.1, released January 26, 2000, developed by Silicon Graphics,
	 * Inc. The Original Code is Copyright (c) 1991-2000 Silicon Graphics, Inc.
	 * Copyright in any portions created by third parties is as indicated
	 * elsewhere herein. All Rights Reserved.
	 */
var r={};r.DEBUG=!1,r.assert=function(t,e){if(r.DEBUG&&!t)throw new Error("Assertion failed"+(e?": "+e:""))},r.GLU_TESS_MAX_COORD=1e150,r.TRUE_PROJECT=!1,r.TESS_MAX_CACHE=100,r.GLU_TESS_DEFAULT_TOLERANCE=0,r.windingRule={GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},r.primitiveType={GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},r.errorType={GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},r.gluEnum={GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901},r.PQHandle,r.PQKey,r.geom={},r.geom.vertEq=function(t,e){return t.s===e.s&&t.t===e.t},r.geom.vertLeq=function(t,e){return t.s<e.s||t.s===e.s&&t.t<=e.t},r.geom.edgeEval=function(t,e,i){var r=e.s-t.s,n=i.s-e.s;return r+n>0?r<n?e.t-t.t+(t.t-i.t)*(r/(r+n)):e.t-i.t+(i.t-t.t)*(n/(r+n)):0},r.geom.edgeSign=function(t,e,i){var r=e.s-t.s,n=i.s-e.s;return r+n>0?(e.t-i.t)*r+(e.t-t.t)*n:0},r.geom.transLeq=function(t,e){return t.t<e.t||t.t===e.t&&t.s<=e.s},r.geom.transEval=function(t,e,i){var r=e.t-t.t,n=i.t-e.t;return r+n>0?r<n?e.s-t.s+(t.s-i.s)*(r/(r+n)):e.s-i.s+(i.s-t.s)*(n/(r+n)):0},r.geom.transSign=function(t,e,i){var r=e.t-t.t,n=i.t-e.t;return r+n>0?(e.s-i.s)*r+(e.s-t.s)*n:0},r.geom.edgeGoesLeft=function(t){return r.geom.vertLeq(t.dst(),t.org)},r.geom.edgeGoesRight=function(t){return r.geom.vertLeq(t.org,t.dst())},r.geom.vertL1dist=function(t,e){return Math.abs(t.s-e.s)+Math.abs(t.t-e.t)},r.geom.vertCCW=function(t,e,i){return t.s*(e.t-i.t)+e.s*(i.t-t.t)+i.s*(t.t-e.t)>=0},r.geom.interpolate_=function(t,e,i,r){return t=t<0?0:t,i=i<0?0:i,t<=i?0===i?(e+r)/2:e+(r-e)*(t/(t+i)):r+(e-r)*(i/(t+i))},r.geom.edgeIntersect=function(t,e,i,n,o){var s,a,l;r.geom.vertLeq(t,e)||(l=t,t=e,e=l),r.geom.vertLeq(i,n)||(l=i,i=n,n=l),r.geom.vertLeq(t,i)||(l=t,t=i,i=l,l=e,e=n,n=l),r.geom.vertLeq(i,e)?r.geom.vertLeq(e,n)?(s=r.geom.edgeEval(t,i,e),a=r.geom.edgeEval(i,e,n),s+a<0&&(s=-s,a=-a),o.s=r.geom.interpolate_(s,i.s,a,e.s)):(s=r.geom.edgeSign(t,i,e),a=-r.geom.edgeSign(t,n,e),s+a<0&&(s=-s,a=-a),o.s=r.geom.interpolate_(s,i.s,a,n.s)):o.s=(i.s+e.s)/2,r.geom.transLeq(t,e)||(l=t,t=e,e=l),r.geom.transLeq(i,n)||(l=i,i=n,n=l),r.geom.transLeq(t,i)||(l=t,t=i,i=l,l=e,e=n,n=l),r.geom.transLeq(i,e)?r.geom.transLeq(e,n)?(s=r.geom.transEval(t,i,e),a=r.geom.transEval(i,e,n),s+a<0&&(s=-s,a=-a),o.t=r.geom.interpolate_(s,i.t,a,e.t)):(s=r.geom.transSign(t,i,e),a=-r.geom.transSign(t,n,e),s+a<0&&(s=-s,a=-a),o.t=r.geom.interpolate_(s,i.t,a,n.t)):o.t=(i.t+e.t)/2},r.mesh={},r.mesh.makeEdge=function(t){var e=r.mesh.makeEdgePair_(t.eHead);return r.mesh.makeVertex_(e,t.vHead),r.mesh.makeVertex_(e.sym,t.vHead),r.mesh.makeFace_(e,t.fHead),e},r.mesh.meshSplice=function(t,e){var i=!1,n=!1;t!==e&&(e.org!==t.org&&(n=!0,r.mesh.killVertex_(e.org,t.org)),e.lFace!==t.lFace&&(i=!0,r.mesh.killFace_(e.lFace,t.lFace)),r.mesh.splice_(e,t),n||(r.mesh.makeVertex_(e,t.org),t.org.anEdge=t),i||(r.mesh.makeFace_(e,t.lFace),t.lFace.anEdge=t))},r.mesh.deleteEdge=function(t){var e=t.sym,i=!1;t.lFace!==t.rFace()&&(i=!0,r.mesh.killFace_(t.lFace,t.rFace())),t.oNext===t?r.mesh.killVertex_(t.org,null):(t.rFace().anEdge=t.oPrev(),t.org.anEdge=t.oNext,r.mesh.splice_(t,t.oPrev()),i||r.mesh.makeFace_(t,t.lFace)),e.oNext===e?(r.mesh.killVertex_(e.org,null),r.mesh.killFace_(e.lFace,null)):(t.lFace.anEdge=e.oPrev(),e.org.anEdge=e.oNext,r.mesh.splice_(e,e.oPrev())),r.mesh.killEdge_(t)},r.mesh.addEdgeVertex=function(t){var e=r.mesh.makeEdgePair_(t),i=e.sym;return r.mesh.splice_(e,t.lNext),e.org=t.dst(),r.mesh.makeVertex_(i,e.org),e.lFace=i.lFace=t.lFace,e},r.mesh.splitEdge=function(t){var e=r.mesh.addEdgeVertex(t),i=e.sym;return r.mesh.splice_(t.sym,t.sym.oPrev()),r.mesh.splice_(t.sym,i),t.sym.org=i.org,i.dst().anEdge=i.sym,i.sym.lFace=t.rFace(),i.winding=t.winding,i.sym.winding=t.sym.winding,i},r.mesh.connect=function(t,e){var i=!1,n=r.mesh.makeEdgePair_(t),o=n.sym;return e.lFace!==t.lFace&&(i=!0,r.mesh.killFace_(e.lFace,t.lFace)),r.mesh.splice_(n,t.lNext),r.mesh.splice_(o,e),n.org=t.dst(),o.org=e.org,n.lFace=o.lFace=t.lFace,t.lFace.anEdge=o,i||r.mesh.makeFace_(n,t.lFace),n},r.mesh.zapFace=function(t){var e,i=t.anEdge,n=i.lNext;do if(e=n,n=e.lNext,e.lFace=null,null===e.rFace()){e.oNext===e?r.mesh.killVertex_(e.org,null):(e.org.anEdge=e.oNext,r.mesh.splice_(e,e.oPrev()));var o=e.sym;o.oNext===o?r.mesh.killVertex_(o.org,null):(o.org.anEdge=o.oNext,r.mesh.splice_(o,o.oPrev())),r.mesh.killEdge_(e)}while(e!==i);var s=t.prev,a=t.next;a.prev=s,s.next=a},r.mesh.meshUnion=function(t,e){var i=t.fHead,r=t.vHead,n=t.eHead,o=e.fHead,s=e.vHead,a=e.eHead;return o.next!==o&&(i.prev.next=o.next,o.next.prev=i.prev,o.prev.next=i,i.prev=o.prev),s.next!==s&&(r.prev.next=s.next,s.next.prev=r.prev,s.prev.next=r,r.prev=s.prev),a.next!==a&&(n.sym.next.sym.next=a.next,a.next.sym.next=n.sym.next,a.sym.next.sym.next=n,n.sym.next=a.sym.next),t},r.mesh.deleteMesh=function(t){},r.mesh.makeEdgePair_=function(t){var e=new r.GluHalfEdge,i=new r.GluHalfEdge,n=t.sym.next;return i.next=n,n.sym.next=e,e.next=t,t.sym.next=i,e.sym=i,e.oNext=e,e.lNext=i,i.sym=e,i.oNext=i,i.lNext=e,e},r.mesh.splice_=function(t,e){var i=t.oNext,r=e.oNext;i.sym.lNext=e,r.sym.lNext=t,t.oNext=r,e.oNext=i},r.mesh.makeVertex_=function(t,e){var i=e.prev,n=new r.GluVertex(e,i);i.next=n,e.prev=n,n.anEdge=t;var o=t;do o.org=n,o=o.oNext;while(o!==t)},r.mesh.makeFace_=function(t,e){var i=e.prev,n=new r.GluFace(e,i);i.next=n,e.prev=n,n.anEdge=t,n.inside=e.inside;var o=t;do o.lFace=n,o=o.lNext;while(o!==t)},r.mesh.killEdge_=function(t){var e=t.next,i=t.sym.next;e.sym.next=i,i.sym.next=e},r.mesh.killVertex_=function(t,e){var i=t.anEdge,r=i;do r.org=e,r=r.oNext;while(r!==i);var n=t.prev,o=t.next;o.prev=n,n.next=o},r.mesh.killFace_=function(t,e){var i=t.anEdge,r=i;do r.lFace=e,r=r.lNext;while(r!==i);var n=t.prev,o=t.next;o.prev=n,n.next=o},r.normal={},r.normal.S_UNIT_X_=1,r.normal.S_UNIT_Y_=0,r.normal.projectPolygon=function(t){var e=!1,i=[t.normal[0],t.normal[1],t.normal[2]];0===i[0]&&0===i[1]&&0===i[2]&&(r.normal.computeNormal_(t,i),e=!0);var n=t.sUnit,o=t.tUnit,s=r.normal.longAxis_(i);if(r.TRUE_PROJECT){r.normal.normalize_(i),n[s]=0,n[(s+1)%3]=r.normal.S_UNIT_X_,n[(s+2)%3]=r.normal.S_UNIT_Y_;var a=r.normal.dot_(n,i);n[0]-=a*i[0],n[1]-=a*i[1],n[2]-=a*i[2],r.normal.normalize_(n),o[0]=i[1]*n[2]-i[2]*n[1],o[1]=i[2]*n[0]-i[0]*n[2],o[2]=i[0]*n[1]-i[1]*n[0],r.normal.normalize_(o)}else n[s]=0,n[(s+1)%3]=r.normal.S_UNIT_X_,n[(s+2)%3]=r.normal.S_UNIT_Y_,o[s]=0,o[(s+1)%3]=i[s]>0?-r.normal.S_UNIT_Y_:r.normal.S_UNIT_Y_,o[(s+2)%3]=i[s]>0?r.normal.S_UNIT_X_:-r.normal.S_UNIT_X_;for(var l=t.mesh.vHead,h=l.next;h!==l;h=h.next)h.s=r.normal.dot_(h.coords,n),h.t=r.normal.dot_(h.coords,o);e&&r.normal.checkOrientation_(t)},r.normal.dot_=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},r.normal.normalize_=function(t){var e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];e=Math.sqrt(e),t[0]/=e,t[1]/=e,t[2]/=e},r.normal.longAxis_=function(t){var e=0;return Math.abs(t[1])>Math.abs(t[0])&&(e=1),Math.abs(t[2])>Math.abs(t[e])&&(e=2),e},r.normal.computeNormal_=function(t,e){var i,n=[-2*r.GLU_TESS_MAX_COORD,-2*r.GLU_TESS_MAX_COORD,-2*r.GLU_TESS_MAX_COORD],o=[2*r.GLU_TESS_MAX_COORD,2*r.GLU_TESS_MAX_COORD,2*r.GLU_TESS_MAX_COORD],s=[],a=[],l=t.mesh.vHead;for(i=l.next;i!==l;i=i.next)for(var h=0;h<3;++h){var c=i.coords[h];c<o[h]&&(o[h]=c,a[h]=i),c>n[h]&&(n[h]=c,s[h]=i)}var u=0;if(n[1]-o[1]>n[0]-o[0]&&(u=1),n[2]-o[2]>n[u]-o[u]&&(u=2),o[u]>=n[u])return e[0]=0,e[1]=0,void(e[2]=1);var d=0,p=a[u],f=s[u],g=[0,0,0],m=[p.coords[0]-f.coords[0],p.coords[1]-f.coords[1],p.coords[2]-f.coords[2]],E=[0,0,0];for(i=l.next;i!==l;i=i.next){E[0]=i.coords[0]-f.coords[0],E[1]=i.coords[1]-f.coords[1],E[2]=i.coords[2]-f.coords[2],g[0]=m[1]*E[2]-m[2]*E[1],g[1]=m[2]*E[0]-m[0]*E[2],g[2]=m[0]*E[1]-m[1]*E[0];var v=g[0]*g[0]+g[1]*g[1]+g[2]*g[2];v>d&&(d=v,e[0]=g[0],e[1]=g[1],e[2]=g[2])}d<=0&&(e[0]=e[1]=e[2]=0,e[r.normal.longAxis_(m)]=1)},r.normal.checkOrientation_=function(t){for(var e=0,i=t.mesh.fHead,r=i.next;r!==i;r=r.next){var n=r.anEdge;if(!(n.winding<=0))do e+=(n.org.s-n.dst().s)*(n.org.t+n.dst().t),n=n.lNext;while(n!==r.anEdge)}if(e<0){for(var o=t.mesh.vHead,s=o.next;s!==o;s=s.next)s.t=-s.t;t.tUnit[0]=-t.tUnit[0],t.tUnit[1]=-t.tUnit[1],t.tUnit[2]=-t.tUnit[2]}},r.render={},r.render.renderMesh=function(t,e,i){for(var n=!1,o=-1,s=e.fHead.prev;s!==e.fHead;s=s.prev)if(s.inside){n||(t.callBeginOrBeginData(r.primitiveType.GL_TRIANGLES),n=!0);var a=s.anEdge;do{if(i){var l=a.rFace().inside?0:1;o!==l&&(o=l,t.callEdgeFlagOrEdgeFlagData(!!o))}t.callVertexOrVertexData(a.org.data),a=a.lNext}while(a!==s.anEdge)}n&&t.callEndOrEndData()},r.render.renderBoundary=function(t,e){for(var i=e.fHead.next;i!==e.fHead;i=i.next)if(i.inside){t.callBeginOrBeginData(r.primitiveType.GL_LINE_LOOP);var n=i.anEdge;do t.callVertexOrVertexData(n.org.data),n=n.lNext;while(n!==i.anEdge);t.callEndOrEndData()}},r.sweep={},r.sweep.SENTINEL_COORD_=4*r.GLU_TESS_MAX_COORD,r.sweep.TOLERANCE_NONZERO_=!1,r.sweep.computeInterior=function(t){t.fatalError=!1,r.sweep.removeDegenerateEdges_(t),r.sweep.initPriorityQ_(t),r.sweep.initEdgeDict_(t);for(var e;null!==(e=t.pq.extractMin());){for(;;){var i=t.pq.minimum();if(null===i||!r.geom.vertEq(i,e))break;i=t.pq.extractMin(),r.sweep.spliceMergeVertices_(t,e.anEdge,i.anEdge)}r.sweep.sweepEvent_(t,e)}var n=t.dict.getMin().getKey();t.event=n.eUp.org,r.sweep.doneEdgeDict_(t),r.sweep.donePriorityQ_(t),r.sweep.removeDegenerateFaces_(t.mesh),t.mesh.checkMesh()},r.sweep.addWinding_=function(t,e){t.winding+=e.winding,t.sym.winding+=e.sym.winding},r.sweep.edgeLeq_=function(t,e,i){var n=t.event,o=e.eUp,s=i.eUp;if(o.dst()===n)return s.dst()===n?r.geom.vertLeq(o.org,s.org)?r.geom.edgeSign(s.dst(),o.org,s.org)<=0:r.geom.edgeSign(o.dst(),s.org,o.org)>=0:r.geom.edgeSign(s.dst(),n,s.org)<=0;if(s.dst()===n)return r.geom.edgeSign(o.dst(),n,o.org)>=0;var a=r.geom.edgeEval(o.dst(),n,o.org),l=r.geom.edgeEval(s.dst(),n,s.org);return a>=l},r.sweep.deleteRegion_=function(t,e){e.fixUpperEdge,e.eUp.activeRegion=null,t.dict.deleteNode(e.nodeUp),e.nodeUp=null},r.sweep.fixUpperEdge_=function(t,e){r.mesh.deleteEdge(t.eUp),t.fixUpperEdge=!1,t.eUp=e,e.activeRegion=t},r.sweep.topLeftRegion_=function(t){var e=t.eUp.org;do t=t.regionAbove();while(t.eUp.org===e);if(t.fixUpperEdge){var i=r.mesh.connect(t.regionBelow().eUp.sym,t.eUp.lNext);r.sweep.fixUpperEdge_(t,i),t=t.regionAbove()}return t},r.sweep.topRightRegion_=function(t){var e=t.eUp.dst();do t=t.regionAbove();while(t.eUp.dst()===e);return t},r.sweep.addRegionBelow_=function(t,e,i){var n=new r.ActiveRegion;return n.eUp=i,n.nodeUp=t.dict.insertBefore(e.nodeUp,n),i.activeRegion=n,n},r.sweep.isWindingInside_=function(t,e){switch(t.windingRule){case r.windingRule.GLU_TESS_WINDING_ODD:return 0!==(1&e);case r.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==e;case r.windingRule.GLU_TESS_WINDING_POSITIVE:return e>0;case r.windingRule.GLU_TESS_WINDING_NEGATIVE:return e<0;case r.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return e>=2||e<=-2}return!1},r.sweep.computeWinding_=function(t,e){e.windingNumber=e.regionAbove().windingNumber+e.eUp.winding,e.inside=r.sweep.isWindingInside_(t,e.windingNumber)},r.sweep.finishRegion_=function(t,e){var i=e.eUp,n=i.lFace;n.inside=e.inside,n.anEdge=i,r.sweep.deleteRegion_(t,e)},r.sweep.finishLeftRegions_=function(t,e,i){for(var n=e,o=e.eUp;n!==i;){n.fixUpperEdge=!1;var s=n.regionBelow(),a=s.eUp;if(a.org!==o.org){if(!s.fixUpperEdge){r.sweep.finishRegion_(t,n);break}a=r.mesh.connect(o.lPrev(),a.sym),r.sweep.fixUpperEdge_(s,a)}o.oNext!==a&&(r.mesh.meshSplice(a.oPrev(),a),r.mesh.meshSplice(o,a)),r.sweep.finishRegion_(t,n),o=s.eUp,n=s}return o},r.sweep.addRightEdges_=function(t,e,i,n,o,s){var a=!0,l=i;do r.sweep.addRegionBelow_(t,e,l.sym),l=l.oNext;while(l!==n);null===o&&(o=e.regionBelow().eUp.rPrev());for(var h,c=e,u=o;h=c.regionBelow(),l=h.eUp.sym,l.org===u.org;)l.oNext!==u&&(r.mesh.meshSplice(l.oPrev(),l),r.mesh.meshSplice(u.oPrev(),l)),h.windingNumber=c.windingNumber-l.winding,h.inside=r.sweep.isWindingInside_(t,h.windingNumber),c.dirty=!0,!a&&r.sweep.checkForRightSplice_(t,c)&&(r.sweep.addWinding_(l,u),r.sweep.deleteRegion_(t,c),r.mesh.deleteEdge(u)),a=!1,c=h,u=l;c.dirty=!0,s&&r.sweep.walkDirtyRegions_(t,c)},r.sweep.callCombine_=function(t,e,i,n,o){var s=[e.coords[0],e.coords[1],e.coords[2]];e.data=null,e.data=t.callCombineOrCombineData(s,i,n),null===e.data&&(o?t.fatalError||(t.callErrorOrErrorData(r.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),t.fatalError=!0):e.data=i[0])},r.sweep.spliceMergeVertices_=function(t,e,i){var n=[null,null,null,null],o=[.5,.5,0,0];n[0]=e.org.data,n[1]=i.org.data,r.sweep.callCombine_(t,e.org,n,o,!1),r.mesh.meshSplice(e,i)},r.sweep.vertexWeights_=function(t,e,i,n,o){var s=r.geom.vertL1dist(e,t),a=r.geom.vertL1dist(i,t),l=o,h=o+1;n[l]=.5*a/(s+a),n[h]=.5*s/(s+a),t.coords[0]+=n[l]*e.coords[0]+n[h]*i.coords[0],t.coords[1]+=n[l]*e.coords[1]+n[h]*i.coords[1],t.coords[2]+=n[l]*e.coords[2]+n[h]*i.coords[2]},r.sweep.getIntersectData_=function(t,e,i,n,o,s){var a=[0,0,0,0],l=[i.data,n.data,o.data,s.data];e.coords[0]=e.coords[1]=e.coords[2]=0,r.sweep.vertexWeights_(e,i,n,a,0),r.sweep.vertexWeights_(e,o,s,a,2),r.sweep.callCombine_(t,e,l,a,!0)},r.sweep.checkForRightSplice_=function(t,e){var i=e.regionBelow(),n=e.eUp,o=i.eUp;if(r.geom.vertLeq(n.org,o.org)){if(r.geom.edgeSign(o.dst(),n.org,o.org)>0)return!1;r.geom.vertEq(n.org,o.org)?n.org!==o.org&&(t.pq.remove(n.org.pqHandle),r.sweep.spliceMergeVertices_(t,o.oPrev(),n)):(r.mesh.splitEdge(o.sym),r.mesh.meshSplice(n,o.oPrev()),e.dirty=i.dirty=!0)}else{if(r.geom.edgeSign(n.dst(),o.org,n.org)<0)return!1;e.regionAbove().dirty=e.dirty=!0,r.mesh.splitEdge(n.sym),r.mesh.meshSplice(o.oPrev(),n)}return!0},r.sweep.checkForLeftSplice_=function(t,e){var i,n=e.regionBelow(),o=e.eUp,s=n.eUp;if(r.geom.vertLeq(o.dst(),s.dst())){if(r.geom.edgeSign(o.dst(),s.dst(),o.org)<0)return!1;e.regionAbove().dirty=e.dirty=!0,i=r.mesh.splitEdge(o),r.mesh.meshSplice(s.sym,i),i.lFace.inside=e.inside}else{if(r.geom.edgeSign(s.dst(),o.dst(),s.org)>0)return!1;e.dirty=n.dirty=!0,i=r.mesh.splitEdge(s),r.mesh.meshSplice(o.lNext,s.sym),i.rFace().inside=e.inside}return!0},r.sweep.checkForIntersect_=function(t,e){var i=e.regionBelow(),n=e.eUp,o=i.eUp,s=n.org,a=o.org,l=n.dst(),h=o.dst(),c=new r.GluVertex;if(s===a)return!1;var u=Math.min(s.t,l.t),d=Math.max(a.t,h.t);if(u>d)return!1;if(r.geom.vertLeq(s,a)){if(r.geom.edgeSign(h,s,a)>0)return!1}else if(r.geom.edgeSign(l,a,s)<0)return!1;r.geom.edgeIntersect(l,s,h,a,c),r.geom.vertLeq(c,t.event)&&(c.s=t.event.s,c.t=t.event.t);var p=r.geom.vertLeq(s,a)?s:a;if(r.geom.vertLeq(p,c)&&(c.s=p.s,c.t=p.t),r.geom.vertEq(c,s)||r.geom.vertEq(c,a))return r.sweep.checkForRightSplice_(t,e),!1;if(!r.geom.vertEq(l,t.event)&&r.geom.edgeSign(l,t.event,c)>=0||!r.geom.vertEq(h,t.event)&&r.geom.edgeSign(h,t.event,c)<=0){if(h===t.event)return r.mesh.splitEdge(n.sym),r.mesh.meshSplice(o.sym,n),e=r.sweep.topLeftRegion_(e),n=e.regionBelow().eUp,r.sweep.finishLeftRegions_(t,e.regionBelow(),i),r.sweep.addRightEdges_(t,e,n.oPrev(),n,n,!0),!0;if(l===t.event){r.mesh.splitEdge(o.sym),r.mesh.meshSplice(n.lNext,o.oPrev()),i=e,e=r.sweep.topRightRegion_(e);var f=e.regionBelow().eUp.rPrev();return i.eUp=o.oPrev(),o=r.sweep.finishLeftRegions_(t,i,null),r.sweep.addRightEdges_(t,e,o.oNext,n.rPrev(),f,!0),!0}return r.geom.edgeSign(l,t.event,c)>=0&&(e.regionAbove().dirty=e.dirty=!0,r.mesh.splitEdge(n.sym),n.org.s=t.event.s,n.org.t=t.event.t),r.geom.edgeSign(h,t.event,c)<=0&&(e.dirty=i.dirty=!0,r.mesh.splitEdge(o.sym),o.org.s=t.event.s,o.org.t=t.event.t),!1}return r.mesh.splitEdge(n.sym),r.mesh.splitEdge(o.sym),r.mesh.meshSplice(o.oPrev(),n),n.org.s=c.s,n.org.t=c.t,n.org.pqHandle=t.pq.insert(n.org),r.sweep.getIntersectData_(t,n.org,s,l,a,h),e.regionAbove().dirty=e.dirty=i.dirty=!0,!1},r.sweep.walkDirtyRegions_=function(t,e){for(var i=e.regionBelow();;){for(;i.dirty;)e=i,i=i.regionBelow();if(!e.dirty&&(i=e,e=e.regionAbove(),null===e||!e.dirty))return;e.dirty=!1;var n=e.eUp,o=i.eUp;if(n.dst()!==o.dst()&&r.sweep.checkForLeftSplice_(t,e)&&(i.fixUpperEdge?(r.sweep.deleteRegion_(t,i),r.mesh.deleteEdge(o),i=e.regionBelow(),o=i.eUp):e.fixUpperEdge&&(r.sweep.deleteRegion_(t,e),r.mesh.deleteEdge(n),e=i.regionAbove(),n=e.eUp)),n.org!==o.org)if(n.dst()===o.dst()||e.fixUpperEdge||i.fixUpperEdge||n.dst()!==t.event&&o.dst()!==t.event)r.sweep.checkForRightSplice_(t,e);else if(r.sweep.checkForIntersect_(t,e))return;n.org===o.org&&n.dst()===o.dst()&&(r.sweep.addWinding_(o,n),r.sweep.deleteRegion_(t,e),r.mesh.deleteEdge(n),e=i.regionAbove())}},r.sweep.connectRightVertex_=function(t,e,i){var n=i.oNext,o=e.regionBelow(),s=e.eUp,a=o.eUp,l=!1;if(s.dst()!==a.dst()&&r.sweep.checkForIntersect_(t,e),r.geom.vertEq(s.org,t.event)&&(r.mesh.meshSplice(n.oPrev(),s),e=r.sweep.topLeftRegion_(e),n=e.regionBelow().eUp,r.sweep.finishLeftRegions_(t,e.regionBelow(),o),l=!0),r.geom.vertEq(a.org,t.event)&&(r.mesh.meshSplice(i,a.oPrev()),i=r.sweep.finishLeftRegions_(t,o,null),l=!0),l)return void r.sweep.addRightEdges_(t,e,i.oNext,n,n,!0);var h;h=r.geom.vertLeq(a.org,s.org)?a.oPrev():s,h=r.mesh.connect(i.lPrev(),h),r.sweep.addRightEdges_(t,e,h,h.oNext,h.oNext,!1),h.sym.activeRegion.fixUpperEdge=!0,r.sweep.walkDirtyRegions_(t,e)},r.sweep.connectLeftDegenerate_=function(t,e,i){var n=e.eUp;if(r.geom.vertEq(n.org,i))return void(r.sweep.TOLERANCE_NONZERO_&&r.sweep.spliceMergeVertices_(t,n,i.anEdge));if(!r.geom.vertEq(n.dst(),i))return r.mesh.splitEdge(n.sym),e.fixUpperEdge&&(r.mesh.deleteEdge(n.oNext),e.fixUpperEdge=!1),r.mesh.meshSplice(i.anEdge,n),void r.sweep.sweepEvent_(t,i);if(r.sweep.TOLERANCE_NONZERO_){e=r.sweep.topRightRegion_(e);var o=e.regionBelow(),s=o.eUp.sym,a=s.oNext,l=a;o.fixUpperEdge&&(r.sweep.deleteRegion_(t,o),r.mesh.deleteEdge(s),s=a.oPrev()),r.mesh.meshSplice(i.anEdge,s),r.geom.edgeGoesLeft(a)||(a=null),r.sweep.addRightEdges_(t,e,s.oNext,l,a,!0)}},r.sweep.connectLeftVertex_=function(t,e){var i=new r.ActiveRegion;i.eUp=e.anEdge.sym;var n=t.dict.search(i).getKey(),o=n.regionBelow(),s=n.eUp,a=o.eUp;if(0===r.geom.edgeSign(s.dst(),e,s.org))return void r.sweep.connectLeftDegenerate_(t,n,e);var l,h=r.geom.vertLeq(a.dst(),s.dst())?n:o;if(n.inside||h.fixUpperEdge){if(h===n)l=r.mesh.connect(e.anEdge.sym,s.lNext);else{var c=r.mesh.connect(a.dNext(),e.anEdge);l=c.sym}h.fixUpperEdge?r.sweep.fixUpperEdge_(h,l):r.sweep.computeWinding_(t,r.sweep.addRegionBelow_(t,n,l)),r.sweep.sweepEvent_(t,e)}else r.sweep.addRightEdges_(t,n,e.anEdge,e.anEdge,null,!0)},r.sweep.sweepEvent_=function(t,e){t.event=e;for(var i=e.anEdge;null===i.activeRegion;)if(i=i.oNext,i===e.anEdge)return void r.sweep.connectLeftVertex_(t,e);var n=r.sweep.topLeftRegion_(i.activeRegion),o=n.regionBelow(),s=o.eUp,a=r.sweep.finishLeftRegions_(t,o,null);a.oNext===s?r.sweep.connectRightVertex_(t,n,a):r.sweep.addRightEdges_(t,n,a.oNext,s,s,!0)},r.sweep.addSentinel_=function(t,e){var i=new r.ActiveRegion,n=r.mesh.makeEdge(t.mesh);n.org.s=r.sweep.SENTINEL_COORD_,n.org.t=e,n.dst().s=-r.sweep.SENTINEL_COORD_,n.dst().t=e,t.event=n.dst(),i.eUp=n,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=t.dict.insert(i)},r.sweep.initEdgeDict_=function(t){t.dict=new r.Dict(t,r.sweep.edgeLeq_),r.sweep.addSentinel_(t,-r.sweep.SENTINEL_COORD_),r.sweep.addSentinel_(t,r.sweep.SENTINEL_COORD_)},r.sweep.doneEdgeDict_=function(t){for(var e;null!==(e=t.dict.getMin().getKey());)!e.sentinel,r.sweep.deleteRegion_(t,e);t.dict=null},r.sweep.removeDegenerateEdges_=function(t){for(var e,i=t.mesh.eHead,n=i.next;n!==i;n=e){e=n.next;var o=n.lNext;r.geom.vertEq(n.org,n.dst())&&n.lNext.lNext!==n&&(r.sweep.spliceMergeVertices_(t,o,n),r.mesh.deleteEdge(n),n=o,o=n.lNext),o.lNext===n&&(o!==n&&(o!==e&&o!==e.sym||(e=e.next),r.mesh.deleteEdge(o)),n!==e&&n!==e.sym||(e=e.next),r.mesh.deleteEdge(n))}},r.sweep.initPriorityQ_=function(t){var e=new r.PriorityQ(r.geom.vertLeq);t.pq=e;var i,n=t.mesh.vHead;for(i=n.next;i!==n;i=i.next)i.pqHandle=e.insert(i);e.init()},r.sweep.donePriorityQ_=function(t){t.pq.deleteQ(),t.pq=null},r.sweep.removeDegenerateFaces_=function(t){for(var e,i=t.fHead.next;i!==t.fHead;i=e){e=i.next;var n=i.anEdge;n.lNext.lNext===n&&(r.sweep.addWinding_(n.oNext,n),r.mesh.deleteEdge(n))}},r.tessmono={},r.tessmono.tessellateMonoRegion_=function(t){for(var e=t.anEdge;r.geom.vertLeq(e.dst(),e.org);e=e.lPrev());for(;r.geom.vertLeq(e.org,e.dst());e=e.lNext);for(var i,n=e.lPrev();e.lNext!==n;)if(r.geom.vertLeq(e.dst(),n.org)){for(;n.lNext!==e&&(r.geom.edgeGoesLeft(n.lNext)||r.geom.edgeSign(n.org,n.dst(),n.lNext.dst())<=0);)i=r.mesh.connect(n.lNext,n),n=i.sym;n=n.lPrev()}else{for(;n.lNext!==e&&(r.geom.edgeGoesRight(e.lPrev())||r.geom.edgeSign(e.dst(),e.org,e.lPrev().org)>=0);)i=r.mesh.connect(e,e.lPrev()),e=i.sym;e=e.lNext}for(;n.lNext.lNext!==e;)i=r.mesh.connect(n.lNext,n),n=i.sym},r.tessmono.tessellateInterior=function(t){for(var e,i=t.fHead.next;i!==t.fHead;i=e)e=i.next,i.inside&&r.tessmono.tessellateMonoRegion_(i)},r.tessmono.discardExterior=function(t){for(var e,i=t.fHead.next;i!==t.fHead;i=e)e=i.next,i.inside||r.mesh.zapFace(i)},r.tessmono.setWindingNumber=function(t,e,i){for(var n,o=t.eHead.next;o!==t.eHead;o=n)n=o.next,o.rFace().inside!==o.lFace.inside?o.winding=o.lFace.inside?e:-e:i?r.mesh.deleteEdge(o):o.winding=0},r.Dict=function(t,e){this.head_=new r.DictNode,this.frame_=t,this.leq_=e},r.Dict.prototype.deleteDict_=function(){},r.Dict.prototype.insertBefore=function(t,e){do t=t.prev;while(null!==t.key&&!this.leq_(this.frame_,t.key,e));var i=new r.DictNode(e,t.next,t);return t.next.prev=i,t.next=i,i},r.Dict.prototype.insert=function(t){return this.insertBefore(this.head_,t)},r.Dict.prototype.deleteNode=function(t){t.next.prev=t.prev,t.prev.next=t.next},r.Dict.prototype.search=function(t){var e=this.head_;do e=e.next;while(null!==e.key&&!this.leq_(this.frame_,t,e.key));return e},r.Dict.prototype.getMin=function(){return this.head_.next},r.Dict.prototype.getMax=function(){return this.head_.prev},r.DictNode=function(t,e,i){this.key=t||null,this.next=e||this,this.prev=i||this},r.DictNode.prototype.getKey=function(){return this.key},r.DictNode.prototype.getSuccessor=function(){return this.next},r.DictNode.prototype.getPredecessor=function(){return this.prev},r.CachedVertex=function(){this.coords=[0,0,0],this.data=null},r.GluTesselator=function(){this.state=r.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.callError_=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.relTolerance=r.GLU_TESS_DEFAULT_TOLERANCE,this.windingRule=r.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.callCombine_=null,this.boundaryOnly=!1,this.callBegin_=null,this.callEdgeFlag_=null,this.callVertex_=null,this.callEnd_=null,this.callMesh_=null,this.callBeginData_=null,this.callEdgeFlagData_=null,this.callVertexData_=null,this.callEndData_=null,this.callErrorData_=null,this.callCombineData_=null,this.polygonData_=null,this.emptyCache=!1,this.cacheCount=0,this.cache=new Array(r.TESS_MAX_CACHE);for(var t=0;t<r.TESS_MAX_CACHE;t++)this.cache[t]=new r.CachedVertex},r.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},r.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(r.GluTesselator.tessState_.T_DORMANT)},r.GluTesselator.prototype.gluTessProperty=function(t,e){switch(t){case r.gluEnum.GLU_TESS_TOLERANCE:if(e<0||e>1)break;return void(this.relTolerance=e);case r.gluEnum.GLU_TESS_WINDING_RULE:var i=e;switch(i){case r.windingRule.GLU_TESS_WINDING_ODD:case r.windingRule.GLU_TESS_WINDING_NONZERO:case r.windingRule.GLU_TESS_WINDING_POSITIVE:case r.windingRule.GLU_TESS_WINDING_NEGATIVE:case r.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=i)}break;case r.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly=!!e);default:return void this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_ENUM)}this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_VALUE)},r.GluTesselator.prototype.gluGetTessProperty=function(t){switch(t){case r.gluEnum.GLU_TESS_TOLERANCE:return this.relTolerance;case r.gluEnum.GLU_TESS_WINDING_RULE:var e=this.windingRule;return e;case r.gluEnum.GLU_TESS_BOUNDARY_ONLY:return this.boundaryOnly;default:this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_ENUM)}return!1},r.GluTesselator.prototype.gluTessNormal=function(t,e,i){this.normal[0]=t,this.normal[1]=e,this.normal[2]=i},r.GluTesselator.prototype.gluTessCallback=function(t,e){var i=e?e:null;switch(t){case r.gluEnum.GLU_TESS_BEGIN:return void(this.callBegin_=i);case r.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.callBeginData_=i);case r.gluEnum.GLU_TESS_EDGE_FLAG:return void(this.callEdgeFlag_=i);case r.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.callEdgeFlagData_=i);case r.gluEnum.GLU_TESS_VERTEX:return void(this.callVertex_=i);case r.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.callVertexData_=i);case r.gluEnum.GLU_TESS_END:return void(this.callEnd_=i);case r.gluEnum.GLU_TESS_END_DATA:return void(this.callEndData_=i);case r.gluEnum.GLU_TESS_ERROR:return void(this.callError_=i);case r.gluEnum.GLU_TESS_ERROR_DATA:return void(this.callErrorData_=i);case r.gluEnum.GLU_TESS_COMBINE:return void(this.callCombine_=i);case r.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.callCombineData_=i);case r.gluEnum.GLU_TESS_MESH:return void(this.callMesh_=i);default:return void this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_ENUM)}},r.GluTesselator.prototype.gluTessVertex=function(t,e){var i=!1,n=[0,0,0];this.requireState_(r.GluTesselator.tessState_.T_IN_CONTOUR),this.emptyCache&&(this.emptyCache_(),this.lastEdge_=null);for(var o=0;o<3;++o){var s=t[o];s<-r.GLU_TESS_MAX_COORD&&(s=-r.GLU_TESS_MAX_COORD,i=!0),s>r.GLU_TESS_MAX_COORD&&(s=r.GLU_TESS_MAX_COORD,i=!0),n[o]=s}if(i&&this.callErrorOrErrorData(r.errorType.GLU_TESS_COORD_TOO_LARGE),null===this.mesh){if(this.cacheCount<r.TESS_MAX_CACHE)return void this.cacheVertex_(n,e);this.emptyCache_()}this.addVertex_(n,e)},r.GluTesselator.prototype.gluTessBeginPolygon=function(t){this.requireState_(r.GluTesselator.tessState_.T_DORMANT),this.state=r.GluTesselator.tessState_.T_IN_POLYGON,this.cacheCount=0,this.emptyCache=!1,this.mesh=null,this.polygonData_=t},r.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(r.GluTesselator.tessState_.T_IN_POLYGON),this.state=r.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null,this.cacheCount>0&&(this.emptyCache=!0)},r.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(r.GluTesselator.tessState_.T_IN_CONTOUR),this.state=r.GluTesselator.tessState_.T_IN_POLYGON},r.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(r.GluTesselator.tessState_.T_IN_POLYGON),this.state=r.GluTesselator.tessState_.T_DORMANT,null===this.mesh&&this.emptyCache_(),r.normal.projectPolygon(this),r.sweep.computeInterior(this),!this.fatalError){var t=this.mesh;if(this.boundaryOnly?r.tessmono.setWindingNumber(t,1,!0):r.tessmono.tessellateInterior(t),this.mesh.checkMesh(),this.callBegin_||this.callEnd_||this.callVertex_||this.callEdgeFlag_||this.callBeginData_||this.callEndData_||this.callVertexData_||this.callEdgeFlagData_)if(this.boundaryOnly)r.render.renderBoundary(this,this.mesh);else{var e=!(!this.callEdgeFlag_&&!this.callEdgeFlagData_);r.render.renderMesh(this,this.mesh,e)}if(this.callMesh_)return r.tessmono.discardExterior(this.mesh),this.callMesh_(this.mesh),this.mesh=null,void(this.polygonData_=null)}r.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},r.GluTesselator.prototype.makeDormant_=function(){this.mesh&&r.mesh.deleteMesh(this.mesh),this.state=r.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null},r.GluTesselator.prototype.requireState_=function(t){this.state!==t&&this.gotoState_(t)},r.GluTesselator.prototype.gotoState_=function(t){for(;this.state!==t;)if(this.state<t)switch(this.state){case r.GluTesselator.tessState_.T_DORMANT:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case r.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state){case r.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case r.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_END_POLYGON),this.makeDormant_()}},r.GluTesselator.prototype.addVertex_=function(t,e){var i=this.lastEdge_;null===i?(i=r.mesh.makeEdge(this.mesh),r.mesh.meshSplice(i,i.sym)):(r.mesh.splitEdge(i),i=i.lNext),i.org.data=e,i.org.coords[0]=t[0],i.org.coords[1]=t[1],i.org.coords[2]=t[2],i.winding=1,i.sym.winding=-1,this.lastEdge_=i},r.GluTesselator.prototype.cacheVertex_=function(t,e){var i=this.cache[this.cacheCount];i.data=e,i.coords[0]=t[0],i.coords[1]=t[1],i.coords[2]=t[2],++this.cacheCount},r.GluTesselator.prototype.emptyCache_=function(){this.mesh=new r.GluMesh;for(var t=0;t<this.cacheCount;t++){var e=this.cache[t];this.addVertex_(e.coords,e.data)}this.cacheCount=0,this.emptyCache=!1},r.GluTesselator.prototype.callBeginOrBeginData=function(t){this.callBeginData_?this.callBeginData_(t,this.polygonData_):this.callBegin_&&this.callBegin_(t)},r.GluTesselator.prototype.callVertexOrVertexData=function(t){this.callVertexData_?this.callVertexData_(t,this.polygonData_):this.callVertex_&&this.callVertex_(t)},r.GluTesselator.prototype.callEdgeFlagOrEdgeFlagData=function(t){this.callEdgeFlagData_?this.callEdgeFlagData_(t,this.polygonData_):this.callEdgeFlag_&&this.callEdgeFlag_(t)},r.GluTesselator.prototype.callEndOrEndData=function(){this.callEndData_?this.callEndData_(this.polygonData_):this.callEnd_&&this.callEnd_()},r.GluTesselator.prototype.callCombineOrCombineData=function(t,e,i){var r;return this.callCombineData_?r=this.callCombineData_(t,e,i,this.polygonData_):this.callCombine_&&(r=this.callCombine_(t,e,i)),void 0===r&&(r=null),r},r.GluTesselator.prototype.callErrorOrErrorData=function(t){this.callErrorData_?this.callErrorData_(t,this.polygonData_):this.callError_&&this.callError_(t)},r.GluFace=function(t,e){this.next=t||this,this.prev=e||this,this.anEdge=null,this.data=null,this.inside=!1},r.GluHalfEdge=function(t){this.next=t||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},r.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},r.GluHalfEdge.prototype.dst=function(){return this.sym.org},r.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},r.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},r.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},r.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},r.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},r.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},r.GluMesh=function(){this.vHead=new r.GluVertex,this.fHead=new r.GluFace,this.eHead=new r.GluHalfEdge,this.eHeadSym=new r.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},r.GluMesh.prototype.checkMesh=function(){if(r.DEBUG){var t,e,i=this.fHead,n=this.vHead,o=this.eHead,s=i;for(s=i;(e=s.next)!==i;s=e){t=e.anEdge;do t=t.lNext;while(t!==e.anEdge)}var a,l=n;for(l=n;(a=l.next)!==n;l=a){t=a.anEdge;do t=t.oNext;while(t!==a.anEdge)}var h=o;for(h=o;(t=h.next)!==o;h=t);}},r.GluVertex=function(t,e){this.next=t||this,
this.prev=e||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=null},r.PQHandleElem=function(){this.key=null,this.node=0},r.PQHandleElem.realloc=function(t,e){var i=new Array(e),n=0;if(null!==t)for(;n<t.length;n++)i[n]=t[n];for(;n<e;n++)i[n]=new r.PQHandleElem;return i},r.PQNode=function(){this.handle=0},r.PQNode.realloc=function(t,e){var i=new Array(e),n=0;if(null!==t)for(;n<t.length;n++)i[n]=t[n];for(;n<e;n++)i[n]=new r.PQNode;return i},r.PriorityQ=function(t){this.keys_=r.PriorityQ.prototype.PQKeyRealloc_(null,r.PriorityQ.INIT_SIZE_),this.order_=null,this.size_=0,this.max_=r.PriorityQ.INIT_SIZE_,this.initialized_=!1,this.leq_=t,this.heap_=new r.PriorityQHeap(this.leq_)},r.PriorityQ.INIT_SIZE_=32,r.PriorityQ.prototype.deleteQ=function(){this.heap_.deleteHeap(),this.heap_=null,this.order_=null,this.keys_=null},r.PriorityQ.prototype.init=function(){this.order_=[];for(var t=0;t<this.size_;t++)this.order_[t]=t;var e=function(t,e){return function(i,r){return e(t[i],t[r])?1:-1}}(this.keys_,this.leq_);if(this.order_.sort(e),this.max_=this.size_,this.initialized_=!0,this.heap_.init(),r.DEBUG){var i=0,n=i+this.size_-1;for(t=i;t<n;++t);}},r.PriorityQ.prototype.insert=function(t){if(this.initialized_)return this.heap_.insert(t);var e=this.size_;return++this.size_>=this.max_&&(this.max_*=2,this.keys_=r.PriorityQ.prototype.PQKeyRealloc_(this.keys_,this.max_)),this.keys_[e]=t,-(e+1)},r.PriorityQ.prototype.PQKeyRealloc_=function(t,e){var i=new Array(e),r=0;if(null!==t)for(;r<t.length;r++)i[r]=t[r];for(;r<e;r++)i[r]=null;return i},r.PriorityQ.prototype.keyLessThan_=function(t,e){var i=this.keys_[t],r=this.keys_[e];return!this.leq_(r,i)},r.PriorityQ.prototype.keyGreaterThan_=function(t,e){var i=this.keys_[t],r=this.keys_[e];return!this.leq_(i,r)},r.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var t=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var e=this.heap_.minimum();if(this.leq_(e,t))return this.heap_.extractMin()}do--this.size_;while(this.size_>0&&null===this.keys_[this.order_[this.size_-1]]);return t},r.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var t=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var e=this.heap_.minimum();if(this.leq_(e,t))return e}return t},r.PriorityQ.prototype.isEmpty_=function(){return 0===this.size_&&this.heap_.isEmpty()},r.PriorityQ.prototype.remove=function(t){if(t>=0)return void this.heap_.remove(t);for(t=-(t+1),this.keys_[t]=null;this.size_>0&&null===this.keys_[this.order_[this.size_-1]];)--this.size_},r.PriorityQHeap=function(t){this.nodes_=r.PQNode.realloc(null,r.PriorityQHeap.INIT_SIZE_+1),this.handles_=r.PQHandleElem.realloc(null,r.PriorityQHeap.INIT_SIZE_+1),this.size_=0,this.max_=r.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.leq_=t,this.nodes_[1].handle=1},r.PriorityQHeap.INIT_SIZE_=32,r.PriorityQHeap.prototype.deleteHeap=function(){this.handles_=null,this.nodes_=null},r.PriorityQHeap.prototype.init=function(){for(var t=this.size_;t>=1;--t)this.floatDown_(t);this.initialized_=!0},r.PriorityQHeap.prototype.insert=function(t){var e=++this.size_;2*e>this.max_&&(this.max_*=2,this.nodes_=r.PQNode.realloc(this.nodes_,this.max_+1),this.handles_=r.PQHandleElem.realloc(this.handles_,this.max_+1));var i;return 0===this.freeList_?i=e:(i=this.freeList_,this.freeList_=this.handles_[i].node),this.nodes_[e].handle=i,this.handles_[i].node=e,this.handles_[i].key=t,this.initialized_&&this.floatUp_(e),i},r.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},r.PriorityQHeap.prototype.minimum=function(){return this.handles_[this.nodes_[1].handle].key},r.PriorityQHeap.prototype.extractMin=function(){var t=this.nodes_,e=this.handles_,i=t[1].handle,r=e[i].key;return this.size_>0&&(t[1].handle=t[this.size_].handle,e[t[1].handle].node=1,e[i].key=null,e[i].node=this.freeList_,this.freeList_=i,--this.size_>0&&this.floatDown_(1)),r},r.PriorityQHeap.prototype.remove=function(t){var e=this.nodes_,i=this.handles_,r=i[t].node;e[r].handle=e[this.size_].handle,i[e[r].handle].node=r,r<=--this.size_&&(r<=1||this.leq_(i[e[r>>1].handle].key,i[e[r].handle].key)?this.floatDown_(r):this.floatUp_(r)),i[t].key=null,i[t].node=this.freeList_,this.freeList_=t},r.PriorityQHeap.prototype.floatDown_=function(t){for(var e=this.nodes_,i=this.handles_,r=e[t].handle;;){var n=t<<1;n<this.size_&&this.leq_(i[e[n+1].handle].key,i[e[n].handle].key)&&++n;var o=e[n].handle;if(n>this.size_||this.leq_(i[r].key,i[o].key)){e[t].handle=r,i[r].node=t;break}e[t].handle=o,i[o].node=t,t=n}},r.PriorityQHeap.prototype.floatUp_=function(t){for(var e=this.nodes_,i=this.handles_,r=e[t].handle;;){var n=t>>1,o=e[n].handle;if(0===n||this.leq_(i[o].key,i[r].key)){e[t].handle=r,i[r].node=t;break}e[t].handle=o,i[o].node=t,t=n}},r.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},r.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},r.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},t.exports=r},function(t,e,i){var r=i(119),n=i(51),o=(i(14),i(60)),s=i(12),a=i(138),l=i(11),h=i(17),c=i(141),u=(i(126),i(117),i(127)),d=function(t,e,i){this._boundaries=t,r.call(this,e,i),this._extrude=!0,this.height=0};d.prototype=Object.create(r.prototype),d.prototype.calculateGreatCircleBoundaries=function(t,e){var i=this;return e.map(function(e){return i.makeTessellatedPositions(t,e)})},d.prototype.positionsAsArray=function(){return this._boundaries[0]},d.prototype.makeSurfacePrimitive=function(){var t=new a(this._boundaries,this._attributes);return t._highlightAttributes=this._highlightAttributes,t},d.prototype.doMakeOrderedRenderable=function(t){function e(e){return t.surfacePointForMode(e.latitude,e.longitude,e.altitude,WorldWind.RELATIVE_TO_GROUND,new l(0,0,0)).subtract(o)}if(!this.referencePosition)return null;if(!this.activeAttributes.drawInterior&&!this.activeAttributes.drawOutline)return null;var i=this.getElevationAtReferencePoint(t);if(this.currentData.boundaryPoints&&i===this.elevationAtReferencePoint)return this;this.elevationAtReferencePoint=i;var r=this.currentData,o=r.referencePoint;return t.surfacePointForMode(this.referencePosition.latitude,this.referencePosition.longitude,this.referencePosition.altitude,this._altitudeMode,o),r.transformationMatrix.setToTranslation(o[0],o[1],o[2]),r.greatCircleBoundaries=this.calculateGreatCircleBoundaries(t,this._boundaries),r.boundaryPoints=this.computeBoundaryPoints(t,r.greatCircleBoundaries),r.originalBoundaries=this.computeBoundaryPoints(t,this._boundaries),r.capTriangles=this.triangulate(t,r.greatCircleBoundaries,this.referencePosition.altitude),r.capTriangles=r.capTriangles.map(e),r.capTriangles=u.pointsAsFloat32array(r.capTriangles,3),r.sidesBuffer=this.makeSidesBuffer(r.greatCircleBoundaries[0].length-1),r.drawInterior=this.activeAttributes.drawInterior,this.resetExpiration(r),r.fillVbo=!0,r.extent||(r.extent=new n),r.extent.setToPoints(r.sidesBuffer),r.extent.translate(r.referencePoint),this},d.prototype.extraPoints=function(t,e){var i=1e3,r=1e3,n=-1e3,o=-1e3;this._boundaries[0].forEach(function(t){i>t.latitude&&(i=t.latitude),n<t.latitude&&(n=t.latitude),r>t.longitude&&(r=t.longitude),o<t.longitude&&(o=t.longitude)});for(var s=[],a=1;a<1+2*Math.floor(n-i);a++)for(var l=1;l<1+2*Math.floor(o-r);l++)s.push([h.interpolate(.05*a,i,n),h.interpolate(.05*l,r,o),e]);return s},d.prototype.computeBoundaryPoints=function(t,e){for(var i,r,n,o,s=Number.MAX_VALUE,a=t.navigatorState.eyePoint,h=[],c=this._extrude?6:3,u=new l(0,0,0),d=0;d<e.length;d++){i=(this._extrude?2:1)*e[d].length,h[d]=new Float32Array(3*i);for(var p=0,f=e[d].length;p<f;p++)r=e[d][p],t.surfacePointForMode(r.latitude,r.longitude,r.altitude,this.altitudeMode,u),o=u.distanceToSquared(a),o<s&&(s=o),u.subtract(this.currentData.referencePoint),n=c*p,h[d][n]=u[0],h[d][n+1]=u[1],h[d][n+2]=u[2],this._extrude&&(t.surfacePointForMode(r.latitude,r.longitude,0,this.altitudeMode,u),o=u.distanceToSquared(a),o<s&&(s=o),u.subtract(this.currentData.referencePoint),h[d][n+3]=u[0],h[d][n+4]=u[1],h[d][n+5]=u[2])}return this.currentData.eyeDistance=Math.sqrt(s),h},d.prototype.triangulate=function(t,e,i){function r(t){return[t.latitude,t.longitude,t.altitude]}var n=e.map(function(t){var e=t.map(r);return e.pop(),e}),o=n.reduce(function(t,e){return t.concat(e)},[]);o=o.concat(this.extraPoints(t,i));for(var a=[],l=0,h=0;h<n.length;h++){for(var u=n[h],d=0;d<u.length;d++){var p=d===u.length-1?0:d+1;a.push([d,p])}l+=u.length}var f=c(o,a,{exterior:!1}),g=[];return f.forEach(function(t){t.forEach(function(t){var e=o[t];g.push(new s(e[0],e[1],e[2]))})}),g},d.prototype.makeTessellatedPositions=function(t,e){var i,r=[],n=new l(0,0,0),o=new l(0,0,0),s=e[0];r.push(s);for(var a=1,h=e.length;a<h;a++)i=e[a],this.makeSegment(t,s,i,n,o,r),s=i,n.copy(o);return r},d.prototype.mustDrawVerticals=function(t){return this._extrude&&this.activeAttributes.drawOutline&&this.activeAttributes.drawVerticals&&this.altitudeMode!==WorldWind.CLAMP_TO_GROUND},d.prototype.doRenderOrdered=function(t){var e,i=this.currentData;if(t.pickingMode&&(e=t.uniquePickColor()),this.activeAttributes.drawInterior&&i.capTriangles&&i.capTriangles.length>0&&this.drawCap(t,e),this._extrude&&this.activeAttributes.drawInterior&&this.drawSides(t,e),this.activeAttributes.drawOutline,i.fillVbo=!1,t.pickingMode){var r=new o(e,this.pickDelegate?this.pickDelegate:this,null,t.currentLayer,!1);t.resolvePick(r)}},d.prototype.drawCap=function(t,e){var i=t.currentGlContext,r=t.currentProgram,n=this.currentData,o=n.capTriangles.length/3;this.applyMvpMatrix(t),this.loadShaderVariables(t,this.activeAttributes.interiorColor,e),u.createOrLoadVBO(t,this.currentData,"capVboPositionsCacheKey","capTriangles"),i.vertexAttribPointer(r.vertexPointLocation,3,i.FLOAT,!1,0,0),i.drawArrays(i.TRIANGLES,0,o)},d.prototype.loadShaderVariables=function(t,e,i){u.loadShaderVariables(t,e,i,this.layer.opacity)},d.prototype.makeCapBufferWithNormals=function(){for(var t=this.currentData,e=t.capNormal,i=3,r=i+3,n=t.capTriangles.length/i,o=t.capTriangles,s=new Float32Array(n*r),a=0,l=0;l<n;l++){for(var h=0;h<i;h++)s[a++]=o[l*i+h];s[a++]=e[0],s[a++]=e[1],s[a++]=e[2]}return s},d.prototype.drawSides=function(t,e){var i,r,n=t.currentGlContext,o=t.currentProgram,s=this.currentData,a=s.fillVbo,l=this.activeAttributes.applyLighting,h=3+(l?3:0),c=4*h;r=0;for(var d=0;d<s.boundaryPoints.length;d++)r+=s.boundaryPoints[d].length/6-1;if(s.sidesVboCacheKey||(s.sidesVboCacheKey=t.gpuResourceCache.generateCacheKey()),i=t.gpuResourceCache.resourceForKey(s.sidesVboCacheKey),!i||a){s.numSideVertices=s.sidesBuffer.length/h,i||(i=n.createBuffer()),t.gpuResourceCache.putResource(s.sidesVboCacheKey,i,4*s.sidesBuffer.length),n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,s.sidesBuffer,n.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),s.groundPoints=new Float32Array(s.numSideVertices);for(var p=0;p<=s.numSideVertices/6;p++)s.groundPoints[6*p+0]=1,s.groundPoints[6*p+1]=0,s.groundPoints[6*p+2]=1,s.groundPoints[6*p+3]=0,s.groundPoints[6*p+4]=0,s.groundPoints[6*p+5]=1}else n.bindBuffer(n.ARRAY_BUFFER,i);this.loadShaderVariables(t,this.activeAttributes.interiorColor,e),o.loadTextureEnabled(n,!1),l&&!t.pickingMode?(o.loadApplyLighting(n,!0),n.enableVertexAttribArray(o.normalVectorLocation),n.vertexAttribPointer(o.normalVectorLocation,3,n.FLOAT,!1,c,c-12)):o.loadApplyLighting(n,!1),n.vertexAttribPointer(o.vertexPointLocation,3,n.FLOAT,!1,c,0),n.enableVertexAttribArray(t.currentProgram.groundPointsLocation),u.createOrLoadVBO(t,this.currentData,"sidesGroundPointsVBO","groundPoints"),n.vertexAttribPointer(o.groundPointsLocation,1,n.FLOAT,!1,0,0),n.drawArrays(n.TRIANGLES,0,s.numSideVertices)},d.prototype.makeSidesBuffer=function(t){var e,i,r,n,o,s,a,h,c,u,d,p=this.currentData,f=this.activeAttributes.applyLighting,g=3+(f?3:0);r=2*t*3*g,e=new Float32Array(r),i=0,n=new l(0,0,0),o=new l(0,0,0),s=new l(0,0,0),a=new l(0,0,0),h=c=u=d=null;for(var m=0;m<p.boundaryPoints.length;m++)for(var E,v=p.boundaryPoints[m],y=0;y<v.length-6;y+=6)n[0]=v[y],n[1]=v[y+1],n[2]=v[y+2],o[0]=v[y+3],o[1]=v[y+4],o[2]=v[y+5],s[0]=v[y+6],s[1]=v[y+7],s[2]=v[y+8],a[0]=v[y+9],a[1]=v[y+10],a[2]=v[y+11],E=f?l.computeTriangleNormal(n,o,s):null,this.addVertexToBuffer(n,h,E,e,i),i+=g,this.addVertexToBuffer(o,c,E,e,i),i+=g,this.addVertexToBuffer(s,u,E,e,i),i+=g,this.addVertexToBuffer(o,c,E,e,i),i+=g,this.addVertexToBuffer(a,d,E,e,i),i+=g,this.addVertexToBuffer(s,u,E,e,i),i+=g;return e},d.prototype.addVertexToBuffer=function(t,e,i,r,n){r[n++]=t[0],r[n++]=t[1],r[n++]=t[2],e&&(r[n++]=e[0],r[n++]=e[1]),i&&(r[n++]=i[0],r[n++]=i[1],r[n]=i[2])},d.prototype.drawOutline=function(t,e){var i,r,n,o,s=t.currentGlContext,a=t.currentProgram,l=this.currentData,h=l.fillVbo;a.loadTextureEnabled(s,!1),a.loadApplyLighting(s,!1),s.disableVertexAttribArray(a.vertexTexCoordLocation),this.activeAttributes.applyLighting&&s.disableVertexAttribArray(a.normalVectorLocation),l.boundaryVboCacheKeys||(this.currentData.boundaryVboCacheKeys=[]),this.applyMvpMatrix(t),a.loadTextureEnabled(s,!1),s.disableVertexAttribArray(a.vertexTexCoordLocation);for(var c=0;c<l.boundaryPoints.length;c++){if(i=l.boundaryPoints[c].length/3,l.boundaryVboCacheKeys[c]||(l.boundaryVboCacheKeys[c]=t.gpuResourceCache.generateCacheKey()),r=t.gpuResourceCache.resourceForKey(l.boundaryVboCacheKeys[c]),r||(r=s.createBuffer(),t.gpuResourceCache.putResource(l.boundaryVboCacheKeys[c],r,12*i),h=!0),s.bindBuffer(s.ARRAY_BUFFER,r),h){var u=this._extrude?l.boundaryPoints[c].map(function(t,e){return(e+1)%6===0?0:t}):l.boundaryPoints[c];s.bufferData(s.ARRAY_BUFFER,u,s.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1)}this.loadShaderVariables(t,this.activeAttributes.outlineColor,e),s.lineWidth(this.activeAttributes.outlineWidth),this._extrude?(n=24,o=i/2):(n=12,o=i),s.vertexAttribPointer(a.vertexPointLocation,3,s.FLOAT,!1,n,0),s.drawArrays(s.LINE_STRIP,0,o),this.mustDrawVerticals(t)&&(s.vertexAttribPointer(a.vertexPointLocation,3,s.FLOAT,!1,0,0),s.drawArrays(s.LINES,0,i-2))}},t.exports=d},function(t,e,i){"use strict";function r(t){return[Math.min(t[0],t[1]),Math.max(t[0],t[1])]}function n(t,e){return t[0]-e[0]||t[1]-e[1]}function o(t){return t.map(r).sort(n)}function s(t,e,i){return e in t?t[e]:i}function a(t,e,i){Array.isArray(e)?(i=i||{},e=e||[]):(i=e||{},e=[]);var r=!!s(i,"delaunay",!0),n=!!s(i,"interior",!0),a=!!s(i,"exterior",!0),d=!!s(i,"infinity",!1);if(!n&&!a||0===t.length)return[];var p=l(t,e);if(r||n!==a||d){for(var f=h(t.length,o(e)),g=0;g<p.length;++g){var m=p[g];f.addTriangle(m[0],m[1],m[2])}return r&&c(t,f),a?n?d?u(f,0,d):f.cells():u(f,1,d):u(f,-1)}return p}var l=i(142),h=i(150),c=i(151),u=i(153);t.exports=a},function(t,e,i){"use strict";function r(t,e,i,r,n){this.a=t,this.b=e,this.idx=i,this.lowerIds=r,this.upperIds=n}function n(t,e,i,r){this.a=t,this.b=e,this.type=i,this.idx=r}function o(t,e){var i=t.a[0]-e.a[0]||t.a[1]-e.a[1]||t.type-e.type;return i?i:t.type!==f&&(i=p(t.a,t.b,e.b))?i:t.idx-e.idx}function s(t,e){return p(t.a,t.b,e)}function a(t,e,i,r,n){for(var o=d.lt(e,r,s),a=d.gt(e,r,s),l=o;l<a;++l){for(var h=e[l],c=h.lowerIds,u=c.length;u>1&&p(i[c[u-2]],i[c[u-1]],r)>0;)t.push([c[u-1],c[u-2],n]),u-=1;c.length=u,c.push(n);for(var f=h.upperIds,u=f.length;u>1&&p(i[f[u-2]],i[f[u-1]],r)<0;)t.push([f[u-2],f[u-1],n]),u-=1;f.length=u,f.push(n)}}function l(t,e){var i;return(i=t.a[0]<e.a[0]?p(t.a,t.b,e.a):p(e.b,e.a,t.a))?i:(i=e.b[0]<t.b[0]?p(t.a,t.b,e.b):p(e.b,e.a,t.b),i||t.idx-e.idx)}function h(t,e,i){var n=d.le(t,i,l),o=t[n],s=o.upperIds,a=s[s.length-1];o.upperIds=[a],t.splice(n+1,0,new r(i.a,i.b,i.idx,[a],s))}function c(t,e,i){var r=i.a;i.a=i.b,i.b=r;var n=d.eq(t,i,l),o=t[n],s=t[n-1];s.upperIds=o.upperIds,t.splice(n,1)}function u(t,e){for(var i=t.length,s=e.length,l=[],u=0;u<i;++u)l.push(new n(t[u],null,f,u));for(var u=0;u<s;++u){var d=e[u],p=t[d[0]],E=t[d[1]];p[0]<E[0]?l.push(new n(p,E,m,u),new n(E,p,g,u)):p[0]>E[0]&&l.push(new n(E,p,m,u),new n(p,E,g,u))}l.sort(o);for(var v=l[0].a[0]-(1+Math.abs(l[0].a[0]))*Math.pow(2,-52),y=[new r([v,1],[v,0],-1,[],[],[],[])],_=[],u=0,T=l.length;u<T;++u){var L=l[u],x=L.type;x===f?a(_,y,t,L.a,L.idx):x===m?h(y,t,L):c(y,t,L)}return _}var d=i(143),p=i(144)[3],f=0,g=1,m=2;t.exports=u},function(t,e){"use strict";function i(t,e,i,r,n){var o=["function ",t,"(a,l,h,",r.join(","),"){",n?"":"var i=",i?"l-1":"h+1",";while(l<=h){\tvar m=(l+h)>>>1,x=a[m]"];return n?e.indexOf("c")<0?o.push(";if(x===y){return m}else if(x<=y){"):o.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):o.push(";if(",e,"){i=m;"),i?o.push("l=m+1}else{h=m-1}"):o.push("h=m-1}else{l=m+1}"),o.push("}"),n?o.push("return -1};"):o.push("return i};"),o.join("")}function r(t,e,r,n){var o=new Function([i("A","x"+t+"y",e,["y"],n),i("P","c(x,y)"+t+"0",e,["y","c"],n),"function dispatchBsearch",r,"(a,y,c,l,h){\tif(typeof(c)==='function'){\treturn P(a,(l===void 0)?0:l|0,(h===void 0)?a.length-1:h|0,y,c)\t}else{\treturn A(a,(c===void 0)?0:c|0,(l===void 0)?a.length-1:l|0,y)\t}}\treturn dispatchBsearch",r].join(""));return o()}t.exports={ge:r(">=",!1,"GE"),gt:r(">",!1,"GT"),lt:r("<",!0,"LT"),le:r("<=",!0,"LE"),eq:r("-",!0,"EQ",!0)}},function(t,e,i){"use strict";function r(t,e){for(var i=new Array(t.length-1),r=1;r<t.length;++r)for(var n=i[r-1]=new Array(t.length-1),o=0,s=0;o<t.length;++o)o!==e&&(n[s++]=t[r][o]);return i}function n(t){for(var e=new Array(t),i=0;i<t;++i){e[i]=new Array(t);for(var r=0;r<t;++r)e[i][r]=["m",r,"[",t-i-1,"]"].join("")}return e}function o(t){return 1&t?"-":""}function s(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",s(t.slice(0,e)),",",s(t.slice(e)),")"].join("")}function a(t){if(2===t.length)return[["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("")];for(var e=[],i=0;i<t.length;++i)e.push(["scale(",s(a(r(t,i))),",",o(i),t[0][i],")"].join(""));return e}function l(t){for(var e=[],i=[],o=n(t),l=[],h=0;h<t;++h)0===(1&h)?e.push.apply(e,a(r(o,h))):i.push.apply(i,a(r(o,h))),l.push("m"+h);var c=s(e),g=s(i),m="orientation"+t+"Exact",E=["function ",m,"(",l.join(),"){var p=",c,",n=",g,",d=sub(p,n);\treturn d[d.length-1];};return ",m].join(""),v=new Function("sum","prod","scale","sub",E);return v(d,u,p,f)}function h(t){var e=T[t.length];return e||(e=T[t.length]=l(t.length)),e.apply(void 0,t)}function c(){for(;T.length<=g;)T.push(l(T.length));for(var e=[],i=["slow"],r=0;r<=g;++r)e.push("a"+r),i.push("o"+r);for(var n=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"],r=2;r<=g;++r)n.push("case ",r,":return o",r,"(",e.slice(0,r).join(),");");n.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),i.push(n.join(""));var o=Function.apply(void 0,i);t.exports=o.apply(void 0,[h].concat(T));for(var r=0;r<=g;++r)t.exports[r]=T[r]}var u=i(145),d=i(146),p=i(147),f=i(149),g=5,m=1.1102230246251565e-16,E=(3+16*m)*m,v=(7+56*m)*m,y=l(3),_=l(4),T=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,i){var r,n=(t[1]-i[1])*(e[0]-i[0]),o=(t[0]-i[0])*(e[1]-i[1]),s=n-o;if(n>0){if(o<=0)return s;r=n+o}else{if(!(n<0))return s;if(o>=0)return s;r=-(n+o)}var a=E*r;return s>=a||s<=-a?s:y(t,e,i)},function(t,e,i,r){var n=t[0]-r[0],o=e[0]-r[0],s=i[0]-r[0],a=t[1]-r[1],l=e[1]-r[1],h=i[1]-r[1],c=t[2]-r[2],u=e[2]-r[2],d=i[2]-r[2],p=o*h,f=s*l,g=s*a,m=n*h,E=n*l,y=o*a,T=c*(p-f)+u*(g-m)+d*(E-y),L=(Math.abs(p)+Math.abs(f))*Math.abs(c)+(Math.abs(g)+Math.abs(m))*Math.abs(u)+(Math.abs(E)+Math.abs(y))*Math.abs(d),x=v*L;return T>x||-T>x?T:_(t,e,i,r)}];c()},function(t,e){"use strict";function i(t,e,i){var n=t*e,o=r*t,s=o-t,a=o-s,l=t-a,h=r*e,c=h-e,u=h-c,d=e-u,p=n-a*u,f=p-l*u,g=f-a*d,m=l*d-g;return i?(i[0]=m,i[1]=n,i):[m,n]}t.exports=i;var r=+(Math.pow(2,27)+1)},function(t,e){"use strict";function i(t,e){var i=t+e,r=i-t,n=i-r,o=e-r,s=t-n,a=s+o;return a?[a,i]:[i]}function r(t,e){var r=0|t.length,n=0|e.length;if(1===r&&1===n)return i(t[0],e[0]);var o,s,a=r+n,l=new Array(a),h=0,c=0,u=0,d=Math.abs,p=t[c],f=d(p),g=e[u],m=d(g);f<m?(s=p,c+=1,c<r&&(p=t[c],f=d(p))):(s=g,u+=1,u<n&&(g=e[u],m=d(g))),c<r&&f<m||u>=n?(o=p,c+=1,c<r&&(p=t[c],f=d(p))):(o=g,u+=1,u<n&&(g=e[u],m=d(g)));for(var E,v,y,_,T,L=o+s,x=L-o,b=s-x,S=b,w=L;c<r&&u<n;)f<m?(o=p,c+=1,c<r&&(p=t[c],f=d(p))):(o=g,u+=1,u<n&&(g=e[u],m=d(g))),s=S,L=o+s,x=L-o,b=s-x,b&&(l[h++]=b),E=w+L,v=E-w,y=E-v,_=L-v,T=w-y,S=T+_,w=E;for(;c<r;)o=p,s=S,L=o+s,x=L-o,b=s-x,b&&(l[h++]=b),E=w+L,v=E-w,y=E-v,_=L-v,T=w-y,S=T+_,w=E,c+=1,c<r&&(p=t[c]);for(;u<n;)o=g,s=S,L=o+s,x=L-o,b=s-x,b&&(l[h++]=b),E=w+L,v=E-w,y=E-v,_=L-v,T=w-y,S=T+_,w=E,u+=1,u<n&&(g=e[u]);return S&&(l[h++]=S),w&&(l[h++]=w),h||(l[h++]=0),l.length=h,l}t.exports=r},function(t,e,i){"use strict";function r(t,e){var i=t.length;if(1===i){var r=n(t[0],e);return r[0]?r:[r[1]]}var s=new Array(2*i),a=[.1,.1],l=[.1,.1],h=0;n(t[0],e,a),a[0]&&(s[h++]=a[0]);for(var c=1;c<i;++c){n(t[c],e,l);var u=a[1];o(u,l[0],a),a[0]&&(s[h++]=a[0]);var d=l[1],p=a[1],f=d+p,g=f-d,m=p-g;a[1]=f,m&&(s[h++]=m)}return a[1]&&(s[h++]=a[1]),0===h&&(s[h++]=0),s.length=h,s}var n=i(145),o=i(148);t.exports=r},function(t,e){"use strict";function i(t,e,i){var r=t+e,n=r-t,o=r-n,s=e-n,a=t-o;return i?(i[0]=a+s,i[1]=r,i):[a+s,r]}t.exports=i},function(t,e){"use strict";function i(t,e){var i=t+e,r=i-t,n=i-r,o=e-r,s=t-n,a=s+o;return a?[a,i]:[i]}function r(t,e){var r=0|t.length,n=0|e.length;if(1===r&&1===n)return i(t[0],-e[0]);var o,s,a=r+n,l=new Array(a),h=0,c=0,u=0,d=Math.abs,p=t[c],f=d(p),g=-e[u],m=d(g);f<m?(s=p,c+=1,c<r&&(p=t[c],f=d(p))):(s=g,u+=1,u<n&&(g=-e[u],m=d(g))),c<r&&f<m||u>=n?(o=p,c+=1,c<r&&(p=t[c],f=d(p))):(o=g,u+=1,u<n&&(g=-e[u],m=d(g)));for(var E,v,y,_,T,L=o+s,x=L-o,b=s-x,S=b,w=L;c<r&&u<n;)f<m?(o=p,c+=1,c<r&&(p=t[c],f=d(p))):(o=g,u+=1,u<n&&(g=-e[u],m=d(g))),s=S,L=o+s,x=L-o,b=s-x,b&&(l[h++]=b),E=w+L,v=E-w,y=E-v,_=L-v,T=w-y,S=T+_,w=E;for(;c<r;)o=p,s=S,L=o+s,x=L-o,b=s-x,b&&(l[h++]=b),E=w+L,v=E-w,y=E-v,_=L-v,T=w-y,S=T+_,w=E,c+=1,c<r&&(p=t[c]);for(;u<n;)o=g,s=S,L=o+s,x=L-o,b=s-x,b&&(l[h++]=b),E=w+L,v=E-w,y=E-v,_=L-v,T=w-y,S=T+_,w=E,u+=1,u<n&&(g=-e[u]);return S&&(l[h++]=S),w&&(l[h++]=w),h||(l[h++]=0),l.length=h,l}t.exports=r},function(t,e,i){"use strict";function r(t,e){this.stars=t,this.edges=e}function n(t,e,i){for(var r=1,n=t.length;r<n;r+=2)if(t[r-1]===e&&t[r]===i)return t[r-1]=t[n-2],t[r]=t[n-1],void(t.length=n-2)}function o(t,e){for(var i=new Array(t),n=0;n<t;++n)i[n]=[];return new r(i,e)}var s=i(143);t.exports=o;var a=r.prototype;a.isConstraint=function(){function t(t,e){return t[0]-e[0]||t[1]-e[1]}var e=[0,0];return function(i,r){return e[0]=Math.min(i,r),e[1]=Math.max(i,r),s.eq(this.edges,e,t)>=0}}(),a.removeTriangle=function(t,e,i){var r=this.stars;n(r[t],e,i),n(r[e],i,t),n(r[i],t,e)},a.addTriangle=function(t,e,i){var r=this.stars;r[t].push(e,i),r[e].push(i,t),r[i].push(t,e)},a.opposite=function(t,e){for(var i=this.stars[e],r=1,n=i.length;r<n;r+=2)if(i[r]===t)return i[r-1];return-1},a.flip=function(t,e){var i=this.opposite(t,e),r=this.opposite(e,t);this.removeTriangle(t,e,i),this.removeTriangle(e,t,r),this.addTriangle(t,r,i),this.addTriangle(e,i,r)},a.edges=function(){for(var t=this.stars,e=[],i=0,r=t.length;i<r;++i)for(var n=t[i],o=0,s=n.length;o<s;o+=2)e.push([n[o],n[o+1]]);return e},a.cells=function(){for(var t=this.stars,e=[],i=0,r=t.length;i<r;++i)for(var n=t[i],o=0,s=n.length;o<s;o+=2){var a=n[o],l=n[o+1];i<Math.min(a,l)&&e.push([i,a,l])}return e}},function(t,e,i){"use strict";function r(t,e,i,r,n,s){var a=e.opposite(r,n);if(!(a<0)){if(n<r){var l=r;r=n,n=l,l=s,s=a,a=l}e.isConstraint(r,n)||o(t[r],t[n],t[s],t[a])<0&&i.push(r,n)}}function n(t,e){for(var i=[],n=t.length,s=e.stars,a=0;a<n;++a)for(var l=s[a],h=1;h<l.length;h+=2){var c=l[h];if(!(c<a||e.isConstraint(a,c))){for(var u=l[h-1],d=-1,p=1;p<l.length;p+=2)if(l[p-1]===c){d=l[p];break}d<0||o(t[a],t[c],t[u],t[d])<0&&i.push(a,c)}}for(;i.length>0;){for(var c=i.pop(),a=i.pop(),u=-1,d=-1,l=s[a],f=1;f<l.length;f+=2){var g=l[f-1],m=l[f];g===c?d=m:m===c&&(u=g)}u<0||d<0||o(t[a],t[c],t[u],t[d])>=0||(e.flip(a,c),r(t,e,i,u,a,d),r(t,e,i,a,d,u),r(t,e,i,d,c,u),r(t,e,i,c,u,d))}}var o=i(152)[4];i(143);t.exports=n},function(t,e,i){"use strict";function r(t,e){for(var i=new Array(t.length-1),r=1;r<t.length;++r)for(var n=i[r-1]=new Array(t.length-1),o=0,s=0;o<t.length;++o)o!==e&&(n[s++]=t[r][o]);return i}function n(t){for(var e=new Array(t),i=0;i<t;++i){e[i]=new Array(t);for(var r=0;r<t;++r)e[i][r]=["m",r,"[",t-i-2,"]"].join("")}return e}function o(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",o(t.slice(0,e)),",",o(t.slice(e)),")"].join("")}function s(t,e){if("m"===t.charAt(0)){if("w"===e.charAt(0)){var i=t.split("[");return["w",e.substr(1),"m",i[0].substr(1)].join("")}return["prod(",t,",",e,")"].join("")}return s(e,t)}function a(t){return t&!0?"-":""}function l(t){if(2===t.length)return[["diff(",s(t[0][0],t[1][1]),",",s(t[1][0],t[0][1]),")"].join("")];for(var e=[],i=0;i<t.length;++i)e.push(["scale(",o(l(r(t,i))),",",a(i),t[0][i],")"].join(""));return e}function h(t,e){for(var i=[],r=0;r<e-2;++r)i.push(["prod(m",t,"[",r,"],m",t,"[",r,"])"].join(""));return o(i)}function c(t){for(var e=[],i=[],s=n(t),a=0;a<t;++a)s[0][a]="1",s[t-1][a]="w"+a;for(var a=0;a<t;++a)0===(1&a)?e.push.apply(e,l(r(s,a))):i.push.apply(i,l(r(s,a)));for(var c=o(e),u=o(i),d="exactInSphere"+t,p=[],a=0;a<t;++a)p.push("m"+a);for(var f=["function ",d,"(",p.join(),"){"],a=0;a<t;++a){f.push("var w",a,"=",h(a,t),";");for(var g=0;g<t;++g)g!==a&&f.push("var w",a,"m",g,"=scale(w",a,",m",g,"[0]);")}f.push("var p=",c,",n=",u,",d=diff(p,n);return d[d.length-1];}return ",d);var _=new Function("sum","diff","prod","scale",f.join(""));return _(E,v,m,y)}function u(){return 0}function d(){return 0}function p(){return 0}function f(t){var e=T[t.length];return e||(e=T[t.length]=c(t.length)),e.apply(void 0,t)}function g(){for(;T.length<=_;)T.push(c(T.length));for(var e=[],i=["slow"],r=0;r<=_;++r)e.push("a"+r),i.push("o"+r);for(var n=["function testInSphere(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"],r=2;r<=_;++r)n.push("case ",r,":return o",r,"(",e.slice(0,r).join(),");");n.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return testInSphere"),i.push(n.join(""));var o=Function.apply(void 0,i);t.exports=o.apply(void 0,[f].concat(T));for(var r=0;r<=_;++r)t.exports[r]=T[r]}var m=i(145),E=i(146),v=i(149),y=i(147),_=6,T=[u,d,p];g()},function(t,e,i){"use strict";function r(t,e,i,r,n,o,s){this.cells=t,this.neighbor=e,this.flags=r,this.constraint=i,this.active=n,this.next=o,this.boundary=s}function n(t,e){return t[0]-e[0]||t[1]-e[1]||t[2]-e[2]}function o(t,e){for(var i=t.cells(),o=i.length,s=0;s<o;++s){var a=i[s],l=a[0],h=a[1],c=a[2];h<c?h<l&&(a[0]=h,a[1]=c,a[2]=l):c<l&&(a[0]=c,a[1]=l,a[2]=h)}i.sort(n);for(var u=new Array(o),s=0;s<u.length;++s)u[s]=0;var d=[],p=[],f=new Array(3*o),g=new Array(3*o),m=null;e&&(m=[]);for(var E=new r(i,f,g,u,d,p,m),s=0;s<o;++s)for(var a=i[s],v=0;v<3;++v){var l=a[v],h=a[(v+1)%3],y=f[3*s+v]=E.locate(h,l,t.opposite(h,l)),_=g[3*s+v]=t.isConstraint(l,h);y<0&&(_?p.push(s):(d.push(s),u[s]=1),e&&m.push([h,l,-1]))}return E}function s(t,e,i){for(var r=0,n=0;n<t.length;++n)e[n]===i&&(t[r++]=t[n]);return t.length=r,t}function a(t,e,i){var r=o(t,i);if(0===e)return i?r.cells.concat(r.boundary):r.cells;for(var n=1,a=r.active,l=r.next,h=r.flags,c=r.cells,u=r.constraint,d=r.neighbor;a.length>0||l.length>0;){for(;a.length>0;){var p=a.pop();if(h[p]!==-n){h[p]=n;for(var f=(c[p],0);f<3;++f){var g=d[3*p+f];g>=0&&0===h[g]&&(u[3*p+f]?l.push(g):(a.push(g),h[g]=n))}}}var m=l;l=a,a=m,l.length=0,n=-n}var E=s(c,h,e);return i?E.concat(r.boundary):E}var l=i(143);t.exports=a;var h=r.prototype;h.locate=function(){var t=[0,0,0];return function(e,i,r){var o=e,s=i,a=r;return i<r?i<e&&(o=i,s=r,a=e):r<e&&(o=r,s=e,a=i),o<0?-1:(t[0]=o,t[1]=s,t[2]=a,l.eq(this.cells,t,n))}}()},function(t,e,i){function r(t){var e=p.position(t.geometry.coordinates),i=new a(null);i._imageSource="images/transparentPixel.png",i.labelAttributes=new l(null),i.labelAttributes._offset.x=t.geometry.properties.offsetX||0,i.labelAttributes._offset.y=t.geometry.properties.offsetY||0,i.labelAttributes._color=c.colorFromHex(t.geometry.properties.color),i.labelAttributes._font=new u(20);var r=new h(e,!0,i);return r.altitudeMode=WorldWind.RELATIVE_TO_GROUND,r.label=t.geometry.properties.text,r.eyeDistanceScalingThreshold=5e3,r.source=t,[r]}function n(t){var e=p.position(t.geometry.coordinates),i=[],r=t.geometry.properties.bbox?s(t.geometry.properties.bbox)[0]:.001*(t.geometry.properties.fontSize||1),n=t.geometry.properties.color,a=t.geometry.properties.text.length,l=.5*r/Math.cos(e.latitude);return e.longitude-=l*(a-1)/2*(2*(t.geometry.properties.offsetX||0)),t.geometry.properties.text.split("").forEach(function(s){o(e);var a=new d(e,s,r,n,t.properties);a.source=t,i.push(a),e.longitude+=l}),i}function o(t){t.longitude>180&&(t.longitude-=360),t.longitude<-180&&(t.longitude+=360)}function s(t){return[t.max[0]-t.min[0],t.max[1]-t.min[1]]}var a=i(155),l=i(156),h=(i(157),i(159)),c=i(23),u=i(101),d=i(58),p=i(117);t.exports={create:function(t){return"coco"===t.geometry.properties.api?n(t):r(t)}}},function(t,e,i){var r,n;r=[i(23),i(101),i(6),i(105),i(156)],n=function(t,e,i,r,n){"use strict";var o=function(e){this._imageColor=e?e._imageColor:new t(1,1,1,1),this._imageOffset=e?e._imageOffset:new i(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,.5),this._imageScale=e?e._imageScale:1,this._imageSource=e?e._imageSource:null,this._depthTest=!e||e._depthTest,this._labelAttributes=e?e._labelAttributes:new n(null),this._drawLeaderLine=!!e&&e._drawLeaderLine,this._leaderLineAttributes=e?e._leaderLineAttributes:new r(null),this.stateKeyInvalid=!0};return o.prototype.computeStateKey=function(){return"ic "+this._imageColor.toHexString(!0)+" io "+this._imageOffset.toString()+" is "+this._imageScale+" ip "+this._imageSource+" dt "+this._depthTest+" la "+this._labelAttributes.stateKey+" dll "+this._drawLeaderLine+" lla "+this._leaderLineAttributes.stateKey},Object.defineProperties(o.prototype,{stateKey:{get:function(){return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey(),this.stateKeyInvalid=!1),this._stateKey}},imageColor:{get:function(){return this._imageColor},set:function(t){this._imageColor=t,this.stateKeyInvalid=!0}},imageOffset:{get:function(){return this._imageOffset},set:function(t){this._imageOffset=t,this.stateKeyInvalid=!0}},imageScale:{get:function(){return this._imageScale},set:function(t){this._imageScale=t,this.stateKeyInvalid=!0}},imageSource:{get:function(){return this._imageSource},set:function(t){this._imageSource=t,this.stateKeyInvalid=!0}},depthTest:{get:function(){return this._depthTest},set:function(t){this._depthTest=t,this.stateKeyInvalid=!0}},labelAttributes:{get:function(){return this._labelAttributes},set:function(t){this._labelAttributes=t,this.stateKeyInvalid=!0}},drawLeaderLine:{get:function(){return this._drawLeaderLine},set:function(t){this._drawLeaderLine=t,this.stateKeyInvalid=!0}},leaderLineAttributes:{get:function(){return this._leaderLineAttributes},set:function(t){this._leaderLineAttributes=t,this.stateKeyInvalid=!0}}}),o}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(23),i(101),i(6)],n=function(t,e,i){"use strict";var r=function(r){this._color=r?r._color:new t(1,1,1,1),this._font=r?r._font:new e(14),this._offset=r?r._offset:new i(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,0),this._scale=r?r._scale:1,this._depthTest=!!r&&r._depthTest,this.stateKeyInvalid=!0};return r.prototype.computeStateKey=function(){return"c "+this._color.toHexString(!0)+" f "+this._font.toString()+" o "+this._offset.toString()+" s "+this._scale+" dt "+this._depthTest;
},Object.defineProperties(r.prototype,{stateKey:{get:function(){return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey(),this.stateKeyInvalid=!1),this._stateKey}},color:{get:function(){return this._color},set:function(t){this._color=t,this.stateKeyInvalid=!0}},font:{get:function(){return this._font},set:function(t){this._font=t,this.stateKeyInvalid=!0}},offset:{get:function(){return this._offset},set:function(t){this._offset=t,this.stateKeyInvalid=!0}},scale:{get:function(){return this._scale},set:function(t){this._scale=t,this.stateKeyInvalid=!0}},depthTest:{get:function(){return this._depthTest},set:function(t){this._depthTest=t,this.stateKeyInvalid=!0}}}),r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(158),i(11)],n=function(t,e,i,r){"use strict";var n=function(r,n){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Text","constructor","missingPosition"));i.call(this,n),this.position=r,this.declutterGroup=1};return n.placePoint=new r(0,0,0),n.prototype=Object.create(i.prototype),n.prototype.clone=function(){var t=new n(this.position,this.text);return t.copy(this),t.pickDelegate=this.pickDelegate?this.pickDelegate:this,t},n.prototype.render=function(t){t.globe.projectionLimits&&!t.globe.projectionLimits.containsLocation(this.position.latitude,this.position.longitude)||i.prototype.render.call(this,t)},n.prototype.computeScreenPointAndEyeDistance=function(t){return t.surfacePointForMode(this.position.latitude,this.position.longitude,this.position.altitude,this.altitudeMode,n.placePoint),!!t.navigatorState.frustumInModelCoordinates.containsPoint(n.placePoint)&&(this.eyeDistance=this.alwaysOnTop?0:t.navigatorState.eyePoint.distanceTo(n.placePoint),!!t.navigatorState.projectWithDepth(n.placePoint,this.depthOffset,this.screenPoint))},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(102),i(23),i(101),i(8),i(36),i(60),i(103),i(156),i(39),i(7),i(11),i(17)],n=function(t,e,i,r,n,o,s,a,l,h,c,u,d){"use strict";var p=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Text","constructor","missingText"));a.call(this),this.attributes=new l(null),this.highlightAttributes=null,this.highlighted=!1,this.enabled=!0,this.text=e,this.altitudeMode=WorldWind.ABSOLUTE,this.pickDelegate=null,this.alwaysOnTop=!1,this.targetVisibility=1,this.currentVisibility=1,this.declutterGroup=0,this.markerImageSource=WorldWind.configuration.baseUrl+"images/white-dot.png",this.markerImageScale=.1,this.activeAttributes=null,this.activeTexture=null,this.imageTransform=o.fromIdentity(),this.texCoordMatrix=o.fromIdentity(),this.imageBounds=null,this.layer=null,this.depthOffset=-.003,this.screenPoint=new u(0,0,0)};return p.matrix=o.fromIdentity(),p.glPickPoint=new u(0,0,0),p.prototype=Object.create(a.prototype),p.prototype.copy=function(t){return this.text=t.text,this.attributes=t.attributes,this.highlightAttributes=t.highlightAttributes,this.highlighted=t.highlighted,this.enabled=t.enabled,this.altitudeMode=t.altitudeMode,this.pickDelegate=t.pickDelegate,this.alwaysOnTop=t.alwaysOnTop,this.depthOffset=t.depthOffset,this.declutterGroup=t.declutterGroup,this.targetVisibility=t.targetVisibility,this.currentVisibility=t.currentVisibility,this},Object.defineProperties(p.prototype,{screenBounds:{get:function(){return this.imageBounds}}}),p.prototype.render=function(t){if(this.enabled&&this.text&&0!==this.text.length&&t.accumulateOrderedRenderables){var e;if(this.lastFrameTime!=t.timestamp)e=this.makeOrderedRenderable(t);else{var i=this.clone();e=i.makeOrderedRenderable(t)}e&&e.isVisible(t)&&(e.layer=t.currentLayer,this.lastFrameTime=t.timestamp,t.addOrderedRenderable(e))}},p.prototype.renderOrdered=function(t){if((0!==this.currentVisibility||0!==this.targetVisibility||this.markerImageSource)&&(this.drawOrderedText(t),t.pickingMode)){var e=new s(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,this.position,this.layer,!1);t.resolvePick(e)}},p.prototype.makeOrderedRenderable=function(t){var e,i,r,n;if(this.determineActiveAttributes(t),!this.activeAttributes)return null;if(!this.computeScreenPointAndEyeDistance(t))return null;var o=this.activeAttributes.font,s=this.text+o.toString();return this.activeTexture=t.gpuResourceCache.resourceForKey(s),this.activeTexture||(this.activeTexture=t.textSupport.createTexture(t,this.text,o,!0),t.gpuResourceCache.putResource(s,this.activeTexture,this.activeTexture.size)),e=this.activeTexture.imageWidth,i=this.activeTexture.imageHeight,r=this.activeAttributes.scale,n=this.activeAttributes.offset.offsetForSize(e,i),this.imageTransform.setTranslation(this.screenPoint[0]-n[0]*r,this.screenPoint[1]-n[1]*r,this.screenPoint[2]),this.imageTransform.setScale(e*r,i*r,1),this.imageBounds=d.boundingRectForUnitQuad(this.imageTransform),this},p.prototype.computeScreenPointAndEyeDistance=function(t){throw new h(n.logMessage(n.LEVEL_SEVERE,"Renderable","render","abstractInvocation"))},p.prototype.determineActiveAttributes=function(t){this.highlighted&&this.highlightAttributes?this.activeAttributes=this.highlightAttributes:this.activeAttributes=this.attributes},p.prototype.isVisible=function(t){return t.pickingMode?t.pickRectangle&&this.imageBounds.intersects(t.pickRectangle):this.imageBounds.intersects(t.navigatorState.viewport)},p.prototype.drawOrderedText=function(t){this.beginDrawing(t);try{this.doDrawOrderedText(t),!t.pickingMode}finally{this.endDrawing(t)}},p.prototype.drawBatchOrderedText=function(t){for(var e;(e=t.peekOrderedRenderable())&&e instanceof p;){t.popOrderedRenderable();try{e.doDrawOrderedText(t)}catch(t){n.logMessage(n.LEVEL_WARNING,"Text","drawBatchOrderedText","Error occurred while rendering text using batching: "+t.message)}}},p.prototype.beginDrawing=function(t){var i,r=t.currentGlContext;t.findAndBindProgram(e),i=t.currentProgram,r.bindBuffer(r.ARRAY_BUFFER,t.unitQuadBuffer3()),r.vertexAttribPointer(i.vertexPointLocation,3,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,t.unitQuadBuffer()),r.vertexAttribPointer(i.vertexTexCoordLocation,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(i.vertexPointLocation),r.enableVertexAttribArray(i.vertexTexCoordLocation),i.loadTextureUnit(r,r.TEXTURE0),t.pickingMode&&i.loadTextureEnabled(r,!1),i.loadModulateColor(r,!1),r.depthMask(!1),p.currentTexture=null},p.prototype.endDrawing=function(t){var e=t.currentGlContext,i=t.currentProgram;e.disableVertexAttribArray(i.vertexPointLocation),e.disableVertexAttribArray(i.vertexTexCoordLocation),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindTexture(e.TEXTURE_2D,null),e.depthMask(!0),p.currentTexture=null},p.prototype.doDrawOrderedText=function(t){var e,i=t.currentGlContext,r=t.currentProgram;if(t.pickingMode&&(this.pickColor=t.uniquePickColor()),!t.pickingMode&&this.currentVisibility!=this.targetVisibility){var n=(t.timestamp-t.previousRedrawTimestamp)/t.fadeTime;this.currentVisibility<this.targetVisibility?this.currentVisibility=Math.min(1,this.currentVisibility+n):this.currentVisibility=Math.max(0,this.currentVisibility-n),t.redrawRequested=!0}if(this.currentVisibility>0&&(p.matrix.copy(t.screenProjection),p.matrix.multiplyMatrix(this.imageTransform),r.loadModelviewProjection(i,p.matrix),t.pickingMode?(r.loadColor(i,this.pickColor),r.loadTextureEnabled(i,!1)):(r.loadColor(i,this.activeAttributes.color),r.loadOpacity(i,this.layer.opacity*this.currentVisibility),this.texCoordMatrix.setToIdentity(),this.activeTexture&&this.texCoordMatrix.multiplyByTextureTransform(this.activeTexture),r.loadTextureMatrix(i,this.texCoordMatrix),this.activeTexture&&this.activeTexture!=p.currentTexture&&(e=this.activeTexture.bind(t),r.loadTextureEnabled(i,e),p.currentTexture=this.activeTexture)),this.activeAttributes.depthTest||i.disable(i.DEPTH_TEST,!1),i.drawArrays(i.TRIANGLE_STRIP,0,4),this.activeAttributes.depthTest||i.disable(i.DEPTH_TEST,!0)),this.currentVisibility<1&&this.markerImageSource){var s=t.gpuResourceCache.resourceForKey(this.markerImageSource);if(!s)return void t.gpuResourceCache.retrieveTexture(t.currentGlContext,this.markerImageSource);var a=this.markerImageScale,l=o.fromIdentity();if(l.setTranslation(this.screenPoint[0]-a*s.imageWidth/2,this.screenPoint[1]-a*s.imageWidth/2,this.screenPoint[2]),l.setScale(s.imageWidth*a,s.imageHeight*a,1),p.matrix.copy(t.screenProjection),p.matrix.multiplyMatrix(l),r.loadModelviewProjection(i,p.matrix),t.pickingMode)r.loadColor(i,this.pickColor),r.loadTextureEnabled(i,!1);else{r.loadColor(i,this.activeAttributes.color),r.loadOpacity(i,this.layer.opacity*(1-this.currentVisibility));var h=o.fromIdentity();h.multiplyByTextureTransform(s),r.loadTextureMatrix(i,h),s!=p.currentTexture&&(e=s.bind(t),r.loadTextureEnabled(i,e),p.currentTexture=s)}this.activeAttributes.depthTest||i.disable(i.DEPTH_TEST,!1),i.drawArrays(i.TRIANGLE_STRIP,0,4),this.activeAttributes.depthTest||i.enable(i.DEPTH_TEST,!0)}},p}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(102),i(23),i(101),i(8),i(36),i(60),i(155),i(103),i(7),i(11),i(17)],n=function(t,e,i,r,n,o,s,a,l,h,c,u){"use strict";var d=function(e,i,r){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Placemark","constructor","missingPosition"));l.call(this),this.attributes=r?r:new a(null),this.highlightAttributes=null,this.highlighted=!1,this.position=e,this.eyeDistanceScaling=i,this.eyeDistanceScalingThreshold=1e6,this.eyeDistanceScalingLabelThreshold=1.5*this.eyeDistanceScalingThreshold,this.label=null,this.altitudeMode=WorldWind.ABSOLUTE,this.alwaysOnTop=!1,this.enableLeaderLinePicking=!1,this.updateImage=!0,this.declutterGroup=2,this.targetVisibility=1,this.currentVisibility=1,this.imageRotation=0,this.imageTilt=0,this.imageRotationReference=WorldWind.RELATIVE_TO_SCREEN,this.imageTiltReference=WorldWind.RELATIVE_TO_SCREEN,this.activeAttributes=null,this.activeTexture=null,this.labelTexture=null,this.placePoint=new c(0,0,0),this.groundPoint=new c(0,0,0),this.imageTransform=o.fromIdentity(),this.labelTransform=o.fromIdentity(),this.texCoordMatrix=o.fromIdentity(),this.imageBounds=null,this.layer=null,this.depthOffset=-.003};return d.screenPoint=new c(0,0,0),d.matrix=o.fromIdentity(),d.scratchPoint=new c(0,0,0),d.prototype=Object.create(l.prototype),Object.defineProperties(d.prototype,{screenBounds:{get:function(){return this.labelBounds}}}),d.prototype.copy=function(t){return this.position=t.position,this.attributes=t.attributes,this.highlightAttributes=t.highlightAttributes,this.highlighted=t.highlighted,this.enabled=t.enabled,this.label=t.label,this.altitudeMode=t.altitudeMode,this.pickDelegate=t.pickDelegate,this.alwaysOnTop=t.alwaysOnTop,this.depthOffset=t.depthOffset,this.targetVisibility=t.targetVisibility,this.currentVisibility=t.currentVisibility,this.imageRotation=t.imageRotation,this.imageTilt=t.imageTilt,this.imageRotationReference=t.imageRotationReference,this.imageTiltReference=t.imageTiltReference,this},d.prototype.clone=function(){var t=new d(this.position);return t.copy(this),t.pickDelegate=this.pickDelegate?this.pickDelegate:this,t},d.prototype.render=function(t){if(this.enabled&&t.accumulateOrderedRenderables&&(!t.globe.projectionLimits||t.globe.projectionLimits.containsLocation(this.position.latitude,this.position.longitude))){var e;if(this.lastFrameTime!==t.timestamp)e=this.makeOrderedRenderable(t);else{var i=this.clone();e=i.makeOrderedRenderable(t)}e&&e.isVisible(t)&&(e.layer=t.currentLayer,this.lastFrameTime=t.timestamp,t.addOrderedRenderable(e))}},d.prototype.renderOrdered=function(t){if(this.drawOrderedPlacemark(t),t.pickingMode){var e=new s(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,this.position,this.layer,!1);t.pickPoint&&this.mustDrawLabel()&&this.labelBounds.containsPoint(t.navigatorState.convertPointToViewport(t.pickPoint,d.scratchPoint))&&(e.labelPicked=!0),t.resolvePick(e)}},d.prototype.makeOrderedRenderable=function(t){var e,i,r,n;if(this.determineActiveAttributes(t),!this.activeAttributes)return null;if(t.surfacePointForMode(this.position.latitude,this.position.longitude,this.position.altitude,this.altitudeMode,this.placePoint),this.eyeDistance=this.alwaysOnTop?0:t.navigatorState.eyePoint.distanceTo(this.placePoint),this.mustDrawLeaderLine(t)&&t.surfacePointForMode(this.position.latitude,this.position.longitude,0,this.altitudeMode,this.groundPoint),!t.navigatorState.projectWithDepth(this.placePoint,this.depthOffset,d.screenPoint))return null;var o=this.eyeDistanceScaling?Math.max(0,Math.min(1,this.eyeDistanceScalingThreshold/this.eyeDistance)):1;if(this.activeTexture?(e=this.activeTexture.originalImageWidth,i=this.activeTexture.originalImageHeight,r=this.activeAttributes.imageScale*o,n=this.activeAttributes.imageOffset.offsetForSize(e,i),this.imageTransform.setTranslation(d.screenPoint[0]-n[0]*r,d.screenPoint[1]-n[1]*r,d.screenPoint[2]),this.imageTransform.setScale(e*r,i*r,1)):(r=this.activeAttributes.imageScale*o,n=this.activeAttributes.imageOffset.offsetForSize(r,r),this.imageTransform.setTranslation(d.screenPoint[0]-n[0],d.screenPoint[1]-n[1],d.screenPoint[2]),this.imageTransform.setScale(r,r,1)),this.imageBounds=u.boundingRectForUnitQuad(this.imageTransform),this.mustDrawLabel()){var s=this.activeAttributes.labelAttributes.font,a=this.label+s.toString();this.labelTexture=t.gpuResourceCache.resourceForKey(a),this.labelTexture||(this.labelTexture=t.textSupport.createTexture(t,this.label,s,!0),t.gpuResourceCache.putResource(a,this.labelTexture,this.labelTexture.size)),e=this.labelTexture.imageWidth,i=this.labelTexture.imageHeight,r=this.activeAttributes.labelAttributes.scale*o,n=this.activeAttributes.labelAttributes.offset.offsetForSize(e,i),this.labelTransform.setTranslation(d.screenPoint[0]-n[0]*r,d.screenPoint[1]-n[1]*r,d.screenPoint[2]),this.labelTransform.setScale(e*r,i*r,1),this.labelBounds=u.boundingRectForUnitQuad(this.labelTransform)}return this},d.prototype.determineActiveAttributes=function(t){this.highlighted&&this.highlightAttributes?this.activeAttributes=this.highlightAttributes:this.activeAttributes=this.attributes,this.activeAttributes&&this.activeAttributes.imageSource&&(this.activeTexture=t.gpuResourceCache.resourceForKey(this.activeAttributes.imageSource),this.activeTexture&&!this.updateImage||(this.activeTexture=t.gpuResourceCache.retrieveTexture(t.currentGlContext,this.activeAttributes.imageSource),this.updateImage=!1))},d.prototype.isVisible=function(t){return t.pickingMode?t.pickRectangle&&(this.imageBounds.intersects(t.pickRectangle)||this.mustDrawLabel()&&this.labelBounds.intersects(t.pickRectangle)||this.mustDrawLeaderLine(t)&&t.pickFrustum.intersectsSegment(this.groundPoint,this.placePoint)):this.imageBounds.intersects(t.navigatorState.viewport)||this.mustDrawLabel()&&this.labelBounds.intersects(t.navigatorState.viewport)||this.mustDrawLeaderLine(t)&&t.navigatorState.frustumInModelCoordinates.intersectsSegment(this.groundPoint,this.placePoint)},d.prototype.drawOrderedPlacemark=function(t){this.beginDrawing(t);try{this.doDrawOrderedPlacemark(t),t.pickingMode||this.drawBatchOrderedPlacemarks(t)}finally{this.endDrawing(t)}},d.prototype.drawBatchOrderedPlacemarks=function(t){for(var e;(e=t.peekOrderedRenderable())&&e.doDrawOrderedPlacemark;){t.popOrderedRenderable();try{e.doDrawOrderedPlacemark(t)}catch(t){n.logMessage(n.LEVEL_WARNING,"Placemark","drawBatchOrderedPlacemarks","Error occurred while rendering placemark using batching: "+t.message)}}},d.prototype.beginDrawing=function(t){var i,r=t.currentGlContext;t.findAndBindProgram(e),i=t.currentProgram,r.bindBuffer(r.ARRAY_BUFFER,t.unitQuadBuffer()),r.vertexAttribPointer(i.vertexTexCoordLocation,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(i.vertexPointLocation),r.enableVertexAttribArray(i.vertexTexCoordLocation),i.loadTextureUnit(r,r.TEXTURE0),i.loadModulateColor(r,t.pickingMode)},d.prototype.endDrawing=function(t){var e=t.currentGlContext,i=t.currentProgram;e.disableVertexAttribArray(i.vertexPointLocation),e.disableVertexAttribArray(i.vertexTexCoordLocation),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindTexture(e.TEXTURE_2D,null)},d.prototype.doDrawOrderedPlacemark=function(t){var e,i=t.currentGlContext,r=t.currentProgram,n=!0;if(t.pickingMode&&(this.pickColor=t.uniquePickColor()),this.eyeDistanceScaling&&this.eyeDistance>this.eyeDistanceScalingLabelThreshold&&(this.targetVisibility=0),!t.pickingMode&&this.mustDrawLabel()&&this.currentVisibility!=this.targetVisibility){var o=(t.timestamp-t.previousRedrawTimestamp)/t.fadeTime;this.currentVisibility<this.targetVisibility?this.currentVisibility=Math.min(1,this.currentVisibility+o):this.currentVisibility=Math.max(0,this.currentVisibility-o),t.redrawRequested=!0}if(r.loadOpacity(i,t.pickingMode?1:this.layer.opacity),this.mustDrawLeaderLine(t)){this.leaderLinePoints||(this.leaderLinePoints=new Float32Array(6)),this.leaderLinePoints[0]=this.groundPoint[0],this.leaderLinePoints[1]=this.groundPoint[1],this.leaderLinePoints[2]=this.groundPoint[2],this.leaderLinePoints[3]=this.placePoint[0],this.leaderLinePoints[4]=this.placePoint[1],this.leaderLinePoints[5]=this.placePoint[2],this.leaderLineCacheKey||(this.leaderLineCacheKey=t.gpuResourceCache.generateCacheKey());var s=t.gpuResourceCache.resourceForKey(this.leaderLineCacheKey);s||(s=i.createBuffer(),t.gpuResourceCache.putResource(this.leaderLineCacheKey,s,4*this.leaderLinePoints.length)),r.loadTextureEnabled(i,!1),r.loadColor(i,t.pickingMode?this.pickColor:this.activeAttributes.leaderLineAttributes.outlineColor),d.matrix.copy(t.navigatorState.modelviewProjection),r.loadModelviewProjection(i,d.matrix),this.activeAttributes.leaderLineAttributes.depthTest||i.disable(i.DEPTH_TEST),i.lineWidth(this.activeAttributes.leaderLineAttributes.outlineWidth),i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,this.leaderLinePoints,i.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.vertexAttribPointer(r.vertexPointLocation,3,i.FLOAT,!1,0,0),i.drawArrays(i.LINES,0,2)}this.activeAttributes.depthTest||(n=!1,i.disable(i.DEPTH_TEST)),i.bindBuffer(i.ARRAY_BUFFER,t.unitQuadBuffer3()),i.vertexAttribPointer(r.vertexPointLocation,3,i.FLOAT,!1,0,0),d.matrix.copy(t.screenProjection),d.matrix.multiplyMatrix(this.imageTransform);var a=this.imageRotationReference===WorldWind.RELATIVE_TO_GLOBE?t.navigatorState.heading-this.imageRotation:-this.imageRotation;d.matrix.multiplyByTranslation(.5,.5,0),d.matrix.multiplyByRotation(0,0,1,a),d.matrix.multiplyByTranslation(-.5,-.5,0);var l=this.imageTiltReference===WorldWind.RELATIVE_TO_GLOBE?t.navigatorState.tilt+this.imageTilt:this.imageTilt;d.matrix.multiplyByRotation(-1,0,0,l),r.loadModelviewProjection(i,d.matrix),r.loadTextureEnabled(i,!0),t.pickingMode?r.loadColor(i,this.pickColor):r.loadColor(i,this.activeAttributes.imageColor),this.texCoordMatrix.setToIdentity(),this.activeTexture&&this.texCoordMatrix.multiplyByTextureTransform(this.activeTexture),r.loadTextureMatrix(i,this.texCoordMatrix),this.activeTexture?(e=this.activeTexture.bind(t),r.loadTextureEnabled(i,e)):r.loadTextureEnabled(i,!1),i.drawArrays(i.TRIANGLE_STRIP,0,4),this.mustDrawLabel()&&this.currentVisibility>0&&(r.loadOpacity(i,t.pickingMode?1:this.layer.opacity*this.currentVisibility),d.matrix.copy(t.screenProjection),d.matrix.multiplyMatrix(this.labelTransform),r.loadModelviewProjection(i,d.matrix),!t.pickingMode&&this.labelTexture?(this.texCoordMatrix.setToIdentity(),this.texCoordMatrix.multiplyByTextureTransform(this.labelTexture),r.loadTextureMatrix(i,this.texCoordMatrix),r.loadColor(i,this.activeAttributes.labelAttributes.color),e=this.labelTexture.bind(t),r.loadTextureEnabled(i,e)):(r.loadTextureEnabled(i,!1),r.loadColor(i,this.pickColor)),this.activeAttributes.labelAttributes.depthTest?n||(n=!0,i.enable(i.DEPTH_TEST)):(n=!1,i.disable(i.DEPTH_TEST)),i.drawArrays(i.TRIANGLE_STRIP,0,4)),n||i.enable(i.DEPTH_TEST)},d.prototype.mustDrawLabel=function(){return this.label&&this.label.length>0&&this.activeAttributes.labelAttributes},d.prototype.mustDrawLeaderLine=function(t){return this.activeAttributes.drawLeaderLine&&this.activeAttributes.leaderLineAttributes&&(!t.pickingMode||this.enableLeaderLinePicking)},d}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=i(30);t.exports={create:function(t){function e(e){r.post(r.CREATE_GEO_JSON_OBJECT,{type:"Feature",geometry:e,properties:t.properties,id:t.id})}t.geometry.geometries.forEach(e)}}},function(t,e,i){function r(t,e){function i(i){function s(e){t.properties[e]&&(h[e]=t.properties[e])}var a=o.position(t.geometry.coordinates),l=new n(a,{dirPath:r.substring(0,r.lastIndexOf("/")+1)}),h=l.parse(i);h.scale=t.properties.scale||1,h.source=t,["xRotation","yRotation","zRotation"].forEach(s),e([h])}var r=t.properties.file,s=new XMLHttpRequest;s.open("get",r,!0),s.onload=function(){i(this.response)},s.onerror=function(t){console.error(t)},s.send()}var n=i(162),o=i(117);t.exports={create:r}},function(t,e,i){var r,n;r=[i(9),i(163),i(164),i(166),i(167),i(168),i(169),i(165),i(8)],n=function(t,e,i,r,n,o,s,a,l){"use strict";var h=function(e,i){if(!e)throw new t(l.logMessage(l.LEVEL_SEVERE,"ColladaLoader","constructor","missingPosition"));this.position=e,this.dirPath="/",this.init(i)};return h.prototype.init=function(t){t&&(this.dirPath=t.dirPath||"/"),this.scene={type:"SceneTree",dirPath:this.dirPath,images:{},metadata:{},materials:{},meshes:{},root:{children:[]}},this.xmlDoc=null},h.prototype.load=function(t,e){t.indexOf("://")===-1&&(t=this.dirPath+t),a.fetchFile(t,function(t){if(t)try{i=this.parse(t)}catch(t){i=null,l.log(l.LEVEL_SEVERE,"error parsing collada file: "+t)}else var i=null;e(i)}.bind(this))},h.prototype.parse=function(t){this.init();var i=new DOMParser;this.xmlDoc=i.parseFromString(t,"text/xml");var r=this.xmlDoc.querySelectorAll("library_nodes node"),n=this.xmlDoc.querySelectorAll("library_effects effect");return this.scene.metadata=new e(this.xmlDoc).parse(),this.parseLib("visual_scene",r),this.parseLib("library_geometries"),this.parseLib("library_materials",n),this.parseLib("library_images"),this.xmlDoc=null,new s(this.position,this.scene)},h.prototype.parseLib=function(t,e){var s=this.xmlDoc.getElementsByTagName(t),l=[];s&&s.length&&(l=s[0].childNodes);for(var h=0;h<l.length;h++){var c=l[h];if(1===c.nodeType)switch(c.nodeName){case"node":var u=(new o).parse(c,e);u&&this.scene.root.children.push(u);break;case"geometry":var d=c.getAttribute("id"),p=c.querySelector("mesh"),f=new n(d).parse(p);f&&(this.scene.meshes[d]=f);break;case"material":var g=c.getAttribute("id"),m=c.querySelector("instance_effect"),E=m.getAttribute("url").substr(1),v=a.querySelectorById(e,E),y=new r(g).parse(v);y&&(this.scene.materials[g]=y);break;case"image":var _=c.getAttribute("id"),T=c.getAttribute("name"),L=new i(_,T).parse(c);L&&(this.scene.images[_]=L)}}},h}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[],n=function(){"use strict";var t=function(t){this.xmlAsset=t.getElementsByTagName("asset")[0],this.asset={daeVersion:t.querySelector("COLLADA").getAttribute("version")}};return t.prototype.parse=function(){if(!this.xmlAsset)return null;for(var t=0;t<this.xmlAsset.childNodes.length;t++){var e=this.xmlAsset.childNodes.item(t);if(1===e.nodeType)switch(e.nodeName){case"contributor":var i=e.querySelector("authoring_tool");i&&(this.asset.authoring_tool=i.textContext);break;case"unit":this.asset.unit=e.getAttribute("meter");break;default:this.asset[e.localName]=e.textContent}}return this.xmlAsset=null,this.asset},t}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(165)],n=function(t){"use strict";var e=function(t,e){this.filename="",this.map=t,this.name=e,this.path=""};return e.prototype.parse=function(e){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"init_from":this.filename=t.getFilename(r.textContent),this.path=r.textContent}}return this},e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(8)],n=function(t){"use strict";var e={getRawValues:function(t){if(!t)return null;var e=t.textContent;return e=e.replace(/\n/gi," "),e=e.replace(/\s+/gi," "),e=e.trim(),0===e.length?null:e.split(" ")},bufferDataFloat32:function(t){var e=this.getRawValues(t);if(!e)return null;for(var i=e.length,r=new Float32Array(i),n=0;n<i;n++)r[n]=parseFloat(e[n]);return r},bufferDataUInt32:function(t){var e=this.getRawValues(t);if(!e)return null;for(var i=e.length,r=new Uint32Array(i),n=0;n<i;n++)r[n]=parseInt(e[n]);return r},getFirstChildElement:function(t,e){for(var i=t.childNodes,r=0;r<i.length;++r){var n=i.item(r);if(1===n.nodeType&&(n.nodeName&&!e||e&&e===n.nodeName))return n}return null},getFilename:function(t){var e=t.lastIndexOf("\\");return e!==-1&&(t=t.substr(e+1)),e=t.lastIndexOf("/"),e!==-1&&(t=t.substr(e+1)),t},replaceSpace:function(t){return t?t.replace(/ /g,"_"):""},querySelectorById:function(t,e){for(var i=0;i<t.length;i++){var r=t.item(i).getAttribute("id");if(r&&r.toString()===e)return t.item(i)}return null},getTextureType:function(t){for(var e=!0,i=0,r=t.length;i<r;i++)if(t[i]<0||t[i]>1){e=!1;break}return e},fetchFile:function(e,i){var r=new XMLHttpRequest;r.onload=function(){this.status>=200&&this.status<400?i(this.response):(t.log(t.LEVEL_SEVERE,"sever error: "+this.status),i(null))},r.onerror=function(e){t.log(t.LEVEL_SEVERE,"connection error: "+e),i(null)},r.open("get",e,!0),r.send()}};return e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(165)],n=function(t){"use strict";var e=function(t){this.id=t,this.newParams=[]};return e.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseProfileCommon(i)}}return this},e.prototype.parseProfileCommon=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1===i.nodeType)switch(i.nodeName){case"newparam":this.parseNewparam(i);break;case"image":break;case"technique":this.parseTechnique(i)}}},e.prototype.parseNewparam=function(t){for(var e=t.getAttribute("sid"),i=0;i<t.childNodes.length;i++){var r=t.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"surface":var n=r.querySelector("init_from");n&&this.newParams.push({sid:e,type:"surface",initFrom:n.textContent});break;case"sampler2D":var o=r.querySelector("source");this.newParams.push({sid:e,type:"sampler2D",source:o.textContent});break;case"extra":}}},e.prototype.parseTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.techniqueType=i.nodeName,this.parseTechniqueType(i);break;case"extra":}}},e.prototype.parseTechniqueType=function(e){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType&&r.nodeName){var n=r.nodeName,o=t.getFirstChildElement(r);if(o)switch(o.nodeName){case"color":this[n]=t.bufferDataFloat32(o).subarray(0,4);break;case"float":this[n]=t.bufferDataFloat32(o)[0];break;case"texture":var s=o.getAttribute("texture"),a=this.newParams.map(function(t){return t.sid}).indexOf(s),l=this.newParams[a].source;a=this.newParams.map(function(t){return t.sid}).indexOf(l);var h=this.newParams[a].initFrom;this.textures||(this.textures={}),this.textures[n]={mapId:h}}}}},e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(165)],n=function(t){"use strict";var e=function(t){this.filename=t||"",this.name=t||"",this.buffers=[]};return e.prototype.parse=function(e){for(var i={},r={},n={id:"",inputs:[]},o=0;o<e.childNodes.length;o++){var s=e.childNodes[o];if(1===s.nodeType)switch(s.nodeName){case"source":if(!s.querySelector)continue;var a=s.querySelector("float_array");if(!a)continue;var l=t.bufferDataFloat32(a),h=s.querySelector("accessor"),c=parseInt(h.getAttribute("stride"));i[s.getAttribute("id")]={stride:c,data:l};break;case"vertices":this.parseVertices(s,n);break;case"triangles":r=this.parsePolygons(s,i,n,3),this.buffers.push(r);break;case"polygons":r=this.parsePolygons(s,i,n,4),this.buffers.push(r);break;case"polylist":r=this.parsePolygons(s,i,n,null),this.buffers.push(r)}}return this},e.prototype.parseVertices=function(t,e){e.id=t.getAttribute("id");for(var i=t.querySelectorAll("input"),r=0;r<i.length;r++){var n=i[r],o=n.getAttribute("source").substr(1),s=n.getAttribute("semantic").toUpperCase();e.inputs.push({semantic:s,source:o})}},e.prototype.parsePolygons=function(t,e,i,r){var n=[];if(null==r){var o=t.querySelector("vcount");n=o.textContent.trim().split(" ")}var s=parseInt(t.getAttribute("count")),a=t.getAttribute("material"),l=this.parseInputs(t,e,i),h=l.inputs,c=l.maxOffset,u=t.querySelector("p"),d=[];u&&(d=u.textContent.trim().split(" "));for(var p=h.length,f=0,g={},m=[],E=0,v=!1,y=0;y<s;y++){if(n.length)var _=parseInt(n[y]);else _=r;for(var T=-1,L=-1,x=-1,b=0;b<_;b++){var S=d.slice(E,E+c).join(" ");if(x=L,g.hasOwnProperty(S))L=g[S],v=!0;else{for(var w=0;w<p;w++){var M=h[w],R=M[4],A=parseInt(d[E+R]),C=M[1],P=M[3];A*=M[2];for(var I=0;I<M[2];I++)C.push(P[A+I])}L=f,f+=1,g[S]=L}_>3&&(0===b&&(T=L),b>2*c&&(m.push(T),m.push(x))),m.push(L),E+=c}}var D={vertices:new Float32Array(h[0][1]),indexedRendering:v,material:a};return this.transformMeshInfo(D,h,m),D},e.prototype.parseInputs=function(t,e,i){for(var r=[],n=0,o=t.querySelectorAll("input"),s=0;s<o.length;s++){var a=o.item(s);if(a.getAttribute){var l=a.getAttribute("semantic").toUpperCase(),h=a.getAttribute("source").substr(1),c=parseInt(a.getAttribute("offset"));n=n<c+1?c+1:n;var u=0;if(a.getAttribute("set")&&(u=parseInt(a.getAttribute("set"))),i.id===h)for(var d=i.inputs,p=0;p<d.length;p++){var f=e[d[p].source];f&&r.push([d[p].semantic,[],f.stride,f.data,c,u])}else f=e[h],r.push([l,[],f.stride,f.data,c,u])}}return{inputs:r,maxOffset:n}},e.prototype.transformMeshInfo=function(e,i,r){for(var n={normal:"normals",texcoord:"uvs"},o=1;o<i.length;o++){var s=i[o][0].toLowerCase(),a=i[o][1];a.length&&(n[s]&&(s=n[s]),e[s]&&(s+=i[o][5]),e[s]=new Float32Array(a),"uvs"===s&&(e.isClamp=t.getTextureType(a)))}return e.indexedRendering&&(e.indices=new Uint16Array(r)),e},e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(165),i(36),i(11)],n=function(t,e,i){"use strict";var r=function(){this.id="",this.name="",this.sid="",this.children=[],this.materials=[],this.mesh="",this.localMatrix=e.fromIdentity(),this.worldMatrix=e.fromIdentity()};return r.prototype.parse=function(t,i,n){this.id=t.getAttribute("id"),this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.children=[],this.materials=[],this.mesh="",this.localMatrix=e.fromIdentity(),this.worldMatrix=e.fromIdentity(),this.setNodeTransforms(t,n);for(var o=0;o<t.childNodes.length;o++){var s=t.childNodes[o];if(1===s.nodeType)switch(s.nodeName){case"node":this.children.push((new r).parse(s,i,this.worldMatrix));break;case"instance_geometry":this.mesh=s.getAttribute("url").substr(1);for(var a=s.querySelectorAll("instance_material"),l=0;l<a.length;l++){var h=a.item(l);this.materials.push({id:h.getAttribute("target").substr(1),symbol:h.getAttribute("symbol")})}break;case"instance_node":var c=s.getAttribute("url").substr(1),u=this.getLibraryNode(i,c);u&&this.children.push((new r).parse(u,i,this.worldMatrix))}}return this},r.prototype.setNodeTransforms=function(r,n){var o=e.fromIdentity(),s=e.fromIdentity(),a=e.fromIdentity(),l=e.fromIdentity();n||(n=e.fromIdentity());for(var h=[],c=0;c<r.childNodes.length;c++){var u=r.childNodes[c];if(1===u.nodeType)switch(u.nodeName){case"matrix":var d=t.bufferDataFloat32(u);o.copy(d),h.push(o);break;case"rotate":d=t.bufferDataFloat32(u),s.multiplyByRotation(d[0],d[1],d[2],d[3]),h.push(s);break;case"translate":d=t.bufferDataFloat32(u),a.multiplyByTranslation(d[0],d[1],d[2]),h.push(a);break;case"scale":d=t.bufferDataFloat32(u),l.multiplyByScale(d[0],d[1],d[2]),h.push(l)}}for(c=0;c<h.length;c++)this.localMatrix.multiplyMatrix(h[c]);this.worldMatrix.setToMultiply(n,this.localMatrix),this.normalMatrix=e.fromIdentity();var p=new i(0,0,0);this.worldMatrix.extractRotationAngles(p),this.normalMatrix.multiplyByRotation(-1,0,0,p[0]),this.normalMatrix.multiplyByRotation(0,-1,0,p[1]),
this.normalMatrix.multiplyByRotation(0,0,-1,p[2])},r.prototype.getLibraryNode=function(t,e){for(var i=0;i<t.length;i++){var r=t[i].attributes.getNamedItem("id");if(r&&r.value===e)return t[i]}return null},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(102),i(23),i(8),i(36),i(12),i(60),i(103),i(11)],n=function(t,e,i,r,n,o,s,a,l){"use strict";var h=function(e,i){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"ColladaScene","constructor","missingPosition"));a.call(this),this._position=e,this._nodes=[],this._meshes={},this._materials={},this._images={},this._upAxis="",this._dirPath="",this._xRotation=0,this._yRotation=0,this._zRotation=0,this._xTranslation=0,this._yTranslation=0,this._zTranslation=0,this._scale=1,this._altitudeMode=WorldWind.ABSOLUTE,this._localTransforms=!0,this._useTexturePaths=!0,this._nodesToHide=[],this._hideNodes=!1,this.setSceneData(i),this._placePoint=new l(0,0,0),this._transformationMatrix=n.fromIdentity(),this._normalMatrix=n.fromIdentity(),this._texCoordMatrix=n.fromIdentity().setToUnitYFlip(),this._activeTexture=null};return h.prototype=Object.create(a.prototype),h.prototype.constructor=h,Object.defineProperties(h.prototype,{position:{get:function(){return this._position},set:function(t){this._position=t}},nodes:{get:function(){return this._nodes},set:function(t){this._nodes=t}},meshes:{get:function(){return this._meshes},set:function(t){this._meshes=t}},materials:{get:function(){return this._materials},set:function(t){this._materials=t}},images:{get:function(){return this._images},set:function(t){this._images=t}},upAxis:{get:function(){return this._upAxis},set:function(t){this._upAxis=t}},dirPath:{get:function(){return this._dirPath},set:function(t){this._dirPath=t}},xRotation:{get:function(){return this._xRotation},set:function(t){this._xRotation=t}},yRotation:{get:function(){return this._yRotation},set:function(t){this._yRotation=t}},zRotation:{get:function(){return this._zRotation},set:function(t){this._zRotation=t}},xTranslation:{get:function(){return this._xTranslation},set:function(t){this._xTranslation=t}},yTranslation:{get:function(){return this._yTranslation},set:function(t){this._yTranslation=t}},zTranslation:{get:function(){return this._zTranslation},set:function(t){this._zTranslation=t}},scale:{get:function(){return this._scale},set:function(t){this._scale=t}},placePoint:{get:function(){return this._placePoint},set:function(t){this._placePoint=t}},altitudeMode:{get:function(){return this._altitudeMode},set:function(t){this._altitudeMode=t}},transformationMatrix:{get:function(){return this._transformationMatrix},set:function(t){this._transformationMatrix=t}},normalMatrix:{get:function(){return this._normalMatrix},set:function(t){this._normalMatrix=t}},localTransforms:{get:function(){return this._localTransforms},set:function(t){this._localTransforms=t}},useTexturePaths:{get:function(){return this._useTexturePaths},set:function(t){this._useTexturePaths=t}},nodesToHide:{get:function(){return this._nodesToHide},set:function(t){this._nodesToHide=t}},hideNodes:{get:function(){return this._hideNodes},set:function(t){this._hideNodes=t}}}),h.prototype.setSceneData=function(t){t&&(this.nodes=t.root.children,this.meshes=t.meshes,this.materials=t.materials,this.images=t.images,this.upAxis=t.metadata.up_axis,this.dirPath=t.dirPath)},h.prototype.render=function(t){var e;this.enabled&&(this.lastFrameTime!==t.timestamp&&(e=this.makeOrderedRenderable(t)),e&&(e.layer=t.currentLayer,this.lastFrameTime=t.timestamp,t.addOrderedRenderable(e)))},h.prototype.makeOrderedRenderable=function(t){return t.surfacePointForMode(this.position.latitude,this.position.longitude,this.position.altitude,this.altitudeMode,this.placePoint),this.eyeDistance=t.navigatorState.eyePoint.distanceTo(this.placePoint),this},h.prototype.renderOrdered=function(t){if(this.drawOrderedScene(t),t.pickingMode){var e=new s(this.pickColor.clone(),this,this.position,this.layer,!1);t.resolvePick(e)}},h.prototype.drawOrderedScene=function(t){this.beginDrawing(t);try{this.doDrawOrderedScene(t)}finally{this.endDrawing(t)}},h.prototype.beginDrawing=function(t){var i=t.currentGlContext;t.findAndBindProgram(e),i.enable(i.CULL_FACE),i.enable(i.DEPTH_TEST)},h.prototype.doDrawOrderedScene=function(t){t.pickingMode&&(this.pickColor=t.uniquePickColor()),this.computeTransformationMatrix(t.globe);for(var e=0,i=this.nodes.length;e<i;e++)this.traverseNodeTree(t,this.nodes[e])},h.prototype.traverseNodeTree=function(t,e){var i=this.mustRenderNode(e.id);if(i){if(e.mesh)for(var r=e.mesh,n=this.meshes[r].buffers,o=0,s=n.length;o<s;o++){for(var a=n[o].material,l=0;l<e.materials.length;l++)if(a===e.materials[l].symbol){var h=e.materials[l].id;break}var c=this.materials[h];this.draw(t,n[o],c,e.worldMatrix,e.normalMatrix)}for(var u=0;u<e.children.length;u++)this.traverseNodeTree(t,e.children[u])}},h.prototype.draw=function(t,e,i,r,n){var o=t.currentGlContext,s=t.currentProgram;this.applyVertices(t,e),s.loadTextureEnabled(o,!1),this.applyColor(t,i);var a=i&&null!=i.textures&&e.uvs&&e.uvs.length>0;a&&this.applyTexture(t,e,i);var l=null!=e.normals&&e.normals.length>0;l&&!t.pickingMode&&this.applyLighting(t,e),this.applyMatrix(t,l,a,r,n),e.indexedRendering?(this.applyIndices(t,e),o.drawElements(o.TRIANGLES,e.indices.length,o.UNSIGNED_SHORT,0)):o.drawArrays(o.TRIANGLES,0,Math.floor(e.vertices.length/3)),this.resetDraw(t,l,a)},h.prototype.applyVertices=function(t,e){var i,r=t.currentGlContext,n=t.currentProgram;e.verticesVboCacheKey||(e.verticesVboCacheKey=t.gpuResourceCache.generateCacheKey()),i=t.gpuResourceCache.resourceForKey(e.verticesVboCacheKey),i||(i=r.createBuffer(),t.gpuResourceCache.putResource(e.verticesVboCacheKey,i,e.vertices.length),e.refreshVertexBuffer=!0),r.bindBuffer(r.ARRAY_BUFFER,i),e.refreshVertexBuffer&&(r.bufferData(r.ARRAY_BUFFER,e.vertices,r.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),e.refreshVertexBuffer=!1),r.enableVertexAttribArray(n.vertexPointLocation),r.vertexAttribPointer(n.vertexPointLocation,3,r.FLOAT,!1,0,0)},h.prototype.applyColor=function(t,e){var r=t.currentGlContext,n=t.currentProgram;if(e)if("constant"===e.techniqueType)var o=e.reflective;else o=e.diffuse;var s,a=1,l=1,h=1,c=1;o&&(a=o[0],l=o[1],h=o[2],c=null!=o[3]?o[3]:1);var u=new i(a,l,h,c);s=c*t.currentLayer.opacity,r.depthMask(s>=1||t.pickingMode),n.loadColor(r,t.pickingMode?this.pickColor:u),n.loadOpacity(r,t.pickingMode?s>0?1:0:s)},h.prototype.applyTexture=function(t,e,i){var r,n,o,s=t.currentGlContext,a=t.currentProgram;if(i.textures.diffuse)var l=i.textures.diffuse.mapId;else l=i.textures.reflective.mapId;var h=this.useTexturePaths?this.images[l].path:this.images[l].filename;this._activeTexture=t.gpuResourceCache.resourceForKey(this.dirPath+h+""),this._activeTexture||(o=e.isClamp?s.CLAMP_TO_EDGE:s.REPEAT,this._activeTexture=t.gpuResourceCache.retrieveTexture(s,this.dirPath+h+"",o)),r=this._activeTexture&&this._activeTexture.bind(t),r&&(e.texCoordsVboCacheKey||(e.texCoordsVboCacheKey=t.gpuResourceCache.generateCacheKey()),n=t.gpuResourceCache.resourceForKey(e.texCoordsVboCacheKey),n||(n=s.createBuffer(),t.gpuResourceCache.putResource(e.texCoordsVboCacheKey,n,e.uvs.length),e.refreshTexCoordBuffer=!0),s.bindBuffer(s.ARRAY_BUFFER,n),e.refreshTexCoordBuffer&&(s.bufferData(s.ARRAY_BUFFER,e.uvs,s.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),e.refreshTexCoordBuffer=!1),a.loadTextureEnabled(s,!0),s.enableVertexAttribArray(a.vertexTexCoordLocation),s.vertexAttribPointer(a.vertexTexCoordLocation,2,s.FLOAT,!1,0,0),a.loadTextureUnit(s,s.TEXTURE0),a.loadModulateColor(s,t.pickingMode))},h.prototype.applyLighting=function(t,e){var i,r=t.currentGlContext,n=t.currentProgram;n.loadApplyLighting(r,!0),e.normalsVboCacheKey||(e.normalsVboCacheKey=t.gpuResourceCache.generateCacheKey()),i=t.gpuResourceCache.resourceForKey(e.normalsVboCacheKey),i||(i=r.createBuffer(),t.gpuResourceCache.putResource(e.normalsVboCacheKey,i,e.normals.length),e.refreshNormalBuffer=!0),r.bindBuffer(r.ARRAY_BUFFER,i),e.refreshNormalBuffer&&(r.bufferData(r.ARRAY_BUFFER,e.normals,r.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),e.refreshNormalBuffer=!1),r.enableVertexAttribArray(n.normalVectorLocation),r.vertexAttribPointer(n.normalVectorLocation,3,r.FLOAT,!1,0,0)},h.prototype.applyMatrix=function(t,e,i,r,o){var s=n.fromIdentity();if(s.copy(t.navigatorState.modelviewProjection),s.multiplyMatrix(this.transformationMatrix),r&&this.localTransforms&&s.multiplyMatrix(r),e&&!t.pickingMode){var a=n.fromIdentity();a.copy(t.navigatorState.modelviewNormalTransform),a.multiplyMatrix(this.normalMatrix),o&&this.localTransforms&&a.multiplyMatrix(o),t.currentProgram.loadModelviewInverse(t.currentGlContext,a)}i&&this._activeTexture&&(t.currentProgram.loadTextureMatrix(t.currentGlContext,this._texCoordMatrix),this._activeTexture=null),t.currentProgram.loadModelviewProjection(t.currentGlContext,s)},h.prototype.applyIndices=function(t,e){var i,r=t.currentGlContext;e.indicesVboCacheKey||(e.indicesVboCacheKey=t.gpuResourceCache.generateCacheKey()),i=t.gpuResourceCache.resourceForKey(e.indicesVboCacheKey),i||(i=r.createBuffer(),t.gpuResourceCache.putResource(e.indicesVboCacheKey,i,e.indices.length),e.refreshIndicesBuffer=!0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i),e.refreshIndicesBuffer&&(r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.indices,r.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),e.refreshIndicesBuffer=!1)},h.prototype.resetDraw=function(t,e,i){var r=t.currentGlContext,n=t.currentProgram;e&&!t.pickingMode&&(n.loadApplyLighting(r,!1),r.disableVertexAttribArray(n.normalVectorLocation)),i&&r.disableVertexAttribArray(n.vertexTexCoordLocation),r.disableVertexAttribArray(n.vertexPointLocation)},h.prototype.endDrawing=function(t){t.bindProgram(null)},h.prototype.computeTransformationMatrix=function(t){this.transformationMatrix=n.fromIdentity(),this.transformationMatrix.multiplyByLocalCoordinateTransform(this.placePoint,t),this.transformationMatrix.multiplyByRotation(1,0,0,this.xRotation),this.transformationMatrix.multiplyByRotation(0,1,0,this.yRotation),this.transformationMatrix.multiplyByRotation(0,0,1,this.zRotation),this.transformationMatrix.multiplyByScale(this.scale,this.scale,this.scale),this.transformationMatrix.multiplyByTranslation(this.xTranslation,this.yTranslation,this.zTranslation),this.computeNormalMatrix()},h.prototype.computeNormalMatrix=function(){var t=new l(0,0,0);this.transformationMatrix.extractRotationAngles(t),this.normalMatrix=n.fromIdentity(),this.normalMatrix.multiplyByRotation(-1,0,0,t[0]),this.normalMatrix.multiplyByRotation(0,-1,0,t[1]),this.normalMatrix.multiplyByRotation(0,0,-1,t[2])},h.prototype.mustRenderNode=function(t){var e=!0;if(this.hideNodes){var i=this.nodesToHide.indexOf(t);e=i===-1}return e},h}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){function r(t,e){function i(e){m.clearRect(0,0,g,g),t.geometry.geometries.forEach(function(t){var i=t.properties,n=t.coordinates;if("Point"===t.type)return m.textAlign="center",m.fillStyle=e?"white":"#"+i.color.substring(0,6),m.font=Math.floor(i.fontSize*y)+"px "+i.fontName,m.textBaseline="middle",void m.fillText(i.text,r(n,0),r(n,1));m.beginPath(),"Polygon"===t.type&&(n=n[0]);var o=n[0];m.moveTo(r(o,0),r(o,1)),n.forEach(function(t,e){e&&m.lineTo(r(t,0),r(t,1))}),"LineString"===t.type&&(m.lineWidth=i.widthMultiplier,m.strokeStyle=e?"white":"#"+i.stroke.substring(0,6),m.stroke()),"Polygon"===t.type&&(m.fillStyle=e?"white":"#"+i.fill.substring(0,6),m.fill()),m.closePath()})}function r(t,e){var i=E+y*(t[e]-v.min[e]);return 1===e?g-i:i}function o(){return new l(m.getImageData(0,0,g,g))}var f=t.properties,g=f.quality||100;p.setAttribute("width",g),p.setAttribute("height",g);var m=p.getContext("2d"),E=f.padding||2,v=t.geometry.properties.bbox,y=(g-2*E)/s(v),_=d.position(f.anchorPoint.coordinates),T=new h(_,!1,null);T.source=t;var L=f.offsetX||0,x=f.offsetY||0,b=WorldWind.OFFSET_FRACTION,S=((L-v.min[0])*y+E)/g,w=(x*y+E)/g,M=f.scale||1;T.attributes=new a({_imageColor:d.extractColor(f,null,1),_depthTest:f.depth!==!1,_imageOffset:new c(b,S,b,w)}),i(!1),T.attributes._imageSource=o(),i(!0),T.attributes._whiteImageSource=o(),T.highlightAttributes=new a(T.attributes),T.highlightAttributes.imageColor=d.extractColor(f,null,1),T.enabled=f.visible!==!1,T.altitudeMode=f.altitudeMode||WorldWind.RELATIVE_TO_GROUND,T.attributes.imageScale=0;var R=T.mustDrawLabel;T.mustDrawLabel=function(){T.activeAttributes.imageScale=n(T)*M,R.call(T)},e([T]),setTimeout(function(){u.post(u.REDRAW)},100)}function n(t){var e=t.source.properties.generalization.scales,i=t.eyeDistance,r=e[0],n=e[e.length-1];e.forEach(function(t){t.scale<i&&t.scale>r.scale&&(r=t),t.scale>i&&t.scale<n.scale&&(n=t)});var s=(t.eyeDistance-r.scale)/(n.scale-r.scale);return o(s===1/0?1:s,r.ratio,n.ratio)}function o(t,e,i){return(1-t)*e+t*i}function s(t){return Math.max(t.max[0]-t.min[0],t.max[1]-t.min[1])}var a=i(155),l=i(22),h=i(159),c=i(6),u=i(30),d=i(117),p=document.createElement("canvas");t.exports={create:r}},function(t,e,i){var r=i(30),n=i(12),o=i(117),s=i(93);t.exports=function(t){function e(e){var i=t.canvasCoordinates(e.clientX,e.clientY),r=t.pickTerrain(i);if(r.objects.length){var o=r.objects[0].position,s=t.navigator.currentState().eyePoint,l=t.globe.computePositionFromPoint(s[0],s[1],s[2],new n);a({lat:o.latitude,lon:o.longitude,alt:l.altitude/3})}}function i(e){var i=o.location(e);t.navigator.lookAtLocation.longitude=i.longitude,t.navigator.lookAtLocation.latitude=i.latitude,r.post(r.REDRAW)}function a(t){l(!0),h.goTo(t.alt?o.position(t):o.location(t),l.bind(this,!1))}function l(t){r.post(r._BLOCK_NAVIGATOR_EVENTS_LISTENERS,t)}var h=new s(t);h.animationFrequency=10,h.travelTime=1e3,t.canvas.addEventListener("dblclick",e),r.listen(r.ROTATE_TO,a),r.listen(r.SET_LOCATION,i)}},function(t,e,i){function r(t){t.globe=t.globe===p?f:p,n.post(n.REDRAW)}var n=i(30),o=i(86),s=i(86),a=(i(83),i(92)),l=i(79),h=i(81),c=new a;engine.zeroElevationModel=c;var u={mercator:new l,equirectangular:new h},d="equirectangular",p=new o(c,null),f=new s(c,u.mercator);engine.globe3d=p,t.exports=function(t){r(t),n.listen(n.SWITCH_GLOBE,function(){r(t)}),n.listen(n.SWITCH_2D_PROJECTION,function(t){if(!t){var e=Object.keys(u),i=e.indexOf(d)+1;t=e[i===e.length?0:i]}d=t,f.projection=u[t],n.post(n.REDRAW)}),n.listen(n._CHANGE_ELEVATION_MODEL,function(t){p.elevationModel=t})}},function(t,e,i){var r=i(30),n=i(174),o=i(178),s=(i(179),i(181)),a=i(190),l=i(187),h=i(70),c=i(71),u=(i(86),i(92),i(83),i(192),i(194)),d=i(196),p=i(197),f=i(205),g=i(206);l.prototype.getNamedLayer=function(t){if(!t||0===t.length)throw new ArgumentError(Logger.logMessage(Logger.LEVEL_SEVERE,"WmsCapabilities","getNamedLayer","No WMS layer name provided."));for(var e=this.getNamedLayers(),i=0,r=e.length;i<r;i++)if(t===e[i].name)return e[i];return null},l.prototype.getNamedLayers=function(){return this.accumulateNamedLayers(this.capability.layers)},l.prototype.accumulateNamedLayers=function(t,e){var i=e||[];if(!t)return i;for(var r=0,n=t.length;r<n;r++){var o=t[r];o.name&&i.push(o),o.layers&&this.accumulateNamedLayers(o.layers,i)}return i};var m={DEFAULT_TILE_URL:"tiles/worldmap/z{z}/{y}/{x}.png",DEFAULT_GROUND_PATH:"images/ground/worldmap.2048x1024.jpg",DEFAULT_WMS_GET_MAP:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},DEFAULT_WMTS_GET_CAPABILITIES:{SERVICE:"WMTS",REQUEST:"GetCapabilities",VERSION:"1.0.0"},DEFAULT_WMS_GET_CAPABILITIES:{SERVICE:"WMS",REQUEST:"GetCapabilities",VERSION:"1.0.0"}},E=function(){this.getParamString=function(t,e){var i=[];for(var r in t)t.hasOwnProperty(r)&&i.push(r+"="+t[r]);return(e&&e.indexOf("?")!==-1?"&":"?")+i.join("&")},this.guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},this.extend=function(t){var e,i,r,n,o=Array.prototype.slice.call(arguments,1);for(i=0,r=o.length;i<r;i++){n=o[i]||{};for(e in n)n.hasOwnProperty(e)&&(t[e]=n[e])}return t}};E.prototype.createTileMapLayer=function(t){var e=this;t=t||{},t.patternUrl||(t.patternUrl=m.DEFAULT_TILE_URL),t.name||(t.name="map"+e.guid());var i=new n(t);return t.detail&&t.detail>=1&&t.detail<=2.2&&(i.detailControl=t.detail),i},E.prototype.getWMTSCapabilities=function(t,e){var i=this,r=t.patternUrl+i.getParamString(t.params,t.patternUrl),n=new XMLHttpRequest;if(n.open("GET",r,!1),n.send(),200!=n.status){var o=n.status+": "+n.statusText;e&&e(o)}else{var a=new DOMParser,l=a.parseFromString(n.responseText,"text/xml"),h=new s(l);e&&e(h)}},E.prototype.getWMSCapabilities=function(t,e){var i=this,r=t.patternUrl+i.getParamString(t.params,t.patternUrl);t.proxy&&(r=t.proxy+r);var n=new XMLHttpRequest;if(n.open("GET",r,!1),n.send(),200!=n.status){var o=n.status+": "+n.statusText;e&&e(o)}else{var s=new DOMParser,a=s.parseFromString(n.responseText,"text/xml"),h=new l(a);e&&e(h)}},E.prototype.createGroundMapLayer=function(t){return t=t||{},t.ground||(t.ground=m.DEFAULT_GROUND_PATH),new o(t.ground)},t.exports=function(t){function e(){y&&(r.post(r._REMOVE_LAYER,y),r.post(r.REDRAW))}function i(){_&&r.post(r._REMOVE_LAYER,_),L&&(L.forEach(function(t,e,i){r.post(r._REMOVE_LAYER,t)}),L=[]),r.post(r.REDRAW)}function n(t,e){var t=t||{},i=e||[],n=[];if(t.patternUrl){t.params||(t.params=m.DEFAULT_WMS_GET_CAPABILITIES),t.layers&&Array.isArray(t.layers)&&(n=t.layers);var o=function(e){if(null!=e&&e.capability){var o=e.getNamedLayers();if(null!=o&&o.length>0){for(var s=0;s<o.length-1;s++){var l=a.formLayerConfiguration(o[s]);t.proxy&&(l.proxy=t.proxy);var h=new g(l);i.push(h)}r.post(r.GET_OGC_LAYERS,{requestType:"wms",visibleIndices:n,layers:i})}}};T.getWMSCapabilities(t,o)}}function o(t,e){var i=e||[],t=t||{},n=[];if(t.patternUrl){t.params||(t.params=m.DEFAULT_WMTS_GET_CAPABILITIES),t.layers&&Array.isArray(t.layers)&&(n=t.layers);var o=function(t){if(null!=t&&t.contents){for(var e=t.contents.layer,o=0;o<e.length;o++){var s=t.contents.layer[o],a=new f(s);i.push(a)}r.post(r.GET_OGC_LAYERS,{requestType:"wmts",visibleIndices:n,layers:i})}};T.getWMTSCapabilities(t,o)}}function s(t){t&&(r.post(r._CREATE_GROUND_MAP_LAYER,t),t.type&&"tile"!==t.type?"wmts"===t.type?r.post(r._CREATE_WMTS_MAP_LAYER,t):"wms"===t.type&&r.post(r._CREATE_WMS_MAP_LAYER,t):r.post(r._CREATE_TILE_MAP_LAYER,t))}function l(e){if(e.type&&"none"!==e.type){if(e.url)if("rest"===e.type){var i="elev"+T.guid(),n="elevation/DTED0";t.globe3d.elevationModel=new u(null,n,i)}else t.globe3d.elevationModel=new d(e)}else t.globe3d.elevationModel=t.zeroElevationModel;r.post(r.REDRAW)}function v(t){t&&t.visibleIndices&&Array.isArray(t.visibleIndices)&&t.visibleIndices.forEach(function(e,i,n){"number"==typeof e&&Array.isArray(t.layers)&&e>=0&&e<t.layers.length&&r.post(r._INSERT_LAYER,{index:i+1,layer:t.layers[e]})})}var y,_,T=new E,L=[];r.listen(r._DESTROY_GROUND_MAP_LAYER,e),r.listen(r._CREATE_GROUND_MAP_LAYER,function(t){e(),y=T.createGroundMapLayer(t),r.post(r._INSERT_LAYER,{index:0,layer:y}),r.post(r.REDRAW)}),r.listen(r._DESTROY_MAP_LAYER,i),r.listen(r._CREATE_WMS_MAP_LAYER,function(t){i(),n(t,L)}),r.listen(r._CREATE_WMTS_MAP_LAYER,function(t){i(),o(t,L)}),r.listen(r._CREATE_TILE_MAP_LAYER,function(t){i(),_=T.createTileMapLayer(t),r.post(r._INSERT_LAYER,{index:1,layer:_}),r.post(r.REDRAW)}),r.listen(r.CHANGE_MAP,s),r.listen(r.GET_OGC_LAYERS,v),r.listen(r.CHANGE_ELEVATION_MODEL,l),h.prototype.loadElevationImage=function(t,e){var i=new c(t.imagePath,t.sector,t.tileWidth,t.tileHeight);if("image/tiff"==this.retrievalImageFormat){var r=new p("0");r.parse(e.response);var n=r.createTypedElevationArray();i.imageData=n,i.size=i.imageData.length}else"application/bil16"==this.retrievalImageFormat?(i.imageData=new Int16Array(e.response),i.size=2*i.imageData.length):"application/bil32"==this.retrievalImageFormat&&(i.imageData=new Float32Array(e.response),i.size=4*i.imageData.length);i.imageData&&(i.findMinAndMaxElevation(),this.imageCache.putEntry(t.imagePath,i,i.size),this.timestamp=Date.now())}}},function(t,e,i){var r=i(175),n=(i(23),i(14)),o=i(48),s=i(30),a=85.05,l=function(t){function e(t,e,i,r){return c(r,{x:e,y:i,z:t,s:u(e,i),q:d(e,i,t)})}function i(t){var e,i,r,n,o=Array.prototype.slice.call(arguments,1);for(i=0,r=o.length;i<r;i++){n=o[i]||{};for(e in n)n.hasOwnProperty(e)&&(t[e]=n[e])}return t}function l(t,e){return t.options=i({},t.options,e),t.options}var h=this;this.emptyImageUrl="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",this.options={minZoom:0,maxZoom:18,tileSize:256,subdomains:"123",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,suffix:"jpg",name:"tileLayer"},this.tileLoadingLimit=15,this.tileLoadingIsBlocked=!1,this.options=l(this,t),this.imageSize=this.options.tileSize,r.call(this,new o(-a,a,-180,180),new n(a,180),this.options.maxZoom,"image/"+this.options.suffix,this.options.name,this.options.tileSize,this.options.tileSize),this.displayName="HttpTiledImageLayer",this.urlBuilder={urlForTile:function(t){return e(t.level.levelNumber+1,t.column,t.row,h.options.patternUrl)}};var c=function(t,e){return t.replace(/\{ *([\w_]+) *\}/g,function(t,i){var r=e[i];if(!e.hasOwnProperty(i))throw new Error("No value provided for variable "+t);return r})},u=function(t,e){var i=(t+e)%h.options.subdomains.length;return h.options.subdomains[i]},d=function(t,e,i){for(var r=[],n=i;n>0;n--){var o="0",s=1<<n-1;0!=(t&s)&&o++,0!=(e&s)&&(o++,o++),r.push(o)}return r.join("")};this.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},this.splitWords=function(t){return t.replace(/^\s+|\s+$/g,"").split(/\s+/)},this.quadKey=function(t){var e,i,r=t[0],n=new Array(r),o=1<<r-1;for(e=0;e<r;++e)i=48,t[1]&o&&(i+=1),t[2]&o&&(i+=2),n[e]=String.fromCharCode(i),o>>=1;return n.join("")},s.listen(s._BLOCK_TILE_LOADING,this.blockTileLoading.bind(this))};l.prototype=Object.create(r.prototype),l.prototype.getEmptyImageUrl=function(){return this.emptyImageUrl},l.prototype.doRender=function(t){r.prototype.doRender.call(this,t),this.inCurrentFrame},l.prototype.createTopLevelTiles=function(t){var e=this;e.topLevelTiles=[[0,0],[0,1],[1,0],[1,1]].map(function(t){return e.createTile(null,e.levels.firstLevel(),t[0],t[1])})},l.prototype.mapSizeForLevel=function(t){return 256<<t+1},t.exports=l,l.prototype.removeFromCurrentRetrievals=function(t){r.prototype.removeFromCurrentRetrievals.call(this,t),s.post(s.WAIT,this.currentRetrievals.length)},l.prototype.blockTileLoading=function(){this.tileLoadingIsBlocked=!0,this.unblockTileLoadingTimeout&&clearTimeout(this.unblockTileLoadingTimeout),this.unblockTileLoadingTimeout=setTimeout(this.unblockTileLoading.bind(this),300)},l.prototype.unblockTileLoading=function(){this.tileLoadingIsBlocked=!1,this.refresh(),s.post(s.REDRAW)},l.prototype.canLoadNextTile=function(){return this.currentRetrievals.length<this.tileLoadingLimit&&!this.tileLoadingIsBlocked},l.prototype.retrieveTileImage=function(t,e,i){this.canLoadNextTile()&&(s.post(s.WAIT,!0),r.prototype.retrieveTileImage.call(this,t,e,i))}},function(t,e,i){var r,n;r=[i(23),i(48),i(176),i(7),i(17)],n=function(t,e,i,r,n){"use strict";var o=function(t,e,n,o,s,a,l){i.call(this,t,e,n,o,s,a,l),this.detectBlankImages=!1,this.testPixels=[new r(20,20),new r(235,20),new r(20,235),new r(235,235)],this.destCanvas=document.createElement("canvas"),this.destContext=this.destCanvas.getContext("2d")};return o.prototype=Object.create(i.prototype),o.prototype.createTile=function(t,r,o,s){var a,l,h,c,u,d,p=this.mapSizeForLevel(r.levelNumber),f=n.clamp(s*this.imageSize,0,p),g=n.clamp(o*this.imageSize,0,p),m=n.clamp(f+this.imageSize,0,p),E=n.clamp(g+this.imageSize,0,p);return a=f/p-.5,l=.5-E/p,h=90-360*Math.atan(Math.exp(2*-l*Math.PI))/Math.PI,c=360*a,a=m/p-.5,l=.5-g/p,u=90-360*Math.atan(Math.exp(2*-l*Math.PI))/Math.PI,d=360*a,t=new e(h,u,c,d),i.prototype.createTile.call(this,t,r,o,s)},o.prototype.createTexture=function(t,e,r){var o,s,a,l,h,c,u,d,p=t.canvas2D,f=t.ctx2D,g=this.destCanvas,m=this.destContext,E=m.createImageData(r.width,r.height),v=e.sector,y=n.gudermannianInverse(v.minLatitude),_=n.gudermannianInverse(v.maxLatitude);if(p.width=r.width,p.height=r.height,g.width=r.width,g.height=r.height,f.drawImage(r,0,0,r.width,r.height),o=f.getImageData(0,0,r.width,r.height),this.detectBlankImages&&this.isBlankImage(r,o))return this.absentResourceList.markResourceAbsentPermanently(e.imagePath),null;for(var T=0;T<1;T++)for(var L=0;L<r.height;L++){u=1-L/(r.height-1),s=u*v.deltaLatitude()+v.minLatitude,a=n.gudermannianInverse(s),d=1-(a-y)/(_-y),d=n.clamp(d,0,1),l=Math.floor(d*(r.height-1));for(var x=0;x<r.width;x++)h=4*(x+l*r.width),c=4*(x+L*r.width),E.data[c]=o.data[h],E.data[c+1]=o.data[h+1],E.data[c+2]=o.data[h+2],E.data[c+3]=o.data[h+3]}return m.putImageData(E,0,0),i.prototype.createTexture.call(this,t,e,g)},o.prototype.isBlankImage=function(t,e){for(var i,r,n=null,o=0,s=this.testPixels.length;o<s;o++)if(i=this.testPixels[o],r=4*(i[0]+i[1]*t.width),n){if(e.data[r]!=n[0]||e.data[r+1]!=n[1]||e.data[r+2]!=n[2])return!1}else n=[e.data[r],e.data[r+1],e.data[r+2]];return!0},o}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(21),i(9),i(177),i(99),i(73),i(8),i(24),i(25),i(50),i(56)],n=function(t,e,i,r,n,o,s,a,l,h){"use strict";var c=function(i,a,l,h,c,u,d){if(!i)throw new e(o.logMessage(o.LEVEL_SEVERE,"TiledImageLayer","constructor","missingSector"));if(!a)throw new e(o.logMessage(o.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified level-zero delta is null or undefined."));if(!h)throw new e(o.logMessage(o.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified image format is null or undefined."));if(!c)throw new e(o.logMessage(o.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified cache path is null or undefined."));if(!l||l<1)throw new e(o.logMessage(o.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified number of levels is less than one."));if(!u||!d||u<1||d<1)throw new e(o.logMessage(o.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified tile width or height is less than one."));r.call(this,"Tiled Image Layer"),this.retrievalImageFormat=h,this.cachePath=c,this.levels=new n(i,a,l,u,d),this.detailControl=1.75,this.expiration=null,this.currentTiles=[],this.currentTilesInvalid=!0,this.tileCache=new s(5e5,4e5),this.currentRetrievals=[],this.absentResourceList=new t(3,5e4),this.pickEnabled=!1};return c.prototype=Object.create(r.prototype),c.prototype.refresh=function(){this.expiration=new Date,this.currentTilesInvalid=!0},c.prototype.prePopulate=function(t){if(!t)throw new e(o.logMessage(o.LEVEL_SEVERE,"TiledImageLayer","prePopulate","missingWorldWindow"));var i=t.drawContext;this.topLevelTiles&&0!==this.topLevelTiles.length||this.createTopLevelTiles(i);for(var r=0;r<this.topLevelTiles.length;r++){var n=this.topLevelTiles[r];this.isTileTextureInMemory(i,n)||this.retrieveTileImage(i,n,!0)}},c.prototype.prePopulateCurrentTiles=function(t){if(!t)throw new e(o.logMessage(o.LEVEL_SEVERE,"TiledImageLayer","prePopulate","missingWorldWindow"));var i=t.drawContext;this.assembleTiles(i);for(var r=0,n=this.currentTiles.length;r<n;r++){var s=this.currentTiles[r];this.isTileTextureInMemory(i,s)||this.retrieveTileImage(i,s,!0)}},c.prototype.isPrePopulated=function(t){if(!t)throw new e(o.logMessage(o.LEVEL_SEVERE,"TiledImageLayer","isPrePopulated","missingWorldWindow"));for(var i=0;i<this.topLevelTiles.length;i++)if(!this.isTileTextureInMemory(t.drawContext,this.topLevelTiles[i]))return!1;return!0},c.prototype.createTile=function(t,e,r,n){var o=this.cachePath+"-layer/"+e.levelNumber+"/"+r+"/"+r+"_"+n+"."+h.suffixForMimeType(this.retrievalImageFormat);return new i(t,e,r,n,o)},c.prototype.doRender=function(t){if(t.terrain){if(this.currentTilesInvalid||!this.lasTtMVP||!t.navigatorState.modelviewProjection.equals(this.lasTtMVP)||t.globeStateKey!=this.lastGlobeStateKey)if(this.currentTilesInvalid=!1,t.surfaceOpacity>=1&&this.opacity>=1){this.previousTiles={};for(var e=0;e<this.currentTiles.length;e++)this.previousTiles[this.currentTiles[e].imagePath]=this.currentTiles[e];this.assembleTiles(t),this.fadeOutgoingTiles(t)}else this.assembleTiles(t);this.lasTtMVP=t.navigatorState.modelviewProjection,this.lastGlobeStateKey=t.globeStateKey,this.currentTiles.length>0&&(t.surfaceTileRenderer.renderTiles(t,this.currentTiles,this.opacity,t.surfaceOpacity>=1),t.frameStatistics.incrementImageTileCount(this.currentTiles.length),this.inCurrentFrame=!0)}},c.prototype.fadeOutgoingTiles=function(t){for(var e=(t.timestamp-t.previousRedrawTimestamp)/t.fadeTime,i={},r=0;r<this.currentTiles.length;r++){var n=this.currentTiles[r];i[n.imagePath]=n}for(var o in this.previousTiles)this.previousTiles.hasOwnProperty(o)&&(n=this.previousTiles[o],n.opacity>0&&!i[n.imagePath]&&(n.opacity=Math.max(0,n.opacity-e),n.opacity>0&&(this.currentTiles.push(n),this.currentTilesInvalid=!0,t.redrawRequested=!0)))},c.prototype.isLayerInView=function(t){return t.terrain&&t.terrain.sector&&t.terrain.sector.intersects(this.levels.sector)},c.prototype.createTopLevelTiles=function(t){this.topLevelTiles=[],l.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles)},c.prototype.assembleTiles=function(t){this.currentTiles=[],this.topLevelTiles&&0!==this.topLevelTiles.length||this.createTopLevelTiles(t);for(var e=0,i=this.topLevelTiles.length;e<i;e++){var r=this.topLevelTiles[e];r.update(t),this.currentAncestorTile=null,this.isTileVisible(t,r)&&this.addTileOrDescendants(t,r)}},c.prototype.addTileOrDescendants=function(t,e){if(this.tileMeetsRenderingCriteria(t,e))return void this.addTile(t,e);var i=null;try{(this.isTileTextureInMemory(t,e)||0===e.level.levelNumber)&&(i=this.currentAncestorTile,this.currentAncestorTile=e);for(var r=this.levels.level(e.level.levelNumber+1),n=e.subdivideToCache(r,this,this.tileCache),o=0,s=n.length;o<s;o++){var a=n[o];a.update(t),this.levels.sector.intersects(a.sector)&&this.isTileVisible(t,a)&&this.addTileOrDescendants(t,a)}}finally{i&&(this.currentAncestorTile=i)}},c.prototype.addTile=function(t,e){e.fallbackTile=null;var i=t.gpuResourceCache.resourceForKey(e.imagePath);return i?(e.opacity=1,this.currentTiles.push(e),void(this.expiration&&this.isTextureExpired(i)&&this.retrieveTileImage(t,e))):(this.retrieveTileImage(t,e),void(this.currentAncestorTile&&this.isTileTextureInMemory(t,this.currentAncestorTile)&&(e.fallbackTile=this.currentAncestorTile,e.fallbackTile.opacity=1,this.currentTiles.push(e))))},c.prototype.isTileVisible=function(t,e){return!(t.globe.projectionLimits&&!e.sector.overlaps(t.globe.projectionLimits))&&e.extent.intersectsFrustum(t.navigatorState.frustumInModelCoordinates)},c.prototype.tileMeetsRenderingCriteria=function(t,e){var i=this.detailControl;return(e.sector.minLatitude>=75||e.sector.maxLatitude<=-75)&&(i*=1.2),e.level.isLastLevel()||!e.mustSubdivide(t,i)},c.prototype.isTileTextureInMemory=function(t,e){return t.gpuResourceCache.containsResource(e.imagePath)},c.prototype.isTextureExpired=function(t){return this.expiration&&t.creationTime.getTime()<=this.expiration.getTime()},c.prototype.retrieveTileImage=function(t,e,i){if(this.currentRetrievals.indexOf(e.imagePath)<0){if(this.absentResourceList.isResourceAbsent(e.imagePath))return;var r=this.resourceUrlForTile(e,this.retrievalImageFormat),n=new Image,s=e.imagePath,a=t.gpuResourceCache,l=t.currentGlContext.canvas,h=this;if(!r)return void(this.currentTilesInvalid=!0);n.onload=function(){o.log(o.LEVEL_INFO,"Image retrieval succeeded: "+r);var c=h.createTexture(t,e,n);if(h.removeFromCurrentRetrievals(s),c&&(a.putResource(s,c,c.size),h.currentTilesInvalid=!0,h.absentResourceList.unmarkResourceAbsent(s),!i)){var u=document.createEvent("Event");u.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),l.dispatchEvent(u)}},n.onerror=function(){h.removeFromCurrentRetrievals(s),h.absentResourceList.markResourceAbsent(s),o.log(o.LEVEL_WARNING,"Image retrieval failed: "+r)},this.currentRetrievals.push(s),n.crossOrigin="anonymous",n.src=r}},c.prototype.createTexture=function(t,e,i){return new a(t.currentGlContext,i);
},c.prototype.removeFromCurrentRetrievals=function(t){var e=this.currentRetrievals.indexOf(t);e>-1&&this.currentRetrievals.splice(e,1)},c.prototype.resourceUrlForTile=function(t,e){return this.urlBuilder?this.urlBuilder.urlForTile(t,e):null},c}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(49),i(50)],n=function(t,e,i,r){"use strict";var n=function(r,n,o,s,a){if(!a||a.length<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"ImageTile","constructor","The specified image path is null, undefined or zero length."));i.call(this,r,n,o,s),this.imagePath=a,this.fallbackTile=null,this.gpuCacheKey=a};return n.prototype=Object.create(i.prototype),n.prototype.size=function(){return this.__proto__.__proto__.size.call(this)+this.imagePath.length+8},n.prototype.bind=function(t){var e=this.__proto__.__proto__.bind.call(this,t);return!!e||!!this.fallbackTile&&this.fallbackTile.bind(t)},n.prototype.applyInternalTransform=function(t,e){this.fallbackTile&&!t.gpuResourceCache.resourceForKey(this.imagePath)&&this.applyFallbackTransform(e)},n.prototype.applyFallbackTransform=function(t){var e=this.level.levelNumber-this.fallbackTile.level.levelNumber;if(!(e<=0)){var i=this.fallbackTile.sector.deltaLatitude(),r=this.fallbackTile.sector.deltaLongitude(),n=this.sector.deltaLongitude()/r,o=this.sector.deltaLatitude()/i,s=(this.sector.minLongitude-this.fallbackTile.sector.minLongitude)/r,a=(this.sector.minLatitude-this.fallbackTile.sector.minLatitude)/i;t.multiply(n,0,0,s,0,o,0,a,0,0,1,0,0,0,0,1)}},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=i(113),n=i(48),o=i(59),s=function(t){r.call(this,"Single image layer"),this.addRenderable(new o(n.FULL_SPHERE,t)),this.minActiveAltitude=0};s.prototype=Object.create(r.prototype),t.exports=s},function(t,e,i){var r,n;r=[i(21),i(9),i(8),i(48),i(99),i(24),i(25),i(84),i(180),i(17),i(56)],n=function(t,e,i,r,n,o,s,a,l,h,c){"use strict";var u=function(s,l,h){if(!s)throw new e(i.logMessage(i.LEVEL_SEVERE,"WmtsLayer","constructor","No layer configuration specified."));n.call(this,"WMTS Layer"),this.layerIdentifier=s.identifier,this.styleIdentifier=l,this.timeString=h;var c=s.format;if(c.indexOf("image/png")>=0?this.imageFormat="image/png":c.indexOf("image/jpeg")>=0?this.imageFormat="image/jpeg":c.indexOf("image/tiff")>=0?this.imageFormat="image/tiff":c.indexOf("image/gif")>=0?this.imageFormat="image/gif":this.imageFormat=c[0],!this.imageFormat)throw new e(i.logMessage(i.LEVEL_SEVERE,"WmtsLayer","constructor","Layer does not provide a supported image format."));if(s.resourceUrl&&s.resourceUrl.length>1){for(var d=0;d<s.resourceUrl.length;d++)if(this.imageFormat===s.resourceUrl[d].format){this.resourceUrl=s.resourceUrl[d].template;break}}else this.serviceUrl=s.capabilities.getGetTileKvpAddress(),this.serviceUrl&&(this.serviceUrl=a.fixGetMapString(this.serviceUrl));if(!this.resourceUrl&&!this.serviceUrl)throw new e(i.logMessage(i.LEVEL_SEVERE,"WmtsLayer","constructor","No resource URL or KVP GetTile service URL specified in WMTS capabilities."));if(this.styleIdentifier){for(var p=!1,d=0;d<s.style.length;d++)if(s.style[d].identifier===this.styleIdentifier){p=!0;break}p||(i.logMessage(i.LEVEL_WARNING,"WmtsLayer","constructor","The specified style identifier is not available. The server's default style will be used."),this.styleIdentifier=null)}if(!this.styleIdentifier&&s.style)for(d=0;d<s.style.length;d++)if(s.style[d].isDefault){this.styleIdentifier=s.style[d].identifier;break}this.styleIdentifier||i.logMessage(i.LEVEL_WARNING,"WmtsLayer","constructor","No default style available. A style will not be specified in tile requests.");var f,g=null,m=null;for(d=0;d<s.tileMatrixSetLink.length;d++)f=s.tileMatrixSetLink[d].tileMatrixSetRef,u.isEpsg4326Crs(f.supportedCRS)?g=g||f:u.isEpsg3857Crs(f.supportedCRS)&&(m=m||f);if(this.tileMatrixSet=g||m,!this.tileMatrixSet)throw new e(i.logMessage(i.LEVEL_SEVERE,"WmtsLayer","constructor","No supported Tile Matrix Set could be found."));if(s.wgs84BoundingBox)this.sector=new r(s.wgs84BoundingBox.lowerCorner[1],s.wgs84BoundingBox.upperCorner[1],s.wgs84BoundingBox.lowerCorner[0],s.wgs84BoundingBox.upperCorner[0]);else if(this.tileMatrixSet.boundingBox&&WmtsLayerCapabilities.isEpsg4326Crs(this.tileMatrixSet.boundingBox.crs))this.sector=new r(this.tileMatrixSet.boundingBox.lowerCorner[1],this.tileMatrixSet.boundingBox.upperCorner[1],this.tileMatrixSet.boundingBox.lowerCorner[0],this.tileMatrixSet.boundingBox.upperCorner[0]);else if(WmtsLayerCapabilities.isEpsg4326Crs(this.tileMatrixSet.supportedCRS))throw new e(i.logMessage(i.LEVEL_SEVERE,"WmtsLayer","constructor","No EPSG:4326 bounding box was specified in the layer or tile matrix set capabilities."));this.cachePath=(this.resourceUrl||this.serviceUrl)+this.layerIdentifier+this.styleIdentifier+this.tileMatrixSet.identifier,h&&(this.cachePath=this.cachePath+h),s.title.length>0?this.displayName=s.title[0].value:this.displayName=s.identifier,this.pickEnabled=!1,this.currentTiles=[],this.currentTilesInvalid=!0,this.tileCache=new o(500,400),this.currentRetrievals=[],this.absentResourceList=new t(3,5e4),this.pickEnabled=!1,this.detailControl=1.75};return u.prototype=Object.create(n.prototype),u.prototype.doRender=function(t){t.terrain&&(!this.currentTilesInvalid&&this.lasTtMVP&&t.navigatorState.modelviewProjection.equals(this.lasTtMVP)&&t.globeStateKey==this.lastGlobeStateKey||(this.currentTilesInvalid=!1,this.assembleTiles(t)),this.lasTtMVP=t.navigatorState.modelviewProjection,this.lastGlobeStateKey=t.globeStateKey,this.currentTiles.length>0&&(t.surfaceTileRenderer.renderTiles(t,this.currentTiles,this.opacity),t.frameStatistics.incrementImageTileCount(this.currentTiles.length),this.inCurrentFrame=!0))},u.prototype.isLayerInView=function(t){return t.terrain&&t.terrain.sector&&t.terrain.sector.intersects(this.sector)},u.prototype.isTileVisible=function(t,e){return!(t.globe.projectionLimits&&!e.sector.overlaps(t.globe.projectionLimits))&&e.extent.intersectsFrustum(t.navigatorState.frustumInModelCoordinates)},u.prototype.assembleTiles=function(t){this.currentTiles=[],this.topLevelTiles&&0!==this.topLevelTiles.length||this.createTopLevelTiles(t);for(var e=0,i=this.topLevelTiles.length;e<i;e++){var r=this.topLevelTiles[e];r.update(t),this.currentAncestorTile=null,this.isTileVisible(t,r)&&this.addTileOrDescendants(t,r)}},u.prototype.addTileOrDescendants=function(t,e){if(this.tileMeetsRenderingCriteria(t,e))return void this.addTile(t,e);var i=null;try{(this.isTileTextureInMemory(t,e)||0===e.tileMatrix.levelNumber)&&(i=this.currentAncestorTile,this.currentAncestorTile=e);for(var r=this.tileMatrixSet.tileMatrix[e.tileMatrix.levelNumber+1],n=e.subdivideToCache(r,this,this.tileCache),o=0,s=n.length;o<s;o++){var a=n[o];a.update(t),this.sector.intersects(a.sector)&&this.isTileVisible(t,a)&&this.addTileOrDescendants(t,a)}}finally{i&&(this.currentAncestorTile=i)}},u.prototype.addTile=function(t,e){e.fallbackTile=null;var i=t.gpuResourceCache.resourceForKey(e.imagePath);return i?(this.currentTiles.push(e),void(this.expiration&&this.isTextureExpired(i)&&this.retrieveTileImage(t,e))):(this.retrieveTileImage(t,e),void(this.currentAncestorTile&&this.isTileTextureInMemory(t,this.currentAncestorTile)&&this.currentTiles.push(this.currentAncestorTile)))},u.prototype.isTextureExpired=function(t){return this.expiration&&t.creationTime.getTime()<=this.expiration.getTime()},u.prototype.isTileTextureInMemory=function(t,e){return t.gpuResourceCache.containsResource(e.imagePath)},u.prototype.tileMeetsRenderingCriteria=function(t,e){var i=this.detailControl;return(e.sector.minLatitude>=75||e.sector.maxLatitude<=-75)&&(i*=1.2),e.tileMatrix.levelNumber===this.tileMatrixSet.tileMatrix.length-1||!e.mustSubdivide(t,i)},u.prototype.retrieveTileImage=function(t,e){if(this.currentRetrievals.indexOf(e.imagePath)<0){if(this.absentResourceList.isResourceAbsent(e.imagePath))return;var r=this.resourceUrlForTile(e,this.imageFormat),n=new Image,o=e.imagePath,s=t.gpuResourceCache,a=t.currentGlContext.canvas,l=this;if(!r)return void(this.currentTilesInvalid=!0);n.onload=function(){i.log(i.LEVEL_INFO,"Image retrieval succeeded: "+r);var h=l.createTexture(t,e,n);if(l.removeFromCurrentRetrievals(o),h){s.putResource(o,h,h.size),l.currentTilesInvalid=!0,l.absentResourceList.unmarkResourceAbsent(o);var c=document.createEvent("Event");c.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),a.dispatchEvent(c)}},n.onerror=function(){l.removeFromCurrentRetrievals(o),l.absentResourceList.markResourceAbsent(o),i.log(i.LEVEL_WARNING,"Image retrieval failed: "+r)},this.currentRetrievals.push(o),n.crossOrigin="anonymous",n.src=r}},u.prototype.resourceUrlForTile=function(t,e){var i;return this.resourceUrl?(i=this.resourceUrl.replace("{Style}",this.styleIdentifier).replace("{TileMatrixSet}",this.tileMatrixSet.identifier).replace("{TileMatrix}",t.tileMatrix.identifier).replace("{TileCol}",t.column).replace("{TileRow}",t.row),this.timeString&&i.replace("{Time}",this.timeString)):(i=this.serviceUrl+"service=WMTS&request=GetTile&version=1.0.0",i+="&Layer="+this.layerIdentifier,this.styleIdentifier&&(i+="&Style="+this.styleIdentifier),i+="&Format="+e,this.timeString&&(i+="&Time="+this.timeString),i+="&TileMatrixSet="+this.tileMatrixSet.identifier,i+="&TileMatrix="+t.tileMatrix.identifier,i+="&TileRow="+t.row,i+="&TileCol="+t.column),i},u.prototype.removeFromCurrentRetrievals=function(t){var e=this.currentRetrievals.indexOf(t);e>-1&&this.currentRetrievals.splice(e,1)},u.prototype.createTopLevelTiles=function(t){var e=this.tileMatrixSet.tileMatrix[0];this.topLevelTiles=[];for(var i=0;i<e.matrixHeight;i++)for(var r=0;r<e.matrixWidth;r++)this.topLevelTiles.push(this.createTile(e,i,r))},u.prototype.createTile=function(t,e,i){return u.isEpsg4326Crs(this.tileMatrixSet.supportedCRS)?this.createTile4326(t,e,i):u.isEpsg3857Crs(this.tileMatrixSet.supportedCRS)?this.createTile3857(t,e,i):void 0},u.prototype.createTile4326=function(t,e,i){var n=this.sector.deltaLatitude()/t.matrixHeight,o=this.sector.deltaLongitude()/t.matrixWidth,s=t.topLeftCorner[0]-e*n,a=s-n,l=t.topLeftCorner[1]+o*i,h=l+o,c=new r(a,s,l,h);return this.makeTile(c,t,e,i)},u.prototype.createTile3857=function(t,e,i){t.mapWidth||this.computeTileMatrixValues3857(t);var n,o,s,a,l,c,u=h.clamp(i*t.tileWidth-.5,0,t.mapWidth),d=h.clamp(e*t.tileHeight-.5,0,t.mapHeight),p=h.clamp(u+t.tileWidth+.5,0,t.mapWidth),f=h.clamp(d+t.tileHeight+.5,0,t.mapHeight);n=u/t.mapWidth,o=f/t.mapHeight,a=t.topLeftCorner[0]+n*t.tileMatrixDeltaX,s=t.topLeftCorner[1]-o*t.tileMatrixDeltaY;var g=h.epsg3857ToEpsg4326(a,s);n=p/t.mapWidth,o=d/t.mapHeight,c=t.topLeftCorner[0]+n*t.tileMatrixDeltaX,l=t.topLeftCorner[1]-o*t.tileMatrixDeltaY;var m=h.epsg3857ToEpsg4326(c,l),E=new r(g[0],m[0],g[1],m[1]);return this.makeTile(E,t,e,i)},u.prototype.computeTileMatrixValues3857=function(t){var e=28e-5*t.scaleDenominator,i=t.tileWidth*e,r=t.tileHeight*e,n=t.topLeftCorner[0]+i*t.matrixWidth,o=t.topLeftCorner[1]-r*t.matrixHeight,s=[n,o],a=t.topLeftCorner;t.tileMatrixDeltaX=s[0]-a[0],t.tileMatrixDeltaY=a[1]-s[1],t.mapWidth=t.tileWidth*t.matrixWidth,t.mapHeight=t.tileHeight*t.matrixHeight},u.prototype.makeTile=function(t,e,i,r){var n=this.cachePath+"-layer/"+e.identifier+"/"+i+"/"+r+"."+c.suffixForMimeType(this.imageFormat);return new l(t,e,i,r,n)},u.prototype.createTexture=function(t,e,i){return u.isEpsg4326Crs(this.tileMatrixSet.supportedCRS)?new s(t.currentGlContext,i):u.isEpsg3857Crs(this.tileMatrixSet.supportedCRS)?this.createTexture3857(t,e,i):void 0},u.prototype.createTexture3857=function(t,e,i){this.destCanvas||(this.destCanvas=document.createElement("canvas"),this.destContext=this.destCanvas.getContext("2d"));var r,n,o,a,l,c,u,d,p=t.canvas2D,f=t.ctx2D,g=this.destCanvas,m=this.destContext,E=m.createImageData(i.width,i.height),v=e.sector,y=h.gudermannianInverse(v.minLatitude),_=h.gudermannianInverse(v.maxLatitude);p.width=i.width,p.height=i.height,g.width=i.width,g.height=i.height,f.drawImage(i,0,0,i.width,i.height),r=f.getImageData(0,0,i.width,i.height);for(var T=0;T<1;T++)for(var L=0;L<i.height;L++){u=1-L/(i.height-1),n=u*v.deltaLatitude()+v.minLatitude,o=h.gudermannianInverse(n),d=1-(o-y)/(_-y),d=h.clamp(d,0,1),a=Math.floor(d*(i.height-1));for(var x=0;x<i.width;x++)l=4*(x+a*i.width),c=4*(x+L*i.width),E.data[c]=r.data[l],E.data[c+1]=r.data[l+1],E.data[c+2]=r.data[l+2],E.data[c+3]=r.data[l+3]}return m.putImageData(E,0,0),new s(t.currentGlContext,g)},u.isEpsg4326Crs=function(t){return t.indexOf("EPSG")>=0&&t.indexOf("4326")>=0},u.isEpsg3857Crs=function(t){return t.indexOf("EPSG")>=0&&(t.indexOf("3857")>=0||t.indexOf("900913")>=0)},u}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(13),i(9),i(51),i(8),i(11),i(56)],n=function(t,e,i,r,n,o){"use strict";var s=function(e,i,r,n,o){this.sector=e,this.tileMatrix=i,this.row=r,this.column=n,this.imagePath=o,this.texelSize=e.deltaLatitude()*t.DEGREES_TO_RADIANS/i.tileHeight,this.tileKey=i.levelNumber.toString()+"."+r.toString()+"."+n.toString(),this.gpuCacheKey=o};return s.prototype.isEqual=function(t){return!!t&&(!!t.tileKey&&this.tileKey==t.tileKey)},s.prototype.distanceTo=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Tile","distanceTo","missingVector"));for(var i,n,o,s=t[0],a=t[1],l=t[2],h=this.samplePoints,c=Number.POSITIVE_INFINITY,u=0,d=h.length;u<d;u+=3)i=s-h[u],n=a-h[u+1],o=l-h[u+2],c=Math.min(c,i*i+n*n+o*o);return Math.sqrt(c)},s.prototype.subdivide=function(t,i){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WmtsLayerTile","subdivide","The specified tile matrix is null or undefined."));if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"WmtsLayerTile","subdivide","The specified tile factory is null or undefined."));var n,o,s,a,l=[];return n=t.matrixHeight/this.tileMatrix.matrixHeight,o=t.matrixWidth/this.tileMatrix.matrixWidth,s=n*this.row,a=o*this.column,l.push(i.createTile(t,s,a)),s=n*this.row,a=o*this.column+1,l.push(i.createTile(t,s,a)),s=n*this.row+1,a=o*this.column,l.push(i.createTile(t,s,a)),s=n*this.row+1,a=o*this.column+1,l.push(i.createTile(t,s,a)),l},s.prototype.subdivideToCache=function(t,i,n){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Tile","subdivideToCache","The specified tile matrix is null or undefined."));if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"Tile","subdivideToCache","The specified tile factory is null or undefined."));var o=n?n.entryForKey(this.tileKey):null;return o||(o=this.subdivide(t,i),o&&n&&n.putEntry(this.tileKey,o,o.length)),o},s.prototype.mustSubdivide=function(t,e){var i=t.globe.equatorialRadius*this.texelSize,r=this.distanceTo(t.navigatorState.eyePoint),n=t.navigatorState.pixelSizeAtDistance(r);return i>Math.max(e*n,.5)},s.prototype.update=function(t){var e=t.globe.elevationTimestamp(),i=t.verticalExaggeration,r=t.globeStateKey;this.updateTimestamp==e&&this.updateVerticalExaggeration==i&&this.updateGlobeStateKey==r||(this.doUpdate(t),t.frameStatistics.incrementTileUpdateCount(1),this.updateTimestamp=e,this.updateVerticalExaggeration=i,this.updateGlobeStateKey=r)},s.prototype.doUpdate=function(t){var e=t.globe,r=t.verticalExaggeration,s=e.minAndMaxElevationsForSector(this.sector),a=s?s[0]*r:0,l=s?s[1]*r:0;a==l&&(a=l+10),this.extent||(this.extent=new i),this.extent.setToSector(this.sector,e,a,l),this.samplePoints||(this.sampleElevations=new Float64Array(9),this.samplePoints=new Float64Array(3*this.sampleElevations.length)),o.fillArray(this.sampleElevations,.5*(a+l)),e.computePointsForGrid(this.sector,3,3,this.sampleElevations,n.ZERO,this.samplePoints),this.referencePoint||(this.referencePoint=new n(0,0,0)),e.computePointFromPosition(this.sector.centroidLatitude(),this.sector.centroidLongitude(),0,this.referencePoint)},s.prototype.bind=function(t){var e=t.gpuResourceCache.resourceForKey(this.gpuCacheKey);return!(!e||!e.bind(t))||!!this.fallbackTile&&this.fallbackTile.bind(t)},s.prototype.applyInternalTransform=function(t,e){},s}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(182),i(183),i(185),i(186),i(187),i(189)],n=function(t,e,i,r,n,o,s,a){"use strict";var l=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmtsCapabilities","constructor","No XML DOM specified."));this.assembleDocument(i)};return l.prototype.assembleDocument=function(t){var e=t.documentElement;this.version=e.getAttribute("version"),this.updateSequence=e.getAttribute("updateSequence");for(var i=e.children||e.childNodes,s=0;s<i.length;s++){var a=i[s];"ServiceIdentification"===a.localName?this.serviceIdentification=new n(a):"ServiceProvider"===a.localName?this.serviceProvider=new o(a):"OperationsMetadata"===a.localName?this.operationsMetadata=new r(a):"Contents"===a.localName&&(this.contents=this.assembleContents(a))}this.resolveTileMatrixSetLinks()},l.prototype.assembleContents=function(t){for(var i={},r=t.children||t.childNodes,n=0;n<r.length;n++){var o=r[n];if("Layer"===o.localName){i.layer=i.layer||[];try{i.layer.push(new a(o,this))}catch(t){e.logMessage(e.LEVEL_SEVERE,"WmtsCapabilities","constructor","Exception reading WMTS layer description: "+t.message)}}else if("TileMatrixSet"===o.localName){i.tileMatrixSet=i.tileMatrixSet||[];try{i.tileMatrixSet.push(l.assembleTileMatrixSet(o))}catch(t){e.logMessage(e.LEVEL_SEVERE,"WmtsCapabilities","constructor","Exception reading WMTS tile matrix set description: "+t.message)}}}return i},l.assembleTileMatrixSet=function(t){for(var e={},r=t.children||t.childNodes,n=0;n<r.length;n++){var o=r[n];"Identifier"===o.localName?e.identifier=o.textContent:"SupportedCRS"===o.localName?e.supportedCRS=o.textContent:"WellKnownScaleSet"===o.localName?e.wellKnownScaleSet=o.textContent:"BoundingBox"===o.localName?e.boundingBox=a.assembleBoundingBox(o):"TileMatrix"===o.localName?(e.tileMatrix=e.tileMatrix||[],e.tileMatrix.push(l.assembleTileMatrix(o))):"Title"===o.localName?(e.title=e.title||[],e.title.push(new i(o))):"Abstract"===o.localName&&(e.abstract=e.abstract||[],e.abstract.push(new i(o)))}for(var s=0;s<e.tileMatrix.length;s++)e.tileMatrix[s].levelNumber=s;return e},l.assembleTileMatrix=function(t){for(var e={},r=t.children||t.childNodes,n=0;n<r.length;n++){var o=r[n];if("Identifier"===o.localName)e.identifier=o.textContent;else if("Title"===o.localName)e.title=tileMatrixSet.title||[],e.title.push(new i(o));else if("Abstract"===o.localName)e.abstract=tileMatrixSet.abstract||[],e.abstract.push(new i(o));else if("ScaleDenominator"===o.localName)e.scaleDenominator=parseFloat(o.textContent);else if("TileWidth"===o.localName)e.tileWidth=parseFloat(o.textContent);else if("TileHeight"===o.localName)e.tileHeight=parseFloat(o.textContent);else if("MatrixWidth"===o.localName)e.matrixWidth=parseFloat(o.textContent);else if("MatrixHeight"===o.localName)e.matrixHeight=parseFloat(o.textContent);else if("TopLeftCorner"===o.localName){var s=o.textContent.split(" ");e.topLeftCorner=[parseFloat(s[0]),parseFloat(s[1])]}}return e},l.prototype.resolveTileMatrixSetLinks=function(){for(var t=0;t<this.contents.layer.length;t++)for(var e=this.contents.layer[t],i=0;i<e.tileMatrixSetLink.length;i++)for(var r=e.tileMatrixSetLink[i],n=0;n<this.contents.tileMatrixSet.length;n++)if(this.contents.tileMatrixSet[n].identifier===r.tileMatrixSet){r.tileMatrixSetRef=this.contents.tileMatrixSet[n];break}},l.prototype.getGetTileKvpAddress=function(){for(var t=0;t<this.operationsMetadata.operation.length;t++){var e=this.operationsMetadata.operation[t];if("GetTile"===e.name)return e.dcp[0].http.get[0].href}return null},l}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8)],n=function(t,e){"use strict";var i=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"LanguageString","constructor","missingDomElement"));this.value=i.textContent;var r=i.getAttribute("lang");r&&(this.lang=r)};return i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(184)],n=function(t,e,i){"use strict";var r=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"OwsOperationsMetadata","constructor","missingDomElement"));for(var n=i.children,o=0;o<n.length;o++){var s=n[o];"Operation"===s.localName&&(this.operation=this.operation||[],this.operation.push(r.assembleOperation(s)))}};return r.assembleOperation=function(t){var e={};e.name=t.getAttribute("name");for(var i=t.children,n=0;n<i.length;n++){var o=i[n];"DCP"===o.localName&&(e.dcp=e.dcp||[],e.dcp.push(r.assembleDcp(o)))}return e},r.assembleDcp=function(t){for(var e={},i=t.children,n=0;n<i.length;n++){var o=i[n];"HTTP"===o.localName&&(e.http=r.assembleHttp(o))}return e},r.assembleHttp=function(t){for(var e={},i=t.children,n=0;n<i.length;n++){var o=i[n];"Get"===o.localName&&(e.get=e.get||[],e.get.push(r.assembleGet(o)))}return e},r.assembleGet=function(t){var e={};e.href=t.getAttribute("xlink:href");for(var r=t.children,n=0;n<r.length;n++){var o=r[n];"Constraint"===o.localName&&(e.constraint=e.constraint||[],e.constraint.push(new i(o)))}return e},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8)],n=function(t,e){"use strict";var i=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"OwsConstraint","constructor","missingDomElement"));this.name=i.getAttribute("name");for(var r=i.children,n=0;n<r.length;n++){var o=r[n];if("AllowedValues"===o.localName){this.allowedValues=this.allowedValues||[];for(var s=0;s<o.children.length;s++)"Value"===o.children[s].localName&&this.allowedValues.push(o.children[s].textContent)}else"AnyValue"===o.localName?this.anyValue=!0:"NoValues"===o.localName&&(this.noValues=!0)}};return i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8)],n=function(t,e){"use strict";var i=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"OwsServiceIdentification","constructor","missingDomElement"));for(var r=i.children,n=0;n<r.length;n++){var o=r[n];"ServiceType"===o.localName?this.serviceType=o.textContent:"ServiceTypeVersion"===o.localName?this.serviceTypeVersion=o.textContent:"Profile"===o.localName?(this.profile=this.profiles||[],this.profile.push(o.textContent)):"Title"===o.localName?(this.title=this.title||[],this.title.push(o.textContent)):"Abstract"===o.localName?(this.abstract=this.title||[],this.abstract.push(o.textContent)):"Fees"===o.localName?this.fees=o.textContent:"AccessConstraints"===o.localName&&(this.accessConstraints=this.accessConstraints||[],this.accessConstraints.push(o.textContent))}};return i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8)],n=function(t,e){"use strict";var i=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"OwsServiceProvider","constructor","missingDomElement"));for(var r=i.children,n=0;n<r.length;n++){var o=r[n];"ProviderName"===o.localName?this.providerName=o.textContent:"ProviderSite"===o.localName&&(this.providerSite=o.getAttribute("xlink:href"))}};return i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(188)],n=function(t,e,i){"use strict";var r=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsCapabilities","constructor","No XML DOM specified."));this.assembleDocument(i)};return r.prototype.assembleDocument=function(t){var e=t.documentElement;this.version=e.getAttribute("version"),this.updateSequence=e.getAttribute("updateSequence");for(var i=e.children||e.childNodes,r=0;r<i.length;r++){var n=i[r];"Service"===n.localName?this.service=this.assembleService(n):"Capability"===n.localName&&(this.capability=this.assembleCapability(n))}},r.prototype.assembleService=function(t){for(var e={capsDoc:this},i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];"Name"===n.localName?e.name=n.textContent:"Title"===n.localName?e.title=n.textContent:"Abstract"===n.localName?e.abstract=n.textContent:"KeywordList"===n.localName?e.keywordList=this.assembleKeywordList(n):"OnlineResource"===n.localName?e.onlineResource=n.getAttribute("xlink:href"):"Fees"===n.localName?e.fees=n.textContent:"AccessConstraints"===n.localName?e.accessConstraints=n.textContent:"LayerLimit"==n.localName?e.layerLimit=parseInt(n.textContent):"MaxWidth"==n.localName?e.maxWidth=parseInt(n.textContent):"MaxHeight"==n.localName?e.maxHeight=parseInt(n.textContent):"ContactInformation"===n.localName&&(e.contactInformation=this.assembleContactInformation(n))}return e},r.prototype.assembleKeywordList=function(t){for(var e=[],i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];"Keyword"===n.localName&&e.push(n.textContent)}return e},r.prototype.assembleContactInformation=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];"ContactPersonPrimary"===n.localName?e.contactPersonPrimary=this.assembleContactPersonPrimary(n):"ContactPosition"===n.localName?e.contactPosition=n.textContent:"ContactVoiceTelephone"===n.localName?e.contactVoiceTelephone=n.textContent:"ContactFacsimileTelephone"===n.localName?e.contactFacsimileTelephone=n.textContent:"ContactElectronicMailAddress"===n.localName?e.contactElectronicMailAddress=n.textContent:"ContactAddress"===n.localName&&(e.contactAddress=this.assembleContactAddress(n))}return e},r.prototype.assembleContactPersonPrimary=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];"ContactPerson"===n.localName?e.contactPerson=n.textContent:"ContactOrganization"===n.localName&&(e.contactOrganization=n.textContent)}return e},r.prototype.assembleContactAddress=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];"AddressType"===n.localName?e.addressType=n.textContent:"Address"===n.localName?e.address=n.textContent:"City"===n.localName?e.city=n.textContent:"StateOrProvince"===n.localName?e.stateOrProvince=n.textContent:"PostCode"===n.localName?e.postCode=n.textContent:"Country"===n.localName&&(e.country=n.textContent)}return e},r.prototype.assembleCapability=function(t){for(var e={capsDoc:this},r=t.children||t.childNodes,n=0;n<r.length;n++){var o=r[n];"Request"===o.localName?e.request=this.assembleRequests(o):"Exception"===o.localName?e.exception=this.assembleException(o):"Layer"===o.localName&&(e.layers=e.layers||[],e.layers.push(new i(o,e)))}return e},r.prototype.assembleRequests=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];"GetCapabilities"===n.localName?e.getCapabilities=this.assembleRequest(n):"GetMap"===n.localName?e.getMap=this.assembleRequest(n):"GetFeatureInfo"===n.localName&&(e.getFeatureInfo=this.assembleRequest(n))}return e},r.prototype.assembleRequest=function(t){for(var e={name:t.localName},i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];if("Format"===n.localName)e.formats=e.formats||[],e.formats.push(n.textContent);else if("DCPType"===n.localName)for(var o=n.children||n.childNodes,s=0;s<o.length;s++){var a=o[s];if("HTTP"===a.localName)for(var l=a.children||a.childNodes,h=0;h<l.length;h++){var c=l[h];if("Get"===c.localName)for(var u=c.children||c.childNodes,d=0;d<u.length;d++){var p=u[d];"OnlineResource"===p.localName&&(e.url=p.getAttribute("xlink:href"))}}}}return e},r.prototype.assembleException=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];"Format"===n.localName&&(e.formats=e.formats||[],e.formats.push(n.textContent))}return e},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8)],n=function(t,e){"use strict";var i=function(i,r){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsLayerCapabilities","constructor","Layer element is null or undefined."));this.parent=r,this.layers,this.name,this.title,this.abstract,this.keywordList,this.identifiers,this.metadataUrls,this.dataUrls,this.featureListUrls,this.assembleLayer(i)};return Object.defineProperties(i.prototype,{capability:{get:function(){for(var t=this;t&&t instanceof i;)t=t.parent;return t}},queryable:{get:function(){return i.replace(this,"_queryable")}},cascaded:{get:function(){return i.replace(this,"_cascaded")}},opaque:{get:function(){return i.replace(this,"_opaque")}},noSubsets:{get:function(){return i.replace(this,"_noSubsets")}},fixedWidth:{get:function(){return i.replace(this,"_fixedWidth")}},fixedHeight:{get:function(){return i.replace(this,"_fixedHeight")}},styles:{get:function(){return i.accumulate(this,"_styles",[])}},crses:{get:function(){return i.accumulate(this,"_crses",[])}},srses:{get:function(){return i.accumulate(this,"_srses",[])}},geographicBoundingBox:{get:function(){return i.replace(this,"_geographicBoundingBox")}},latLonBoundingBox:{get:function(){return i.replace(this,"_latLonBoundingBox")}},boundingBoxes:{get:function(){return i.replace(this,"_boundingBoxes")}},dimensions:{get:function(){for(var t=[],e=this;e&&e instanceof i;)e._dimensions&&e._dimensions.length>0&&e._dimensions.forEach(function(e){var i=e.name,r=!0;t.forEach(function(t){t.name===i&&(r=!1)}),r&&t.push(e)}),e=e.parent;return t.length>0?t:void 0}},extents:{get:function(){for(var t=[],e=this;e&&e instanceof i;)e._extents&&e._extents.length>0&&e._extents.forEach(function(e){var i=e.name,r=!0;t.forEach(function(t){t.name===i&&(r=!1)}),r&&t.push(e)}),e=e.parent;return t.length>0?t:void 0}},attribution:{get:function(){return i.replace(this,"_attribution")}},authorityUrls:{get:function(){return i.accumulate(this,"_authorityUrls",[])}},minScaleDenominator:{get:function(){return i.replace(this,"_minScaleDenominator")}},maxScaleDenominator:{get:function(){return i.replace(this,"_maxScaleDenominator")}},scaleHint:{get:function(){return i.replace(this,"_scaleHint")}}}),i.accumulate=function(t,e,r){for(;t&&t instanceof i;){var n=t[e];if(n)for(var o=0;o<n.length;o++)r.push(n[o]);t=t.parent}return r.length>0?r:null},i.replace=function(t,e){for(;t&&t instanceof i;){var r=t[e];if(r)return r;t=t.parent}},i.prototype.assembleLayer=function(t){var e,r;e=t.getAttribute("queryable"),e&&(this._queryable="1"===e||"true"===e),e=t.getAttribute("opaque"),e&&(this._opaque="1"===e||"true"===e),e=t.getAttribute("noSubsets"),e&&(this._noSubsets="1"===e||"true"===e),e=t.getAttribute("cascaded"),e&&(this._cascaded=parseInt("10")),e=t.getAttribute("fixedWidth"),e&&(this._fixedWidth=parseInt("10")),e=t.getAttribute("fixedHeight"),e&&(this._fixedHeight=parseInt("10"));var n=t.children||t.childNodes;for(r=0;r<n.length;r++){var o=n[r];if("Layer"===o.localName)this.layers||(this.layers=[]),this.layers.push(new i(o,this));else if("Name"===o.localName)this.name=o.textContent;else if("Title"===o.localName)this.title=o.textContent;else if("Abstract"===o.localName)this.abstract=o.textContent;else if("KeywordList"===o.localName){this.keywordList=this.keywordList||[];for(var s=o.children||o.childNodes,a=0;a<s.length;a++){var l=s[a];"Keyword"===l.localName&&this.keywordList.push(l.textContent)}}else"Style"===o.localName?(this._styles||(this._styles=[]),this._styles.push(i.assembleStyle(o))):"CRS"===o.localName?(this._crses||(this._crses=[]),this._crses.push(o.textContent)):"SRS"===o.localName?(this._srses||(this._srses=[]),this._srses.push(o.textContent)):"EX_GeographicBoundingBox"===o.localName?this._geographicBoundingBox=i.assembleGeographicBoundingBox(o):"LatLonBoundingBox"===o.localName?this._geographicBoundingBox=i.assembleLatLonBoundingBox(o):"BoundingBox"===o.localName?(this._boundingBoxes||(this._boundingBoxes=[]),this._boundingBoxes.push(i.assembleBoundingBox(o))):"Dimension"===o.localName?(this._dimensions||(this._dimensions=[]),this._dimensions.push(i.assembleDimension(o))):"Extent"===o.localName?(this._extents||(this._extents=[]),this._extents.push(i.assembleDimension(o))):"Attribution"===o.localName?this._attribution=i.assembleAttribution(o):"AuthorityURL"===o.localName?(this._authorityUrls||(this._authorityUrls=[]),this._authorityUrls.push(i.assembleAuthorityUrl(o))):"Identifier"===o.localName?(this.identifiers||(this.identifiers=[]),this.identifiers.push(i.assembleIdentifier(o))):"MetadataURL"===o.localName?(this.metadataUrls||(this.metadataUrls=[]),this.metadataUrls.push(i.assembleMetadataUrl(o))):"DataURL"===o.localName?(this.dataUrls||(this.dataUrls=[]),this.dataUrls.push(i.assembleUrl(o))):"FeatureListURL"===o.localName?(this.featureListUrls||(this.featureListUrls=[]),
this.featureListUrls.push(i.assembleUrl(o))):"MinScaleDenominator"===o.localName?this._minScaleDenominator=parseFloat(o.textContent):"MaxScaleDenominator"===o.localName?this._maxScaleDenominator=parseFloat(o.textContent):"ScaleHint"===o.localName&&(this._scaleHint={},this._scaleHint.min=i.getFloatAttribute(o,"min"),this._scaleHint.max=i.getFloatAttribute(o,"max"))}},i.assembleStyle=function(t){for(var e={},r=t.children||t.childNodes,n=0;n<r.length;n++){var o=r[n];"Name"===o.localName?e.name=o.textContent:"Title"===o.localName?e.title=o.textContent:"Abstract"===o.localName?e.abstract=o.textContent:"LegendURL"===o.localName?(e.legendUrls||(e.legendUrls=[]),e.legendUrls.push(i.assembleLegendUrl(o))):"StyleSheetURL"===o.localName?e.styleSheetUrl=i.assembleUrl(o):"StyleURL"===o.localName&&(e.styleUrl=i.assembleUrl(o))}return e},i.assembleGeographicBoundingBox=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];"westBoundLongitude"===n.localName?e.westBoundLongitude=parseFloat(n.textContent):"eastBoundLongitude"===n.localName?e.eastBoundLongitude=parseFloat(n.textContent):"southBoundLatitude"===n.localName?e.southBoundLatitude=parseFloat(n.textContent):"northBoundLatitude"===n.localName&&(e.northBoundLatitude=parseFloat(n.textContent))}return e},i.assembleLatLonBoundingBox=function(t){var e={};return e.minx=i.getFloatAttribute(t,"minx"),e.miny=i.getFloatAttribute(t,"miny"),e.maxx=i.getFloatAttribute(t,"maxx"),e.maxy=i.getFloatAttribute(t,"maxy"),e},i.assembleBoundingBox=function(t){var e={};return e.crs=t.getAttribute("CRS"),e.minx=i.getFloatAttribute(t,"minx"),e.miny=i.getFloatAttribute(t,"miny"),e.maxx=i.getFloatAttribute(t,"maxx"),e.maxy=i.getFloatAttribute(t,"maxy"),e.resx=i.getFloatAttribute(t,"resx"),e.resy=i.getFloatAttribute(t,"resy"),e},i.assembleDimension=function(t){var e={};return e.name=t.getAttribute("name"),e.units=t.getAttribute("units"),e.unitSymbol=t.getAttribute("unitSymbol"),e.default=t.getAttribute("default"),e.multipleValues=t.getAttribute("multipleValues"),e.multipleValues&&(e.multipleValues="true"===e.multipleValues||"1"===e.multipleValues),e.nearestValue=t.getAttribute("nearestValue"),e.nearestValue&&(e.nearestValue="true"===e.nearestValue||"1"===e.nearestValue),e.current=t.getAttribute("current"),e.current&&(e.current="true"===e.current||"1"===e.current),e.content=t.textContent,e},i.assembleAttribution=function(t){for(var e={},r=t.children||t.childNodes,n=0;n<r.length;n++){var o=r[n];"Title"===o.localName?e.title=o.textContent:"OnlineResource"===o.localName?e.url=o.getAttribute("xlink:href"):"LogoUrul"===o.localName&&(e.logoUrl=i.assembleLogoUrl(o))}return e},i.assembleAuthorityUrl=function(t){var e={};e.name=t.getAttribute("name");for(var i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];"OnlineResource"===n.localName&&(e.url=n.getAttribute("xlink:href"))}return e},i.assembleIdentifier=function(t){var e={};return e.authority=t.getAttribute("authority"),e.content=t.textContent,e},i.assembleMetadataUrl=function(t){var e={};e.type=t.getAttribute("type");for(var i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];"Format"===n.localName?e.format=n.textContent:"OnlineResource"===n.localName&&(e.url=n.getAttribute("xlink:href"))}return e},i.assembleLegendUrl=function(t){var e={};e.width=i.getIntegerAttribute(t,"width"),e.height=i.getIntegerAttribute(t,"height");for(var r=t.children||t.childNodes,n=0;n<r.length;n++){var o=r[n];"Format"===o.localName?e.format=o.textContent:"OnlineResource"===o.localName&&(e.url=o.getAttribute("xlink:href"))}return e},i.assembleLogoUrl=function(t){var e={};e.width=i.getIntegerAttribute(t,"width"),e.height=i.getIntegerAttribute(t,"height");for(var r=t.children||t.childNodes,n=0;n<r.length;n++){var o=r[n];"Format"===o.localName?e.format=o.textContent:"OnlineResource"===o.localName&&(e.url=o.getAttribute("xlink:href"))}return e},i.assembleUrl=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];"Format"===n.localName?e.format=n.textContent:"OnlineResource"===n.localName&&(e.url=n.getAttribute("xlink:href"))}return e},i.getIntegerAttribute=function(t,e){var i=t.getAttribute(e);return i=i?parseInt(i):void 0},i.getFloatAttribute=function(t,e){var i=t.getAttribute(e);return i=i?parseFloat(i):void 0},i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(182),i(187)],n=function(t,e,i,r){"use strict";var n=function(i,r){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmtsLayerCapabilities","constructor","missingDomElement"));this.capabilities=r,this.identifier,this.title,this.abstract,this.keywords,this.wgs84BoundingBox,this.boundingBox,this.styles,this.formats,this.infoFormat,this.dimension,this.metadata,this.tileMatrixSetLink,this.resourceUrl,this.assembleLayer(i)};return n.prototype.assembleLayer=function(t){for(var e=t.children||t.childNodes,r=0;r<e.length;r++){var o=e[r];"Identifier"===o.localName?this.identifier=o.textContent:"Title"===o.localName?(this.title=this.title||[],this.title.push(new i(o))):"Abstract"===o.localName?(this.abstract=this.abstract||[],this.abstract.push(new i(o))):"WGS84BoundingBox"===o.localName?this.wgs84BoundingBox=n.assembleBoundingBox(o):"BoundingBox"===o.localName?(this.boundingBox=this.boundingBox||[],this.boundingBox.push(n.assembleBoundingBox(o))):"Style"===o.localName?(this.style=this.style||[],this.style.push(n.assembleStyle(o))):"Format"===o.localName?(this.format=this.format||[],this.format.push(o.textContent)):"InfoFormat"===o.localName?(this.infoFormat=this.infoFormat||[],this.infoFormat.push(o.textContent)):"Dimension"===o.localName?(this.dimension=this.dimension||[],this.dimension.push(n.assembleDimension(o))):"Metadata"===o.localName?(this.metadata=this.metadata||[],this.metadata.push(n.assembleMetadata(o))):"ResourceURL"===o.localName?(this.resourceUrl=this.resourceUrl||[],this.resourceUrl.push(n.assembleResourceUrl(o))):"TileMatrixSetLink"===o.localName&&(this.tileMatrixSetLink=this.tileMatrixSetLink||[],this.tileMatrixSetLink.push(n.assembleTileMatrixSetLink(o)))}},n.assembleStyle=function(t){var e={};e.isDefault=t.getAttribute("isDefault");for(var r=t.children||t.childNodes,o=0;o<r.length;o++){var s=r[o];"Identifier"===s.localName?e.identifier=s.textContent:"Title"===s.localName?(e.title=e.title||[],e.title.push(new i(s))):"Abstract"===s.localName?(e.abstract=e.abstract||[],e.abstract.push(new i(s))):"LegendURL"===s.localName&&(e.legendUrl=e.legendUrl||[],e.legendUrl.push(n.assembleLegendUrl(s)))}return e},n.assembleBoundingBox=function(t){var e={},i=t.getAttribute("crs");i&&(e.crs=i);for(var r=t.children||t.childNodes,n=0;n<r.length;n++){var o=r[n];if("LowerCorner"===o.localName){var s=o.textContent.split(" ");e.lowerCorner=[parseFloat(s[0]),parseFloat(s[1])]}else if("UpperCorner"===o.localName){var a=o.textContent.split(" ");e.upperCorner=[parseFloat(a[0]),parseFloat(a[1])]}}return e},n.assembleDimension=function(t){for(var e={},r=t.children||t.childNodes,n=0;n<r.length;n++){var o=r[n];"Identifier"===o.localName?e.identifier=o.textContent:"Title"===o.localName?(e.title=e.title||[],e.title.push(new i(o))):"Abstract"===o.localName?(e.abstract=e.abstract||[],e.abstract.push(new i(o))):"UOM"===o.localName?e.uom={name:o.getAttribute("name"),reference:o.getAttribute("reference")}:"UnitSymbol"==o.localName?e.unitSymbol=o.textContent:"Default"===o.localName?e.default=o.textContent:"Current"===o.localName?e.current="true"===o.textContent:"Value"===o.localName&&(e.value=e.value||[],e.value.push(o.textContent))}return e},n.assembleMetadata=function(t){var e={};return e},n.assembleResourceUrl=function(t){var e={};return e.format=t.getAttribute("format"),e.resourceType=t.getAttribute("resourceType"),e.template=t.getAttribute("template"),e},n.assembleLegendUrl=function(t){var e={};return e.format=t.getAttribute("format"),e.minScaleDenominator=t.getAttribute("minScaleDenominator"),e.maxScaleDenominator=t.getAttribute("maxScaleDenominator"),e.href=t.getAttribute("xlink:href"),e.width=t.getAttribute("width"),e.height=t.getAttribute("height"),e},n.assembleTileMatrixSetLink=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];"TileMatrixSet"===o.localName?e.tileMatrixSet=o.textContent:"TileMatrixSetLimits"===o.localName&&(e.tileMatrixSetLimits=n.assembleTileMatrixSetLimits(o))}return e},n.assembleTileMatrixSetLimits=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];"TileMatrixLimits"===o.localName&&(e.tileMatrixLimits=e.tileMatrixLimits||[],e.tileMatrixLimits.push(n.assembleTileMatrixLimits(o)))}return e},n.assembleTileMatrixLimits=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];"TileMatrix"===n.localName?e.tileMatrix=n.textContent:"MinTileRow"===n.localName?e.minTileRow=parseInt(n.textContent):"MaxTileRow"===n.localName?e.maxTileRow=parseInt(n.textContent):"MinTileCol"===n.localName?e.minTileCol=parseInt(n.textContent):"maxTileCol"===n.localName&&(e.maxTileCol=parseInt(n.textContent))}return e},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(14),i(8),i(191),i(48),i(176),i(84)],n=function(t,e,i,r,n,o,s){"use strict";var a=function(e,r){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"WmsLayer","constructor","No configuration specified."));var n=e.service+e.layerNames+e.styleNames;r&&(n+=r),o.call(this,e.sector,e.levelZeroDelta,e.numLevels,e.format,n,e.size,e.size),this.displayName=e.title,this.pickEnabled=!1,this.urlBuilder=new s(e.service,e.layerNames,e.styleNames,e.version,r),e.coordinateSystem&&(this.urlBuilder.crs=e.coordinateSystem),this.timeString=r};return a.prototype=Object.create(o.prototype),a.formLayerConfiguration=function(t){var i={title:t.title,version:t.capability.capsDoc.version},r=t.geographicBoundingBox||t.latLonBoundingBox;r&&r.westBoundLongitude?i.sector=new n(r.southBoundLatitude,r.northBoundLatitude,r.westBoundLongitude,r.eastBoundLongitude):r&&r.minx?i.sector=new n(r.miny,r.maxy,r.minx,r.maxx):i.sector=n.FULL_SPHERE,i.levelZeroDelta=new e(36,36),i.numLevels=19,i.size=256,i.layerNames=t.name;var o=t.capability.request.getMap,s=o.formats;s.indexOf("image/png")>=0?i.format="image/png":s.indexOf("image/jpeg")>=0?i.format="image/jpeg":s.indexOf("image/tiff")>=0?i.format="image/tiff":s.indexOf("image/gif")>=0&&(i.format="image/gif"),i.service=o.url;var l=t.crses;l||(l=t.srses),l&&(l.indexOf("EPSG:4326")>=0||l.indexOf("epsg:4326")>=0?i.coordinateSystem="EPSG:4326":(l.indexOf("CRS84")>=0||l.indexOf("CRS:84")>=0)&&(i.coordinateSystem="CRS:84"));var h=a.parseTimeDimensions(t);return h&&h.length>0&&(i.timeSequences=h),i},a.parseTimeDimensions=function(t){var e=t.extents||t.dimensions,i=null;if(e){i=[];for(var n=0;n<e.length;n++){var o=e[n];if("time"===o.name.toLowerCase()&&(!o.units||"iso8601"===o.units.toLowerCase()))for(var s=o.content.split(","),a=0;a<s.length;a++){var l=s[a],h=l.split("/");1===h.length?i.push(new Date(l)):3===h.length&&i.push(new r(l))}}}return i},a}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8)],n=function(t,e){"use strict";var i=function(r){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"PeriodicTimeSequence","constructor","missingString"));var n=r.split("/");if(3!==n.length)throw new t(e.logMessage(e.LEVEL_SEVERE,"PeriodicTimeSequence","constructor","The interval string "+r+" does not contain 3 elements."));this.sequenceString=r,this.startTime=new Date(n[0]),this.endTime=new Date(n[1]),this.intervalMilliseconds=this.endTime.getTime()-this.startTime.getTime(),this._currentTime=this.startTime,this.infiniteInterval=this.startTime.getTime()==this.endTime.getTime(),this.period=i.parsePeriodString(n[2],!1)};return Object.defineProperties(i.prototype,{currentTime:{get:function(){return this._currentTime},set:function(t){this._currentTime=t}},scaleForCurrentTime:{get:function(){return this.currentTime?(this.currentTime.getTime()-this.startTime.getTime())/this.intervalMilliseconds:1}}}),i.prototype.next=function(){return this.currentTime?this.currentTime.getTime()>=this.endTime.getTime()&&!this.infiniteInterval?this.currentTime=null:this.currentTime=i.incrementTime(this.currentTime,this.period):this.currentTime=this.startTime,this.currentTime},i.prototype.previous=function(){return this.currentTime?this.currentTime.getTime()===this.startTime.getTime()?this.currentTime=null:this.currentTime=this.getTimeForScale(.9999*this.scaleForCurrentTime):this.currentTime=this.endTime,this.currentTime},i.prototype.reset=function(){this.currentTime=null},i.prototype.getTimeForScale=function(t){if(t<=0)return this.startTime;if(t>=1)return this.endTime;var e=new Date(this.startTime.getTime()),r=e,n=0;for(n=0;n<t;n=(e.getTime()-this.startTime.getTime())/this.intervalMilliseconds)r=e,e=i.incrementTime(e,this.period);return r},i.incrementTime=function(t,e){var r=new Date(t.getTime());return 0!=e[0]&&r.setUTCFullYear(r.getUTCFullYear()+e[0]),0!=e[1]&&i.addMonths(r,e[1]),0!=e[2]&&r.setUTCDate(r.getUTCDate()+7*e[2]),0!=e[3]&&r.setUTCDate(r.getUTCDate()+e[3]),0!=e[4]&&r.setUTCHours(r.getUTCHours()+e[4]),0!=e[5]&&r.setUTCMinutes(r.getUTCMinutes()+e[5]),0!=e[6]&&r.setUTCSeconds(r.getUTCSeconds()+e[6]),r},i.isLeapYear=function(t){return t%4===0&&t%100!==0||t%400===0},i.getDaysInMonth=function(t,e){return[31,i.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][e]},i.addMonths=function(t,e){var r=t.getUTCDate();return t.setUTCDate(1),t.setUTCMonth(t.getUTCMonth()+e),t.setUTCDate(Math.min(r,i.getDaysInMonth(t.getUTCFullYear(),t.getUTCMonth()))),t},i.parsePeriodString=function(i,r){var n,o=!!r&&r,s=[2,3,4,5,7,8,9],a=[0,0,0,0,0,0,0],l=[0,12,4,7,24,60,60];if(i=i.toUpperCase(),!i)return a;if("string"!=typeof i)throw new t(e.logMessage(e.LEVEL_SEVERE,"PeriodicTimeSequence","parsePeriodString","Invalid ISO8601 period string '"+i+"'"));if(!(n=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(i)))throw new t(e.logMessage(e.LEVEL_SEVERE,"PeriodicTimeSequence","parsePeriodString","String '"+i+"' is not a valid ISO8601 period."));for(var h=0;h<s.length;h++){var c=s[h];a[h]=n[c]?+n[c].replace(/[A-Za-z]+/g,""):0}if(o)for(h=a.length-1;h>0;h--)a[h]>=l[h]&&(a[h-1]=a[h-1]+Math.floor(a[h]/l[h]),a[h]=a[h]%l[h]);return a},i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(14),i(48),i(70),i(193)],n=function(t,e,i,r){"use strict";var n=function(){i.call(this,e.FULL_SPHERE,new t(45,45),12,"image/tiff","EarthElevations256",256,256),this.displayName="WCS Earth Elevation Model",this.minElevation=-11e3,this.maxElevation=8850,this.pixelIsPoint=!1,this.urlBuilder=new r("https://worldwind26.arc.nasa.gov/wms2","NASA_SRTM30_900m_Tiled","1.0.0")};return n.prototype=Object.create(i.prototype),n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8)],n=function(t,e){"use strict";var i=function(i,r,n){if(!i||0===i.length)throw new t(e.logMessage(e.LEVEL_SEVERE,"WcsTileUrlBuilder","constructor","The WCS service address is missing."));if(!r||0===r.length)throw new t(e.logMessage(e.LEVEL_SEVERE,"WcsTileUrlBuilder","constructor","The WCS coverage name is missing."));this.serviceAddress=i,this.coverageName=r,this.wcsVersion=n&&n.length>0?n:"1.0.0",this.crs="EPSG:4326"};return i.prototype.urlForTile=function(r,n){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"WcsUrlBuilder","urlForTile","missingTile"));if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"WcsUrlBuilder","urlForTile","The coverage format is null or undefined."));var o=r.sector,s=i.fixGetCoverageString(this.serviceAddress);return s.search(/service=wcs/i)<0&&(s+="service=WCS"),s+="&request=GetCoverage",s=s+"&version="+this.wcsVersion,s=s+"&coverage="+this.coverageName,s=s+"&format="+n,s=s+"&width="+r.tileWidth,s=s+"&height="+r.tileHeight,s=s+"&crs="+this.crs,s+="&bbox=",s=s+o.minLongitude+","+o.minLatitude+",",s=s+o.maxLongitude+","+o.maxLatitude,s=s.replace(" ","%20")},i.fixGetCoverageString=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"WcsTileUrlBuilder","fixGetCoverageString","The specified service address is null or undefined."));var r=i.indexOf("?");return r<0?i+="?":r!==i.length-1&&(r=i.search(/&$/),r<0&&(i+="&")),i},i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(14),i(48),i(70),i(195)],n=function(t,e,i,r){"use strict";var n=function(n,o,s){i.call(this,e.FULL_SPHERE,new t(60,60),5,"application/bil16","EarthElevations",512,512),this.displayName=s,this.minElevation=-11e3,this.maxElevation=8850,this.urlBuilder=new r(n,o)};return n.prototype=Object.create(i.prototype),n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(56)],n=function(t,e,i){"use strict";var r=function(t,e){this.serverAddress=t,t&&0!==t.length||(this.serverAddress=i.currentUrlSansFilePart()),this.pathToData=e};return r.prototype.urlForTile=function(r,n){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","missingTile"));if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","The image format is null or undefined."));var o=this.serverAddress;return this.pathToData&&(o=o+"/"+this.pathToData),o=o+"/"+r.level.levelNumber.toString(),o=o+"/"+r.row.toString(),o=o+"/"+r.row.toString()+"_"+r.column.toString(),o=o+"."+i.suffixForMimeType(n),o=o.replace(" ","%20")},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=i(70),n=i(48),o=i(14),s=i(193),a=i(84),l=(i(195),function(t){var e=this;this.parameters=t,this.displayName="Custom Earth Elevation Model ("+e.parameters.type+")",this.minElevation=-11e3,this.maxElevation=8850,this.pixelIsPoint=!1;var i="image/tiff";"wcs"===e.parameters.type?(i="image/tiff",this.urlBuilder=new s(e.parameters.url&&"*"!==e.parameters.url?e.parameters.url:"https://worldwind26.arc.nasa.gov/wms2",e.parameters.layers?e.parameters.layers:"NASA_SRTM30_900m_Tiled","1.0.0")):"wms"===e.parameters.type&&(i="application/bil16",this.urlBuilder=new a(e.parameters.url&&"*"!==e.parameters.url?e.parameters.url:"https://worldwind26.arc.nasa.gov/elev",e.parameters.layers?e.parameters.layers:"GEBCO,aster_v2,USGS-NED","","1.3.0")),r.call(this,n.FULL_SPHERE,new o(45,45),12,i,"EarthElevations256",256,256)});l.prototype=Object.create(r.prototype),t.exports=l},function(t,e,i){var r,n;r=[i(10),i(9),i(198),i(199),i(200),i(201),i(14),i(48),i(8),i(203),i(202),i(204),i(56)],n=function(t,e,i,r,n,o,s,a,l,h,c,u,d){"use strict";var p=function(t){if(!t)throw new e(l.logMessage(l.LEVEL_SEVERE,"GeoTiffReader","constructor","missingUrl"));this._url=t,this._isLittleEndian=!1,this._imageFileDirectories=[],this._geoTiffData=null,this._metadata=new n};return Object.defineProperties(p.prototype,{url:{get:function(){return this._url}},isLittleEndian:{get:function(){return this._isLittleEndian}},imageFileDirectories:{get:function(){return this._imageFileDirectories}},geoTiffData:{get:function(){return this._geoTiffData}},metadata:{get:function(){return this._metadata}}}),p.prototype.requestUrl=function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status){var r=i.response;r&&(this.parse(r),e())}else l.log(l.LEVEL_WARNING,"GeoTiff retrieval failed ("+i.statusText+"): "+t)}.bind(this),i.onerror=function(){l.log(l.LEVEL_WARNING,"GeoTiff retrieval failed: "+t)},i.ontimeout=function(){l.log(l.LEVEL_WARNING,"GeoTiff retrieval timed out: "+t)},i.send(null)},p.prototype.parse=function(e){if(this._geoTiffData=new DataView(e),this.getEndianness(),!this.isTiffFileType())throw new t(l.logMessage(l.LEVEL_SEVERE,"GeoTiffReader","parse","invalidTiffFileType"));var i=o.getBytes(this.geoTiffData,4,4,this.isLittleEndian);this.parseImageFileDirectory(i),this.getMetadataFromImageFileDirectory(),this.parseGeoKeys(),this.setBBox()},p.prototype.getEndianness=function(){var e=o.getBytes(this.geoTiffData,0,2,this.isLittleEndian);if(18761===e)this._isLittleEndian=!0;else{if(19789!==e)throw new t(l.logMessage(l.LEVEL_SEVERE,"GeoTiffReader","getEndianness","invalidByteOrderValue"));this._isLittleEndian=!1}},p.prototype.isTiffFileType=function(){var t=o.getBytes(this.geoTiffData,2,2,this.isLittleEndian);return 42===t},p.prototype.isGeoTiff=function(){return!!this.getIFDByTag(i.Tag.GEO_KEY_DIRECTORY)},p.prototype.readAsImage=function(t){this.requestUrl(this.url,function(){var e=this.metadata.bitsPerSample,i=this.metadata.samplesPerPixel,r=this.metadata.photometricInterpretation,n=this.metadata.imageLength,o=this.metadata.imageWidth;if(this.metadata.colorMap)var s=this.metadata.colorMap,a=Math.pow(2,e[0]);var l=document.createElement("canvas");l.width=o,l.height=n;var h=l.getContext("2d");if(this.metadata.stripOffsets){var c=this.parseStrips(!1);if(this.metadata.rowsPerStrip)var u=this.metadata.rowsPerStrip;else var u=n;for(var d=c.length,p=0,f=u,g=n%u,m=0===g?u:g,E=0;E<d;E++){E+1===d&&(f=m);for(var v=c[E].length,y=p*E,_=0,T=0;T<v;_++)for(var L=0;L<o;L++,T++){var x=c[E][T];h.fillStyle=this.getFillStyle(x,r,e,i,s,a),h.fillRect(L,y+_,1,1)}p=u}}else if(this.metadata.tileOffsets)for(var b=this.parseTiles(!1),S=this.metadata.tileWidth,w=this.metadata.tileLength,M=Math.ceil(o/S),_=0;_<n;_++)for(var L=0;L<o;L++){var R=Math.floor(L/S),A=Math.floor(_/w),C=A*M+R,P=L%S,I=_%w,D=I*S+P,x=b[C][D];h.fillStyle=this.getFillStyle(x,r,e,i,s,a),h.fillRect(L,_,1,1)}this._geoTiffData=null,t(l)}.bind(this))},p.prototype.getFillStyle=function(t,e,i,r,n,s){var a=0,h=0,u=0,d=1;switch(this.metadata.noData&&t[0]==this.metadata.noData&&(d=0),e){case c.PhotometricInterpretation.WHITE_IS_ZERO:var p=Math.pow(2,i)-1;t[0]=p-t[0];case c.PhotometricInterpretation.BLACK_IS_ZERO:a=h=u=o.clampColorSample(t[0],i[0]);break;case c.PhotometricInterpretation.RGB:if(a=o.clampColorSample(t[0],i[0]),h=o.clampColorSample(t[1],i[1]),u=o.clampColorSample(t[2],i[2]),4===r&&2===this.metadata.extraSamples[0]){var f=Math.pow(2,i[3]);d=t[3]/f}break;case c.PhotometricInterpretation.RGB_PALETTE:if(n){var g=t[0];a=o.clampColorSample(n[g],16),h=o.clampColorSample(n[s+g],16),u=o.clampColorSample(n[2*s+g],16)}break;case c.PhotometricInterpretation.TRANSPARENCY_MASK:l.log(l.LEVEL_WARNING,"Photometric interpretation not yet implemented: TRANSPARENCY_MASK");break;case c.PhotometricInterpretation.CMYK:l.log(l.LEVEL_WARNING,"Photometric interpretation not yet implemented: CMYK");break;case c.PhotometricInterpretation.Y_Cb_Cr:l.log(l.LEVEL_WARNING,"Photometric interpretation not yet implemented: Y_Cb_Cr");break;case c.PhotometricInterpretation.CIE_LAB:l.log(l.LEVEL_WARNING,"Photometric interpretation not yet implemented: CIE_LAB");break;default:l.log("Unknown photometric interpretation: "+e)}return o.getRGBAFillValue(a,h,u,d)},p.prototype.createTypedElevationArray=function(){var t,e=[],i=this.metadata.bitsPerSample[0];if(this.metadata.stripOffsets)for(var r=this.parseStrips(!0),n=0;n<r.length;n++)e=e.concat(r[n]);else if(this.metadata.tileOffsets)for(var o=this.parseTiles(!0),s=this.metadata.imageWidth,a=this.metadata.imageLength,l=this.metadata.tileWidth,h=this.metadata.tileLength,u=Math.ceil(s/l),d=0;d<a;d++)for(var p=0;p<s;p++){var f=Math.floor(p/l),g=Math.floor(d/h),m=g*u+f,E=p%l,v=d%h,y=v*l+E,_=o[m][y];e.push(_)}if(this.metadata.sampleFormat)var T=this.metadata.sampleFormat[0];else var T=c.SampleFormat.UNSIGNED;switch(i){case 8:t=T===c.SampleFormat.SIGNED?new Int8Array(e):new Uint8Array(e);break;case 16:t=T===c.SampleFormat.SIGNED?new Int16Array(e):new Uint16Array(e);break;case 32:t=T===c.SampleFormat.SIGNED?new Int32Array(e):T===c.SampleFormat.IEEE_FLOAT?new Float32Array(e):new Uint32Array(e);break;case 64:t=new Float64Array(e)}return t},p.prototype.readAsData=function(t){this.requestUrl(this.url,function(){t(this.createTypedElevationArray())}.bind(this))},p.prototype.parseStrips=function(t){var e=this.metadata.samplesPerPixel,i=this.metadata.bitsPerSample,r=this.metadata.stripOffsets,n=this.metadata.stripByteCounts,o=this.metadata.compression;if(this.metadata.sampleFormat)var s=this.metadata.sampleFormat;else var s=c.SampleFormat.UNSIGNED;for(var a=e*i[0],l=a/8,h=[],u=0;u<r.length;u++){var d=r[u],p=n[u];h[u]=this.parseBlock(t,o,l,p,d,i,s)}return h},p.prototype.parseBlock=function(t,e,i,r,n,s,a){var h=[];switch(e){case c.Compression.UNCOMPRESSED:for(var u=0,d=i;u<r;u+=d){for(var p=0,f=[];p<s.length;p++){var g=s[p]/8,m=p*g;f.push(o.getSampleBytes(this.geoTiffData,n+u+m,g,a[p],this.isLittleEndian))}t?h.push(f[0]):h.push(f)}break;case c.Compression.CCITT_1D:l.log(l.LEVEL_WARNING,"Compression type not yet implemented: CCITT_1D");break;case c.Compression.GROUP_3_FAX:l.log(l.LEVEL_WARNING,"Compression type not yet implemented: GROUP_3_FAX");break;case c.Compression.GROUP_4_FAX:l.log(l.LEVEL_WARNING,"Compression type not yet implemented: GROUP_4_FAX");break;case c.Compression.LZW:l.log(l.LEVEL_WARNING,"Compression type not yet implemented: LZW");break;case c.Compression.JPEG:l.log(l.LEVEL_WARNING,"Compression type not yet implemented: JPEG");break;case c.Compression.PACK_BITS:if(this.metadata.tileOffsets)var E=this.metadata.tileWidth,v=this.metadata.tileWidth,y=new ArrayBuffer(E*v*i);else var _=this.metadata.rowsPerStrip,T=this.metadata.imageWidth,y=new ArrayBuffer(_*T*i);for(var L=new DataView(y),x=!0,f=[],b=0,S=0,w=0,u=0;u<r;u+=1)if(x){b=1,S=1,x=!1;var M=this.geoTiffData.getInt8(n+u,this.isLittleEndian);M>=0&&M<=127?b=M+1:M>=-127&&M<=-1?S=-M+1:x=!0}else{for(var R=o.getBytes(this.geoTiffData,n+u,1,this.isLittleEndian),A=0;A<S;A++)L.setInt8(w,R),w++;b--,0===b&&(x=!0)}for(var u=0,d=i;u<y.byteLength;u+=d){for(var p=0,f=[];p<s.length;p++){var g=s[p]/8,m=p*g;f.push(o.getSampleBytes(L,u+m,g,a[p],this.isLittleEndian))}t?h.push(f[0]):h.push(f)}}return h},p.prototype.parseTiles=function(t){var e=this.metadata.samplesPerPixel,i=this.metadata.bitsPerSample,r=this.metadata.compression;if(this.metadata.sampleFormat)var n=this.metadata.sampleFormat;else{var n=new Array(e);d.fillArray(n,c.SampleFormat.UNSIGNED)}for(var o=e*i[0],s=o/8,a=this.metadata.tileWidth,l=this.metadata.tileLength,h=this.metadata.tileOffsets,u=this.metadata.tileByteCounts,p=this.metadata.imageLength,f=this.metadata.imageWidth,g=Math.ceil(f/a),m=Math.ceil(p/l),E=[],v=0;v<m;v++)for(var y=0;y<g;y++){var _=g*v+y,T=h[_],L=u[_];E[_]=this.parseBlock(t,r,s,L,T,i,n)}return E},p.prototype.geoTiffImageToPCS=function(t,i){if(null===t||void 0===t)throw new e(l.logMessage(l.LEVEL_SEVERE,"GeoTiffReader","geoTiffImageToPCS","missingXValue"));if(null===i||void 0===i)throw new e(l.logMessage(l.LEVEL_SEVERE,"GeoTiffReader","geoTiffImageToPCS","missingYValue"));var r=[t,i],n=this.metadata.modelTiepoint,o=this.metadata.modelPixelScale,a=this.metadata.modelTransformation,c=n?n.length:0,u=o?o.length:0,d=a?a.length:0;if(c>6&&0===u);else if(16===d){var p=t,f=i;t=p*a[0]+f*a[1]+a[3],i=p*a[4]+f*a[5]+a[7],r=[t,i]}else u<3||c<6?r=[t,i]:(t=(t-n[0])*o[0]+n[3],i=(i-n[1])*(-1*o[1])+n[4],r=[t,i]);return h.defs([["EPSG:26771","+proj=tmerc +lat_0=36.66666666666666 +lon_0=-88.33333333333333 +k=0.9999749999999999 +x_0=152400.3048006096 +y_0=0 +ellps=clrk66 +datum=NAD27 +to_meter=0.3048006096012192 +no_defs "],["EPSG:32633","+proj=utm +zone=33 +datum=WGS84 +units=m +no_defs"]]),this.metadata.projectedCSType&&(r=h("EPSG:"+this.metadata.projectedCSType,"EPSG:4326",r)),new s(r[1],r[0])},p.prototype.setBBox=function(){var t=this.geoTiffImageToPCS(0,0),e=this.geoTiffImageToPCS(this.metadata.imageWidth,0),i=this.geoTiffImageToPCS(0,this.metadata.imageLength);this.geoTiffImageToPCS(this.metadata.imageWidth,this.metadata.imageLength);this.metadata.bbox=new a(i.latitude,t.latitude,t.longitude,e.longitude)},p.prototype.getMetadataFromImageFileDirectory=function(){for(var t=0;t<this.imageFileDirectories[0].length;t++)switch(this.imageFileDirectories[0][t].tag){case c.Tag.BITS_PER_SAMPLE:this.metadata.bitsPerSample=this.imageFileDirectories[0][t].getIFDEntryValue();break;case c.Tag.COLOR_MAP:this.metadata.colorMap=this.imageFileDirectories[0][t].getIFDEntryValue();break;case c.Tag.COMPRESSION:this.metadata.compression=this.imageFileDirectories[0][t].getIFDEntryValue()[0];break;case c.Tag.EXTRA_SAMPLES:this.metadata.extraSamples=this.imageFileDirectories[0][t].getIFDEntryValue();break;case c.Tag.IMAGE_LENGTH:this.metadata.imageLength=this.imageFileDirectories[0][t].getIFDEntryValue()[0];break;case c.Tag.IMAGE_WIDTH:this.metadata.imageWidth=this.imageFileDirectories[0][t].getIFDEntryValue()[0];break;case c.Tag.MAX_SAMPLE_VALUE:this.metadata.maxSampleValue=this.imageFileDirectories[0][t].getIFDEntryValue()[0];break;case c.Tag.MIN_SAMPLE_VALUE:this.metadata.minSampleValue=this.imageFileDirectories[0][t].getIFDEntryValue()[0];break;case c.Tag.ORIENTATION:this.metadata.orientation=this.imageFileDirectories[0][t].getIFDEntryValue()[0];break;case c.Tag.PHOTOMETRIC_INTERPRETATION:this.metadata.photometricInterpretation=this.imageFileDirectories[0][t].getIFDEntryValue()[0];break;case c.Tag.PLANAR_CONFIGURATION:this.metadata.planarConfiguration=this.imageFileDirectories[0][t].getIFDEntryValue()[0];break;case c.Tag.ROWS_PER_STRIP:this.metadata.rowsPerStrip=this.imageFileDirectories[0][t].getIFDEntryValue()[0];break;case c.Tag.RESOLUTION_UNIT:this.metadata.resolutionUnit=this.imageFileDirectories[0][t].getIFDEntryValue()[0];break;case c.Tag.SAMPLES_PER_PIXEL:this.metadata.samplesPerPixel=this.imageFileDirectories[0][t].getIFDEntryValue()[0];break;case c.Tag.SAMPLE_FORMAT:this.metadata.sampleFormat=this.imageFileDirectories[0][t].getIFDEntryValue();break;case c.Tag.SOFTWARE:this.metadata.software=this.imageFileDirectories[0][t].getIFDEntryValue();break;case c.Tag.STRIP_BYTE_COUNTS:this.metadata.stripByteCounts=this.imageFileDirectories[0][t].getIFDEntryValue();break;case c.Tag.STRIP_OFFSETS:this.metadata.stripOffsets=this.imageFileDirectories[0][t].getIFDEntryValue();break;case c.Tag.TILE_BYTE_COUNTS:this.metadata.tileByteCounts=this.imageFileDirectories[0][t].getIFDEntryValue();break;case c.Tag.TILE_OFFSETS:this.metadata.tileOffsets=this.imageFileDirectories[0][t].getIFDEntryValue();break;case c.Tag.TILE_LENGTH:this.metadata.tileLength=this.imageFileDirectories[0][t].getIFDEntryValue();break;case c.Tag.TILE_WIDTH:this.metadata.tileWidth=this.imageFileDirectories[0][t].getIFDEntryValue();break;case c.Tag.X_RESOLUTION:this.metadata.xResolution=this.imageFileDirectories[0][t].getIFDEntryValue();break;case c.Tag.Y_RESOLUTION:this.metadata.tileWidth=this.imageFileDirectories[0][t].getIFDEntryValue();break;case i.Tag.GEO_ASCII_PARAMS:this.metadata.geoAsciiParams=this.imageFileDirectories[0][t].getIFDEntryValue();break;case i.Tag.GEO_DOUBLE_PARAMS:this.metadata.geoDubleParams=this.imageFileDirectories[0][t].getIFDEntryValue();break;case i.Tag.GEO_KEY_DIRECTORY:this.metadata.geoKeyDirectory=this.imageFileDirectories[0][t].getIFDEntryValue();break;case i.Tag.MODEL_PIXEL_SCALE:this.metadata.modelPixelScale=this.imageFileDirectories[0][t].getIFDEntryValue();break;case i.Tag.MODEL_TIEPOINT:this.metadata.modelTiepoint=this.imageFileDirectories[0][t].getIFDEntryValue();break;case i.Tag.GDAL_NODATA:this.metadata.noData=this.imageFileDirectories[0][t].getIFDEntryValue();break;default:l.log(l.LEVEL_WARNING,"Ignored GeoTiff tag: "+this.imageFileDirectories[0][t].tag)}},p.prototype.getMetadataFromGeoKeys=function(){for(var t=0;t<this.geoKeys.length;t++){var e=o.getTagValueAsString(i.Key,this.geoKeys[t].keyId);e?this._metadata.geotiff.geoKeys[e]=this.geoKeys[t].getGeoKeyValue(this.metadata.geoDoubleParams,this.metadata.geoAsciiParams):l.log(l.LEVEL_WARNING,"Unknown GeoTiff key: "+this.geoKeys[t].keyId)}},p.prototype.parseGeoKeys=function(){if(!this.isGeoTiff())throw new t(l.logMessage(l.LEVEL_SEVERE,"GeoTiffReader","parse","invalidGeoTiffFile"));var e=this.metadata.geoKeyDirectory;if(!e)throw new t(l.logMessage(l.LEVEL_SEVERE,"GeoTiffReader","parseGeoKeys","missingGeoKeyDirectoryTag"));for(var n=(e[0],e[1],e[2],e[3]),o=0;o<n;o++){var s=e[4+4*o],a=e[5+4*o],h=e[6+4*o],c=e[7+4*o];switch(s){case i.Key.GTModelTypeGeoKey:this.metadata.gtModelTypeGeoKey=new r(s,a,h,c).getGeoKeyValue(this.metadata.geoDoubleParams,this.metadata.geoAsciiParams);break;case i.Key.GTRasterTypeGeoKey:
this.metadata.gtRasterTypeGeoKey=new r(s,a,h,c).getGeoKeyValue(this.metadata.geoDoubleParams,this.metadata.geoAsciiParams);break;case i.Key.GTCitationGeoKey:this.metadata.gtCitationGeoKey=new r(s,a,h,c).getGeoKeyValue(this.metadata.geoDoubleParams,this.metadata.geoAsciiParams);break;case i.Key.GeographicTypeGeoKey:this.metadata.geographicTypeGeoKey=new r(s,a,h,c).getGeoKeyValue(this.metadata.geoDoubleParams,this.metadata.geoAsciiParams);break;case i.Key.GeogCitationGeoKey:this.metadata.geogCitationGeoKey=new r(s,a,h,c).getGeoKeyValue(this.metadata.geoDoubleParams,this.metadata.geoAsciiParams);break;case i.Key.GeogAngularUnitsGeoKey:this.metadata.geogAngularUnitsGeoKey=new r(s,a,h,c).getGeoKeyValue(this.metadata.geoDoubleParams,this.metadata.geoAsciiParams);break;case i.Key.GeogAngularUnitSizeGeoKey:this.metadata.geogAngularUnitSizeGeoKey=new r(s,a,h,c).getGeoKeyValue(this.metadata.geoDoubleParams,this.metadata.geoAsciiParams);break;case i.Key.GeogSemiMajorAxisGeoKey:this.metadata.geogSemiMajorAxisGeoKey=new r(s,a,h,c).getGeoKeyValue(this.metadata.geoDoubleParams,this.metadata.geoAsciiParams);break;case i.Key.GeogInvFlatteningGeoKey:this.metadata.geogInvFlatteningGeoKey=new r(s,a,h,c).getGeoKeyValue(this.metadata.geoDoubleParams,this.metadata.geoAsciiParams);break;case i.Key.ProjectedCSTypeGeoKey:this.metadata.projectedCSType=new r(s,a,h,c).getGeoKeyValue(this.metadata.geoDoubleParams,this.metadata.geoAsciiParams);break;default:l.log(l.LEVEL_WARNING,"Ignored GeoTiff key: "+s)}}},p.prototype.parseImageFileDirectory=function(t){if(!t)throw new e(l.logMessage(l.LEVEL_SEVERE,"GeoTiffReader","parseImageFileDirectory","missingOffset"));for(var i=o.getBytes(this.geoTiffData,t,2,this.isLittleEndian),r=[],n=t+2,s=0;s<i;n+=12,s++){var a=o.getBytes(this.geoTiffData,n,2,this.isLittleEndian),h=o.getBytes(this.geoTiffData,n+2,2,this.isLittleEndian),c=o.getBytes(this.geoTiffData,n+4,4,this.isLittleEndian),d=o.getBytes(this.geoTiffData,n+8,4,this.isLittleEndian);r.push(new u(a,h,c,d,this.geoTiffData,this.isLittleEndian))}this._imageFileDirectories.push(r);var p=o.getBytes(this.geoTiffData,n,4,this.isLittleEndian);0!==p&&this.parseImageFileDirectory(p)},p.prototype.getIFDByTag=function(t){if(!t)throw new e(l.logMessage(l.LEVEL_SEVERE,"GeoTiffReader","getIFDByTag","missingTag"));for(var i=0;i<this.imageFileDirectories[0].length;i++)if(this.imageFileDirectories[0][i].tag===t)return this.imageFileDirectories[0][i];return null},p}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[],n=function(){"use strict";var t={Tag:{MODEL_PIXEL_SCALE:33550,MODEL_TRANSFORMATION:34264,MODEL_TIEPOINT:33922,GEO_KEY_DIRECTORY:34735,GEO_DOUBLE_PARAMS:34736,GEO_ASCII_PARAMS:34737,GDAL_NODATA:42113,GDAL_METADATA:42112},Key:{GTModelTypeGeoKey:1024,GTRasterTypeGeoKey:1025,GTCitationGeoKey:1026,GeographicTypeGeoKey:2048,GeogCitationGeoKey:2049,GeogGeodeticDatumGeoKey:2050,GeogPrimeMeridianGeoKey:2051,GeogLinearUnitsGeoKey:2052,GeogLinearUnitSizeGeoKey:2053,GeogAngularUnitsGeoKey:2054,GeogAngularUnitSizeGeoKey:2055,GeogEllipsoidGeoKey:2056,GeogSemiMajorAxisGeoKey:2057,GeogSemiMinorAxisGeoKey:2058,GeogInvFlatteningGeoKey:2059,GeogAzimuthUnitsGeoKey:2060,GeogPrimeMeridianLongGeoKey:2061,GeogTOWGS84GeoKey:2062,ProjectedCSTypeGeoKey:3072,PCSCitationGeoKey:3073,ProjectionGeoKey:3074,ProjCoordTransGeoKey:3075,ProjLinearUnitsGeoKey:3076,ProjLinearUnitSizeGeoKey:3077,ProjStdParallel1GeoKey:3078,ProjStdParallel2GeoKey:3079,ProjNatOriginLongGeoKey:3080,ProjNatOriginLatGeoKey:3081,ProjFalseEastingGeoKey:3082,ProjFalseNorthingGeoKey:3083,ProjFalseOriginLongGeoKey:3084,ProjFalseOriginLatGeoKey:3085,ProjFalseOriginEastingGeoKey:3086,ProjFalseOriginNorthingGeoKey:3087,ProjCenterLongGeoKey:3088,ProjCenterLatGeoKey:3089,ProjCenterEastingGeoKey:3090,ProjCenterNorthingGeoKey:3091,ProjScaleAtNatOriginGeoKey:3092,ProjScaleAtCenterGeoKey:3093,ProjAzimuthAngleGeoKey:3094,ProjStraightVertPoleLongGeoKey:3095,VerticalCSTypeGeoKey:4096,VerticalCitationGeoKey:4097,VerticalDatumGeoKey:4098,VerticalUnitsGeoKey:4099}};return t}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(10),i(9),i(198),i(8)],n=function(t,e,i,r){"use strict";var n=function(t,i,n,o){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"GeoTiffKeyEntry","constructor","missingKeyId"));if(null===i||void 0===i)throw new e(r.logMessage(r.LEVEL_SEVERE,"GeoTiffKeyEntry","constructor","missingTiffTagLocation"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"GeoTiffKeyEntry","constructor","missingCount"));if(null===o||void 0===o)throw new e(r.logMessage(r.LEVEL_SEVERE,"GeoTiffKeyEntry","constructor","missingValueOffset"));this._keyId=t,this._tiffTagLocation=i,this._count=n,this._valueOffset=o};return Object.defineProperties(n.prototype,{keyId:{get:function(){return this._keyId}},tiffTagLocation:{get:function(){return this._tiffTagLocation}},count:{get:function(){return this._count}},valueOffset:{get:function(){return this._valueOffset}}}),n.prototype.getGeoKeyValue=function(t,e){var r;if(0===this.tiffTagLocation)r=this.valueOffset;else if(this.tiffTagLocation===i.Tag.GEO_ASCII_PARAMS){var n="";if(e){for(var o=this.valueOffset;o<this.count-1;o++)n+=e[o];"|"!=e[this.count-1]&&(n+=e[this.count-1]),r=n}}else this.tiffTagLocation===i.Tag.GEO_DOUBLE_PARAMS&&t&&(r=t[this.valueOffset]);return r},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[],n=function(){"use strict";var t=function(){this._bitsPerSample=null,this._colorMap=null,this._compression=null,this._extraSamples=null,this._imageLength=null,this._imageWidth=null,this._maxSampleValue=null,this._minSampleValue=null,this._orientation=0,this._photometricInterpretation=null,this._planarConfiguration=null,this._resolutionUnit=null,this._rowsPerStrip=null,this._samplesPerPixel=null,this._sampleFormat=null,this._software=null,this._stripByteCounts=null,this._stripOffsets=null,this._tileByteCounts=null,this._tileOffsets=null,this._tileLength=null,this._tileWidth=null,this._xResolution=null,this._yResolution=null,this._geoAsciiParams=null,this._geoDoubleParams=null,this._geoKeyDirectory=null,this._modelPixelScale=null,this._modelTiepoint=null,this._modelTransformation=null,this._noData=null,this._bbox=null,this._gtModelTypeGeoKey=null,this._gtRasterTypeGeoKey=null,this._gtCitationGeoKey=null,this._geographicTypeGeoKey=null,this._geogCitationGeoKey=null,this._geogAngularUnitsGeoKey=null,this._geogAngularUnitSizeGeoKey=null,this._geogSemiMajorAxisGeoKey=null,this._geogInvFlatteningGeoKey=null,this._projectedCSType=null};return Object.defineProperties(t.prototype,{bitsPerSample:{get:function(){return this._bitsPerSample},set:function(t){this._bitsPerSample=t}},colorMap:{get:function(){return this._colorMap},set:function(t){this._colorMap=t}},compression:{get:function(){return this._compression},set:function(t){this._compression=t}},extraSamples:{get:function(){return this._extraSamples},set:function(t){this._extraSamples=t}},imageLength:{get:function(){return this._imageLength},set:function(t){this._imageLength=t}},imageWidth:{get:function(){return this._imageWidth},set:function(t){this._imageWidth=t}},maxSampleValue:{get:function(){return this._maxSampleValue},set:function(t){this._maxSampleValue=t}},minSampleValue:{get:function(){return this._minSampleValue},set:function(t){this._minSampleValue=t}},orientation:{get:function(){return this._orientation},set:function(t){this._orientation=t}},photometricInterpretation:{get:function(){return this._photometricInterpretation},set:function(t){this._photometricInterpretation=t}},planarConfiguration:{get:function(){return this._planarConfiguration},set:function(t){this._planarConfiguration=t}},resolutionUnit:{get:function(){return this._resolutionUnit},set:function(t){this._resolutionUnit=t}},rowsPerStrip:{get:function(){return this._rowsPerStrip},set:function(t){this._rowsPerStrip=t}},samplesPerPixel:{get:function(){return this._samplesPerPixel},set:function(t){this._samplesPerPixel=t}},sampleFormat:{get:function(){return this._sampleFormat},set:function(t){this._sampleFormat=t}},software:{get:function(){return this._software},set:function(t){this._software=t}},stripByteCounts:{get:function(){return this._stripByteCounts},set:function(t){this._stripByteCounts=t}},stripOffsets:{get:function(){return this._stripOffsets},set:function(t){this._stripOffsets=t}},tileByteCounts:{get:function(){return this._tileByteCounts},set:function(t){this._tileByteCounts=t}},tileOffsets:{get:function(){return this._tileOffsets},set:function(t){this._tileOffsets=t}},tileLength:{get:function(){return this._tileLength},set:function(t){this._tileLength=t}},tileWidth:{get:function(){return this._tileWidth},set:function(t){this._tileWidth=t}},geoAsciiParams:{get:function(){return this._geoAsciiParams},set:function(t){this._geoAsciiParams=t}},geoDoubleParams:{get:function(){return this._geoDoubleParams},set:function(t){this._geoDoubleParams=t}},geoKeyDirectory:{get:function(){return this._geoKeyDirectory},set:function(t){this._geoKeyDirectory=t}},modelPixelScale:{get:function(){return this._modelPixelScale},set:function(t){this._modelPixelScale=t}},modelTiepoint:{get:function(){return this._modelTiepoint},set:function(t){this._modelTiepoint=t}},modelTransformation:{get:function(){return this._modelTransformation},set:function(t){this._modelTransformation=t}},noData:{get:function(){return this._noData},set:function(t){this._noData=t}},bbox:{get:function(){return this._bbox},set:function(t){this._bbox=t}},gtModelTypeGeoKey:{get:function(){return this._gtModelTypeGeoKey},set:function(t){this._gtModelTypeGeoKey=t}},gtRasterTypeGeoKey:{get:function(){return this._gtRasterTypeGeoKey},set:function(t){this._gtRasterTypeGeoKey=t}},gtCitationGeoKey:{get:function(){return this._gtCitationGeoKey},set:function(t){this._gtCitationGeoKey=t}},geographicTypeGeoKey:{get:function(){return this._geographicTypeGeoKey},set:function(t){this._geographicTypeGeoKey=t}},geogCitationGeoKey:{get:function(){return this._geogCitationGeoKey},set:function(t){this._geogCitationGeoKey=t}},geogAngularUnitsGeoKey:{get:function(){return this._geogAngularUnitsGeoKey},set:function(t){this._geogAngularUnitsGeoKey=t}},geogAngularUnitSizeGeoKey:{get:function(){return this._geogAngularUnitSizeGeoKey},set:function(t){this._geogAngularUnitSizeGeoKey=t}},geogSemiMajorAxisGeoKey:{get:function(){return this._geogSemiMajorAxisGeoKey},set:function(t){this._geogSemiMajorAxisGeoKey=t}},geogInvFlatteningGeoKey:{get:function(){return this._geogInvFlatteningGeoKey},set:function(t){this._geogInvFlatteningGeoKey=t}},projectedCSType:{get:function(){return this._projectedCSType},set:function(t){this._projectedCSType=t}},xResolution:{get:function(){return this._xResolution},set:function(t){this._xResolution=t}},yResolution:{get:function(){return this._yResolution},set:function(t){this._yResolution=t}}}),t}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8),i(202)],n=function(t,e,i){"use strict";var r={getBytes:function(i,r,n,o,s){if(n<=0)throw new t(e.logMessage(e.LEVEL_SEVERE,"GeoTiffReader","getBytes","noBytesRequested"));if(n<=1)return s?i.getInt8(r,o):i.getUint8(r,o);if(n<=2)return s?i.getInt16(r,o):i.getUint16(r,o);if(n<=3)return s?i.getInt32(r,o)>>>8:i.getUint32(r,o)>>>8;if(n<=4)return s?i.getInt32(r,o):i.getUint32(r,o);if(n<=8)return i.getFloat64(r,o);throw new t(e.logMessage(e.LEVEL_SEVERE,"GeoTiffReader","getBytes","tooManyBytesRequested"))},getSampleBytes:function(t,r,n,o,s){var a;switch(o){case i.SampleFormat.UNSIGNED:a=this.getBytes(t,r,n,s,!1);break;case i.SampleFormat.SIGNED:a=this.getBytes(t,r,n,s,!0);break;case i.SampleFormat.IEEE_FLOAT:3==n?a=t.getFloat32(r,s)>>>8:4==n?a=t.getFloat32(r,s):8==n?a=t.getFloat64(r,s):e.log(e.LEVEL_WARNING,"Do not attempt to parse the data  not handled: "+n);break;case i.SampleFormat.UNDEFINED:default:a=this.getBytes(t,r,n,s,!1)}return a},canvasToTiffImage:function(t){var e=new Image;return e.src=t.toDataURL(),e},getRGBAFillValue:function(t,e,i,r){return"undefined"==typeof r&&(r=1),"rgba("+t+", "+e+", "+i+", "+r+")"},getTagValueAsString:function(t,e){for(var i in t)if(t[i]===e)return i},clampColorSample:function(t,e){var i=Math.pow(2,8-e);return Math.floor(t*i+(i-1))},clampColorSampleForElevation:function(t,e,i){var r=255/(i-e);return Math.round(r*(t-e))},getMinMaxGeotiffSamples:function(t,e){for(var i=1/0,r=-(1/0),n=0;n<t.length;n++)for(var o=0;o<t[n].length;o++)for(var s=0;s<t[n][o].length;s++)t[n][o][s]!=e&&(t[n][o][s]>r&&(r=t[n][o][s]),t[n][o][s]<i&&(i=t[n][o][s]));return{max:r,min:i}}};return r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[],n=function(){"use strict";var t={Tag:{NEW_SUBFILE_TYPE:254,SUBFILE_TYPE:255,IMAGE_WIDTH:256,IMAGE_LENGTH:257,BITS_PER_SAMPLE:258,COMPRESSION:259,PHOTOMETRIC_INTERPRETATION:262,THRESHHOLDING:263,CELL_WIDTH:264,CELL_LENGTH:265,FILL_ORDER:266,DOCUMENT_NAME:269,IMAGE_DESCRIPTION:270,MAKE:271,MODEL:272,STRIP_OFFSETS:273,ORIENTATION:274,SAMPLES_PER_PIXEL:277,ROWS_PER_STRIP:278,STRIP_BYTE_COUNTS:279,MIN_SAMPLE_VALUE:280,MAX_SAMPLE_VALUE:281,X_RESOLUTION:282,Y_RESOLUTION:283,PLANAR_CONFIGURATION:284,PAGE_NAME:285,X_POSITION:286,Y_POSITION:287,FREE_OFFSETS:288,FREE_BYTE_COUNTS:289,GRAY_RESPONSE_UNIT:290,GRAY_RESPONSE_CURVE:291,T4_OPTIONS:292,T6_PTIONS:293,RESOLUTION_UNIT:296,PAGE_NUMBER:297,TRANSFER_FUNCTION:301,SOFTWARE:305,DATE_TIME:306,ARTIST:315,HOST_COMPUTER:316,PREDICTOR:317,WHITE_POINT:318,PRIMARY_CHROMATICITIES:319,COLOR_MAP:320,HALFTONE_HINTS:321,TILE_WIDTH:322,TILE_LENGTH:323,TILE_OFFSETS:324,TILE_BYTE_COUNTS:325,INK_SET:332,INK_NAMES:333,NUMBER_OF_INKS:334,DOT_RANGE:336,TARGET_PRINTER:337,EXTRA_SAMPLES:338,SAMPLE_FORMAT:339,S_MIN_SAMPLE_VALUE:340,S_MAX_SAMPLE_VALUE:341,TRANSFER_RANGE:342,JPEG_PROC:512,JPEG_INTERCHANGE_FORMAT:513,JPEG_INTERCHANGE_FORMAT_LENGTH:514,JPEG_RESTART_INTERVAL:515,JPEG_LOSSLESS_PREDICTORS:517,JPEG_POINT_TRANSFORMS:518,JPEG_Q_TABLES:519,JPEG_DC_TABLES:520,JPEG_AC_TABLES:521,Y_Cb_Cr_COEFFICIENTS:529,Y_Cb_Cr_SUB_SAMPLING:530,Y_Cb_Cr_POSITIONING:531,REFERENCE_BLACK_WHITE:532,COPYRIGHT:33432},Compression:{UNCOMPRESSED:1,CCITT_1D:2,GROUP_3_FAX:3,GROUP_4_FAX:4,LZW:5,JPEG:6,PACK_BITS:32773},Orientation:{Row0_IS_TOP__Col0_IS_LHS:1,Row0_IS_TOP__Col0_IS_RHS:2,Row0_IS_BOTTOM__Col0_IS_RHS:3,Row0_IS_BOTTOM__Col0_IS_LHS:4,Row0_IS_LHS__Col0_IS_TOP:5,Row0_IS_RHS__Col0_IS_TOP:6,Row0_IS_RHS__Col0_IS_BOTTOM:7,Row0_IS_LHS__Col0_IS_BOTTOM:8},PhotometricInterpretation:{WHITE_IS_ZERO:0,BLACK_IS_ZERO:1,RGB:2,RGB_PALETTE:3,TRANSPARENCY_MASK:4,CMYK:5,Y_Cb_Cr:6,CIE_LAB:7},PlanarConfiguration:{CHUNKY:1,PLANAR:2},ResolutionUnit:{NONE:1,INCH:2,CENTIMETER:3},SampleFormat:{UNSIGNED:1,SIGNED:2,IEEE_FLOAT:3,UNDEFINED:4,DEFAULT:1},Type:{BYTE:1,ASCII:2,SHORT:3,LONG:4,RATIONAL:5,SBYTE:6,UNDEFINED:7,SSHORT:8,SLONG:9,SRATIONAL:10,FLOAT:11,DOUBLE:12}};return t}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,r;!function(e){t.exports=e()}(function(){return function t(e,i,n){function o(a,l){if(!i[a]){if(!e[a]){var h="function"==typeof r&&r;if(!l&&h)return r(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=i[a]={exports:{}};e[a][0].call(c.exports,function(t){var i=e[a][1][t];return o(i?i:t)},c,c.exports,t,e,i,n)}return i[a].exports}for(var s="function"==typeof r&&r,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(t,e,i){function r(t,e,i){if(!(this instanceof r))return new r(t,e,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&"undefined"==typeof e){var n=t.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=t,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var n=t("mgrs");r.fromMGRS=function(t){return new r(n.toPoint(t))},r.prototype.toMGRS=function(t){return n.forward([this.x,this.y],t)},e.exports=r},{mgrs:66}],2:[function(t,e,i){function r(t,e){if(!(this instanceof r))return new r(t);e=e||function(t){if(t)throw t};var i=n(t);if("object"!=typeof i)return void e(t);var s=a(i),l=r.projections.get(s.projName);l?(o(this,s),o(this,l),this.init(),e(null,this)):e(t)}var n=t("./parseCode"),o=t("./extend"),s=t("./projections"),a=t("./deriveConstants");r.projections=s,r.projections.start(),e.exports=r},{"./deriveConstants":32,"./extend":33,"./parseCode":36,"./projections":38}],3:[function(t,e,i){e.exports=function(t,e,i){var r,n,o,s=i.x,a=i.y,l=i.z||0;for(o=0;o<3;o++)if(!e||2!==o||void 0!==i.z)switch(0===o?(r=s,n="x"):1===o?(r=a,n="y"):(r=l,n="z"),t.axis[o]){case"e":i[n]=r;break;case"w":i[n]=-r;break;case"n":i[n]=r;break;case"s":i[n]=-r;break;case"u":void 0!==i[n]&&(i.z=r);break;case"d":void 0!==i[n]&&(i.z=-r);break;default:return null}return i}},{}],4:[function(t,e,i){var r=Math.PI/2,n=t("./sign");e.exports=function(t){return Math.abs(t)<r?t:t-n(t)*Math.PI}},{"./sign":21}],5:[function(t,e,i){var r=2*Math.PI,n=3.14159265359,o=t("./sign");e.exports=function(t){return Math.abs(t)<=n?t:t-o(t)*r}},{"./sign":21}],6:[function(t,e,i){e.exports=function(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}},{}],7:[function(t,e,i){e.exports=function(t){return 1-.25*t*(1+t/16*(3+1.25*t))}},{}],8:[function(t,e,i){e.exports=function(t){return.375*t*(1+.25*t*(1+.46875*t))}},{}],9:[function(t,e,i){e.exports=function(t){return.05859375*t*t*(1+.75*t)}},{}],10:[function(t,e,i){e.exports=function(t){return t*t*t*(35/3072)}},{}],11:[function(t,e,i){e.exports=function(t,e,i){var r=e*i;return t/Math.sqrt(1-r*r)}},{}],12:[function(t,e,i){e.exports=function(t,e,i,r,n){var o,s;o=t/e;for(var a=0;a<15;a++)if(s=(t-(e*o-i*Math.sin(2*o)+r*Math.sin(4*o)-n*Math.sin(6*o)))/(e-2*i*Math.cos(2*o)+4*r*Math.cos(4*o)-6*n*Math.cos(6*o)),o+=s,Math.abs(s)<=1e-10)return o;return NaN}},{}],13:[function(t,e,i){var r=Math.PI/2;e.exports=function(t,e){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-i)<1e-6)return e<0?-1*r:r;for(var n,o,s,a,l=Math.asin(.5*e),h=0;h<30;h++)if(o=Math.sin(l),s=Math.cos(l),a=t*o,n=Math.pow(1-a*a,2)/(2*s)*(e/(1-t*t)-o/(1-a*a)+.5/t*Math.log((1-a)/(1+a))),l+=n,Math.abs(n)<=1e-10)return l;return NaN}},{}],14:[function(t,e,i){e.exports=function(t,e,i,r,n){return t*n-e*Math.sin(2*n)+i*Math.sin(4*n)-r*Math.sin(6*n)}},{}],15:[function(t,e,i){e.exports=function(t,e,i){var r=t*e;return i/Math.sqrt(1-r*r)}},{}],16:[function(t,e,i){var r=Math.PI/2;e.exports=function(t,e){for(var i,n,o=.5*t,s=r-2*Math.atan(e),a=0;a<=15;a++)if(i=t*Math.sin(s),n=r-2*Math.atan(e*Math.pow((1-i)/(1+i),o))-s,s+=n,Math.abs(n)<=1e-10)return s;return-9999}},{}],17:[function(t,e,i){var r=1,n=.25,o=.046875,s=.01953125,a=.01068115234375,l=.75,h=.46875,c=.013020833333333334,u=.007120768229166667,d=.3645833333333333,p=.005696614583333333,f=.3076171875;e.exports=function(t){var e=[];e[0]=r-t*(n+t*(o+t*(s+t*a))),e[1]=t*(l-t*(o+t*(s+t*a)));var i=t*t;return e[2]=i*(h-t*(c+t*u)),i*=t,e[3]=i*(d-t*p),e[4]=i*t*f,e}},{}],18:[function(t,e,i){var r=t("./pj_mlfn"),n=1e-10,o=20;e.exports=function(t,e,i){for(var s=1/(1-e),a=t,l=o;l;--l){var h=Math.sin(a),c=1-e*h*h;if(c=(r(a,h,Math.cos(a),i)-t)*(c*Math.sqrt(c))*s,a-=c,Math.abs(c)<n)return a}return a}},{"./pj_mlfn":19}],19:[function(t,e,i){e.exports=function(t,e,i,r){return i*=e,e*=e,r[0]*t-i*(r[1]+e*(r[2]+e*(r[3]+e*r[4])))}},{}],20:[function(t,e,i){e.exports=function(t,e){var i;return t>1e-7?(i=t*e,(1-t*t)*(e/(1-i*i)-.5/t*Math.log((1-i)/(1+i)))):2*e}},{}],21:[function(t,e,i){e.exports=function(t){return t<0?-1:1}},{}],22:[function(t,e,i){e.exports=function(t,e){return Math.pow((1-t)/(1+t),e)}},{}],23:[function(t,e,i){e.exports=function(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}},{}],24:[function(t,e,i){var r=Math.PI/2;e.exports=function(t,e,i){var n=t*i,o=.5*t;return n=Math.pow((1-n)/(1+n),o),Math.tan(.5*(r-e))/n}},{}],25:[function(t,e,i){i.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},i.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},i.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},i.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},i.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},i.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},i.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},i.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},i.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},i.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},i.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},i.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},i.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},i.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},i.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},i.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},{}],26:[function(t,e,i){i.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},i.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},i.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},i.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},i.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},i.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},i.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},i.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},i.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},i.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},i.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},i.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},i.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},i.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},i.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},i.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},i.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},i.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},i.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},i.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},i.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},i.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},i.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},i.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},i.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},i.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},i.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},i.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},i.hough={a:6378270,rf:297,ellipseName:"Hough"},i.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},i.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},i.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},i.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},i.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},i.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},i.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},i.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},i.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"},i.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},i.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},i.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"},i.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"},i.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},{}],27:[function(t,e,i){i.greenwich=0,i.lisbon=-9.131906111111,i.paris=2.337229166667,i.bogota=-74.080916666667,i.madrid=-3.687938888889,i.rome=12.452333333333,i.bern=7.439583333333,i.jakarta=106.807719444444,i.ferro=-17.666666666667,i.brussels=4.367975,i.stockholm=18.058277777778,i.athens=23.7163375,i.oslo=10.722916666667},{}],28:[function(t,e,i){function r(t,e,i){var r;return Array.isArray(i)?(r=a(t,e,i),3===i.length?[r.x,r.y,r.z]:[r.x,r.y]):a(t,e,i)}function n(t){return t instanceof s?t:t.oProj?t.oProj:s(t)}function o(t,e,i){t=n(t);var o,s=!1;return"undefined"==typeof e?(e=t,t=l,s=!0):("undefined"!=typeof e.x||Array.isArray(e))&&(i=e,e=t,t=l,s=!0),e=n(e),i?r(t,e,i):(o={forward:function(i){return r(t,e,i)},inverse:function(i){return r(e,t,i)}},s&&(o.oProj=e),o)}var s=t("./Proj"),a=t("./transform"),l=s("WGS84");e.exports=o},{"./Proj":2,"./transform":64}],29:[function(t,e,i){var r=Math.PI/2,n=1,o=2,s=3,a=4,l=5,h=484813681109536e-20,c=1.0026,u=.3826834323650898,d=function(t){if(!(this instanceof d))return new d(t);if(this.datum_type=a,t){if(t.datumCode&&"none"===t.datumCode&&(this.datum_type=l),t.datum_params){for(var e=0;e<t.datum_params.length;e++)t.datum_params[e]=parseFloat(t.datum_params[e]);0===t.datum_params[0]&&0===t.datum_params[1]&&0===t.datum_params[2]||(this.datum_type=n),t.datum_params.length>3&&(0===t.datum_params[3]&&0===t.datum_params[4]&&0===t.datum_params[5]&&0===t.datum_params[6]||(this.datum_type=o,t.datum_params[3]*=h,t.datum_params[4]*=h,t.datum_params[5]*=h,t.datum_params[6]=t.datum_params[6]/1e6+1))}this.datum_type=t.grids?s:this.datum_type,this.a=t.a,this.b=t.b,this.es=t.es,this.ep2=t.ep2,this.datum_params=t.datum_params,this.datum_type===s&&(this.grids=t.grids)}};d.prototype={compare_datums:function(t){return this.datum_type===t.datum_type&&(!(this.a!==t.a||Math.abs(this.es-t.es)>5e-11)&&(this.datum_type===n?this.datum_params[0]===t.datum_params[0]&&this.datum_params[1]===t.datum_params[1]&&this.datum_params[2]===t.datum_params[2]:this.datum_type===o?this.datum_params[0]===t.datum_params[0]&&this.datum_params[1]===t.datum_params[1]&&this.datum_params[2]===t.datum_params[2]&&this.datum_params[3]===t.datum_params[3]&&this.datum_params[4]===t.datum_params[4]&&this.datum_params[5]===t.datum_params[5]&&this.datum_params[6]===t.datum_params[6]:this.datum_type!==s&&t.datum_type!==s||this.nadgrids===t.nadgrids))},geodetic_to_geocentric:function(t){var e,i,n,o,s,a,l,h=t.x,c=t.y,u=t.z?t.z:0,d=0;if(c<-r&&c>-1.001*r)c=-r;else if(c>r&&c<1.001*r)c=r;else if(c<-r||c>r)return null;return h>Math.PI&&(h-=2*Math.PI),s=Math.sin(c),l=Math.cos(c),a=s*s,o=this.a/Math.sqrt(1-this.es*a),e=(o+u)*l*Math.cos(h),i=(o+u)*l*Math.sin(h),n=(o*(1-this.es)+u)*s,t.x=e,t.y=i,t.z=n,d},geocentric_to_geodetic:function(t){var e,i,n,o,s,a,l,h,c,u,d,p,f,g,m,E,v,y=1e-12,_=y*y,T=30,L=t.x,x=t.y,b=t.z?t.z:0;if(f=!1,e=Math.sqrt(L*L+x*x),i=Math.sqrt(L*L+x*x+b*b),e/this.a<y){if(f=!0,m=0,i/this.a<y)return E=r,void(v=-this.b)}else m=Math.atan2(x,L);n=b/i,o=e/i,s=1/Math.sqrt(1-this.es*(2-this.es)*o*o),h=o*(1-this.es)*s,c=n*s,g=0;do g++,l=this.a/Math.sqrt(1-this.es*c*c),v=e*h+b*c-l*(1-this.es*c*c),a=this.es*l/(l+v),s=1/Math.sqrt(1-a*(2-a)*o*o),u=o*(1-a)*s,d=n*s,p=d*h-u*c,h=u,c=d;while(p*p>_&&g<T);return E=Math.atan(d/Math.abs(u)),t.x=m,t.y=E,t.z=v,t},geocentric_to_geodetic_noniter:function(t){var e,i,n,o,s,a,l,h,d,p,f,g,m,E,v,y,_,T=t.x,L=t.y,x=t.z?t.z:0;if(T=parseFloat(T),L=parseFloat(L),x=parseFloat(x),_=!1,0!==T)e=Math.atan2(L,T);else if(L>0)e=r;else if(L<0)e=-r;else if(_=!0,e=0,x>0)i=r;else{if(!(x<0))return i=r,void(n=-this.b);i=-r}return s=T*T+L*L,o=Math.sqrt(s),a=x*c,h=Math.sqrt(a*a+s),p=a/h,g=o/h,f=p*p*p,l=x+this.b*this.ep2*f,y=o-this.a*this.es*g*g*g,d=Math.sqrt(l*l+y*y),m=l/d,E=y/d,v=this.a/Math.sqrt(1-this.es*m*m),n=E>=u?o/E-v:E<=-u?o/-E-v:x/m+v*(this.es-1),_===!1&&(i=Math.atan(m/E)),t.x=e,t.y=i,t.z=n,t},geocentric_to_wgs84:function(t){if(this.datum_type===n)t.x+=this.datum_params[0],t.y+=this.datum_params[1],t.z+=this.datum_params[2];else if(this.datum_type===o){var e=this.datum_params[0],i=this.datum_params[1],r=this.datum_params[2],s=this.datum_params[3],a=this.datum_params[4],l=this.datum_params[5],h=this.datum_params[6],c=h*(t.x-l*t.y+a*t.z)+e,u=h*(l*t.x+t.y-s*t.z)+i,d=h*(-a*t.x+s*t.y+t.z)+r;t.x=c,t.y=u,t.z=d}},geocentric_from_wgs84:function(t){if(this.datum_type===n)t.x-=this.datum_params[0],t.y-=this.datum_params[1],t.z-=this.datum_params[2];else if(this.datum_type===o){var e=this.datum_params[0],i=this.datum_params[1],r=this.datum_params[2],s=this.datum_params[3],a=this.datum_params[4],l=this.datum_params[5],h=this.datum_params[6],c=(t.x-e)/h,u=(t.y-i)/h,d=(t.z-r)/h;t.x=c+l*u-a*d,t.y=-l*c+u+s*d,t.z=a*c-s*u+d}}},e.exports=d},{}],30:[function(t,e,i){var r=1,n=2,o=3,s=5,a=6378137,l=.006694379990141316;e.exports=function(t,e,i){function h(t){return t===r||t===n}var c,u,d;if(t.compare_datums(e))return i;if(t.datum_type===s||e.datum_type===s)return i;var p=t.a,f=t.es,g=e.a,m=e.es,E=t.datum_type;if(E===o)if(0===this.apply_gridshift(t,0,i))t.a=a,t.es=l;else{if(!t.datum_params)return t.a=p,t.es=t.es,i;for(c=1,u=0,d=t.datum_params.length;u<d;u++)c*=t.datum_params[u];if(0===c)return t.a=p,t.es=t.es,i;E=t.datum_params.length>3?n:r}return e.datum_type===o&&(e.a=a,e.es=l),(t.es!==e.es||t.a!==e.a||h(E)||h(e.datum_type))&&(t.geodetic_to_geocentric(i),h(t.datum_type)&&t.geocentric_to_wgs84(i),h(e.datum_type)&&e.geocentric_from_wgs84(i),e.geocentric_to_geodetic(i)),e.datum_type===o&&this.apply_gridshift(e,1,i),t.a=p,t.es=f,e.a=g,e.es=m,i}},{}],31:[function(t,e,i){function r(t){var e=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?r[t]=o(arguments[1]):r[t]=s(arguments[1]):r[t]=i}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?r.apply(e,t):r(t)});if("string"==typeof t){if(t in r)return r[t]}else"EPSG"in t?r["EPSG:"+t.EPSG]=t:"ESRI"in t?r["ESRI:"+t.ESRI]=t:"IAU2000"in t?r["IAU2000:"+t.IAU2000]=t:console.log(t);return}}var n=t("./global"),o=t("./projString"),s=t("./wkt");n(r),e.exports=r},{"./global":34,"./projString":37,"./wkt":65}],32:[function(t,e,i){var r=t("./constants/Datum"),n=t("./constants/Ellipsoid"),o=t("./extend"),s=t("./datum"),a=1e-10,l=.16666666666666666,h=.04722222222222222,c=.022156084656084655;e.exports=function(t){if(t.datumCode&&"none"!==t.datumCode){var e=r[t.datumCode];e&&(t.datum_params=e.towgs84?e.towgs84.split(","):null,t.ellps=e.ellipse,t.datumName=e.datumName?e.datumName:t.datumCode)}if(!t.a){var i=n[t.ellps]?n[t.ellps]:n.WGS84;o(t,i)}return t.rf&&!t.b&&(t.b=(1-1/t.rf)*t.a),(0===t.rf||Math.abs(t.a-t.b)<a)&&(t.sphere=!0,t.b=t.a),t.a2=t.a*t.a,t.b2=t.b*t.b,t.es=(t.a2-t.b2)/t.a2,t.e=Math.sqrt(t.es),t.R_A&&(t.a*=1-t.es*(l+t.es*(h+t.es*c)),t.a2=t.a*t.a,t.b2=t.b*t.b,t.es=0),t.ep2=(t.a2-t.b2)/t.b2,t.k0||(t.k0=1),t.axis||(t.axis="enu"),t.datum||(t.datum=s(t)),t}},{"./constants/Datum":25,"./constants/Ellipsoid":26,"./datum":29,"./extend":33}],33:[function(t,e,i){e.exports=function(t,e){t=t||{};var i,r;if(!e)return t;for(r in e)i=e[r],void 0!==i&&(t[r]=i);return t}},{}],34:[function(t,e,i){e.exports=function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}},{}],35:[function(t,e,i){var r=t("./core");r.defaultDatum="WGS84",r.Proj=t("./Proj"),r.WGS84=new r.Proj("WGS84"),r.Point=t("./Point"),r.toPoint=t("./common/toPoint"),r.defs=t("./defs"),r.transform=t("./transform"),
r.mgrs=t("mgrs"),r.version=t("../package.json").version,t("./includedProjections")(r),e.exports=r},{"../package.json":67,"./Point":1,"./Proj":2,"./common/toPoint":23,"./core":28,"./defs":31,"./includedProjections":"gWUPNW","./transform":64,mgrs:66}],36:[function(t,e,i){function r(t){return"string"==typeof t}function n(t){return t in l}function o(t){var e=["GEOGCS","GEOCCS","PROJCS","LOCAL_CS"];return e.reduce(function(e,i){return e+1+t.indexOf(i)},0)}function s(t){return"+"===t[0]}function a(t){return r(t)?n(t)?l[t]:o(t)?h(t):s(t)?c(t):void 0:t}var l=t("./defs"),h=t("./wkt"),c=t("./projString");e.exports=a},{"./defs":31,"./projString":37,"./wkt":65}],37:[function(t,e,i){var r=.017453292519943295,n=t("./constants/PrimeMeridian");e.exports=function(t){var e={},i={};t.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).forEach(function(t){var e=t.split("=");e.push(!0),i[e[0].toLowerCase()]=e[1]});var o,s,a,l={proj:"projName",datum:"datumCode",rf:function(t){e.rf=parseFloat(t)},lat_0:function(t){e.lat0=t*r},lat_1:function(t){e.lat1=t*r},lat_2:function(t){e.lat2=t*r},lat_ts:function(t){e.lat_ts=t*r},lon_0:function(t){e.long0=t*r},lon_1:function(t){e.long1=t*r},lon_2:function(t){e.long2=t*r},alpha:function(t){e.alpha=parseFloat(t)*r},lonc:function(t){e.longc=t*r},x_0:function(t){e.x0=parseFloat(t)},y_0:function(t){e.y0=parseFloat(t)},k_0:function(t){e.k0=parseFloat(t)},k:function(t){e.k0=parseFloat(t)},a:function(t){e.a=parseFloat(t)},b:function(t){e.b=parseFloat(t)},r_a:function(){e.R_A=!0},zone:function(t){e.zone=parseInt(t,10)},south:function(){e.utmSouth=!0},towgs84:function(t){e.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){e.to_meter=parseFloat(t)},from_greenwich:function(t){e.from_greenwich=t*r},pm:function(t){e.from_greenwich=(n[t]?n[t]:parseFloat(t))*r},nadgrids:function(t){"@null"===t?e.datumCode="none":e.nadgrids=t},axis:function(t){var i="ewnsud";3===t.length&&i.indexOf(t.substr(0,1))!==-1&&i.indexOf(t.substr(1,1))!==-1&&i.indexOf(t.substr(2,1))!==-1&&(e.axis=t)}};for(o in i)s=i[o],o in l?(a=l[o],"function"==typeof a?a(s):e[a]=s):e[o]=s;return"string"==typeof e.datumCode&&"WGS84"!==e.datumCode&&(e.datumCode=e.datumCode.toLowerCase()),e}},{"./constants/PrimeMeridian":27}],38:[function(t,e,i){function r(t,e){var i=s.length;return t.names?(s[i]=t,t.names.forEach(function(t){o[t.toLowerCase()]=i}),this):(console.log(e),!0)}var n=[t("./projections/merc"),t("./projections/longlat")],o={},s=[];i.add=r,i.get=function(t){if(!t)return!1;var e=t.toLowerCase();return"undefined"!=typeof o[e]&&s[o[e]]?s[o[e]]:void 0},i.start=function(){n.forEach(r)}},{"./projections/longlat":50,"./projections/merc":51}],39:[function(t,e,i){var r=1e-10,n=t("../common/msfnz"),o=t("../common/qsfnz"),s=t("../common/adjust_lon"),a=t("../common/asinz");i.init=function(){Math.abs(this.lat1+this.lat2)<r||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=n(this.e3,this.sin_po,this.cos_po),this.qs1=o(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=n(this.e3,this.sin_po,this.cos_po),this.qs2=o(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=o(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>r?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},i.forward=function(t){var e=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var r=o(this.e3,this.sin_phi,this.cos_phi),n=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,a=this.ns0*s(e-this.long0),l=n*Math.sin(a)+this.x0,h=this.rh-n*Math.cos(a)+this.y0;return t.x=l,t.y=h,t},i.inverse=function(t){var e,i,r,n,o,a;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),r=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),r=-1),n=0,0!==e&&(n=Math.atan2(r*t.x,r*t.y)),r=e*this.ns0/this.a,this.sphere?a=Math.asin((this.c-r*r)/(2*this.ns0)):(i=(this.c-r*r)/this.ns0,a=this.phi1z(this.e3,i)),o=s(n/this.ns0+this.long0),t.x=o,t.y=a,t},i.phi1z=function(t,e){var i,n,o,s,l,h=a(.5*e);if(t<r)return h;for(var c=t*t,u=1;u<=25;u++)if(i=Math.sin(h),n=Math.cos(h),o=t*i,s=1-o*o,l=.5*s*s/n*(e/(1-c)-i/s+.5/t*Math.log((1-o)/(1+o))),h+=l,Math.abs(l)<=1e-7)return h;return null},i.names=["Albers_Conic_Equal_Area","Albers","aea"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/msfnz":15,"../common/qsfnz":20}],40:[function(t,e,i){var r=t("../common/adjust_lon"),n=Math.PI/2,o=1e-10,s=t("../common/mlfn"),a=t("../common/e0fn"),l=t("../common/e1fn"),h=t("../common/e2fn"),c=t("../common/e3fn"),u=t("../common/gN"),d=t("../common/asinz"),p=t("../common/imlfn");i.init=function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},i.forward=function(t){var e,i,d,p,f,g,m,E,v,y,_,T,L,x,b,S,w,M,R,A,C,P,I,D=t.x,N=t.y,O=Math.sin(t.y),V=Math.cos(t.y),G=r(D-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=o?(t.x=this.x0+this.a*(n-N)*Math.sin(G),t.y=this.y0-this.a*(n-N)*Math.cos(G),t):Math.abs(this.sin_p12+1)<=o?(t.x=this.x0+this.a*(n+N)*Math.sin(G),t.y=this.y0+this.a*(n+N)*Math.cos(G),t):(M=this.sin_p12*O+this.cos_p12*V*Math.cos(G),S=Math.acos(M),w=S/Math.sin(S),t.x=this.x0+this.a*w*V*Math.sin(G),t.y=this.y0+this.a*w*(this.cos_p12*O-this.sin_p12*V*Math.cos(G)),t):(e=a(this.es),i=l(this.es),d=h(this.es),p=c(this.es),Math.abs(this.sin_p12-1)<=o?(f=this.a*s(e,i,d,p,n),g=this.a*s(e,i,d,p,N),t.x=this.x0+(f-g)*Math.sin(G),t.y=this.y0-(f-g)*Math.cos(G),t):Math.abs(this.sin_p12+1)<=o?(f=this.a*s(e,i,d,p,n),g=this.a*s(e,i,d,p,N),t.x=this.x0+(f+g)*Math.sin(G),t.y=this.y0+(f+g)*Math.cos(G),t):(m=O/V,E=u(this.a,this.e,this.sin_p12),v=u(this.a,this.e,O),y=Math.atan((1-this.es)*m+this.es*E*this.sin_p12/(v*V)),_=Math.atan2(Math.sin(G),this.cos_p12*Math.tan(y)-this.sin_p12*Math.cos(G)),R=0===_?Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):Math.abs(Math.abs(_)-Math.PI)<=o?-Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):Math.asin(Math.sin(G)*Math.cos(y)/Math.sin(_)),T=this.e*this.sin_p12/Math.sqrt(1-this.es),L=this.e*this.cos_p12*Math.cos(_)/Math.sqrt(1-this.es),x=T*L,b=L*L,A=R*R,C=A*R,P=C*R,I=P*R,S=E*R*(1-A*b*(1-b)/6+C/8*x*(1-2*b)+P/120*(b*(4-7*b)-3*T*T*(1-7*b))-I/48*x),t.x=this.x0+S*Math.sin(_),t.y=this.y0+S*Math.cos(_),t))},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,f,g,m,E,v,y,_,T,L,x,b,S,w,M,R,A,C,P,I,D,N;if(this.sphere){if(e=Math.sqrt(t.x*t.x+t.y*t.y),e>2*n*this.a)return;return i=e/this.a,f=Math.sin(i),g=Math.cos(i),m=this.long0,Math.abs(e)<=o?E=this.lat0:(E=d(g*this.sin_p12+t.y*f*this.cos_p12/e),v=Math.abs(this.lat0)-n,m=r(Math.abs(v)<=o?this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y):this.long0+Math.atan2(t.x*f,e*this.cos_p12*g-t.y*this.sin_p12*f))),t.x=m,t.y=E,t}return y=a(this.es),_=l(this.es),T=h(this.es),L=c(this.es),Math.abs(this.sin_p12-1)<=o?(x=this.a*s(y,_,T,L,n),e=Math.sqrt(t.x*t.x+t.y*t.y),b=x-e,E=p(b/this.a,y,_,T,L),m=r(this.long0+Math.atan2(t.x,-1*t.y)),t.x=m,t.y=E,t):Math.abs(this.sin_p12+1)<=o?(x=this.a*s(y,_,T,L,n),e=Math.sqrt(t.x*t.x+t.y*t.y),b=e-x,E=p(b/this.a,y,_,T,L),m=r(this.long0+Math.atan2(t.x,t.y)),t.x=m,t.y=E,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),M=Math.atan2(t.x,t.y),S=u(this.a,this.e,this.sin_p12),R=Math.cos(M),A=this.e*this.cos_p12*R,C=-A*A/(1-this.es),P=3*this.es*(1-C)*this.sin_p12*this.cos_p12*R/(1-this.es),I=e/S,D=I-C*(1+C)*Math.pow(I,3)/6-P*(1+3*C)*Math.pow(I,4)/24,N=1-C*D*D/2-I*D*D*D/6,w=Math.asin(this.sin_p12*Math.cos(D)+this.cos_p12*Math.sin(D)*R),m=r(this.long0+Math.asin(Math.sin(M)*Math.sin(D)/Math.cos(w))),E=Math.atan((1-this.es*N*this.sin_p12/Math.sin(w))*Math.tan(w)/(1-this.es)),t.x=m,t.y=E,t)},i.names=["Azimuthal_Equidistant","aeqd"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/imlfn":12,"../common/mlfn":14}],41:[function(t,e,i){var r=t("../common/mlfn"),n=t("../common/e0fn"),o=t("../common/e1fn"),s=t("../common/e2fn"),a=t("../common/e3fn"),l=t("../common/gN"),h=t("../common/adjust_lon"),c=t("../common/adjust_lat"),u=t("../common/imlfn"),d=Math.PI/2,p=1e-10;i.init=function(){this.sphere||(this.e0=n(this.es),this.e1=o(this.es),this.e2=s(this.es),this.e3=a(this.es),this.ml0=this.a*r(this.e0,this.e1,this.e2,this.e3,this.lat0))},i.forward=function(t){var e,i,n=t.x,o=t.y;if(n=h(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(o)*Math.sin(n)),i=this.a*(Math.atan2(Math.tan(o),Math.cos(n))-this.lat0);else{var s=Math.sin(o),a=Math.cos(o),c=l(this.a,this.e,s),u=Math.tan(o)*Math.tan(o),d=n*Math.cos(o),p=d*d,f=this.es*a*a/(1-this.es),g=this.a*r(this.e0,this.e1,this.e2,this.e3,o);e=c*d*(1-p*u*(1/6-(8-u+8*f)*p/120)),i=g-this.ml0+c*s/a*p*(.5+(5-u+6*f)*p/24)}return t.x=e+this.x0,t.y=i+this.y0,t},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,r=t.x/this.a,n=t.y/this.a;if(this.sphere){var o=n+this.lat0;e=Math.asin(Math.sin(o)*Math.cos(r)),i=Math.atan2(Math.tan(r),Math.cos(o))}else{var s=this.ml0/this.a+n,a=u(s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-d)<=p)return t.x=this.long0,t.y=d,n<0&&(t.y*=-1),t;var f=l(this.a,this.e,Math.sin(a)),g=f*f*f/this.a/this.a*(1-this.es),m=Math.pow(Math.tan(a),2),E=r*this.a/f,v=E*E;e=a-f*Math.tan(a)/g*E*E*(.5-(1+3*m)*E*E/24),i=E*(1-v*(m/3+(1+3*m)*m*v/15))/Math.cos(a)}return t.x=h(i+this.long0),t.y=c(e),t},i.names=["Cassini","Cassini_Soldner","cass"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/imlfn":12,"../common/mlfn":14}],42:[function(t,e,i){var r=t("../common/adjust_lon"),n=t("../common/qsfnz"),o=t("../common/msfnz"),s=t("../common/iqsfnz");i.init=function(){this.sphere||(this.k0=o(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},i.forward=function(t){var e,i,o=t.x,s=t.y,a=r(o-this.long0);if(this.sphere)e=this.x0+this.a*a*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(s)/Math.cos(this.lat_ts);else{var l=n(this.e,Math.sin(s));e=this.x0+this.a*this.k0*a,i=this.y0+this.a*l*.5/this.k0}return t.x=e,t.y=i,t},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i;return this.sphere?(e=r(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=s(this.e,2*t.y*this.k0/this.a),e=r(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=i,t},i.names=["cea"]},{"../common/adjust_lon":5,"../common/iqsfnz":13,"../common/msfnz":15,"../common/qsfnz":20}],43:[function(t,e,i){var r=t("../common/adjust_lon"),n=t("../common/adjust_lat");i.init=function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},i.forward=function(t){var e=t.x,i=t.y,o=r(e-this.long0),s=n(i-this.lat0);return t.x=this.x0+this.a*o*this.rc,t.y=this.y0+this.a*s,t},i.inverse=function(t){var e=t.x,i=t.y;return t.x=r(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=n(this.lat0+(i-this.y0)/this.a),t},i.names=["Equirectangular","Equidistant_Cylindrical","eqc"]},{"../common/adjust_lat":4,"../common/adjust_lon":5}],44:[function(t,e,i){var r=t("../common/e0fn"),n=t("../common/e1fn"),o=t("../common/e2fn"),s=t("../common/e3fn"),a=t("../common/msfnz"),l=t("../common/mlfn"),h=t("../common/adjust_lon"),c=t("../common/adjust_lat"),u=t("../common/imlfn"),d=1e-10;i.init=function(){Math.abs(this.lat1+this.lat2)<d||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=r(this.es),this.e1=n(this.es),this.e2=o(this.es),this.e3=s(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=a(this.e,this.sinphi,this.cosphi),this.ml1=l(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<d?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=a(this.e,this.sinphi,this.cosphi),this.ml2=l(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=l(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},i.forward=function(t){var e,i=t.x,r=t.y;if(this.sphere)e=this.a*(this.g-r);else{var n=l(this.e0,this.e1,this.e2,this.e3,r);e=this.a*(this.g-n)}var o=this.ns*h(i-this.long0),s=this.x0+e*Math.sin(o),a=this.y0+this.rh-e*Math.cos(o);return t.x=s,t.y=a,t},i.inverse=function(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var e,i,r,n;this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var o=0;if(0!==i&&(o=Math.atan2(e*t.x,e*t.y)),this.sphere)return n=h(this.long0+o/this.ns),r=c(this.g-i/this.a),t.x=n,t.y=r,t;var s=this.g-i/this.a;return r=u(s,this.e0,this.e1,this.e2,this.e3),n=h(this.long0+o/this.ns),t.x=n,t.y=r,t},i.names=["Equidistant_Conic","eqdc"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/imlfn":12,"../common/mlfn":14,"../common/msfnz":15}],45:[function(t,e,i){var r=Math.PI/4,n=t("../common/srat"),o=Math.PI/2,s=20;i.init=function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+r)/(Math.pow(Math.tan(.5*this.lat0+r),this.C)*n(this.e*t,this.ratexp))},i.forward=function(t){var e=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+r),this.C)*n(this.e*Math.sin(i),this.ratexp))-o,t.x=this.C*e,t},i.inverse=function(t){for(var e=1e-14,i=t.x/this.C,a=t.y,l=Math.pow(Math.tan(.5*a+r)/this.K,1/this.C),h=s;h>0&&(a=2*Math.atan(l*n(this.e*Math.sin(t.y),-.5*this.e))-o,!(Math.abs(a-t.y)<e));--h)t.y=a;return h?(t.x=i,t.y=a,t):null},i.names=["gauss"]},{"../common/srat":22}],46:[function(t,e,i){var r=t("../common/adjust_lon"),n=1e-10,o=t("../common/asinz");i.init=function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},i.forward=function(t){var e,i,o,s,a,l,h,c,u=t.x,d=t.y;return o=r(u-this.long0),e=Math.sin(d),i=Math.cos(d),s=Math.cos(o),l=this.sin_p14*e+this.cos_p14*i*s,a=1,l>0||Math.abs(l)<=n?(h=this.x0+this.a*a*i*Math.sin(o)/l,c=this.y0+this.a*a*(this.cos_p14*e-this.sin_p14*i*s)/l):(h=this.x0+this.infinity_dist*i*Math.sin(o),c=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*i*s)),t.x=h,t.y=c,t},i.inverse=function(t){var e,i,n,s,a,l;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(s=Math.atan2(e,this.rc),i=Math.sin(s),n=Math.cos(s),l=o(n*this.sin_p14+t.y*i*this.cos_p14/e),a=Math.atan2(t.x*i,e*this.cos_p14*n-t.y*this.sin_p14*i),a=r(this.long0+a)):(l=this.phic0,a=0),t.x=a,t.y=l,t},i.names=["gnom"]},{"../common/adjust_lon":5,"../common/asinz":6}],47:[function(t,e,i){var r=t("../common/adjust_lon");i.init=function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},i.forward=function(t){var e,i,n,o,s,a,l,h=t.x,c=t.y,u=r(h-this.long0);return e=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/e)-this.s45),n=-u*this.alfa,o=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(n)),s=Math.asin(Math.cos(i)*Math.sin(n)/Math.cos(o)),a=this.n*s,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(o/2+this.s45),this.n),t.y=l*Math.cos(a)/1,t.x=l*Math.sin(a)/1,this.czech||(t.y*=-1,t.x*=-1),t},i.inverse=function(t){var e,i,r,n,o,s,a,l,h=t.x;t.x=t.y,t.y=h,this.czech||(t.y*=-1,t.x*=-1),s=Math.sqrt(t.x*t.x+t.y*t.y),o=Math.atan2(t.y,t.x),n=o/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/s,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),i=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(e)),t.x=this.long0-i/this.alfa,a=e,l=0;var c=0;do t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-t.y)<1e-10&&(l=1),a=t.y,c+=1;while(0===l&&c<15);return c>=15?null:t},i.names=["Krovak","krovak"]},{"../common/adjust_lon":5}],48:[function(t,e,i){var r=Math.PI/2,n=Math.PI/4,o=1e-10,s=t("../common/qsfnz"),a=t("../common/adjust_lon");i.S_POLE=1,i.N_POLE=2,i.EQUIT=3,i.OBLIQ=4,i.init=function(){var t=Math.abs(this.lat0);if(Math.abs(t-r)<o?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<o?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=s(this.e,1),this.mmf=.5/(1-this.es),this.apa=this.authset(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=s(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},i.forward=function(t){var e,i,l,h,c,u,d,p,f,g,m=t.x,E=t.y;if(m=a(m-this.long0),this.sphere){if(c=Math.sin(E),g=Math.cos(E),l=Math.cos(m),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(i=this.mode===this.EQUIT?1+g*l:1+this.sinph0*c+this.cosph0*g*l,i<=o)return null;i=Math.sqrt(2/i),e=i*g*Math.sin(m),i*=this.mode===this.EQUIT?c:this.cosph0*c-this.sinph0*g*l}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(l=-l),Math.abs(E+this.phi0)<o)return null;i=n-.5*E,i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)),e=i*Math.sin(m),i*=l}}else{switch(d=0,p=0,f=0,l=Math.cos(m),h=Math.sin(m),c=Math.sin(E),u=s(this.e,c),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(d=u/this.qp,p=Math.sqrt(1-d*d)),this.mode){case this.OBLIQ:f=1+this.sinb1*d+this.cosb1*p*l;break;case this.EQUIT:f=1+p*l;break;case this.N_POLE:f=r+E,u=this.qp-u;break;case this.S_POLE:f=E-r,u=this.qp+u}if(Math.abs(f)<o)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:f=Math.sqrt(2/f),i=this.mode===this.OBLIQ?this.ymf*f*(this.cosb1*d-this.sinb1*p*l):(f=Math.sqrt(2/(1+p*l)))*d*this.ymf,e=this.xmf*f*p*h;break;case this.N_POLE:case this.S_POLE:u>=0?(e=(f=Math.sqrt(u))*h,i=l*(this.mode===this.S_POLE?f:-f)):e=i=0}}return t.x=this.a*e+this.x0,t.y=this.a*i+this.y0,t},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,n,s,l,h,c,u=t.x/this.a,d=t.y/this.a;if(this.sphere){var p,f=0,g=0;if(p=Math.sqrt(u*u+d*d),i=.5*p,i>1)return null;switch(i=2*Math.asin(i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(g=Math.sin(i),f=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(p)<=o?0:Math.asin(d*g/p),u*=g,d=f*p;break;case this.OBLIQ:i=Math.abs(p)<=o?this.phi0:Math.asin(f*this.sinph0+d*g*this.cosph0/p),u*=g*this.cosph0,d=(f-Math.sin(i)*this.sinph0)*p;break;case this.N_POLE:d=-d,i=r-i;break;case this.S_POLE:i-=r}e=0!==d||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(u,d):0}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(u/=this.dd,d*=this.dd,h=Math.sqrt(u*u+d*d),h<o)return t.x=0,t.y=this.phi0,t;s=2*Math.asin(.5*h/this.rq),n=Math.cos(s),u*=s=Math.sin(s),this.mode===this.OBLIQ?(c=n*this.sinb1+d*s*this.cosb1/h,l=this.qp*c,d=h*this.cosb1*n-d*this.sinb1*s):(c=d*s/h,l=this.qp*c,d=h*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(d=-d),l=u*u+d*d,!l)return t.x=0,t.y=this.phi0,t;c=1-l/this.qp,this.mode===this.S_POLE&&(c=-c)}e=Math.atan2(u,d),i=this.authlat(Math.asin(c),this.apa)}return t.x=a(this.long0+e),t.y=i,t},i.P00=.3333333333333333,i.P01=.17222222222222222,i.P02=.10257936507936508,i.P10=.06388888888888888,i.P11=.0664021164021164,i.P20=.016415012942191543,i.authset=function(t){var e,i=[];return i[0]=t*this.P00,e=t*t,i[0]+=e*this.P01,i[1]=e*this.P10,e*=t,i[0]+=e*this.P02,i[1]+=e*this.P11,i[2]=e*this.P20,i},i.authlat=function(t,e){var i=t+t;return t+e[0]*Math.sin(i)+e[1]*Math.sin(i+i)+e[2]*Math.sin(i+i+i)},i.names=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"]},{"../common/adjust_lon":5,"../common/qsfnz":20}],49:[function(t,e,i){var r=1e-10,n=t("../common/msfnz"),o=t("../common/tsfnz"),s=Math.PI/2,a=t("../common/sign"),l=t("../common/adjust_lon"),h=t("../common/phi2z");i.init=function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<r)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),i=Math.cos(this.lat1),s=n(this.e,e,i),a=o(this.e,this.lat1,e),l=Math.sin(this.lat2),h=Math.cos(this.lat2),c=n(this.e,l,h),u=o(this.e,this.lat2,l),d=o(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>r?this.ns=Math.log(s/c)/Math.log(a/u):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=s/(this.ns*Math.pow(a,this.ns)),this.rh=this.a*this.f0*Math.pow(d,this.ns),this.title||(this.title="Lambert Conformal Conic")}},i.forward=function(t){var e=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=r&&(i=a(i)*(s-2*r));var n,h,c=Math.abs(Math.abs(i)-s);if(c>r)n=o(this.e,i,Math.sin(i)),h=this.a*this.f0*Math.pow(n,this.ns);else{if(c=i*this.ns,c<=0)return null;h=0}var u=this.ns*l(e-this.long0);return t.x=this.k0*(h*Math.sin(u))+this.x0,t.y=this.k0*(this.rh-h*Math.cos(u))+this.y0,t},i.inverse=function(t){var e,i,r,n,o,a=(t.x-this.x0)/this.k0,c=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(a*a+c*c),i=1):(e=-Math.sqrt(a*a+c*c),i=-1);var u=0;if(0!==e&&(u=Math.atan2(i*a,i*c)),0!==e||this.ns>0){if(i=1/this.ns,r=Math.pow(e/(this.a*this.f0),i),n=h(this.e,r),n===-9999)return null}else n=-s;return o=l(u/this.ns+this.long0),t.x=o,t.y=n,t},i.names=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/sign":21,"../common/tsfnz":24}],50:[function(t,e,i){function r(t){return t}i.init=function(){},i.forward=r,i.inverse=r,i.names=["longlat","identity"]},{}],51:[function(t,e,i){var r=t("../common/msfnz"),n=Math.PI/2,o=1e-10,s=57.29577951308232,a=t("../common/adjust_lon"),l=Math.PI/4,h=t("../common/tsfnz"),c=t("../common/phi2z");i.init=function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=r(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},i.forward=function(t){var e=t.x,i=t.y;if(i*s>90&&i*s<-90&&e*s>180&&e*s<-180)return null;var r,c;if(Math.abs(Math.abs(i)-n)<=o)return null;if(this.sphere)r=this.x0+this.a*this.k0*a(e-this.long0),c=this.y0+this.a*this.k0*Math.log(Math.tan(l+.5*i));else{var u=Math.sin(i),d=h(this.e,i,u);r=this.x0+this.a*this.k0*a(e-this.long0),c=this.y0-this.a*this.k0*Math.log(d)}return t.x=r,t.y=c,t},i.inverse=function(t){var e,i,r=t.x-this.x0,o=t.y-this.y0;if(this.sphere)i=n-2*Math.atan(Math.exp(-o/(this.a*this.k0)));else{var s=Math.exp(-o/(this.a*this.k0));if(i=c(this.e,s),i===-9999)return null}return e=a(this.long0+r/(this.a*this.k0)),t.x=e,t.y=i,t},i.names=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/tsfnz":24}],52:[function(t,e,i){var r=t("../common/adjust_lon");i.init=function(){},i.forward=function(t){var e=t.x,i=t.y,n=r(e-this.long0),o=this.x0+this.a*n,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=o,t.y=s,t},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e=r(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=i,t},i.names=["Miller_Cylindrical","mill"]},{"../common/adjust_lon":5}],53:[function(t,e,i){var r=t("../common/adjust_lon"),n=1e-10;i.init=function(){},i.forward=function(t){for(var e=t.x,i=t.y,o=r(e-this.long0),s=i,a=Math.PI*Math.sin(i),l=0;!0;l++){var h=-(s+Math.sin(s)-a)/(1+Math.cos(s));if(s+=h,Math.abs(h)<n)break}s/=2,Math.PI/2-Math.abs(i)<n&&(o=0);var c=.900316316158*this.a*o*Math.cos(s)+this.x0,u=1.4142135623731*this.a*Math.sin(s)+this.y0;return t.x=c,t.y=u,t},i.inverse=function(t){var e,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),e=Math.asin(i);var n=r(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,Math.abs(i)>1&&(i=1);var o=Math.asin(i);return t.x=n,t.y=o,t},i.names=["Mollweide","moll"]},{"../common/adjust_lon":5}],54:[function(t,e,i){var r=484813681109536e-20;i.iterations=1,i.init=function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},i.forward=function(t){var e,i=t.x,n=t.y,o=n-this.lat0,s=i-this.long0,a=o/r*1e-5,l=s,h=1,c=0;for(e=1;e<=10;e++)h*=a,c+=this.A[e]*h;var u,d,p=c,f=l,g=1,m=0,E=0,v=0;for(e=1;e<=6;e++)u=g*p-m*f,d=m*p+g*f,g=u,m=d,E=E+this.B_re[e]*g-this.B_im[e]*m,v=v+this.B_im[e]*g+this.B_re[e]*m;return t.x=v*this.a+this.x0,t.y=E*this.a+this.y0,t},i.inverse=function(t){var e,i,n,o=t.x,s=t.y,a=o-this.x0,l=s-this.y0,h=l/this.a,c=a/this.a,u=1,d=0,p=0,f=0;for(e=1;e<=6;e++)i=u*h-d*c,n=d*h+u*c,u=i,d=n,p=p+this.C_re[e]*u-this.C_im[e]*d,f=f+this.C_im[e]*u+this.C_re[e]*d;for(var g=0;g<this.iterations;g++){var m,E,v=p,y=f,_=h,T=c;for(e=2;e<=6;e++)m=v*p-y*f,E=y*p+v*f,v=m,y=E,_+=(e-1)*(this.B_re[e]*v-this.B_im[e]*y),T+=(e-1)*(this.B_im[e]*v+this.B_re[e]*y);v=1,y=0;var L=this.B_re[1],x=this.B_im[1];for(e=2;e<=6;e++)m=v*p-y*f,E=y*p+v*f,v=m,y=E,L+=e*(this.B_re[e]*v-this.B_im[e]*y),x+=e*(this.B_im[e]*v+this.B_re[e]*y);var b=L*L+x*x;p=(_*L+T*x)/b,f=(T*L-_*x)/b}var S=p,w=f,M=1,R=0;for(e=1;e<=9;e++)M*=S,R+=this.D[e]*M;var A=this.lat0+R*r*1e5,C=this.long0+w;return t.x=C,t.y=A,t},i.names=["New_Zealand_Map_Grid","nzmg"]},{}],55:[function(t,e,i){var r=t("../common/tsfnz"),n=t("../common/adjust_lon"),o=t("../common/phi2z"),s=Math.PI/2,a=Math.PI/4,l=1e-10;i.init=function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),e=Math.cos(this.lat0),i=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(e,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-i*i);var o=r(this.e,this.lat0,t),s=this.bl/e*Math.sqrt((1-this.es)/(1-i*i));s*s<1&&(s=1);var a,l;if(isNaN(this.longc)){var h=r(this.e,this.lat1,Math.sin(this.lat1)),c=r(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(s+Math.sqrt(s*s-1))*Math.pow(o,this.bl):this.el=(s-Math.sqrt(s*s-1))*Math.pow(o,this.bl);var u=Math.pow(h,this.bl),d=Math.pow(c,this.bl);a=this.el/u,l=.5*(a-1/a);var p=(this.el*this.el-d*u)/(this.el*this.el+d*u),f=(d-u)/(d+u),g=n(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(p*Math.tan(.5*this.bl*g)/f)/this.bl,this.long0=n(this.long0);var m=n(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*m)/l),this.alpha=Math.asin(s*Math.sin(this.gamma0))}else a=this.lat0>=0?s+Math.sqrt(s*s-1):s-Math.sqrt(s*s-1),this.el=a*Math.pow(o,this.bl),l=.5*(a-1/a),this.gamma0=Math.asin(Math.sin(this.alpha)/s),this.long0=this.longc-Math.asin(l*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(s*s-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(s*s-1),Math.cos(this.alpha))},i.forward=function(t){var e,i,o,h=t.x,c=t.y,u=n(h-this.long0);if(Math.abs(Math.abs(c)-s)<=l)o=c>0?-1:1,i=this.al/this.bl*Math.log(Math.tan(a+o*this.gamma0*.5)),e=-1*o*s*this.al/this.bl;else{var d=r(this.e,c,Math.sin(c)),p=this.el/Math.pow(d,this.bl),f=.5*(p-1/p),g=.5*(p+1/p),m=Math.sin(this.bl*u),E=(f*Math.sin(this.gamma0)-m*Math.cos(this.gamma0))/g;i=Math.abs(Math.abs(E)-1)<=l?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-E)/(1+E))/this.bl,e=Math.abs(Math.cos(this.bl*u))<=l?this.al*this.bl*u:this.al*Math.atan2(f*Math.cos(this.gamma0)+m*Math.sin(this.gamma0),Math.cos(this.bl*u))/this.bl}return this.no_rot?(t.x=this.x0+e,t.y=this.y0+i):(e-=this.uc,t.x=this.x0+i*Math.cos(this.alpha)+e*Math.sin(this.alpha),t.y=this.y0+e*Math.cos(this.alpha)-i*Math.sin(this.alpha)),t},i.inverse=function(t){var e,i;this.no_rot?(i=t.y-this.y0,e=t.x-this.x0):(i=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),e=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),e+=this.uc);var r=Math.exp(-1*this.bl*i/this.al),a=.5*(r-1/r),h=.5*(r+1/r),c=Math.sin(this.bl*e/this.al),u=(c*Math.cos(this.gamma0)+a*Math.sin(this.gamma0))/h,d=Math.pow(this.el/Math.sqrt((1+u)/(1-u)),1/this.bl);return Math.abs(u-1)<l?(t.x=this.long0,t.y=s):Math.abs(u+1)<l?(t.x=this.long0,t.y=-1*s):(t.y=o(this.e,d),t.x=n(this.long0-Math.atan2(a*Math.cos(this.gamma0)-c*Math.sin(this.gamma0),Math.cos(this.bl*e/this.al))/this.bl)),t},i.names=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},{"../common/adjust_lon":5,"../common/phi2z":16,"../common/tsfnz":24}],56:[function(t,e,i){var r=t("../common/e0fn"),n=t("../common/e1fn"),o=t("../common/e2fn"),s=t("../common/e3fn"),a=t("../common/adjust_lon"),l=t("../common/adjust_lat"),h=t("../common/mlfn"),c=1e-10,u=t("../common/gN"),d=20;i.init=function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=r(this.es),this.e1=n(this.es),this.e2=o(this.es),this.e3=s(this.es),this.ml0=this.a*h(this.e0,this.e1,this.e2,this.e3,this.lat0)},i.forward=function(t){var e,i,r,n=t.x,o=t.y,s=a(n-this.long0);if(r=s*Math.sin(o),this.sphere)Math.abs(o)<=c?(e=this.a*s,i=-1*this.a*this.lat0):(e=this.a*Math.sin(r)/Math.tan(o),i=this.a*(l(o-this.lat0)+(1-Math.cos(r))/Math.tan(o)));else if(Math.abs(o)<=c)e=this.a*s,i=-1*this.ml0;else{var d=u(this.a,this.e,Math.sin(o))/Math.tan(o);e=d*Math.sin(r),i=this.a*h(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+d*(1-Math.cos(r));
}return t.x=e+this.x0,t.y=i+this.y0,t},i.inverse=function(t){var e,i,r,n,o,s,l,u,p;if(r=t.x-this.x0,n=t.y-this.y0,this.sphere)if(Math.abs(n+this.a*this.lat0)<=c)e=a(r/this.a+this.long0),i=0;else{s=this.lat0+n/this.a,l=r*r/this.a/this.a+s*s,u=s;var f;for(o=d;o;--o)if(f=Math.tan(u),p=-1*(s*(u*f+1)-u-.5*(u*u+l)*f)/((u-s)/f-1),u+=p,Math.abs(p)<=c){i=u;break}e=a(this.long0+Math.asin(r*Math.tan(u)/this.a)/Math.sin(i))}else if(Math.abs(n+this.ml0)<=c)i=0,e=a(this.long0+r/this.a);else{s=(this.ml0+n)/this.a,l=r*r/this.a/this.a+s*s,u=s;var g,m,E,v,y;for(o=d;o;--o)if(y=this.e*Math.sin(u),g=Math.sqrt(1-y*y)*Math.tan(u),m=this.a*h(this.e0,this.e1,this.e2,this.e3,u),E=this.e0-2*this.e1*Math.cos(2*u)+4*this.e2*Math.cos(4*u)-6*this.e3*Math.cos(6*u),v=m/this.a,p=(s*(g*v+1)-v-.5*g*(v*v+l))/(this.es*Math.sin(2*u)*(v*v+l-2*s*v)/(4*g)+(s-v)*(g*E-2/Math.sin(2*u))-E),u-=p,Math.abs(p)<=c){i=u;break}g=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=a(this.long0+Math.asin(r*g/this.a)/Math.sin(i))}return t.x=e,t.y=i,t},i.names=["Polyconic","poly"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/mlfn":14}],57:[function(t,e,i){var r=t("../common/adjust_lon"),n=t("../common/adjust_lat"),o=t("../common/pj_enfn"),s=20,a=t("../common/pj_mlfn"),l=t("../common/pj_inv_mlfn"),h=Math.PI/2,c=1e-10,u=t("../common/asinz");i.init=function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=o(this.es)},i.forward=function(t){var e,i,n=t.x,o=t.y;if(n=r(n-this.long0),this.sphere){if(this.m)for(var l=this.n*Math.sin(o),h=s;h;--h){var u=(this.m*o+Math.sin(o)-l)/(this.m+Math.cos(o));if(o-=u,Math.abs(u)<c)break}else o=1!==this.n?Math.asin(this.n*Math.sin(o)):o;e=this.a*this.C_x*n*(this.m+Math.cos(o)),i=this.a*this.C_y*o}else{var d=Math.sin(o),p=Math.cos(o);i=this.a*a(o,d,p,this.en),e=this.a*n*p/Math.sqrt(1-this.es*d*d)}return t.x=e,t.y=i,t},i.inverse=function(t){var e,i,o,s;return t.x-=this.x0,o=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,o/=this.C_x*(this.m+Math.cos(e)),this.m?e=u((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=u(Math.sin(e)/this.n)),o=r(o+this.long0),e=n(e)):(e=l(t.y/this.a,this.es,this.en),s=Math.abs(e),s<h?(s=Math.sin(e),i=this.long0+t.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(e)),o=r(i)):s-c<h&&(o=this.long0)),t.x=o,t.y=e,t},i.names=["Sinusoidal","sinu"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/asinz":6,"../common/pj_enfn":17,"../common/pj_inv_mlfn":18,"../common/pj_mlfn":19}],58:[function(t,e,i){i.init=function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),i=this.a,r=this.rf,n=1/r,o=2*n-Math.pow(n,2),s=this.e=Math.sqrt(o);this.R=this.k0*i*Math.sqrt(1-o)/(1-o*Math.pow(e,2)),this.alpha=Math.sqrt(1+o/(1-o)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+t/2)),h=Math.log((1+s*e)/(1-s*e));this.K=a-this.alpha*l+this.alpha*s/2*h},i.forward=function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),r=-this.alpha*(e+i)+this.K,n=2*(Math.atan(Math.exp(r))-Math.PI/4),o=this.alpha*(t.x-this.lambda0),s=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(n)+Math.cos(this.b0)*Math.cos(o))),a=Math.asin(Math.cos(this.b0)*Math.sin(n)-Math.sin(this.b0)*Math.cos(n)*Math.cos(o));return t.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,t.x=this.R*s+this.x0,t},i.inverse=function(t){for(var e=t.x-this.x0,i=t.y-this.y0,r=e/this.R,n=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(n)+Math.sin(this.b0)*Math.cos(n)*Math.cos(r)),s=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(n))),a=this.lambda0+s/this.alpha,l=0,h=o,c=-1e3,u=0;Math.abs(h-c)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),c=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=a,t.y=h,t},i.names=["somerc"]},{}],59:[function(t,e,i){var r=Math.PI/2,n=1e-10,o=t("../common/sign"),s=t("../common/msfnz"),a=t("../common/tsfnz"),l=t("../common/phi2z"),h=t("../common/adjust_lon");i.ssfn_=function(t,e,i){return e*=i,Math.tan(.5*(r+t))*Math.pow((1-e)/(1+e),.5*i)},i.init=function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=n&&(this.k0=.5*(1+o(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=n&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=n&&(this.k0=.5*this.cons*s(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/a(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=s(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-r,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},i.forward=function(t){var e,i,o,s,l,c,u=t.x,d=t.y,p=Math.sin(d),f=Math.cos(d),g=h(u-this.long0);return Math.abs(Math.abs(u-this.long0)-Math.PI)<=n&&Math.abs(d+this.lat0)<=n?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*p+this.coslat0*f*Math.cos(g)),t.x=this.a*e*f*Math.sin(g)+this.x0,t.y=this.a*e*(this.coslat0*p-this.sinlat0*f*Math.cos(g))+this.y0,t):(i=2*Math.atan(this.ssfn_(d,p,this.e))-r,s=Math.cos(i),o=Math.sin(i),Math.abs(this.coslat0)<=n?(l=a(this.e,d*this.con,this.con*p),c=2*this.a*this.k0*l/this.cons,t.x=this.x0+c*Math.sin(u-this.long0),t.y=this.y0-this.con*c*Math.cos(u-this.long0),t):(Math.abs(this.sinlat0)<n?(e=2*this.a*this.k0/(1+s*Math.cos(g)),t.y=e*o):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*s*Math.cos(g))),t.y=e*(this.cosX0*o-this.sinX0*s*Math.cos(g))+this.y0),t.x=e*s*Math.sin(g)+this.x0,t))},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,o,s,a,c=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var u=2*Math.atan(c/(.5*this.a*this.k0));return e=this.long0,i=this.lat0,c<=n?(t.x=e,t.y=i,t):(i=Math.asin(Math.cos(u)*this.sinlat0+t.y*Math.sin(u)*this.coslat0/c),e=h(Math.abs(this.coslat0)<n?this.lat0>0?this.long0+Math.atan2(t.x,-1*t.y):this.long0+Math.atan2(t.x,t.y):this.long0+Math.atan2(t.x*Math.sin(u),c*this.coslat0*Math.cos(u)-t.y*this.sinlat0*Math.sin(u))),t.x=e,t.y=i,t)}if(Math.abs(this.coslat0)<=n){if(c<=n)return i=this.lat0,e=this.long0,t.x=e,t.y=i,t;t.x*=this.con,t.y*=this.con,o=c*this.cons/(2*this.a*this.k0),i=this.con*l(this.e,o),e=this.con*h(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else s=2*Math.atan(c*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,c<=n?a=this.X0:(a=Math.asin(Math.cos(s)*this.sinX0+t.y*Math.sin(s)*this.cosX0/c),e=h(this.long0+Math.atan2(t.x*Math.sin(s),c*this.cosX0*Math.cos(s)-t.y*this.sinX0*Math.sin(s)))),i=-1*l(this.e,Math.tan(.5*(r+a)));return t.x=e,t.y=i,t},i.names=["stere"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/sign":21,"../common/tsfnz":24}],60:[function(t,e,i){var r=t("./gauss"),n=t("../common/adjust_lon");i.init=function(){r.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},i.forward=function(t){var e,i,o,s;return t.x=n(t.x-this.long0),r.forward.apply(this,[t]),e=Math.sin(t.y),i=Math.cos(t.y),o=Math.cos(t.x),s=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*o),t.x=s*i*Math.sin(t.x),t.y=s*(this.cosc0*e-this.sinc0*i*o),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},i.inverse=function(t){var e,i,o,s,a;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,a=Math.sqrt(t.x*t.x+t.y*t.y)){var l=2*Math.atan2(a,this.R2);e=Math.sin(l),i=Math.cos(l),s=Math.asin(i*this.sinc0+t.y*e*this.cosc0/a),o=Math.atan2(t.x*e,a*this.cosc0*i-t.y*this.sinc0*e)}else s=this.phic0,o=0;return t.x=o,t.y=s,r.inverse.apply(this,[t]),t.x=n(t.x+this.long0),t},i.names=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"]},{"../common/adjust_lon":5,"./gauss":45}],61:[function(t,e,i){var r=t("../common/e0fn"),n=t("../common/e1fn"),o=t("../common/e2fn"),s=t("../common/e3fn"),a=t("../common/mlfn"),l=t("../common/adjust_lon"),h=Math.PI/2,c=1e-10,u=t("../common/sign"),d=t("../common/asinz");i.init=function(){this.e0=r(this.es),this.e1=n(this.es),this.e2=o(this.es),this.e3=s(this.es),this.ml0=this.a*a(this.e0,this.e1,this.e2,this.e3,this.lat0)},i.forward=function(t){var e,i,r,n=t.x,o=t.y,s=l(n-this.long0),h=Math.sin(o),c=Math.cos(o);if(this.sphere){var u=c*Math.sin(s);if(Math.abs(Math.abs(u)-1)<1e-10)return 93;i=.5*this.a*this.k0*Math.log((1+u)/(1-u)),e=Math.acos(c*Math.cos(s)/Math.sqrt(1-u*u)),o<0&&(e=-e),r=this.a*this.k0*(e-this.lat0)}else{var d=c*s,p=Math.pow(d,2),f=this.ep2*Math.pow(c,2),g=Math.tan(o),m=Math.pow(g,2);e=1-this.es*Math.pow(h,2);var E=this.a/Math.sqrt(e),v=this.a*a(this.e0,this.e1,this.e2,this.e3,o);i=this.k0*E*d*(1+p/6*(1-m+f+p/20*(5-18*m+Math.pow(m,2)+72*f-58*this.ep2)))+this.x0,r=this.k0*(v-this.ml0+E*g*(p*(.5+p/24*(5-m+9*f+4*Math.pow(f,2)+p/30*(61-58*m+Math.pow(m,2)+600*f-330*this.ep2)))))+this.y0}return t.x=i,t.y=r,t},i.inverse=function(t){var e,i,r,n,o,s,a=6;if(this.sphere){var p=Math.exp(t.x/(this.a*this.k0)),f=.5*(p-1/p),g=this.lat0+t.y/(this.a*this.k0),m=Math.cos(g);e=Math.sqrt((1-m*m)/(1+f*f)),o=d(e),g<0&&(o=-o),s=0===f&&0===m?this.long0:l(Math.atan2(f,m)+this.long0)}else{var E=t.x-this.x0,v=t.y-this.y0;for(e=(this.ml0+v/this.k0)/this.a,i=e,n=0;!0&&(r=(e+this.e1*Math.sin(2*i)-this.e2*Math.sin(4*i)+this.e3*Math.sin(6*i))/this.e0-i,i+=r,!(Math.abs(r)<=c));n++)if(n>=a)return 95;if(Math.abs(i)<h){var y=Math.sin(i),_=Math.cos(i),T=Math.tan(i),L=this.ep2*Math.pow(_,2),x=Math.pow(L,2),b=Math.pow(T,2),S=Math.pow(b,2);e=1-this.es*Math.pow(y,2);var w=this.a/Math.sqrt(e),M=w*(1-this.es)/e,R=E/(w*this.k0),A=Math.pow(R,2);o=i-w*T*A/M*(.5-A/24*(5+3*b+10*L-4*x-9*this.ep2-A/30*(61+90*b+298*L+45*S-252*this.ep2-3*x))),s=l(this.long0+R*(1-A/6*(1+2*b+L-A/20*(5-2*L+28*b-3*x+8*this.ep2+24*S)))/_)}else o=h*u(v),s=this.long0}return t.x=s,t.y=o,t},i.names=["Transverse_Mercator","Transverse Mercator","tmerc"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/mlfn":14,"../common/sign":21}],62:[function(t,e,i){var r=.017453292519943295,n=t("./tmerc");i.dependsOn="tmerc",i.init=function(){this.zone&&(this.lat0=0,this.long0=(6*Math.abs(this.zone)-183)*r,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,n.init.apply(this),this.forward=n.forward,this.inverse=n.inverse)},i.names=["Universal Transverse Mercator System","utm"]},{"./tmerc":61}],63:[function(t,e,i){var r=t("../common/adjust_lon"),n=Math.PI/2,o=1e-10,s=t("../common/asinz");i.init=function(){this.R=this.a},i.forward=function(t){var e,i,a=t.x,l=t.y,h=r(a-this.long0);Math.abs(l)<=o&&(e=this.x0+this.R*h,i=this.y0);var c=s(2*Math.abs(l/Math.PI));(Math.abs(h)<=o||Math.abs(Math.abs(l)-n)<=o)&&(e=this.x0,i=l>=0?this.y0+Math.PI*this.R*Math.tan(.5*c):this.y0+Math.PI*this.R*-Math.tan(.5*c));var u=.5*Math.abs(Math.PI/h-h/Math.PI),d=u*u,p=Math.sin(c),f=Math.cos(c),g=f/(p+f-1),m=g*g,E=g*(2/p-1),v=E*E,y=Math.PI*this.R*(u*(g-v)+Math.sqrt(d*(g-v)*(g-v)-(v+d)*(m-v)))/(v+d);h<0&&(y=-y),e=this.x0+y;var _=d+g;return y=Math.PI*this.R*(E*_-u*Math.sqrt((v+d)*(d+1)-_*_))/(v+d),i=l>=0?this.y0+y:this.y0-y,t.x=e,t.y=i,t},i.inverse=function(t){var e,i,n,s,a,l,h,c,u,d,p,f,g;return t.x-=this.x0,t.y-=this.y0,p=Math.PI*this.R,n=t.x/p,s=t.y/p,a=n*n+s*s,l=-Math.abs(s)*(1+a),h=l-2*s*s+n*n,c=-2*l+1+2*s*s+a*a,g=s*s/c+(2*h*h*h/c/c/c-9*l*h/c/c)/27,u=(l-h*h/3/c)/c,d=2*Math.sqrt(-u/3),p=3*g/u/d,Math.abs(p)>1&&(p=p>=0?1:-1),f=Math.acos(p)/3,i=t.y>=0?(-d*Math.cos(f+Math.PI/3)-h/3/c)*Math.PI:-(-d*Math.cos(f+Math.PI/3)-h/3/c)*Math.PI,e=Math.abs(n)<o?this.long0:r(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(n*n-s*s)+a*a))/2/n),t.x=e,t.y=i,t},i.names=["Van_der_Grinten_I","VanDerGrinten","vandg"]},{"../common/adjust_lon":5,"../common/asinz":6}],64:[function(t,e,i){var r=.017453292519943295,n=57.29577951308232,o=1,s=2,a=t("./datum_transform"),l=t("./adjust_axis"),h=t("./Proj"),c=t("./common/toPoint");e.exports=function t(e,i,u){function d(t,e){return(t.datum.datum_type===o||t.datum.datum_type===s)&&"WGS84"!==e.datumCode}var p;return Array.isArray(u)&&(u=c(u)),e.datum&&i.datum&&(d(e,i)||d(i,e))&&(p=new h("WGS84"),t(e,p,u),e=p),"enu"!==e.axis&&l(e,!1,u),"longlat"===e.projName?(u.x*=r,u.y*=r):(e.to_meter&&(u.x*=e.to_meter,u.y*=e.to_meter),e.inverse(u)),e.from_greenwich&&(u.x+=e.from_greenwich),u=a(e.datum,i.datum,u),i.from_greenwich&&(u.x-=i.from_greenwich),"longlat"===i.projName?(u.x*=n,u.y*=n):(i.forward(u),i.to_meter&&(u.x/=i.to_meter,u.y/=i.to_meter)),"enu"!==i.axis&&l(i,!0,u),u}},{"./Proj":2,"./adjust_axis":3,"./common/toPoint":23,"./datum_transform":30}],65:[function(t,e,i){function r(t,e,i){t[e]=i.map(function(t){var e={};return n(t,e),e}).reduce(function(t,e){return h(t,e)},{})}function n(t,e){var i;return Array.isArray(t)?(i=t.shift(),"PARAMETER"===i&&(i=t.shift()),1===t.length?Array.isArray(t[0])?(e[i]={},n(t[0],e[i])):e[i]=t[0]:t.length?"TOWGS84"===i?e[i]=t:(e[i]={},["UNIT","PRIMEM","VERT_DATUM"].indexOf(i)>-1?(e[i]={name:t[0].toLowerCase(),convert:t[1]},3===t.length&&(e[i].auth=t[2])):"SPHEROID"===i?(e[i]={name:t[0],a:t[1],rf:t[2]},4===t.length&&(e[i].auth=t[3])):["GEOGCS","GEOCCS","DATUM","VERT_CS","COMPD_CS","LOCAL_CS","FITTED_CS","LOCAL_DATUM"].indexOf(i)>-1?(t[0]=["name",t[0]],r(e,i,t)):t.every(function(t){return Array.isArray(t)})?r(e,i,t):n(t,e[i])):e[i]=!0,void 0):void(e[t]=!0)}function o(t,e){var i=e[0],r=e[1];!(i in t)&&r in t&&(t[i]=t[r],3===e.length&&(t[i]=e[2](t[i])))}function s(t){return t*l}function a(t){function e(e){var i=t.to_meter||1;return parseFloat(e,10)*i}"GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&(t.to_meter=parseFloat(t.UNIT.convert,10))),t.GEOGCS&&(t.GEOGCS.DATUM?t.datumCode=t.GEOGCS.DATUM.name.toLowerCase():t.datumCode=t.GEOGCS.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"===t.datumCode&&("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),t.GEOGCS.DATUM&&t.GEOGCS.DATUM.SPHEROID&&(t.ellps=t.GEOGCS.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=t.GEOGCS.DATUM.SPHEROID.a,t.rf=parseFloat(t.GEOGCS.DATUM.SPHEROID.rf,10)),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36")),t.b&&!isFinite(t.b)&&(t.b=t.a);var i=function(e){return o(t,e)},r=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",s],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",s],["x0","false_easting",e],["y0","false_northing",e],["long0","central_meridian",s],["lat0","latitude_of_origin",s],["lat0","standard_parallel_1",s],["lat1","standard_parallel_1",s],["lat2","standard_parallel_2",s],["alpha","azimuth",s],["srsCode","name"]];r.forEach(i),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.PROJECTION&&"Lambert_Azimuthal_Equal_Area"!==t.PROJECTION||(t.long0=t.longc)}var l=.017453292519943295,h=t("./extend");e.exports=function(t,e){var i=JSON.parse((","+t).replace(/\s*\,\s*([A-Z_0-9]+?)(\[)/g,',["$1",').slice(1).replace(/\s*\,\s*([A-Z_0-9]+?)\]/g,',"$1"]').replace(/,\["VERTCS".+/,"")),r=i.shift(),o=i.shift();i.unshift(["name",o]),i.unshift(["type",r]),i.unshift("output");var s={};return n(i,s),a(s.output),h(e,s.output)}},{"./extend":33}],66:[function(t,e,i){function r(t){return t*(Math.PI/180)}function n(t){return 180*(t/Math.PI)}function o(t){var e,i,n,o,s,l,h,c,u,d=t.lat,p=t.lon,f=6378137,g=.00669438,m=.9996,E=r(d),v=r(p);u=Math.floor((p+180)/6)+1,180===p&&(u=60),d>=56&&d<64&&p>=3&&p<12&&(u=32),d>=72&&d<84&&(p>=0&&p<9?u=31:p>=9&&p<21?u=33:p>=21&&p<33?u=35:p>=33&&p<42&&(u=37)),e=6*(u-1)-180+3,c=r(e),i=g/(1-g),n=f/Math.sqrt(1-g*Math.sin(E)*Math.sin(E)),o=Math.tan(E)*Math.tan(E),s=i*Math.cos(E)*Math.cos(E),l=Math.cos(E)*(v-c),h=f*((1-g/4-3*g*g/64-5*g*g*g/256)*E-(3*g/8+3*g*g/32+45*g*g*g/1024)*Math.sin(2*E)+(15*g*g/256+45*g*g*g/1024)*Math.sin(4*E)-35*g*g*g/3072*Math.sin(6*E));var y=m*n*(l+(1-o+s)*l*l*l/6+(5-18*o+o*o+72*s-58*i)*l*l*l*l*l/120)+5e5,_=m*(h+n*Math.tan(E)*(l*l/2+(5-o+9*s+4*s*s)*l*l*l*l/24+(61-58*o+o*o+600*s-330*i)*l*l*l*l*l*l/720));return d<0&&(_+=1e7),{northing:Math.round(_),easting:Math.round(y),zoneNumber:u,zoneLetter:a(d)}}function s(t){var e=t.northing,i=t.easting,r=t.zoneLetter,o=t.zoneNumber;if(o<0||o>60)return null;var a,l,h,c,u,d,p,f,g,m,E=.9996,v=6378137,y=.00669438,_=(1-Math.sqrt(1-y))/(1+Math.sqrt(1-y)),T=i-5e5,L=e;r<"N"&&(L-=1e7),f=6*(o-1)-180+3,a=y/(1-y),p=L/E,g=p/(v*(1-y/4-3*y*y/64-5*y*y*y/256)),m=g+(3*_/2-27*_*_*_/32)*Math.sin(2*g)+(21*_*_/16-55*_*_*_*_/32)*Math.sin(4*g)+151*_*_*_/96*Math.sin(6*g),l=v/Math.sqrt(1-y*Math.sin(m)*Math.sin(m)),h=Math.tan(m)*Math.tan(m),c=a*Math.cos(m)*Math.cos(m),u=v*(1-y)/Math.pow(1-y*Math.sin(m)*Math.sin(m),1.5),d=T/(l*E);var x=m-l*Math.tan(m)/u*(d*d/2-(5+3*h+10*c-4*c*c-9*a)*d*d*d*d/24+(61+90*h+298*c+45*h*h-252*a-3*c*c)*d*d*d*d*d*d/720);x=n(x);var b=(d-(1+2*h+c)*d*d*d/6+(5-2*c+28*h-3*c*c+8*a+24*h*h)*d*d*d*d*d/120)/Math.cos(m);b=f+n(b);var S;if(t.accuracy){var w=s({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});S={top:w.lat,right:w.lon,bottom:x,left:b}}else S={lat:x,lon:b};return S}function a(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function l(t,e){var i=""+t.easting,r=""+t.northing;return t.zoneNumber+t.zoneLetter+h(t.easting,t.northing,t.zoneNumber)+i.substr(i.length-5,e)+r.substr(r.length-5,e)}function h(t,e,i){var r=c(i),n=Math.floor(t/1e5),o=Math.floor(e/1e5)%20;return u(n,o,r)}function c(t){var e=t%m;return 0===e&&(e=m),e}function u(t,e,i){var r=i-1,n=E.charCodeAt(r),o=v.charCodeAt(r),s=n+t-1,a=o+e,l=!1;s>x&&(s=s-x+y-1,l=!0),(s===_||n<_&&s>_||(s>_||n<_)&&l)&&s++,(s===T||n<T&&s>T||(s>T||n<T)&&l)&&(s++,s===_&&s++),s>x&&(s=s-x+y-1),a>L?(a=a-L+y-1,l=!0):l=!1,(a===_||o<_&&a>_||(a>_||o<_)&&l)&&a++,(a===T||o<T&&a>T||(a>T||o<T)&&l)&&(a++,a===_&&a++),a>L&&(a=a-L+y-1);var h=String.fromCharCode(s)+String.fromCharCode(a);return h}function d(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,i=t.length,r=null,n="",o=0;!/[A-Z]/.test(e=t.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+t;n+=e,o++}var s=parseInt(n,10);if(0===o||o+3>i)throw"MGRSPoint bad conversion from: "+t;var a=t.charAt(o++);if(a<="A"||"B"===a||"Y"===a||a>="Z"||"I"===a||"O"===a)throw"MGRSPoint zone letter "+a+" not handled: "+t;r=t.substring(o,o+=2);for(var l=c(s),h=p(r.charAt(0),l),u=f(r.charAt(1),l);u<g(a);)u+=2e6;var d=i-o;if(d%2!==0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var m,E,v,y,_,T=d/2,L=0,x=0;return T>0&&(m=1e5/Math.pow(10,T),E=t.substring(o,o+T),L=parseFloat(E)*m,v=t.substring(o+T),x=parseFloat(v)*m),y=L+h,_=x+u,{easting:y,northing:_,zoneLetter:a,zoneNumber:s,accuracy:m}}function p(t,e){for(var i=E.charCodeAt(e-1),r=1e5,n=!1;i!==t.charCodeAt(0);){if(i++,i===_&&i++,i===T&&i++,i>x){if(n)throw"Bad character: "+t;i=y,n=!0}r+=1e5}return r}function f(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var i=v.charCodeAt(e-1),r=0,n=!1;i!==t.charCodeAt(0);){if(i++,i===_&&i++,i===T&&i++,i>L){if(n)throw"Bad character: "+t;i=y,n=!0}r+=1e5}return r}function g(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}var m=6,E="AJSAJS",v="AFAFAF",y=65,_=73,T=79,L=86,x=90;i.forward=function(t,e){return e=e||5,l(o({lat:t[1],lon:t[0]}),e)},i.inverse=function(t){var e=s(d(t.toUpperCase()));return[e.left,e.bottom,e.right,e.top]},i.toPoint=function(t){var e=i.inverse(t);return[(e[2]+e[0])/2,(e[3]+e[1])/2]}},{}],67:[function(t,e,i){e.exports={name:"proj4",version:"2.3.3",description:"Proj4js is a JavaScript library to transform point coordinates from one coordinate system to another, including datum transformations.",main:"lib/index.js",directories:{test:"test",doc:"docs"},scripts:{test:"./node_modules/istanbul/lib/cli.js test ./node_modules/mocha/bin/_mocha test/test.js"},repository:{type:"git",url:"git://github.com/proj4js/proj4js.git"},author:"",license:"MIT",jam:{main:"dist/proj4.js",include:["dist/proj4.js","README.md","AUTHORS","LICENSE.md"]},devDependencies:{"grunt-cli":"~0.1.13",grunt:"~0.4.2","grunt-contrib-connect":"~0.6.0","grunt-contrib-jshint":"~0.8.0",chai:"~1.8.1",mocha:"~1.17.1","grunt-mocha-phantomjs":"~0.4.0",browserify:"~3.24.5","grunt-browserify":"~1.3.0","grunt-contrib-uglify":"~0.3.2",curl:"git://github.com/cujojs/curl.git",istanbul:"~0.2.4",tin:"~0.4.0"},dependencies:{mgrs:"0.0.0"}}},{}],"./includedProjections":[function(t,e,i){e.exports=t("gWUPNW")},{}],gWUPNW:[function(t,e,i){var r=[t("./lib/projections/tmerc"),t("./lib/projections/utm"),t("./lib/projections/sterea"),t("./lib/projections/stere"),t("./lib/projections/somerc"),t("./lib/projections/omerc"),t("./lib/projections/lcc"),t("./lib/projections/krovak"),t("./lib/projections/cass"),t("./lib/projections/laea"),t("./lib/projections/aea"),t("./lib/projections/gnom"),t("./lib/projections/cea"),t("./lib/projections/eqc"),t("./lib/projections/poly"),t("./lib/projections/nzmg"),t("./lib/projections/mill"),t("./lib/projections/sinu"),t("./lib/projections/moll"),t("./lib/projections/eqdc"),t("./lib/projections/vandg"),t("./lib/projections/aeqd")];e.exports=function(t){r.forEach(function(e){t.Proj.projections.add(e)})}},{"./lib/projections/aea":39,"./lib/projections/aeqd":40,"./lib/projections/cass":41,"./lib/projections/cea":42,"./lib/projections/eqc":43,"./lib/projections/eqdc":44,"./lib/projections/gnom":46,"./lib/projections/krovak":47,"./lib/projections/laea":48,"./lib/projections/lcc":49,"./lib/projections/mill":52,"./lib/projections/moll":53,"./lib/projections/nzmg":54,"./lib/projections/omerc":55,"./lib/projections/poly":56,"./lib/projections/sinu":57,"./lib/projections/somerc":58,"./lib/projections/stere":59,"./lib/projections/sterea":60,"./lib/projections/tmerc":61,"./lib/projections/utm":62,"./lib/projections/vandg":63}]},{},[35])(35)})},function(t,e,i){var r,n;r=[i(10),i(9),i(201),i(8),i(202)],n=function(t,e,i,r,n){"use strict";var o=function(t,i,n,o,s,a){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"TiffIFDEntry","constructor","missingTag"));if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"TiffIFDEntry","constructor","missingType"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"TiffIFDEntry","constructor","missingCount"));if(null===o||void 0===o)throw new e(r.logMessage(r.LEVEL_SEVERE,"TiffIFDEntry","constructor","missingValueOffset"));if(!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"TiffIFDEntry","constructor","missingGeoTiffData"));if(null===a||void 0===a)throw new e(r.logMessage(r.LEVEL_SEVERE,"TiffIFDEntry","constructor","missingIsLittleEndian"));this._tag=t,this._type=i,this._count=n,this._valueOffset=o,this._geoTiffData=s,this._isLittleEndian=a};return Object.defineProperties(o.prototype,{tag:{get:function(){return this._tag}},type:{get:function(){return this._type}},count:{get:function(){return this._count}},valueOffset:{get:function(){return this._valueOffset}},geoTiffData:{get:function(){return this._geoTiffData}},isLittleEndian:{get:function(){return this._isLittleEndian}}}),o.prototype.getIFDTypeLength=function(){switch(this.type){case n.Type.BYTE:case n.Type.ASCII:case n.Type.SBYTE:case n.Type.UNDEFINED:return 1;case n.Type.SHORT:case n.Type.SSHORT:return 2;case n.Type.LONG:case n.Type.SLONG:case n.Type.FLOAT:return 4;case n.Type.RATIONAL:case n.Type.SRATIONAL:case n.Type.DOUBLE:return 8;default:return-1}},o.prototype.getIFDEntryValue=function(){var e=[],o=null,s=this.getIFDTypeLength(),a=s*this.count;if(a<=4)o=this.isLittleEndian===!1?this.valueOffset>>>8*(4-s):this.valueOffset,e.push(o);else for(var l=0;l<this.count;l++){var h=s*l;if(s>=8)if(this.type===n.Type.RATIONAL||this.type===n.Type.SRATIONAL)e.push(i.getBytes(this.geoTiffData,this.valueOffset+h,4,this.isLittleEndian)),e.push(i.getBytes(this.geoTiffData,this.valueOffset+h+4,4,this.isLittleEndian));else{if(this.type!==n.Type.DOUBLE)throw new t(r.logMessage(r.LEVEL_SEVERE,"TiffIFDEntry","parse","invalidTypeOfIFD"));e.push(i.getBytes(this.geoTiffData,this.valueOffset+h,8,this.isLittleEndian))}else e.push(i.getBytes(this.geoTiffData,this.valueOffset+h,s,this.isLittleEndian))}return this.type===n.Type.ASCII?(e.forEach(function(t,e,i){0===t?i.splice(e,1):i[e]=String.fromCharCode(t)}),e.join("")):e},o}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=i(30),n=i(179),o=function(t,e,i){n.call(this,t,e,i),this.displayName=this.layerIdentifier};o.prototype=Object.create(n.prototype),t.exports=o,n.prototype.removeFromCurrentRetrievals=function(t){var e=this.currentRetrievals.indexOf(t);e>-1&&this.currentRetrievals.splice(e,1),r.post(r.WAIT,this.currentRetrievals.length)}},function(t,e,i){var r=i(30),n=i(190),o=i(176),s=function(t,e,i){t.proxy&&t.service&&(t.service=t.proxy+t.service),n.call(this,t,e,i)};s.prototype=Object.create(n.prototype),s.isEpsg4326Crs=function(t){return t.indexOf("EPSG")>=0&&t.indexOf("4326")>=0},s.isEpsg3857Crs=function(t){return t.indexOf("EPSG")>=0&&(t.indexOf("3857")>=0||t.indexOf("900913")>=0)},s.isOGCCrs84=function(t){return t.indexOf("OGC")>=0&&t.indexOf("CRS84")>=0},t.exports=s,o.prototype.removeFromCurrentRetrievals=function(t){var e=this.currentRetrievals.indexOf(t);e>-1&&this.currentRetrievals.splice(e,1),r.post(r.WAIT,this.currentRetrievals.length)},o.prototype.resourceUrlForTile=function(t,e){return this.urlBuilder?(t.sector,this.urlBuilder.urlForTile(t,e)):null}},function(t,e,i){var r=i(30),n=i(208),o=i(212),s=i(214),a=i(220),l=new Date("2017-04-11T20:20:30Z");t.exports=function(t){function e(e){h(f),h(d),h(p),"stars"===e?(d||(d=n(l)),i(d)):e&&e.skybox&&(p&&e.skybox===p.path||(p=u(e.skybox)),i(p)),i(f),t.redraw()}function i(e){t.addLayer(e)}function h(e){t.removeLayer(e)}function c(e){t.insertLayer(e.index,e.layer)}function u(e){var i=new o(e,t);return i.path=e,i}var d,p,f=s(l,t);i(a(null,"images/compass.png")),r.listen(r._ADD_LAYER,i),r.listen(r._INSERT_LAYER,c),r.listen(r._REMOVE_LAYER,h),r.listen(r.CHANGE_SPACE,e),e({skybox:"images/skybox/one"})}},function(t,e,i){var r=i(209),n=i(30);t.exports=function(t){var e=new r;return e.starDataSource="stars.json",e.sunImageSource="images/sunTexture.png",e.time=t,n.listen(n.NAVIGATOR_STATE_CHANGED,function(t){t.range&&(e.showSun=t.range>1e7)}),e}},function(t,e,i){var r,n;r=[i(99),i(8),i(36),i(210),i(211)],n=function(t,e,i,r,n){"use strict";var o=function(e){t.call(this,"StarField"),this.pickEnabled=!1,this.sunSize=128,this.showSun=!0,this._starDataSource=e||WorldWind.configuration.baseUrl+"images/stars.json",this._sunImageSource=WorldWind.configuration.baseUrl+"images/sunTexture.png",this._matrix=i.fromIdentity(),this._starsPositionsVboCacheKey=null,this._numStars=0,this._starData=null,this._minMagnitude=Number.MAX_VALUE,this._maxMagnitude=Number.MIN_VALUE,this._loadStarted=!1,this._minScale=1e7,this._sunPositionsCacheKey="",this._sunBufferView=new Float32Array(4),this._MAX_GL_POINT_SIZE=0};return o.prototype=Object.create(t.prototype),Object.defineProperties(o.prototype,{starDataSource:{get:function(){return this._starDataSource},set:function(t){this._starDataSource=t,this.invalidateStarData()}},sunImageSource:{get:function(){return this._sunImageSource},set:function(t){this._sunImageSource=t}}}),o.prototype.doRender=function(t){if(!t.globe.is2D()){if(!this.haveResources(t))return void this.loadResources(t);this.beginRendering(t);try{this.doDraw(t)}finally{this.endRendering(t)}}},o.prototype.haveResources=function(t){var e=t.gpuResourceCache.resourceForKey(this._sunImageSource);return null!=this._starData&&null!=e},o.prototype.loadResources=function(t){var e=t.currentGlContext,i=t.gpuResourceCache;this._starData||this.fetchStarData();var r=i.resourceForKey(this._sunImageSource);r||i.retrieveTexture(e,this._sunImageSource)},o.prototype.beginRendering=function(t){var e=t.currentGlContext;t.findAndBindProgram(r),e.enableVertexAttribArray(0),e.depthMask(!1)},o.prototype.doDraw=function(t){this.loadCommonUniforms(t),this.renderStars(t),this.showSun&&this.renderSun(t)},o.prototype.loadCommonUniforms=function(t){var e=t.currentGlContext,i=t.currentProgram,r=t.navigatorState.eyePoint,o=t.globe.computePositionFromPoint(r[0],r[1],r[2],{}),s=Math.max(1.5*o.altitude,this._minScale);this._matrix.copy(t.navigatorState.modelviewProjection),this._matrix.multiplyByScale(s,s,s),i.loadModelviewProjection(e,this._matrix);var a=n.computeJulianDate(this.time||new Date);i.loadNumDays(e,a-2451545)},o.prototype.renderStars=function(t){var e=t.currentGlContext,i=t.gpuResourceCache,r=t.currentProgram;this._starsPositionsVboCacheKey||(this._starsPositionsVboCacheKey=i.generateCacheKey());var n=i.resourceForKey(this._starsPositionsVboCacheKey);if(n)e.bindBuffer(e.ARRAY_BUFFER,n);else{n=e.createBuffer();var o=this.createStarsGeometry();i.putResource(this._starsPositionsVboCacheKey,n,4*o.length),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(o),e.STATIC_DRAW)}t.frameStatistics.incrementVboLoadCount(1),e.vertexAttribPointer(0,4,e.FLOAT,!1,0,0),r.loadMagnitudeRange(e,this._minMagnitude,this._maxMagnitude),r.loadTextureEnabled(e,!1),e.drawArrays(e.POINTS,0,this._numStars)},o.prototype.renderSun=function(t){var i=t.currentGlContext,r=t.currentProgram,o=t.gpuResourceCache;this._MAX_GL_POINT_SIZE||(this._MAX_GL_POINT_SIZE=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]),this.sunSize>this._MAX_GL_POINT_SIZE&&e.log(e.LEVEL_WARNING,"StarFieldLayer - sunSize is to big, max size allowed is: "+this._MAX_GL_POINT_SIZE);var s=n.getAsCelestialLocation(this.time||new Date);this._sunBufferView[0]=s.declination,this._sunBufferView[1]=s.rightAscension,this._sunBufferView[2]=Math.min(this.sunSize,this._MAX_GL_POINT_SIZE),this._sunBufferView[3]=1,this._sunPositionsCacheKey||(this._sunPositionsCacheKey=o.generateCacheKey());var a=o.resourceForKey(this._sunPositionsCacheKey);a?(i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferSubData(i.ARRAY_BUFFER,0,this._sunBufferView)):(a=i.createBuffer(),
o.putResource(this._sunPositionsCacheKey,a,4*this._sunBufferView.length),i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferData(i.ARRAY_BUFFER,this._sunBufferView,i.DYNAMIC_DRAW)),t.frameStatistics.incrementVboLoadCount(1),i.vertexAttribPointer(0,4,i.FLOAT,!1,0,0),r.loadTextureEnabled(i,!0);var l=t.gpuResourceCache.resourceForKey(this._sunImageSource);l.bind(t),i.drawArrays(i.POINTS,0,1)},o.prototype.endRendering=function(t){var e=t.currentGlContext;e.depthMask(!0),e.disableVertexAttribArray(0)},o.prototype.fetchStarData=function(){if(!this._loadStarted){this._loadStarted=!0;var t=this,i=new XMLHttpRequest;i.onload=function(){if(this.status>=200&&this.status<300)try{t._starData=JSON.parse(this.response),t.sendRedrawRequest()}catch(t){e.log(e.LEVEL_SEVERE,"StarFieldLayer unable to parse JSON for star data "+t.toString())}else e.log(e.LEVEL_SEVERE,"StarFieldLayer unable to fetch star data. Status: "+this.status+" "+this.statusText);t._loadStarted=!1},i.onerror=function(){e.log(e.LEVEL_SEVERE,"StarFieldLayer unable to fetch star data"),t._loadStarted=!1},i.ontimeout=function(){e.log(e.LEVEL_SEVERE,"StarFieldLayer fetch star data has timeout"),t._loadStarted=!1},i.open("GET",this._starDataSource,!0),i.send()}},o.prototype.createStarsGeometry=function(){var t=this.parseStarsMetadata(this._starData.metadata);if(t.raIndex===-1)throw new Error(e.logMessage(e.LEVEL_SEVERE,"StarFieldLayer","createStarsGeometry","Missing ra field in star data."));if(t.decIndex===-1)throw new Error(e.logMessage(e.LEVEL_SEVERE,"StarFieldLayer","createStarsGeometry","Missing dec field in star data."));if(t.magIndex===-1)throw new Error(e.logMessage(e.LEVEL_SEVERE,"StarFieldLayer","createStarsGeometry","Missing vmag field in star data."));var i=this._starData.data,r=[];this._minMagnitude=Number.MAX_VALUE,this._maxMagnitude=Number.MIN_VALUE;for(var n=0,o=i.length;n<o;n++){var s=i[n],a=s[t.decIndex],l=s[t.raIndex],h=s[t.magIndex],c=h<2?2:1;r.push(a,l,c,h),this._minMagnitude=Math.min(this._minMagnitude,h),this._maxMagnitude=Math.max(this._maxMagnitude,h)}return this._numStars=Math.floor(r.length/4),r},o.prototype.parseStarsMetadata=function(t){for(var e=-1,i=-1,r=-1,n=0,o=t.length;n<o;n++){var s=t[n];"ra"===s.name&&(e=n),"dec"===s.name&&(i=n),"vmag"===s.name&&(r=n)}return{raIndex:e,decIndex:i,magIndex:r}},o.prototype.invalidateStarData=function(){this._starData=null,this._starsPositionsVboCacheKey=null},o.prototype.sendRedrawRequest=function(){var t=document.createEvent("Event");t.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(t)},o}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(54),i(8)],n=function(t,e,i){"use strict";var r=function(t){var i="attribute vec4 vertexPoint;\nuniform mat4 mvpMatrix;\nuniform float numDays;\nuniform vec2 magnitudeRange;\nvarying float magnitudeWeight;\nfloat normalizeAngle(float angle) {\n   float angleDivisions = angle / 360.0;\n   return 360.0 * (angleDivisions - floor(angleDivisions));\n}\nfloat if_gt(float x, float y) {\n   return max(sign(x - y), 0.0);\n}\nvec3 computePosition(float dec, float ra) {\n   float GMST = normalizeAngle(280.46061837 + 360.98564736629 * numDays);\n   float GHA = normalizeAngle(GMST - ra);\n   float lon = -GHA + 360.0 * if_gt(GHA, 180.0);\n   float latRad = radians(dec);\n   float lonRad = radians(lon);\n   float radCosLat = cos(latRad);\n   return vec3(radCosLat * sin(lonRad), sin(latRad), radCosLat * cos(lonRad));\n}\nfloat normalizeScalar(float value, float minValue, float maxValue){\n   return (value - minValue) / (maxValue - minValue);\n}\nvoid main() {\n   vec3 vertexPosition = computePosition(vertexPoint.x, vertexPoint.y);\n   gl_Position = mvpMatrix * vec4(vertexPosition.xyz, 1.0);\n   gl_Position.z = gl_Position.w - 0.00001;\n   gl_PointSize = vertexPoint.z;\n   magnitudeWeight = normalizeScalar(vertexPoint.w, magnitudeRange.x, magnitudeRange.y);\n}",r="precision mediump float;\nuniform sampler2D textureSampler;\nuniform int textureEnabled;\nvarying float magnitudeWeight;\nconst vec4 white = vec4(1.0, 1.0, 1.0, 1.0);\nconst vec4 grey = vec4(0.5, 0.5, 0.5, 1.0);\nvoid main() {\n   if (textureEnabled == 1) {\n       gl_FragColor = texture2D(textureSampler, gl_PointCoord);\n   }\n   else {\n       gl_FragColor = mix(white, grey, magnitudeWeight);\n   }\n}";e.call(this,t,i,r,["vertexPoint"]),this.vertexPointLocation=this.attributeLocation(t,"vertexPoint"),this.mvpMatrixLocation=this.uniformLocation(t,"mvpMatrix"),this.numDaysLocation=this.uniformLocation(t,"numDays"),this.magnitudeRangeLocation=this.uniformLocation(t,"magnitudeRange"),this.textureUnitLocation=this.uniformLocation(t,"textureSampler"),this.textureEnabledLocation=this.uniformLocation(t,"textureEnabled")};return r.key="WorldWindGpuStarFieldProgram",r.prototype=Object.create(e.prototype),r.prototype.loadModelviewProjection=function(e,r){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"StarFieldProgram","loadModelviewProjection","missingMatrix"));this.loadUniformMatrix(e,r,this.mvpMatrixLocation)},r.prototype.loadNumDays=function(e,r){if(null==r)throw new t(i.logMessage(i.LEVEL_SEVERE,"StarFieldProgram","loadNumDays","missingNumDays"));e.uniform1f(this.numDaysLocation,r)},r.prototype.loadMagnitudeRange=function(e,r,n){if(null==r)throw new t(i.logMessage(i.LEVEL_SEVERE,"StarFieldProgram","loadMagRange","missingMinMag"));if(null==n)throw new t(i.logMessage(i.LEVEL_SEVERE,"StarFieldProgram","loadMagRange","missingMaxMag"));e.uniform2f(this.magnitudeRangeLocation,r,n)},r.prototype.loadTextureUnit=function(t,e){t.uniform1i(this.textureUnitLocation,e-t.TEXTURE0)},r.prototype.loadTextureEnabled=function(t,e){t.uniform1i(this.textureEnabledLocation,e?1:0)},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(13),i(9),i(8)],n=function(t,e,i){"use strict";var r={getAsGeographicLocation:function(t){if(t instanceof Date==!1)throw new e(i.logMessage(i.LEVEL_SEVERE,"SunPosition","getAsGeographicLocation","missingDate"));var r=this.getAsCelestialLocation(t);return this.celestialToGeographic(r,t)},getAsCelestialLocation:function(r){if(r instanceof Date==!1)throw new e(i.logMessage(i.LEVEL_SEVERE,"SunPosition","getAsCelestialLocation","missingDate"));var n=this.computeJulianDate(r),o=n-2451545,s=this.normalizeAngle(280.46+.9856474*o),a=this.normalizeAngle(357.528+.9856003*o)*t.DEGREES_TO_RADIANS,l=s+1.915*Math.sin(a)+.02*Math.sin(2*a),h=l*t.DEGREES_TO_RADIANS,c=(23.439-4e-7*o)*t.DEGREES_TO_RADIANS,u=Math.asin(Math.sin(c)*Math.sin(h))*t.RADIANS_TO_DEGREES,d=Math.atan(Math.cos(c)*Math.tan(h))*t.RADIANS_TO_DEGREES;return l>=90&&l<270&&(d+=180),d=this.normalizeAngle(d),{declination:u,rightAscension:d}},celestialToGeographic:function(r,n){if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"SunPosition","celestialToGeographic","missingCelestialLocation"));if(n instanceof Date==!1)throw new e(i.logMessage(i.LEVEL_SEVERE,"SunPosition","celestialToGeographic","missingDate"));var o=this.computeJulianDate(n),s=o-2451545,a=this.normalizeAngle(280.46061837+360.98564736629*s),l=this.normalizeAngle(a-r.rightAscension),h=t.normalizedDegreesLongitude(-l);return{latitude:r.declination,longitude:h}},computeJulianDate:function(t){if(t instanceof Date==!1)throw new e(i.logMessage(i.LEVEL_SEVERE,"SunPosition","computeJulianDate","missingDate"));var r=t.getUTCFullYear(),n=t.getUTCMonth()+1,o=t.getUTCDate(),s=t.getUTCHours(),a=t.getUTCMinutes(),l=t.getUTCSeconds(),h=(s+a/60+l/3600)/24;n<=2&&(r-=1,n+=12);var c=Math.floor(r/100),u=2-c+Math.floor(c/4),d=Math.floor(365.25*(r+4716))+Math.floor(30.6001*(n+1))+o+u-1524.5;return d+h},normalizeAngle:function(t){if(null==t)throw new e(i.logMessage(i.LEVEL_SEVERE,"SunPosition","normalizeAngle","missingAngle"));return 360*(t/360-Math.floor(t/360))}};return r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=i(99),n=i(36),o=i(213),s=function(t,e){r.call(this,"Skybox"),this._imageUrls=this.getImageUrls(t+"/"),this._wwd=e,this.pickEnabled=!1,this._numTriangles=36,this._positionsCacheKey="skyboxPositions",this._mvpMatrix=n.fromIdentity(),this._minScale=1e7};s.prototype=Object.create(r.prototype),Object.defineProperties(s.prototype,{wwd:{set:function(t){this._wwd=t}},imageUrls:{get:function(){return this._imageUrls},set:function(t){this._imageUrls=t}}}),s.prototype.doRender=function(t){if(!t.globe.is2D()&&this._wwd&&this._imageUrls){var e,i=t.currentGlContext,r=t.findAndBindProgram(o),n=this._wwd.viewport,s=this._wwd.navigator.range,a=t.gpuResourceCache.resourceForKey(this._imageUrls.posX);if(!a)return void t.gpuResourceCache.retrieveCubeMapTextures(i,this._imageUrls);a.bind(t),r.loadTextureUnit(i,i.TEXTURE0);var l=1;n.width<n.height&&(l=n.width/n.height);var h=Math.max(s,this._minScale)/l;if(this._mvpMatrix.copy(t.navigatorState.modelviewProjection),this._mvpMatrix[3]=0,this._mvpMatrix[7]=0,this._mvpMatrix[11]=0,this._mvpMatrix.multiplyByScale(h,h,h),r.loadModelviewProjection(i,this._mvpMatrix),e=t.gpuResourceCache.resourceForKey(this._positionsCacheKey))i.bindBuffer(i.ARRAY_BUFFER,e),t.frameStatistics.incrementVboLoadCount(1);else{var c=this.getVertexPositions();this._numTriangles=Math.floor(c.length/3),e=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,e),i.bufferData(i.ARRAY_BUFFER,c,i.STATIC_DRAW),t.gpuResourceCache.putResource(this._positionsCacheKey,e,4*c.length),t.frameStatistics.incrementVboLoadCount(1)}i.vertexAttribPointer(r.vertexPointLocation,3,i.FLOAT,!1,0,0),i.enableVertexAttribArray(0),i.depthMask(!1),i.drawArrays(i.TRIANGLES,0,this._numTriangles),i.depthMask(!0)}},s.prototype.getImageUrls=function(t){return{posX:t+"posx.png",negX:t+"negx.png",posY:t+"posy.png",negY:t+"negy.png",posZ:t+"posz.png",negZ:t+"negz.png"}},s.prototype.getVertexPositions=function(){var t=1;return new Float32Array([-t,t,-t,-t,-t,-t,t,-t,-t,t,-t,-t,t,t,-t,-t,t,-t,-t,-t,t,-t,-t,-t,-t,t,-t,-t,t,-t,-t,t,t,-t,-t,t,t,-t,-t,t,-t,t,t,t,t,t,t,t,t,t,-t,t,-t,-t,-t,-t,t,-t,t,t,t,t,t,t,t,t,t,-t,t,-t,-t,t,-t,t,-t,t,t,-t,t,t,t,t,t,t,-t,t,t,-t,t,-t,-t,-t,-t,-t,-t,t,t,-t,-t,t,-t,-t,-t,-t,t,t,-t,t])},t.exports=s},function(t,e,i){var r=i(9),n=i(54),o=i(8),s=function(t){var e="attribute vec3 vertexPoint;\nuniform  mat4 mvpMatrix;\nvarying vec3 texCoord;\nvoid main(){\n   gl_Position = mvpMatrix * vec4(vertexPoint, 1.0);\n   gl_Position.z = gl_Position.w - 0.00001;\n   texCoord = vertexPoint;\n}\n",i="precision mediump float;\nvarying vec3 texCoord;\nuniform samplerCube skybox;\nvoid main(){\n   gl_FragColor = textureCube(skybox, texCoord);\n}";n.call(this,t,e,i,["vertexPoint"]),this.vertexPointLocation=this.attributeLocation(t,"vertexPoint"),this.mvpMatrixLocation=this.uniformLocation(t,"mvpMatrix"),this.textureUnitLocation=this.uniformLocation(t,"skybox"),this.localState={textureUnit:null}};s.key="WorldWindGpuSkyBoxProgram",s.prototype=Object.create(n.prototype),s.prototype.loadModelviewProjection=function(t,e){if(!e)throw new r(o.logMessage(o.LEVEL_SEVERE,"SkyBoxProgram","loadModelviewProjection","missingMatrix"));this.loadUniformMatrix(t,e,this.mvpMatrixLocation)},s.prototype.loadTextureUnit=function(t,e){this.localState.textureUnit!==e&&(t.uniform1i(this.textureUnitLocation,e-t.TEXTURE0),this.localState.textureUnit=e)},t.exports=s},function(t,e,i){var r=i(30),n=i(215),o=i(17),s=i(12),a=i(211);t.exports=function(t,e){function i(t){function i(){f.lightLocation=n(t?c:h,t?h:c),g+=.1,g>=1&&(clearInterval(l),t||(f.lightLocation=null)),r.post(r.REDRAW)}function n(t,e){return new s(a(t.latitude,e.latitude),a(t.longitude,e.longitude),1e3)}function a(t,e){return o.interpolate(g,t,e)}if(!(!u||!d&&t||d&&!t)){var h=p,c=e.navigator.lookAtLocation;d=!t,clearInterval(l);var g=0;l=setInterval(i,15)}}var l,h=!0,c=!0,u=!0,d=!1,p=a.getAsGeographicLocation(t),f=new n;return f.doRender=function(t){!t.globe.is2D()&&h&&(f.determineLightDirection(t),f.drawSky(t),c&&f.drawGround(t))},f.nightImageSource="images/ground/night.png",f.lightLocation=new s(p.latitude,p.longitude,100),r.listen(r.NAVIGATOR_STATE_CHANGED,function(t){t.range&&i(t.range>1e7)}),r.listen(r.SWITCH_ATMOSPHERE_NIGHT,function(t){u="boolean"==typeof t?t:!u,f.lightLocation=u?new s(p.latitude,p.longitude,1):null,r.post(r.REDRAW)}),r.listen(r.SWITCH_ATMOSPHERE,function(t){h="boolean"==typeof t?t:!h,r.post(r.REDRAW)}),r.listen(r.SWITCH_ATMOSPHERE_GROUND,function(t){c="boolean"==typeof t?t:!c,r.post(r.REDRAW)}),f}},function(t,e,i){var r,n;r=[i(9),i(217),i(99),i(8),i(36),i(216),i(48),i(219),i(11),i(56)],n=function(t,e,i,r,n,o,s,a,l,h){"use strict";var c=function(t){i.call(this,"Atmosphere"),this.pickEnabled=!1,this._nightImageSource=t||WorldWind.configuration.baseUrl+"images/dnb_land_ocean_ice_2012.png",this._lightLocation=null,this._activeLightDirection=new l(0,0,0),this._fullSphereSector=s.FULL_SPHERE,this._skyData={},this._skyWidth=128,this._skyHeight=128,this._numIndices=0,this._texMatrix=o.fromIdentity(),this._activeTexture=null};return c.prototype=Object.create(i.prototype),Object.defineProperties(c.prototype,{lightLocation:{get:function(){return this._lightLocation},set:function(t){this._lightLocation=t}},nightImageSource:{get:function(){return this._nightImageSource},set:function(t){this._nightImageSource=t}}}),c.prototype.doRender=function(t){t.globe.is2D()||(this.determineLightDirection(t),this.drawSky(t),this.drawGround(t))},c.prototype.applySkyVertices=function(t){var e,i,r=t.currentGlContext,n=t.currentProgram,o=this._skyData;o.verticesVboCacheKey||(o.verticesVboCacheKey=t.gpuResourceCache.generateCacheKey()),i=t.gpuResourceCache.resourceForKey(o.verticesVboCacheKey),i?(r.bindBuffer(r.ARRAY_BUFFER,i),r.vertexAttribPointer(0,3,r.FLOAT,!1,0,0)):(e=this.assembleVertexPoints(t,this._skyHeight,this._skyWidth,n.getAltitude()),i=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,i),r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW),r.vertexAttribPointer(0,3,r.FLOAT,!1,0,0),t.gpuResourceCache.putResource(o.verticesVboCacheKey,i,4*e.length),t.frameStatistics.incrementVboLoadCount(1))},c.prototype.applySkyIndices=function(t){var e,i,r=t.currentGlContext,n=this._skyData;n.indicesVboCacheKey||(n.indicesVboCacheKey=t.gpuResourceCache.generateCacheKey()),i=t.gpuResourceCache.resourceForKey(n.indicesVboCacheKey),i?r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i):(e=this.assembleTriStripIndices(this._skyWidth,this._skyHeight),i=r.createBuffer(),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),t.gpuResourceCache.putResource(n.indicesVboCacheKey,i,2*e.length))},c.prototype.drawSky=function(t){var e=t.currentGlContext,i=t.findAndBindProgram(a);i.loadGlobeRadius(e,t.globe.equatorialRadius),i.loadEyePoint(e,t.navigatorState.eyePoint),i.loadVertexOrigin(e,l.ZERO),i.loadModelviewProjection(e,t.navigatorState.modelviewProjection),i.loadLightDirection(e,this._activeLightDirection),i.setScale(e),this.applySkyVertices(t),this.applySkyIndices(t),e.depthMask(!1),e.frontFace(e.CW),e.enableVertexAttribArray(0),e.drawElements(e.TRIANGLE_STRIP,this._numIndices,e.UNSIGNED_SHORT,0),e.depthMask(!0),e.frontFace(e.CCW),e.disableVertexAttribArray(0)},c.prototype.drawGround=function(t){var i,r=t.currentGlContext,n=t.findAndBindProgram(e),o=t.terrain;n.loadGlobeRadius(r,t.globe.equatorialRadius),n.loadEyePoint(r,t.navigatorState.eyePoint),n.loadLightDirection(r,this._activeLightDirection),n.setScale(r),this.nightImageSource&&this.lightLocation&&(this._activeTexture=t.gpuResourceCache.resourceForKey(this.nightImageSource),this._activeTexture||(this._activeTexture=t.gpuResourceCache.retrieveTexture(r,this.nightImageSource)),i=this._activeTexture&&this._activeTexture.bind(t)),o.beginRendering(t);for(var s=0,a=o.surfaceGeometry.length;s<a;s++){var l=o.surfaceGeometry[s],h=l.referencePoint;n.loadVertexOrigin(r,h),i&&(this._texMatrix.setToUnitYFlip(),this._texMatrix.multiplyByTileTransform(l.sector,this._fullSphereSector),n.loadTexMatrix(r,this._texMatrix)),o.beginRenderingTile(t,l),n.loadFragMode(r,n.FRAGMODE_GROUND_SECONDARY),r.blendFunc(r.DST_COLOR,r.ZERO),o.renderTile(t,l);var c=i?n.FRAGMODE_GROUND_PRIMARY_TEX_BLEND:n.FRAGMODE_GROUND_PRIMARY;n.loadFragMode(r,c),r.blendFunc(r.ONE,r.ONE),o.renderTile(t,l),o.endRenderingTile(t,l)}o.endRendering(t),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),this._activeTexture=null},c.prototype.assembleVertexPoints=function(t,e,i,r){var n=e*i,o=new Array(n);h.fillArray(o,r);var s=new Float32Array(3*n);return t.globe.computePointsForGrid(this._fullSphereSector,e,i,o,l.ZERO,s)},c.prototype.assembleTriStripIndices=function(t,e){for(var i=[],r=0,n=0;n<t-1;n++){for(var o=0;o<e;o++)r=o+n*e,i.push(r+e),i.push(r);n<t-2&&(i.push(r),i.push((n+2)*e))}return this._numIndices=i.length,new Uint16Array(i)},c.prototype.determineLightDirection=function(t){null!=this.lightLocation?t.globe.computePointFromLocation(this.lightLocation.latitude,this.lightLocation.longitude,this._activeLightDirection):this._activeLightDirection.copy(t.navigatorState.eyePoint),this._activeLightDirection.normalize()},c}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(8)],n=function(t,e){"use strict";var i=function(t,e,i,r,n,o,s,a,l){this[0]=t,this[1]=e,this[2]=i,this[3]=r,this[4]=n,this[5]=o,this[6]=s,this[7]=a,this[8]=l};return i.prototype=new Float64Array(9),i.fromIdentity=function(){return new i(1,0,0,0,1,0,0,0,1)},i.prototype.setToUnitYFlip=function(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=-1,this[5]=1,this[6]=0,this[7]=0,this[8]=1,this},i.prototype.multiplyMatrix=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"Matrix3","multiplyMatrix","missingMatrix"));var r,n,o,s=this,a=i;return r=s[0],n=s[1],o=s[2],s[0]=r*a[0]+n*a[3]+o*a[6],s[1]=r*a[1]+n*a[4]+o*a[7],s[2]=r*a[2]+n*a[5]+o*a[8],r=s[3],n=s[4],o=s[5],s[3]=r*a[0]+n*a[3]+o*a[6],s[4]=r*a[1]+n*a[4]+o*a[7],s[5]=r*a[2]+n*a[5]+o*a[8],r=s[6],n=s[7],o=s[8],s[6]=r*a[0]+n*a[3]+o*a[6],s[7]=r*a[1]+n*a[4]+o*a[7],s[8]=r*a[2]+n*a[5]+o*a[8],this},i.prototype.multiplyByTileTransform=function(t,e){var i=t.deltaLatitude(),r=t.deltaLongitude(),n=e.deltaLatitude(),o=e.deltaLongitude(),s=r/o,a=i/n,l=(t.minLongitude-e.minLongitude)/o,h=(t.minLatitude-e.minLatitude)/n,c=this;return c[2]+=c[0]*l+c[1]*h,c[5]+=c[3]*l+c[4]*h,c[8]+=c[6]*l+c[6]*h,c[0]*=s,c[1]*=a,c[3]*=s,c[4]*=a,c[6]*=s,c[7]*=a,this},i.prototype.columnMajorComponents=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"Matrix3","columnMajorComponents","missingResult"));return i[0]=this[0],i[1]=this[3],i[2]=this[6],i[3]=this[1],i[4]=this[4],i[5]=this[7],i[6]=this[2],i[7]=this[5],i[8]=this[8],i},i}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(218)],n=function(t){"use strict";var e=function(e){var i="precision mediump int;\nconst int FRAGMODE_GROUND_PRIMARY_TEX_BLEND = 4;\nconst int SAMPLE_COUNT = 2;\nconst float SAMPLES = 2.0;\nconst float PI = 3.141592653589;\nconst float Kr = 0.0025;\nconst float Kr4PI = Kr * 4.0 * PI;\nconst float Km = 0.0015;\nconst float Km4PI = Km * 4.0 * PI;\nconst float ESun = 15.0;\nconst float KmESun = Km * ESun;\nconst float KrESun = Kr * ESun;\nconst vec3 invWavelength = vec3(5.60204474633241, 9.473284437923038, 19.643802610477206);\nconst float rayleighScaleDepth = 0.25;\nuniform int fragMode;\nuniform mat4 mvpMatrix;\nuniform mat3 texCoordMatrix;\nuniform vec3 vertexOrigin;\nuniform vec3 eyePoint;\nuniform float eyeMagnitude;\nuniform float eyeMagnitude2;\nuniform vec3 lightDirection;\nuniform float atmosphereRadius;\nuniform float atmosphereRadius2;\nuniform float globeRadius;\nuniform float scale;\nuniform float scaleDepth;\nuniform float scaleOverScaleDepth;\nattribute vec4 vertexPoint;\nattribute vec2 vertexTexCoord;\nvarying vec3 primaryColor;\nvarying vec3 secondaryColor;\nvarying vec2 texCoord;\nfloat scaleFunc(float cos) {\n    float x = 1.0 - cos;\n    return scaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\nvoid sampleGround() {\n    vec3 point = vertexPoint.xyz + vertexOrigin;\n    vec3 ray = point - eyePoint;\n    float far = length(ray);\n    ray /= far;\n    vec3 start;\n    if (eyeMagnitude < atmosphereRadius) {\n        start = eyePoint;\n    } else {\n        float B = 2.0 * dot(eyePoint, ray);\n        float C = eyeMagnitude2 - atmosphereRadius2;\n        float det = max(0.0, B*B - 4.0 * C);\n        float near = 0.5 * (-B - sqrt(det));\n        start = eyePoint + ray * near;\n        far -= near;\n}\n    float depth = exp((globeRadius - atmosphereRadius) / scaleDepth);\n    float eyeAngle = dot(-ray, point) / length(point);\n    float lightAngle = dot(lightDirection, point) / length(point);\n    float eyeScale = scaleFunc(eyeAngle);\n    float lightScale = scaleFunc(lightAngle);\n    float eyeOffset = depth*eyeScale;\n    float temp = (lightScale + eyeScale);\n    float sampleLength = far / SAMPLES;\n    float scaledLength = sampleLength * scale;\n    vec3 sampleRay = ray * sampleLength;\n    vec3 samplePoint = start + sampleRay * 0.5;\n    vec3 frontColor = vec3(0.0, 0.0, 0.0);\n    vec3 attenuate = vec3(0.0, 0.0, 0.0);\n    for(int i=0; i<SAMPLE_COUNT; i++)\n    {\n        float height = length(samplePoint);\n        float depth = exp(scaleOverScaleDepth * (globeRadius - height));\n        float scatter = depth*temp - eyeOffset;\n        attenuate = exp(-scatter * (invWavelength * Kr4PI + Km4PI));\n        frontColor += attenuate * (depth * scaledLength);\n        samplePoint += sampleRay;\n    }\n    primaryColor = frontColor * (invWavelength * KrESun + KmESun);\n    secondaryColor = attenuate;\n}\nvoid main()\n {\n    sampleGround();\n    gl_Position = mvpMatrix * vertexPoint;\n    if (fragMode == FRAGMODE_GROUND_PRIMARY_TEX_BLEND) {\n        texCoord = (texCoordMatrix * vec3(vertexTexCoord, 1.0)).st;\n    }\n}",r="precision mediump float;\nprecision mediump int;\nconst int FRAGMODE_GROUND_PRIMARY = 2;\nconst int FRAGMODE_GROUND_SECONDARY = 3;\nconst int FRAGMODE_GROUND_PRIMARY_TEX_BLEND = 4;\nuniform int fragMode;\nuniform sampler2D texSampler;\nvarying vec3 primaryColor;\nvarying vec3 secondaryColor;\nvarying vec2 texCoord;\nvoid main (void)\n{\n    if (fragMode == FRAGMODE_GROUND_PRIMARY) {\n        gl_FragColor = vec4(primaryColor, 1.0);\n    } else if (fragMode == FRAGMODE_GROUND_SECONDARY) {\n        gl_FragColor = vec4(secondaryColor, 1.0);\n    } else if (fragMode == FRAGMODE_GROUND_PRIMARY_TEX_BLEND) {\n        vec4 texColor = texture2D(texSampler, texCoord);\n        gl_FragColor = vec4(primaryColor + texColor.rgb * (1.0 - secondaryColor), 1.0);\n    }\n}";t.call(this,e,i,r,["vertexPoint","vertexTexCoord"])};return e.key="WorldWindGroundProgram",e.prototype=Object.create(t.prototype),e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(54),i(8)],n=function(t,e,i){"use strict";var r=function(t,i,r,n){e.call(this,t,i,r,n),this.FRAGMODE_SKY=1,this.FRAGMODE_GROUND_PRIMARY=2,this.FRAGMODE_GROUND_SECONDARY=3,this.FRAGMODE_GROUND_PRIMARY_TEX_BLEND=4,this.altitude=16e4,this.rayleighScaleDepth=.25,this.fragModeLocation=this.uniformLocation(t,"fragMode"),this.mvpMatrixLocation=this.uniformLocation(t,"mvpMatrix"),this.texCoordMatrixLocation=this.uniformLocation(t,"texCoordMatrix"),this.vertexOriginLocation=this.uniformLocation(t,"vertexOrigin"),this.eyePointLocation=this.uniformLocation(t,"eyePoint"),this.eyeMagnitudeLocation=this.uniformLocation(t,"eyeMagnitude"),this.eyeMagnitude2Location=this.uniformLocation(t,"eyeMagnitude2"),this.lightDirectionLocation=this.uniformLocation(t,"lightDirection"),this.atmosphereRadiusLocation=this.uniformLocation(t,"atmosphereRadius"),this.atmosphereRadius2Location=this.uniformLocation(t,"atmosphereRadius2"),this.globeRadiusLocation=this.uniformLocation(t,"globeRadius"),this.scaleLocation=this.uniformLocation(t,"scale"),this.scaleDepthLocation=this.uniformLocation(t,"scaleDepth"),this.scaleOverScaleDepthLocation=this.uniformLocation(t,"scaleOverScaleDepth"),this.scratchArray9=new Float32Array(9)};return r.key="WorldWindGpuAtmosphereProgram",r.prototype=Object.create(e.prototype),r.prototype.getAltitude=function(){return this.altitude},r.prototype.loadFragMode=function(e,r){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"AtmosphereProgram","loadFragMode","missingFragMode"));e.uniform1i(this.fragModeLocation,r)},r.prototype.loadModelviewProjection=function(e,r){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"AtmosphereProgram","loadModelviewProjection","missingMatrix"));this.loadUniformMatrix(e,r,this.mvpMatrixLocation)},r.prototype.loadVertexOrigin=function(e,r){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"AtmosphereProgram","loadVertexOrigin","missingVector"));e.uniform3f(this.vertexOriginLocation,r[0],r[1],r[2])},r.prototype.loadLightDirection=function(e,r){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"AtmosphereProgram","loadLightDirection","missingVector"));e.uniform3f(this.lightDirectionLocation,r[0],r[1],r[2])},r.prototype.loadEyePoint=function(e,r){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"AtmosphereProgram","loadEyePoint","missingVector"));e.uniform3f(this.eyePointLocation,r[0],r[1],r[2]),e.uniform1f(this.eyeMagnitudeLocation,r.magnitude()),e.uniform1f(this.eyeMagnitude2Location,r.magnitudeSquared())},r.prototype.loadGlobeRadius=function(e,r){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"AtmosphereProgram","loadGlobeRadius","missingGlobeRadius"));var n=r,o=n+this.altitude;e.uniform1f(this.globeRadiusLocation,n),e.uniform1f(this.atmosphereRadiusLocation,o),e.uniform1f(this.atmosphereRadius2Location,o*o)},r.prototype.setScale=function(t){t.uniform1f(this.scaleLocation,1/this.getAltitude()),t.uniform1f(this.scaleDepthLocation,this.rayleighScaleDepth),t.uniform1f(this.scaleOverScaleDepthLocation,1/this.getAltitude()/this.rayleighScaleDepth)},r.prototype.loadTexMatrix=function(e,r){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"AtmosphereProgram","loadTexMatrix","missingMatrix"));r.columnMajorComponents(this.scratchArray9),e.uniformMatrix3fv(this.texCoordMatrixLocation,!1,this.scratchArray9)},r}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(218)],n=function(t){"use strict";var e=function(e){var i="precision mediump int;\nconst int SAMPLE_COUNT = 2;\nconst float SAMPLES = 2.0;\nconst float PI = 3.141592653589;\nconst float Kr = 0.0025;\nconst float Kr4PI = Kr * 4.0 * PI;\nconst float Km = 0.0015;\nconst float Km4PI = Km * 4.0 * PI;\nconst float ESun = 15.0;\nconst float KmESun = Km * ESun;\nconst float KrESun = Kr * ESun;\nconst vec3 invWavelength = vec3(5.60204474633241, 9.473284437923038, 19.643802610477206);\nconst float rayleighScaleDepth = 0.25;\nuniform mat4 mvpMatrix;\nuniform vec3 vertexOrigin;\nuniform vec3 eyePoint;\nuniform float eyeMagnitude;\nuniform float eyeMagnitude2;\nuniform mediump vec3 lightDirection;\nuniform float atmosphereRadius;\nuniform float atmosphereRadius2;\nuniform float globeRadius;\nuniform float scale;\nuniform float scaleDepth;\nuniform float scaleOverScaleDepth;\nattribute vec4 vertexPoint;\nvarying vec3 primaryColor;\nvarying vec3 secondaryColor;\nvarying vec3 direction;\nfloat scaleFunc(float cos)\n{\n    float x = 1.0 - cos;\n    return scaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\nvoid sampleSky() {\n    vec3 point = vertexPoint.xyz + vertexOrigin;\n    vec3 ray = point - eyePoint;\n    float far = length(ray);\n    ray /= far;\n    vec3 start;\n    float startOffset;\n    if (eyeMagnitude < atmosphereRadius) {\n        start = eyePoint;\n        float height = length(start);\n        float depth = exp(scaleOverScaleDepth * (globeRadius - eyeMagnitude));\n        float startAngle = dot(ray, start) / height;\n        startOffset = depth*scaleFunc(startAngle);\n    } else {\n        float B = 2.0 * dot(eyePoint, ray);\n        float C = eyeMagnitude2 - atmosphereRadius2;\n        float det = max(0.0, B*B - 4.0 * C);\n        float near = 0.5 * (-B - sqrt(det));\n        start = eyePoint + ray * near;\n        far -= near;\n        float startAngle = dot(ray, start) / atmosphereRadius;\n        float startDepth = exp(-1.0 / scaleDepth);\n        startOffset = startDepth*scaleFunc(startAngle);\n    }\n    float sampleLength = far / SAMPLES;\n    float scaledLength = sampleLength * scale;\n    vec3 sampleRay = ray * sampleLength;\n    vec3 samplePoint = start + sampleRay * 0.5;\n    vec3 frontColor = vec3(0.0, 0.0, 0.0);\n    for(int i=0; i<SAMPLE_COUNT; i++)\n    {\n       float height = length(samplePoint);\n       float depth = exp(scaleOverScaleDepth * (globeRadius - height));\n       float lightAngle = dot(lightDirection, samplePoint) / height;\n       float cameraAngle = dot(ray, samplePoint) / height;\n       float scatter = (startOffset + depth*(scaleFunc(lightAngle) - scaleFunc(cameraAngle)));\n       vec3 attenuate = exp(-scatter * (invWavelength * Kr4PI + Km4PI));\n       frontColor += attenuate * (depth * scaledLength);\n       samplePoint += sampleRay;\n    }\n    primaryColor = frontColor * (invWavelength * KrESun);\n    secondaryColor = frontColor * KmESun;\n    direction = eyePoint - point;\n}\nvoid main()\n{\n    sampleSky();\n    gl_Position = mvpMatrix * vertexPoint;\n    gl_Position.z = gl_Position.w - 0.00001;\n}",r="#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nconst float g = -0.95;\nconst float g2 = g * g;\nuniform mediump vec3 lightDirection;\nvarying vec3 primaryColor;\nvarying vec3 secondaryColor;\nvarying vec3 direction;\nvoid main (void)\n{\n    float cos = dot(lightDirection, direction) / length(direction);\n    float rayleighPhase = 0.75 * (1.0 + cos * cos);\n    float miePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + cos*cos) /         pow(1.0 + g2 - 2.0*g*cos, 1.5);\n    const float exposure = 2.0;\n    vec3 color = primaryColor * rayleighPhase + secondaryColor * miePhase;\n    color = vec3(1.0) - exp(-exposure * color);\n    gl_FragColor = vec4(color, color.b);\n}";t.call(this,e,i,r,["vertexPoint"])};return e.key="WorldWindSkyProgram",e.prototype=Object.create(t.prototype),e}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=i(113),n=(i(221),i(6)),o=i(222),s=i(30);t.exports=function(t,e){function i(t){l.enabled="undefined"==typeof t?!l.enabled:t,s.post(s.REDRAW)}function a(t,e){var i=new n(WorldWind.OFFSET_FRACTION,.95,WorldWind.OFFSET_FRACTION,.9),r=new o(i,t),s=.1;r.beginDrawing=function(t){o.prototype.beginDrawing.call(r,t),t.currentGlContext.disable(t.currentGlContext.DEPTH_TEST)},r.render=function(t){e&&(r.imageRotation=t.navigatorState.heading),t.navigatorState.tilt<85&&(r.imageTilt=t.navigatorState.tilt);var i=r.getActiveTexture(t);i&&(r.imageScale=s*t.currentGlContext.drawingBufferWidth/i.imageWidth),o.prototype.render.call(r,t)},l.addRenderable(r)}s.listen(s.SWITCH_COMPASS,i);var l=new r;return l.enabled=!1,l.pickEnabled=!1,null!=t&&a(t,!1),null!=e&&a(e,!0),l}},function(t,e,i){var r,n;r=[i(9),i(8),i(6),i(222)],n=function(t,e,i,r){"use strict";var n=function(t,e){var n=t?t:new i(WorldWind.OFFSET_FRACTION,1,WorldWind.OFFSET_FRACTION,1),o=e?e:WorldWind.configuration.baseUrl+"images/notched-compass.png";r.call(this,n,o),t||(this.imageOffset=new i(WorldWind.OFFSET_FRACTION,1.1,WorldWind.OFFSET_FRACTION,1.1)),this.size=.15};return n.prototype=Object.create(r.prototype),n.prototype.render=function(t){this.imageRotation=t.navigatorState.heading,this.imageTilt=t.navigatorState.tilt;var e=this.getActiveTexture(t);e&&(this.imageScale=this.size*t.currentGlContext.drawingBufferWidth/e.imageWidth),r.prototype.render.call(this,t)},n}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r,n;r=[i(9),i(102),i(23),i(22),i(8),i(36),i(6),i(60),i(103),i(11),i(17)],n=function(t,e,i,r,n,o,s,a,l,h,c){"use strict";var u=function(e,r){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"ScreenImage","constructor","missingOffset"));if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"ScreenImage","constructor","missingImage"));l.call(this),this.screenOffset=e,this._imageSource=r,this.imageColor=i.WHITE,this.imageOffset=new s(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,.5),this.imageScale=1,this.imageRotation=0,this.imageTilt=0,
this.enabled=!0,this.opacity=1,this.pickDelegate=null,this.activeTexture=null,this.imageTransform=o.fromIdentity(),this.texCoordMatrix=o.fromIdentity(),this.imageBounds=null,this.layer=null};return u.matrix=o.fromIdentity(),u.prototype=Object.create(l.prototype),Object.defineProperties(u.prototype,{imageSource:{get:function(){return this._imageSource},set:function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"ScreenImage","imageSource","missingImage"));this._imageSource=e,this.imageSourceWasUpdated=!0}}}),u.prototype.render=function(t){if(this.enabled&&t.accumulateOrderedRenderables){var e=null;this.lastFrameTime!==t.timestamp&&(e=this.makeOrderedRenderable(t)),e&&e.isVisible(t)&&(e.layer=t.currentLayer,this.lastFrameTime=t.timestamp,t.addOrderedRenderable(e))}},u.prototype.renderOrdered=function(t){if(this.drawOrderedScreenImage(t),t.pickingMode){var e=new a(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,null,this.layer,!1);t.resolvePick(e)}},u.prototype.makeOrderedRenderable=function(t){var e,i,r,n,o,s,a;return this.activeTexture=this.getActiveTexture(t),this.activeTexture&&!this.imageSourceWasUpdated||(this.activeTexture=t.gpuResourceCache.retrieveTexture(t.currentGlContext,this._imageSource),this.activeTexture)?(this.eyeDistance=0,e=this.activeTexture.imageWidth,i=this.activeTexture.imageHeight,r=this.imageScale,s=this.imageOffset.offsetForSize(e,i),n=t.navigatorState.viewport.width,o=t.navigatorState.viewport.height,a=this.screenOffset.offsetForSize(n,o),this.imageTransform.setTranslation(a[0]-s[0]*r,a[1]-s[1]*r,0),this.imageTransform.setScale(e*r,i*r,1),this.imageBounds=c.boundingRectForUnitQuad(this.imageTransform),this):null},u.prototype.getActiveTexture=function(t){return t.gpuResourceCache.resourceForKey(this._imageSource)},u.prototype.isVisible=function(t){return t.pickingMode?t.pickRectangle&&this.imageBounds.intersects(t.pickRectangle):this.imageBounds.intersects(t.navigatorState.viewport)},u.prototype.drawOrderedScreenImage=function(t){this.beginDrawing(t);try{this.doDrawOrderedScreenImage(t)}finally{this.endDrawing(t)}},u.prototype.beginDrawing=function(t){var i,r=t.currentGlContext;t.findAndBindProgram(e),i=t.currentProgram,r.bindBuffer(r.ARRAY_BUFFER,t.unitQuadBuffer()),r.vertexAttribPointer(i.vertexTexCoordLocation,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(i.vertexPointLocation),r.enableVertexAttribArray(i.vertexTexCoordLocation),i.loadTextureUnit(r,r.TEXTURE0),i.loadModulateColor(r,t.pickingMode)},u.prototype.endDrawing=function(t){var e=t.currentGlContext,i=t.currentProgram;e.disableVertexAttribArray(i.vertexPointLocation),e.disableVertexAttribArray(i.vertexTexCoordLocation),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindTexture(e.TEXTURE_2D,null),e.enable(e.DEPTH_TEST)},u.prototype.doDrawOrderedScreenImage=function(t){var e=t.currentGlContext,i=t.currentProgram;e.bindBuffer(e.ARRAY_BUFFER,t.unitQuadBuffer3()),e.vertexAttribPointer(i.vertexPointLocation,3,e.FLOAT,!1,0,0),u.matrix.copy(t.screenProjection),u.matrix.multiplyMatrix(this.imageTransform),u.matrix.multiplyByTranslation(.5,.5,.5),u.matrix.multiplyByRotation(1,0,0,this.imageTilt),u.matrix.multiplyByRotation(0,0,1,this.imageRotation),u.matrix.multiplyByTranslation(-.5,-.5,0),i.loadModelviewProjection(e,u.matrix),i.loadTextureEnabled(e,!0),t.pickingMode?(this.pickColor=t.uniquePickColor(),i.loadColor(e,this.pickColor)):(i.loadColor(e,this.imageColor),i.loadOpacity(e,this.opacity*this.layer.opacity)),this.texCoordMatrix.setToIdentity(),this.texCoordMatrix.multiplyByTextureTransform(this.activeTexture),i.loadTextureMatrix(e,this.texCoordMatrix),this.activeTexture.bind(t)&&e.drawArrays(e.TRIANGLE_STRIP,0,4)},u}.apply(e,r),!(void 0!==n&&(t.exports=n))},function(t,e,i){var r=i(30);t.exports=function(t){function e(e){for(var i=t.canvasCoordinates(e.x,e.y),r=t.pick(i),n=0;n<r.objects.length;n++)if(r.objects[n].parentLayer)return r.objects[n].userObject}r.listen(r._REQUEST_PICK,e)}},function(t,e,i){function r(t){St&&t.id&&2===t.button&&H(t,"Удалить",function(){at.post(at.DESTROY_OBJECT,t.id),at.post(at.SHOW_CONTEXT_MENU,!1)})}function n(t){function e(t){var e=U(),i=it.globe.elevationAtLocation(t[0],t[1]);e.position=new pt(t[0],t[1],i),bt.push(e)}t&&(z()&&t.forEach(e),j()&&e(t))}function o(t){$&&$.forEach(function(e){var i=ct.colorFromHex(t);e.attributes.outlineColor=i,e.highlightAttributes.outlineColor=i})}function s(t){q(),a(t.object.source),n(J.geometry.coordinates),$=t.object.allShapesInSign,ot=setInterval(function(){if(!X){var t=(new Date).getMilliseconds();t=t<500?1e3-t:t;var e=(255*t/1e3).toString(16);o("ff00ff"+e),it.redraw()}},25),w()}function a(t){Y&&d(!0),J=t,Y=J.geometry.type.toLowerCase(),window.addEventListener("mousemove",T),window.addEventListener("mousedown",f),window.addEventListener("mouseup",g),window.addEventListener("touchmove",T),window.addEventListener("touchstart",f),window.addEventListener("touchend",g),at.post(at.BLOCK_NAVIGATION,!0),it.canvas.classList.add("edit-mode")}function l(){var t=bt.map(function(t){return[t.position.latitude,t.position.longitude]});j()?t=t[0]:K()&&(t=[t],t[0].push(t[0][0])),J.geometry.coordinates=t}function h(){bt=[],Tt.innerHTML=""}function c(){bt.forEach(u),u(Z),Lt.setClass("hidden",!Y||!st)}function u(t){if(t){var e=[],i=t.position.latitude,r=t.position.longitude,n=it.globe.elevationAtLocation(i,r);it.globe.computePointFromPosition(i,r,n,xt);var o=it.navigator.currentState().project(xt,e);o&=!gt.isHorizonOccluded(it.drawContext,xt),null!=t.isVisible&&o!==t.isVisible&&(t.style.display=o?"block":"none"),t.style.top=it.canvas.height-e[1]+"px",t.style.left=e[0]+"px",t.isVisible=o}}function d(t){bt.length&&l(),ot&&clearInterval(ot),$&&$.forEach(function(t){t.layer.removeRenderable(t)}),!t&&J&&at.post(at.END_DRAWING,J),at.post(at.BLOCK_NAVIGATION,!1),q(),h(),yt.removeAllRenderables(),window.removeEventListener("mousemove",T),window.removeEventListener("mousedown",f),window.removeEventListener("mouseup",g),window.removeEventListener("touchmove",T),window.removeEventListener("touchstart",f),window.removeEventListener("touchend",g),it.canvas.classList.remove("edit-mode"),D(!1),J=Y=X=Z=Q=null}function p(t){t.x=t.x||t.touches[0].clientX,t.y=t.y||t.touches[0].clientY,t.isLeft=0===t.button||t.touches&&null!=t.touches[0]}function f(t){if(!t.handled&&st){if(p(t),t.target.parentNode===Tt)return X=t.target,G(),X.classList.add("drag"),rt=t.x,void(nt=t.y);if(t.target===it.canvas&&!t.ctrlKey)return q(),2===t.button?O(t):void(t.isLeft&&M(t))}}function g(){X&&(X.classList.remove("drag"),X=null,Q=null,_t.removeAllRenderables(),it.redraw())}function m(){_t.removeAllRenderables(),E([X.position,Z.position,Q]);var t=I(Z.position);E(v(t,Z.position,Q,X.position,"minimum")),E(v(1.3*t,Z.position,Q,X.position,"minimum"))}function E(t){_t.addRenderable(new dt(t,"ff00a5",2))}function v(t,e,i,r,n){var o=ft.greatCircleDistance(e,i),s=ft.greatCircleAzimuth(e,r),a=ft.greatCircleAzimuth(e,i),l=y(s-a);("minimum"===n&&l>180||"exclude"===n)&&(l-=360);for(var h=[_(t,e,i)],c=12,u=0;u<Math.abs(l)/c;u++){var d=y(a+u*c*Math.sign(l)),p=ft.greatCircleLocation(e,d,o,new pt(0,0,0));h.push(_(t,e,p))}return h.push(_(t,e,r)),h}function y(t){return t<0?t+360:t}function _(t,e,i){var r=it.globe.radiusAt(e.latitude,e.longitude),n=t/r,o=ft.greatCircleAzimuth(e,i);return ft.greatCircleLocation(e,o,n,new pt(0,0,0))}function T(t){if(X&&(0===t.button||t.touches[0])){p(t);var e=S(t);e&&(X.classList.contains("center-point")?(!tt&&x(X.position,e),X.position=e):tt?(L(X.position,e),m()):(X.position=e,R()),P())}}function L(t,e){var i=Z.position,r=ft.greatCircleAzimuth(i,e)-ft.greatCircleAzimuth(i,t);bt.forEach(function(t){var e=ft.greatCircleAzimuth(i,t.position)+r,n=ft.greatCircleDistance(i,t.position);ft.greatCircleLocation(i,e,n,t.position)})}function x(t,e){var i=e.latitude-t.latitude,r=e.longitude-t.longitude;bt.forEach(function(t){t.position.latitude+=i,t.position.longitude+=r,b(t.position)})}function b(t){t.longitude>180&&(t.longitude-=360),t.longitude<-180&&(t.longitude+=360)}function S(t){for(var e=it.canvasCoordinates(t.x,t.y),i=it.pick(e).objects,r=0;r<i.length;r++)if(i[r].isTerrain)return i[r].position}function w(){P(),R(),at.post(at._ANCHOR_POINTS_COUNT,bt.length)}function M(t){j()&&h(),F(t),w()}function R(){if(!(bt.length<2)){var t=0,e=0;bt.forEach(function(i){t+=i.position.latitude,e+=i.position.longitude}),t/=bt.length,e/=bt.length;var i=it.globe.elevationAtLocation(t,e);Z||(Z=U("center-point")),Z.position=new pt(t,e,i)}}function A(t){for(var e=[t[0]],i=1;i<t.length-1;i++){var r=bt[i].mode;if(r){var n=I(t[i]),o=v(n,t[i],t[i-1],t[i+1],r);e=e.concat(o)}else e.push(t[i])}e.push(t[t.length-1]),C(e)}function C(t,e){var i=new dt(t,"ffa500",2,null);i.source={id:"_editor",index:e},yt.addRenderable(i)}function P(){if(it.redraw(),!j()){yt.removeAllRenderables();var t=bt.map(function(t,e){return t.innerHTML=e+1,t.position});if(z()&&t.length>1&&A(t),K()&&t.length>2){var e=new ut([t],Et);e._attributes.drawOutline=!1,yt.addRenderable(e),t.push(t[0]),C(t)}}}function I(t){var e=it.drawContext.surfacePointForMode(t.latitude,t.longitude,t.altitude,WorldWind.CLAMP_TO_GROUND,new pt(0,0,0)),i=it.drawContext.navigatorState,r=i.eyePoint.distanceTo(e);return i.pixelSizeAtDistance(r)*vt}function D(t){tt=void 0===t?!tt:t,tt?Tt.classList.add("rotate-mode"):Tt.classList.remove("rotate-mode"),q()}function N(t){var e=[D.bind(null,void 0)],i=[tt?"Режим перемещения":"Режим поворота"];H(t,i,e)}function O(t){H(t,"Завершить",d.bind(null,null)),it.redraw()}function V(t){var e=new ht(null);return e.outlineColor=ct.colorFromHex(t+"fe"),e.interiorColor=ct.colorFromHex(t+"aa"),e}function G(){Q=new ft(X.position.latitude,X.position.longitude)}function F(t){var e=S(t);e&&(X=U("drag",rt=t.x,nt=t.y),X.position=e,G(),bt.push(X),at.post(at._ANCHOR_POINTS_COUNT,bt.length))}function k(t){bt.splice(bt.indexOf(t),1),Tt.removeChild(t),q(),w()}function W(t,e){var i=["Удалить точку"],r=[k.bind(null,t)];bt.indexOf(t);H(e,i,r)}function B(t,e){t===Z?N(e):W(t,e)}function U(t,e,i){var r=mt.div("circle"),n=mt.div(t).append(r).appendTo(Tt);return n.classList.add("anchor-point"),n.oncontextmenu=function(t){return!!st&&(B(n,t),!1)},n.xy=function(t,e){n.style.left=t+"px",n.style.top=e+"px"},n.mode=et,n.xy(e||0,i||0),n}function j(){return"point"===Y}function K(){return"polygon"===Y}function z(){return"linestring"===Y}function q(){at.post(at.SHOW_CONTEXT_MENU,!1)}function H(t,e,i){Array.isArray(e)||(e=[e],i=[i]),at.post(at.SHOW_CONTEXT_MENU,{x:t.x,y:t.y,items:e.map(function(t){return{text:t,func:i[e.indexOf(t)]}})})}var Y,X,Q,J,Z,$,tt,et,it,rt,nt,ot,st,at=i(30),lt=i(113),ht=(i(159),i(155),i(105)),ct=i(23),ut=i(138),dt=i(122),pt=i(12),ft=i(14),gt=i(125),mt=i(225),Et=V("ffa500"),vt=(V("ff00a5"),30),yt=new lt("Editor New Primitive Layer"),_t=new lt("Editor Helper Layer"),Tt=mt.select(".editor"),Lt=mt.select("#editor-border"),xt=[0,0,0],bt=[],St=!1;at.listen(at.OBJECT_MOUSE_CLICK,r),at.listen(at.NAVIGATOR_STATE_CHANGED,P),at.listen(at.START_DRAWING,a),at.listen(at.EDIT_OBJECT,s),at.listen(at._FORCE_END_DRAWING,d),at.listen(at.DELETE_MODE,function(t){St=t}),at.listen(at.BLOCK_NAVIGATION,function(t){st=t}),at.listen(at.SET_DRAW_MODE,function(t){return"draw"===t?void at.post(at.BLOCK_NAVIGATION,!st):void D("rotate"===t)}),t.exports=function(t){it=t,it.addLayer(yt),it.addLayer(_t),it.redrawCallbacks.push(c)}},function(t,e){function i(t,e){var i=n(t,"http://www.w3.org/2000/svg");return a(i,e)}function r(t,e,i){var r=n(t);return a(i),s(r,e)}function n(t,e){return o(e?document.createElementNS(e,t):document.createElement(t))}function o(t){return t.append=function(e){return t.appendChild(e.domElement?e.domElement:e),t},t.appendTo=function(e){return e.appendChild(t),t},t.setClass=function(e,i){return t.classList[i?"add":"remove"](e),t},t.val=h(t,"value"),t.change=h(t,"oninput"),t.html=h(t,"innerHTML"),t.top=l(t,"top"),t.left=l(t,"left"),t.over=c(t,"mouseover"),t.out=c(t,"mouseout"),t.click=c(t,"click"),t}function s(t,e){return e&&(t.className=e.toString()),t}function a(t,e){if(e)for(var i in e)e.hasOwnProperty(i)&&t.setAttribute(i,e[i]);return t}function l(t,e){return function(i){return t.style[e]=i,t}}function h(t,e){return function(i){return i&&(t[e]=i),t}}function c(t,e){return function(i){return t.addEventListener(e,i),t}}t.exports={div:function(t){return r("div",t)},span:function(t){return r("span",t)},input:function(t){return r("input",t)},img:function(t,e){return r("img",e,{src:t?t:""})},svg:function(t){return i("svg",t)},path:function(t){return i("path",t)},circle:function(t){return i("circle",t)},select:function(t,e){return o((e||document).querySelector(t))},all:function(t,e){return Array.prototype.slice.call((e||document).querySelectorAll(t)).map(function(t){return o(t)})}}},function(t,e,i){function r(){var t=a.post(a._REQUEST_PICK,n);if(s&&t!==s&&(s.highlighted=!1,a.post(a.TOOLTIP),a.post(a.OBJECT_MOUSE_OVER,[]),s.hover&&s.hover(!1)),t){t.highlighted=!0;var e=t.source;e&&e.properties&&e.properties.tooltip&&a.post(a.TOOLTIP,e.properties.tooltip),e&&e.id&&t!==s&&a.post(a.OBJECT_MOUSE_OVER,[t]),t.hover&&t.hover(!0)}s=t,a.post(a.REDRAW)}var n,o,s,a=i(30);window.addEventListener("mousedown",function(t){!t.target.classList.contains("context-menu-item")&&a.post(a.SHOW_CONTEXT_MENU,!1),s&&s.source&&a.post(a.OBJECT_MOUSE_CLICK,{id:s.source.id,button:t.button,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,x:t.x,y:t.y})}),window.addEventListener("mousemove",function(t){return n=t,s?void r():(clearTimeout(o),void(o=setTimeout(r,50)))},!1),t.exports=function(){}},function(t,e,i){i(228),i(229),i(239),i(240),i(241),i(243),i(244),i(245),i(246),i(247),i(248),i(249),i(250)},function(t,e,i){function r(t){function e(){t.event&&o.post(t.event,t.data)}var i=n.div("button").click(t.click?t.click:e).appendTo(s);i.oncontextmenu=function(){return!1},i.id=t.id,"right"===t.align?i.style.right=l+50*c++ +"px":i.style.left=l+50*h++ +"px",t.title&&(i.title=t.title),t.html&&(i.innerHTML=t.html),t.icon&&(i.style.backgroundImage="url("+t.icon+")",i.style.backgroundSize="cover",i.style.backgroundPosition="center")}var n=i(225),o=i(30),s=n.select("#buttons"),a=s.currentStyle||window.getComputedStyle(s),l=parseInt(a.marginTop.substring(0,a.marginTop.length-2)),h=0,c=0;o.listen(o.CREATE_BUTTON,r)},function(t,e,i){function r(t){function e(t){"button"===t.type&&r.addButton(t),"field"===t.type&&r.addField(t),"html"===t.type&&r.addHtml(t),"combobox"===t.type&&r.addCombobox(t),"tree"===t.type&&r.addTree(t),"checklist"===t.type&&r.addChecklist(t),"slider"===t.type&&r.addSlider(t)}function i(e,i){var n=t[e];n=n?n:i,n&&(r.style[e]=n+"px")}var r=n(t.id,t.title);return i("width",400),i("height",300),i("left"),i("bottom"),i("top"),i("right"),t.close?r.addCloseButton():t.minimize&&r.addMinimizeButton(),t.contents&&t.contents.forEach(e),t.visible&&r.show(),r.appendTo(document.body),r}var n=i(230),o=i(30);o.listen(o.CREATE_FORM,r)},function(t,e,i){function r(){return s().append(o("M5,15 H16"))}function n(){return s().append(o("M5,5 L16,16 M5,16 L16,5"))}function o(t){return a.path({d:t,stroke:"lightgray","stroke-width":3})}function s(){return a.svg({width:21,height:21,viewbox:"0 0 25 25"})}var a=i(225),l=i(231),h=i(30),c=i(232),u=i(234),d=i(235),p=i(237),f=i(238);t.exports=function(t,e){function i(){a.all(".form").forEach(function(t){t.style.zIndex=100}),v.style.zIndex=1e3}function o(t){i(),v.classList.contains("form-minimized")||(T=v.offsetLeft,L=v.offsetTop,v.classList.remove("form-transition"),x=t.clientX||t.touches[0].clientX,b=t.clientY||t.touches[0].clientY,window.addEventListener("mousemove",E),window.addEventListener("touchmove",E),window.addEventListener("mouseup",s),window.addEventListener("touchend",s))}function s(){window.removeEventListener("mousemove",E),window.removeEventListener("touchmove",E),v.hasMinimazeButton&&v.classList.add("form-transition")}function g(t){var e=window.innerWidth-S-v.offsetWidth;t=t>e?e:t,t=t<S?S:t,v.style.left=t+"px"}function m(t){var e=window.innerHeight-S-v.offsetHeight;t=t>e?e:t,t=t<S?S:t,v.style.bottom=t+"px",v.style.removeProperty("top")}function E(t){var e=t.clientX||t.touches[0].clientX,i=t.clientY||t.touches[0].clientY;g(T+e-x),m(window.innerHeight-(L+i-b)-v.offsetHeight)}var v=a.div("form");v.oncontextmenu=function(){return!1},"string"==typeof e?e=a.div("form-title").html(e).appendTo(v):e&&v.append(e);var y={};v.fields=y;var _=a.div("form-content").appendTo(v);e||(_.style.top=0),v.add=function(t){return _.append(t),v},v.addField=function(t,e){var i=l(t);return v.add(i),t.path?(e=e||"default",y[e]||(y[e]=[]),y[e].push(i),v):v},v.addTree=function(t){v.add(d(t.config,t.data,t.select,t.height))},v.addCombobox=function(t){v.add(c(t.title,t.values,t.width))},v.addChecklist=function(t){v.add(u(t.title,t.values,t.width))},v.addHtml=function(t){v.add(a.div().html(t.html))},v.addButton=function(t){var e=p.create(t);return v.add(e),e},v.addSlider=function(t){v.add(f(t)),v.add(a.div("stub50"))},v.addFields=function(t,e){t.forEach(function(t){v.addField(t,e)})},v.render=function(t,e){return e=e||"default",y[e]&&y[e].forEach(function(e){e.render(t)}),v},v.getField=function(t,e){return e=e||"default",y[e].filter(function(e){return t===e.cfg.path})[0]},v.hasMinimazeButton=!1,v.addMinimizeButton=function(t){v.classList.add("form-transition"),v.hasMinimazeButton=!0;var i=a.div("form-top-button").click(function(){v.oldLeft=v.offsetLeft,v.style.left=160*a.all(".form-minimized").length+10+"px",v.classList.add("form-minimized"),i.classList.add("hidden"),t&&t.classList.add("hidden")}).appendTo(v).append(r());return e&&e.click(function(){v.classList.contains("form-minimized")&&(v.classList.remove("form-minimized"),i.classList.remove("hidden"),t&&t.classList.remove("hidden"),a.all(".form-minimized").forEach(function(t){if(t.offsetLeft>v.offsetLeft){var e=t.offsetLeft-160;t.style.left=e+"px"}}),v.style.left=v.oldLeft+"px")}),v},v.addCloseButton=function(){return a.div("form-top-button").click(v.hide).appendTo(v).append(n()),v},v.show=function(){return i(),v.classList.add("visible"),v},v.hide=function(){return v.classList.remove("visible"),v},v.toggle=function(){return v.classList.contains("visible")?v.hide():v.show()},v.clear=function(){return _.innerHTML="",v},v.id="form-"+t,h.listen(h.SHOW_FORM,function(t){"form-"+t===v.id&&v.show()}),h.listen(h.HIDE_FORM,function(t){"form-"+t===v.id&&v.hide()}),h.listen(h.TOGGLE_FORM,function(t){"form-"+t===v.id&&v.toggle()});var T,L,x,b,S=10;return e&&(e.addEventListener("mousedown",o),e.addEventListener("touchstart",o),window.addEventListener("resize",function(){g(v.offsetLeft),m(window.innerHeight-v.offsetTop-v.offsetHeight)})),v.click(i),v}},function(t,e,i){function r(t){var e=s.div("form-field");e.cfg=t,t.custom||(t.custom={}),s.div("form-field-title").html(t.title+":").appendTo(e);var i=s.div("form-field-value").appendTo(e);if(e.set=function(t){i.html(t)},e.render=function(e){var r=t.custom.provider?t.custom.provider(e):n(e,t.path);t.custom.renderer?t.custom.renderer(r,i,e):null!=r&&("number"==typeof r&&(r=r.toFixed(6)),i.innerHTML=r)},t.listen&&a.listen(t.listen,function(t){e.render(t)}),t.custom.style)for(var r in t.custom.style)t.custom.style.hasOwnProperty(r)&&(e.style[r]=t.custom.style[r]);return e}function n(t,e){try{e=e.split(".");for(var i=0;i<e.length;i++)t=t[e[i]];return t}catch(t){return null}}function o(t,e,i){function r(t){return function(e){return n.custom[t]=e,n}}var n={title:t,path:e,custom:{style:i}};return n.style=r("style"),n.provider=r("provider"),n.renderer=r("renderer"),n.onclick=r("onclick"),n}var s=i(225),a=i(30);t.exports=r,t.exports.cfg=o},function(t,e,i){function r(t,e,i){function r(t){function e(){s.placeholder.innerHTML=t.text}var i=document.createElement("span");i.innerHTML=t.text,t.selected&&e();var r=document.createElement("li");return r.appendChild(i),r.onclick=function(){e(),n.post(t.post,t.data)},s.ul.appendChild(r),r}var s=o("wrapper-dropdown-5",t,i);this.dd=s,this.opts=e.map(r),this.val="",this.index=-1}var n=i(30),o=(i(225),i(233));t.exports=function(t,e,i){var n=new r(t,e,i);return n.dd}},function(t,e,i){var r=i(225),n=0;t.exports=function(t,e,i){function o(){l.classList.remove("active")}var s=document.createElement("ul");s.classList.add("dropdown");var a=r.span().html(e),l=r.div(t).append(a).append(s);return l.style.width=(i||100)+"px",l.tabIndex=n++,l.placeholder=a,l.ul=s,l.onblur=o,window.addEventListener("click",o,!1),l.onclick=function(t){return l.classList.toggle("active"),t.stopPropagation(),!1},l}},function(t,e,i){function r(t,e,i){function r(t,e){var i="checklist-element-"+Math.random().toString(36).substr(2,10),r=document.createElement("label");r.for=i,r.innerHTML=t.text;var o=document.createElement("input");o.type="checkbox",o.value=t.text,o.id=i,o.name=i;var l=document.createElement("li");return l.appendChild(o),l.appendChild(r),a.ul.appendChild(l),r.onclick=function(){var t=o.value;n(t,s.val)!==-1?s.val.splice(n(t,s.val),1):s.val.push(t),n(e,s.index)!==-1?s.index.splice(n(e,s.index),1):s.index.push(e)},l}var s=this,a=o("wrapper-dropdown-4",t,i);this.dd=a,this.opts=e.map(r),this.val=[],this.index=[]}function n(t,e,i){var r=e.length;for(i=i?i<0?Math.max(0,r+i):i:0;i<r;i++)if(i in e&&e[i]===t)return i;return-1}var o=i(233);i(30),i(225);t.exports=function(t,e,i){var n=new r(t,e,i);return n.dd}},function(t,e,i){function r(t,e){t.children&&t.children.forEach(function(i){e.apply(this,[i,t]),r(i,e)})}var n=i(225),o=i(236);t.exports=function(t,e,i,s){function a(e,r){function o(){e.treeNode.classList.toggle("collapsed")}function s(){i(e)}var a=n.path({d:"M15,5 V25 M5,15 H25",stroke:"white",strokeWidth:2}),l=n.svg({width:30,height:30}).append(a).click(o),c=n.span("tree-node-text").html(e[t.property]).click(s);e.treeNode=n.div("tree-node").append(n.span("tree-node-expander").append(l)).append(c).appendTo(r.treeNode?r.treeNode:h),e.treeNode.expander=l,l.style.opacity=0,r.treeNode&&(r.treeNode.expander.style.opacity=1)}var l=n.div("tree"),h=n.div("tree-body");if(r(e,a),s)var c=o(h,t.width,s).appendTo(l);else h.appendTo(l);return l.update=function(){c&&c.update()},l.update(),l}},function(t,e,i){function r(t,e,i){function r(t){var e=u+t.clientY,i=p.offsetHeight-g.offsetHeight;e<0&&(e=0),e>i&&(e=i),p.scrollTop=e/c(),g.style.top=e+"px"}function s(t){u=g.offsetTop-t.clientY,document.addEventListener("mousemove",r),document.addEventListener("mouseup",a),g.parentNode.classList.add("active")}function a(){document.removeEventListener("mousemove",r),document.addEventListener("mouseup",a),g.parentNode.classList.remove("active")}function l(){const t=c();g.style.top=p.scrollTop*t+"px",g.style.height=(t<1?i*t:0)+"px"}function h(t){var e=t.deltaY;p.scrollTop+=e/2,l(),t.preventDefault()}function c(){return i/t.offsetHeight}var u,d=o.div("scroll-container"),p=o.div("viewport").append(t).appendTo(d),f=o.div("track").appendTo(d),g=o.div("knob").appendTo(f);return n(d,e,i),n(p,e,i),n(f,null,i),d.addEventListener("mousewheel",h),g.addEventListener("mousedown",s),d.update=l,d}function n(t,e,i){null!=e&&(t.style.width=e+"px"),null!=i&&(t.style.height=i+"px")}const o=i(225);t.exports=r},function(t,e,i){var r=i(225);t.exports={create:function(t){var e,i=!1;if(t.image){var n=r.img();n.src=t.image,e=r.div("form-button-image").append(n).append(r.span("form-button-image--text").html(t.title))}else e=r.div("form-button").html(t.title);return t.tooltip&&e.setAttribute("title",t.tooltip),t.width&&(e.style.width=t.width+"px"),t.height&&(e.style.height=t.height+"px"),t.group&&Events.listen(Events.FORM_BUTTON_GROUP_STATE_CHANGED,function(i){i.group===t.group&&e.setClass("active",i.title===t.title)}),(t.post||t.action)&&e.click(function(){i||(t.post&&!e.classList.contains("active")&&Events.post(t.post,t.data),t.action&&t.action(),t.group&&Events.post(Events.FORM_BUTTON_GROUP_STATE_CHANGED,{group:t.group,title:t.title}))}),e.setDisabled=function(t){return i=t,e.setClass("disabled",t),e.style.pointerEvents=t?"none":"all",e},e.setVisible=function(t){return e.setClass("hidden",!t),e},e}}},function(t,e,i){var r=i(225),n=30,o=100;t.exports=function(t){function e(t){h=t[d],window.addEventListener("mousemove",i),window.addEventListener("mouseup",s)}function i(e){const i=(e[d]-h)/f;c=u+i*(t.invert?-1:1),c<0&&(c=0),c>o&&(c=o),a(),t&&"function"==typeof t.callback&&t.callback(c/100)}function s(){window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",s),u=c,h=null}function a(){var e=h?c:u,i=t.vertical?t.invert?"bottom":"top":t.invert?"right":"left";g.style[i]=e*f+"px",g.html(l(e))}function l(e){var i=e/o;return t.renderValue&&t.renderValue(i),i.toFixed(2).toString()}var h,c,u=t&&t.value?t.value*o:0,d=t.vertical?"clientY":"clientX",p=r.div("slider");p.style.width=(t.vertical?n:t.size)+"px",p.style.height=(t.vertical?t.size:n)+"px";var f=(t.size-n)/o;t.style&&p.classList.add(t.style);var g=r.div("slider-knob").appendTo(p);return g.addEventListener("mousedown",e),a(),p.setValue=function(t){u=t*o,c=t*o,a()},p}},function(t,e,i){function r(){s.classList.add("visible"),a&&clearInterval(a),a=setInterval(function(){s.classList.remove("visible")},250)}var n=i(225),o=i(30),s=n.div("target").appendTo(document.body);n.svg({viewBox:"0 0 100 100",width:50,height:50}).append(n.circle({r:30,cx:50,cy:50,stroke:"wheat","stroke-width":3,fill:"none"})).append(n.path({stroke:"wheat","stroke-width":3,d:"M50,10 L50,20 M50,80 L50,90 M10,50 L20,50 M80,50 L90,50"})).appendTo(s),o.listen(o.NAVIGATOR_STATE_CHANGED,r),o.listen(o.LOCATION_CHANGED,r);var a},function(t,e,i){function r(){u.style.transform="rotateX("+s+"deg) rotateZ("+a+"deg)"}var n=i(30),o=i(225),s=0,a=0,l="rgba(255, 255, 255, 0.7)",h="rgba(255, 0, 0, 0.7)",c="none",u=o.svg({viewbox:"0 0 100 100",width:100,height:100}).append(o.circle({cx:50,cy:50,r:45,stroke:l,fill:c,"stroke-width":3})).append(o.path({d:"M50,10 L37,50 L63,50 Z",stroke:c,fill:h})).append(o.path({d:"M50,10 L37,50 L50,90 L63,50 Z",stroke:l,fill:c,"stroke-width":3})).click(function(){window.engine.navigator.tilt=0,window.engine.navigator.heading=0}),d=o.div("overlay-compass hidden").append(u).appendTo(document.body);n.listen(n.SWITCH_COMPASS_SVG,function(t){d.setClass("hidden",null==t?!d.classList.contains("hidden"):t)}),d.oncontextmenu=function(){return!1},n.listen(n.NAVIGATOR_STATE_CHANGED,function(t){void 0!==t.tilt&&(s=t.tilt),void 0!==t.heading&&(a=-t.heading),s=s>70?70:s,r()})},function(t,e,i){function r(t){v.post(v._FORCE_END_DRAWING),v.post(v.HIDE_FORM,T),m=!1,t&&(f.cancelled=!0),v.post(v.WIZARD_RESULT,f),v.post(v.CLEAR_LAYER,"editor")}function n(){var t=f.rules[p];S.clear(),S.add(s()),S.add(M.setDisabled(0===p)),S.add(R.setDisabled(p===f.rules.length-1)),S.add(A.setVisible(!0).setDisabled(1===t.max||!E)),S.add(C.setVisible(!1)),S.add(P.setVisible(!0).setDisabled(!E)),S.add(I.setVisible(!1)),S.add(D),S.add(N.setDisabled(!f.rules.reduce(function(t,e){return t&&e.finished}))),t.text&&t.text.forEach(function(t,e){var i=y.input("wizard-point-text");i.setAttribute("type","text"),i.style.top=70+x*p+e*b+"px",i.style.left="50px",i.style.width="150px",i.style.height="20px",i.style.backgroundColor="rgba(128,128,128,0.5)",i.placeholder=t.title,t.value&&(i.value=t.value),i.onkeyup=function(){t.value=i.value},S.add(i)});var e=t.text?t.text.length:0;S.style.height=30*f.rules.length+175+e*b+"px"}function o(t){v.post(v._FORCE_END_DRAWING),p=t;var e=!0;p<0?(p=0,e=!1):p===f.rules.length&&(p=f.rules.length-1,e=!1),e&&(g=0,n(),setTimeout(d,10))}function s(){for(var t,e=f.rules.length,i=x/2,r=f.rules[p],n=r.text?r.text.length:0,o=e*x+L+n*b,s=y.svg({viewbox:"0 0 200 "+o,width:200,height:o}),h=0;h<e;h++){var d=x*h+i+(h>p?L+n*b:0),m=.7*i,E=h===p,v=f.rules[h],_=E?null:h+1;if(!v.finished&&s.append(l(i,d,h+1,"white",!0)),s.append(u(i,d,m,v.finished,_)),v.finished&&s.append(l(i,d,h+1,"black",!0)),s.append(l(x+10,d,v.name,E?"wheat":"white",!1,_)),E){v.description&&s.append(l(x+15,d+20,v.description,"white"));for(var T=0;T<v.min;T++)s.append(u(x+20+15*T,d+40,5,T<g));(!v.max||v.max>v.min)&&s.append(c(x+20+15*v.min,d+40,5,v.min+1<=g))}t&&s.append(a(i,t,d-m)),t=d+m}return s}function a(t,e,i){return y.path({d:"M "+t+","+e+" L "+t+","+i,stroke:"white","stroke-width":2})}function l(t,e,i,r,n,o){var s=document.createElementNS("http://www.w3.org/2000/svg","text");return s.innerHTML=i,s.setAttribute("x",t),s.setAttribute("y",e),s.setAttribute("fill",r),s.setAttribute("cursor","default"),s.setAttribute("alignment-baseline","central"),o&&s.setAttribute("cursor","pointer"),o&&(s.onclick=h.bind(null,o)),n&&s.setAttribute("text-anchor","middle"),s}function h(t){o(t-1)}function c(t,e,i,r,n){function o(i,r){return t+i+","+(e+r)}function s(t,e){return"M"+o(t,e)}function a(t,e){return"L"+o(t,e)}var l={d:s(0,-i)+a(0,i)+s(-i,0)+a(i,0),fill:r?"wheat":"none",stroke:r?"wheat":"white","stroke-width":2};n&&(l.cursor="pointer");var c=y.path(l);return n&&(c.onclick=h.bind(null,n)),c}function u(t,e,i,r,n){var o={r:i,cx:t,cy:e,fill:r?"wheat":"none",stroke:r?"wheat":"white","stroke-width":2};n&&(o.cursor="pointer");var s=y.circle(o);return n&&(s.onclick=h.bind(null,n)),s}function d(){var t=v.post(v._GET_LAYER,"editor");t&&t.renderables.forEach(function(e){e.source.properties.ruleIndex===p&&t.removeRenderable(e)});var e=f.rules[p];e.result?v.post(v.EDIT_OBJECT,{object:{source:e.result}}):v.post(v.START_DRAWING,{type:"Feature",geometry:{type:1===e.max?"Point":"LineString"},properties:{layer:"editor",id:f.id,ruleType:e.type,ruleIndex:p,api:"coco",text:"",width:10,height:10}}),v.post(v.REDRAW),E=!0,n()}var p,f,g,m,E,v=i(30),y=i(225),_=i(242),T="wizard",L=40,x=30,b=27,S=v.post(v.CREATE_FORM,{id:T,width:220,height:400,left:55,bottom:155,title:"Нанесение знака",visible:!1});S.style.transition="0 !important";var w=40,M=S.addButton({action:function(){o(p-1)},tooltip:"Предыдущее правило",title:_.prev(),width:w,height:w}),R=S.addButton({action:function(){o(p+1)},tooltip:"Следующее правило",title:_.next(),width:w,height:w}),A=S.addButton({action:function(){v.post(v.SET_DRAW_MODE,"rotate"),A.setVisible(!1),C.setVisible(!0)},tooltip:"Включить режим поворота",title:_.rotate(),width:w,height:w}),C=S.addButton({action:function(){v.post(v.SET_DRAW_MODE,"move"),C.setVisible(!1),A.setVisible(!0)},tooltip:"Выключить режим поворота",title:_.move(),width:w,height:w}).setVisible(!1),P=S.addButton({action:function(){v.post(v.SET_DRAW_MODE,"draw"),P.setVisible(!1),I.setVisible(!0)},tooltip:"Приостановить нанесение",title:_.look(),width:w,height:w}),I=S.addButton({action:function(){v.post(v.SET_DRAW_MODE,"draw"),I.setVisible(!1),P.setVisible(!0)},tooltip:"Продолжить нанесение",title:_.pencil(),width:w,height:w}),D=S.addButton({action:r.bind(null,!0),tooltip:"Отменить нанесение знака",title:"Отмена",width:90}),N=S.addButton({action:r.bind(null),tooltip:"Закончить нанесение знака",title:"Нанести",width:90});v.listen(v._ANCHOR_POINTS_COUNT,function(t){if(m){g=t;var e=f.rules[p];e.finished=e.min<=t,n(),v.post(v.REDRAW)}}),v.listen(v.END_DRAWING,function(t){E=!1,m&&(f.rules[p].result=t,n(),v.post(v.REDRAW))}),v.listen(v.SHOW_WIZARD,function(t){f=t,m=!0,p=0,g=0,v.post(v.SHOW_FORM,T),d()})},function(t,e){function i(t){return r(n(t[1]),t[0])}function r(t,e){return'<svg viewBox="'+(e||"0 0 100 100")+'">'+t+"</svg>"}function n(t,e,i){return'<path stroke-width="'+(e||1)+'" stroke="'+(i||"white")+'" fill="white" d="'+t+'"/>'}var o=["-256 -500 2048 2048","M1536 640v-128q0 -53 -32.5 -90.5t-84.5 -37.5h-704l293\t            -294q38 -36 38 -90t-38 -90l-75 -76q-37 -37 -90 -37q-52 0 -91 37l-651 652q-37\t             37 -37 90q0 52 37 91l651 650q38 38 91 38q52 0 90 -38l75 -74q38 -38 38 -91t-38\t              -91l-293 -293h704q52 0 84.5 -37.5 t32.5 -90.5z"],s=["-256 -500 2048 2048","M1472 576q0 -54 -37 -91l-651 -651q-39 -37 -91\t            -37q-51 0 -90 37l-75 75q-38 38 -38 91t38 91l293 293h-704q-52 0 -84.5\t             37.5t-32.5 90.5v128q0 53 32.5 90.5t84.5 37.5h704l-293 294q-38 36 -38\t              90t38 90l75 75q38 38 90 38q53 0 91 -38l651 -651q37 -35 37 -90z"],a=["-256 -400 2048 2048","M1536 640q0 -156 -61 -298t-164 -245t-245 -164t-298 -61q-172 0 -327 72.5t-264 204.5q-7 10 -6.5 22.5t8.5 20.5l137 138q10 9 25 9q16 -2 23 -12q73 -95 179 -147t225 -52q104 0 198.5 40.5t163.5 109.5t109.5 163.5t40.5 198.5t-40.5 198.5t-109.5 163.5 t-163.5 109.5t-198.5 40.5q-98 0 -188 -35.5t-160 -101.5l137 -138q31 -30 14 -69q-17 -40 -59 -40h-448q-26 0 -45 19t-19 45v448q0 42 40 59q39 17 69 -14l130 -129q107 101 244.5 156.5t284.5 55.5q156 0 298 -61t245 -164t164 -245t61 -298z"],l=["-120 -400 2048 2048","M1792 640q0 -26 -19 -45l-256 -256q-19 -19 -45 -19t-45 19t-19 45v128h-384v-384h128q26 0 45 -19t19 -45t-19 -45l-256 -256q-19 -19 -45 -19t-45 19l-256 256q-19 19 -19 45t19 45t45 19h128v384h-384v-128q0 -26 -19 -45t-45 -19t-45 19l-256 256q-19 19 -19 45 t19 45l256 256q19 19 45 19t45 -19t19 -45v-128h384v384h-128q-26 0 -45 19t-19 45t19 45l256 256q19 19 45 19t45 -19l256 -256q19 -19 19 -45t-19 -45t-45 -19h-128v-384h384v128q0 26 19 45t45 19t45 -19l256 -256q19 -19 19 -45z"],h=["-256 -500 2048 2048","M1190 955l293 293l-107 107l-293 -293zM1637 1248q0 -27 -18 -45l-1286 -1286q-18 -18 -45 -18t-45 18l-198 198q-18 18 -18 45t18 45l1286 1286q18 18 45 18t45 -18l198 -198q18 -18 18 -45zM286 1438l98 -30l-98 -30l-30 -98l-30 98l-98 30l98 30l30 98zM636 1276 l196 -60l-196 -60l-60 -196l-60 196l-196 60l196 60l60 196zM1566 798l98 -30l-98 -30l-30 -98l-30 98l-98 30l98 30l30 98zM926 1438l98 -30l-98 -30l-30 -98l-30 98l-98 30l98 30l30 98z"],c=["-300 -400 2048 2048","M363 0l91 91l-235 235l-91 -91v-107h128v-128h107zM886\t    928q0 22 -22 22q-10 0 -17 -7l-542 -542q-7 -7 -7 -17q0 -22 22 -22q10 0 17 7l542 542q7 7 7\t    17zM832 1120l416 -416l-832 -832h-416v416zM1515 1024q0 -53 -37 -90l-166 -166l-416 416l166\t    165q36 38 90 38 q53 0 91 -38l235 -234q37 -39 37 -91z"],u=["-2 -1 18 18","M14,8.77 L14,7.17 L12.06,6.53 L11.61,5.44 L12.49,3.6 L11.36,2.47\t    L9.55,3.38 L8.46,2.93 L7.77,1.01 L6.17,1.01 L5.54,2.95 L4.43,3.4\t    L2.59,2.52 L1.46,3.65 L2.37,5.46 L1.92,6.55 L0,7.23 L0,8.82 L1.94,9.46\t    L2.39,10.55 L1.51,12.39 L2.64,13.52 L4.45,12.61 L5.54,13.06 L6.23,14.98\t    L7.82,14.98 L8.45,13.04 L9.56,12.59 L11.4,13.47 L12.53,12.34 L11.61,10.53\t    L12.08,9.44 L14,8.75 L14,8.77 Z M7,11 C5.34,11 4,9.66 4,8 C4,6.34 5.34,5 7,5\t    C8.66,5 10,6.34 10,8 C10,9.66 8.66,11 7,11 L7,11 Z"],d=["3 3 90 90","M32.8,18l-2.9,11.5L18.2,32l8.5,8.3l-3.6,11.3l11.4-3.2l8,8.8l1.5-6l-8.9-9\t    c0.8-3.2,3.8-6.3,6.9-6.9l9.1,9.1l5.9-1.3l-8.5-8.3l3.6-11.3l-11.4,3.2L32.8,18z M52.4,45.8l-6.9,6.9L70.9,78\t    c3.4-0.8,6.2-3.3,6.9-6.9L52.4,45.8z"],p=["-100 -100 1200 1200","M990,500c0,13.3-3.3,23.3-10,36.7c-50,83.3-120,150-206.7,200c-86.7,50-176.7,76.7-273.3,76.7c-96.7,0-186.7-26.7-273.3-76.7C140,686.7,73.3,620,20,536.7C13.3,523.3,10,510,10,500c0-13.3,3.3-23.3,10-36.7c50-83.3,120-150,206.7-200c86.7-50,176.7-76.7,273.3-76.7c96.7,0,186.7,26.7,273.3,76.7c86.7,50,153.3,116.7,206.7,200C986.7,476.7,990,486.7,990,500z M920,500c-56.7-86.7-123.3-150-206.7-193.3c23.3,36.7,33.3,80,33.3,123.3c0,66.7-23.3,123.3-73.3,173.3C626.7,650,566.7,676.7,500,676.7c-66.7,0-123.3-23.3-173.3-73.3C280,556.7,253.3,496.7,253.3,430c0-43.3,10-83.3,33.3-123.3C203.3,350,133.3,413.3,80,500c50,73.3,110,133.3,183.3,176.7c73.3,43.3,153.3,66.7,236.7,66.7c86.7,0,163.3-23.3,236.7-66.7C810,633.3,870,573.3,920,500z M520,310c6.7-6.7,6.7-10,6.7-20c0-6.7-3.3-13.3-6.7-20c-6.7-6.7-10-6.7-20-6.7c-46.7,0-83.3,16.7-116.7,50c-33.3,33.3-50,70-50,116.7c0,6.7,3.3,13.3,6.7,20c6.7,6.7,10,6.7,20,6.7c6.7,0,13.3-3.3,20-6.7c6.7-6.7,6.7-10,6.7-20c0-30,10-56.7,33.3-80c23.3-23.3,50-33.3,80-33.3C506.7,316.7,513.3,313.3,520,310z"];
t.exports={magic:i.bind(null,h),prev:i.bind(null,o),next:i.bind(null,s),rotate:i.bind(null,a),move:i.bind(null,l),pencil:i.bind(null,c),look:i.bind(null,p),gear:i.bind(null,u),wizard:i.bind(null,d)}},function(t,e,i){function r(t){s.style.left=t.x+15+"px",s.style.top=t.y-5+"px"}var n=i(30),o=i(225),s=o.select(".tooltip");n.listen(n.TOOLTIP,function(t){s.setClass("visible",!!t).html(t?t.split(" ").join("&nbsp;"):""),window[t?"addEventListener":"removeEventListener"]("mousemove",r)})},function(t,e,i){var r=i(30),n=i(225),o=n.select(".waiting");r.listen(r.WAIT,function(t){o.setClass("visible",!!t)})},function(t,e,i){function r(t,e){_.post(_.CONTROLS,{parameter:e?e:S,value:t})}function n(t){if("heading"==S){var e=b+d(t);return l(e),void r(-e)}var i=x+p(t);return Math.abs(i)>M&&(i=Math.sign(i)*M),"tilt"==S?(c(i),void r((i+M)/w*90)):void("range"==S&&(h(i),r(1e5+(i+M)/w*2e7)))}function o(t){S=y(this.id),"heading"==S?b=a()-d(t):x=s(this)-p(t),document.addEventListener("mousemove",n),document.addEventListener("mouseup",m),document.addEventListener("touchmove",n),document.addEventListener("touchend",m)}function s(t){return parseFloat(t.getAttribute("transform").split(/\(|\)/)[1].split(" ")[1])}function a(){return parseFloat(R.heading.parentNode.getAttribute("transform").split(/\(|\)/)[1])}function l(t){R.heading.parentNode.setAttribute("transform","rotate("+t+")")}function h(t){R.zoom.setAttribute("transform","translate(100 "+t+")")}function c(t){R.tilt.setAttribute("transform","translate(-100 "+t+")")}function u(t){var e=T.select("#controls-"+t+"-knob");return e.addEventListener("mousedown",o),e.addEventListener("touchstart",o),e}function d(t){return g(Math.PI-Math.atan2(f(t),p(t)))}function p(t){return(t.clientY||t.touches[0].clientY)-E(A.parentNode,"offsetTop")-A.clientHeight/2}function f(t){return(t.clientX||t.touches[0].clientX)-E(A.parentNode,"offsetLeft")-A.clientWidth/2}function g(t){return t/Math.PI*180}function m(){S=null,document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",m),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",m)}function E(t,e){var i=t[e];return t.offsetParent&&(i+=E(t.offsetParent,e)),i}function v(t){function e(){document.removeEventListener("mouseup",e),document.removeEventListener("touchend",e),r(!1,n)}function i(){document.addEventListener("mouseup",e),document.addEventListener("touchend",e),r(!0,n)}const n=y(t.id);t.addEventListener("mousedown",i),t.addEventListener("touchstart",i)}function y(t){return t.split("-")[1]}var _=i(30),T=i(225),L=T.select("#compass");L.oncontextmenu=function(){return!1};var x,b,S,w=160,M=w/2,R={heading:u("heading"),tilt:u("tilt"),zoom:u("range")},A=T.select("#controls-svg");t.exports=A,T.all("path.arrow").forEach(v),_.listen(_.SWITCH_CONTROLS,function(t){"boolean"!=typeof t?L.classList.toggle("visible"):t?L.classList.add("visible"):L.classList.remove("visible")}),_.listen(_.NAVIGATOR_STATE_CHANGED,function(t){if(!S&&(null!=t.heading&&l(-t.heading),null!=t.tilt&&c(t.tilt/90*w-M),null!=t.range)){var e=(1e5+t.range)/2e7*w-M;Math.abs(e)>M&&(e=Math.sign(e)*M),h(e)}})},function(t,e,i){function r(t){o.div("context-menu-item").click(t.func).html(t.text).appendTo(s)}var n=i(30),o=i(225),s=o.select(".context");s.oncontextmenu=function(){return!1},window.addEventListener("resize",function(){s.classList.remove("visible")}),n.listen(n.SHOW_CONTEXT_MENU,function(t){t?(s.innerHTML="",s.style.left=t.x+"px",s.style.top=t.y+"px",t.items.forEach(r),s.classList.add("visible")):s.classList.remove("visible")})},function(t,e,i){function r(){return m}function n(){return E}function o(t){if(v&&v.elevations&&v.elevations.buttons){var e=v.elevations.buttons[t];e&&(p.post(p.CHANGE_ELEVATION_MODEL,e.data),p.post(p.FORM_BUTTON_GROUP_STATE_CHANGED,{group:"elevations",title:e.title}))}}function s(t){if(v&&v.maps&&v.maps.buttons){var e=v.maps.buttons[t];e&&(p.post(p.CHANGE_MAP,e.data),p.post(p.FORM_BUTTON_GROUP_STATE_CHANGED,{group:"maps",title:e.title}))}}function a(t,e){var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",t,!0),i.onreadystatechange=function(){4!=i.readyState||"200"!=i.status&&"0"!=i.status||e(i.responseText)},i.send(null)}function l(){var t=d.select("#"+g);t.parentNode.removeChild(t)}function h(t){function e(t){h.push({type:"html",html:'<div style="cursor: default;height: 40px;line-height: 40px;font-size: 25px;text-align: center;color: khaki">'+t+"</div>"})}function i(t,e,i){n("maps",t,e,p.CHANGE_MAP,i)}function r(t,e,i){n("elevations",t,e,p.CHANGE_ELEVATION_MODEL,i)}function n(t,e,i,r,n){h.push({type:"button",group:t,title:i,image:e,post:r,data:n,action:u})}if(v=t,t){m=[],E=[];var a,l,h=[],c=0;if(t.maps){e(t.maps.title);for(var d in t.maps.buttons){var g=t.maps.buttons[d];"object"==typeof g&&g.data&&(m.push(d),i(g.icon||"images/layers/bmap-64x64.png",g.title,g.data),1==g.default&&(a=d)),c++}}if(t.elevations){e(t.elevations.title);for(var d in t.elevations.buttons){var g=t.elevations.buttons[d];"object"==typeof g&&g.data&&(E.push(d),r(g.icon||"images/layers/bmap-64x64.png",g.title,g.data),1==g.default&&(l=d)),c++}}p.post(p.CREATE_FORM,{id:f,width:315,height:100+92*Math.ceil(c/4),right:5,top:55,contents:h}),!a&&m.length>0&&(a=m[0]),!l&&E.length>0&&(l=E[0]),a&&s(a),l&&o(l)}}function c(t){p.post(p.CREATE_BUTTON,{align:"right",icon:"images/layers/map-ico.png",event:p.TOGGLE_FORM,data:f,id:g}),"object"==typeof t?h(t):"string"==typeof t?a(t,function(t){var e=JSON.parse(t);(e.maps||e.elevations)&&h(e)}):h(T)}function u(){p.post(p.HIDE_FORM,f)}var d=i(225),p=i(30),f="layers",g="show-blp",m=[],E=[],v={};p.listen(p.CREATE_BASE_LAYER_PICKER,c),p.listen(p.DESTROY_BASE_LAYER_PICKER,l),p.listen(p.GET_MAPS_KEYS,r),p.listen(p.GET_ELEVATIONS_KEYS,n),p.listen(p.SET_ACTIVE_MAP,s),p.listen(p.SET_ACTIVE_ELEVATION,o);var y={bing:{title:"Bing",icon:"images/layers/bingAerial.png",default:!0,data:{ground:"images/ground/vesat.2048x1024.jpg",patternUrl:"https://t{s}.ssl.ak.dynamic.tiles.virtualearth.net/comp/ch/{q}?mkt=ru-RU&it=A,G,RL&shading=hill&n=z&og=154&c4w=1"}},osm:{title:"Open Street Map",icon:"images/layers/openStreetMap.png",data:{patternUrl:"http://tile.openstreetmap.org/{z}/{x}/{y}.png"}},twoGis:{title:"2 GIS",icon:"images/layers/twoGisMap.png",data:{patternUrl:"http://tile3.maps.2gis.com/tiles?x={x}&y={y}&z={z}&v=36"}},panorama:{title:"Panorama",icon:"images/layers/worldMap.png",data:{type:"wmts",layers:[11],detail:1.2,patternUrl:"http://gisserver.info/GISWebServiceSE/service.php"}},wmts:{title:"Example WMTS",data:{type:"wmts",layers:[0,1],patternUrl:"https://tiles.geoservice.dlr.de/service/wmts"}},hybrid:{title:"Hybrid",icon:"images/layers/googleHyb.png",data:{ground:"images/ground/sat.2048x1024.jpg",patternUrl:"http://213.170.107.10:8080/tile/?dataset=sat,Both&z={z}&x={x}&y={y}&suffix=.jpg"}}},_={none:{title:"Без рельефа",default:!0,data:{type:"none"}},rest:{title:"Базовый",icon:"images/layers/elevationLocal.png",data:{type:"rest",url:"*"}},wcs:{title:"SRTM WCS",data:{type:"wcs",url:"*"}},wms:{title:"SRTM WMS",data:{type:"wms",url:"*"}}},T={maps:{title:"Карты",buttons:y},elevations:{title:"Рельеф",buttons:_}}},function(t,e,i){function r(){function t(){return p=d/l}function e(){return d.toString().indexOf("5")>-1}var i=window.engine.drawContext;if(!i.pickingMode&&i.navigatorState){var r=engine.navigator.lookAtLocation,n=engine.globe.elevationAtLocation(r.latitude,r.longitude),o=[0,0,0];engine.globe.computePointFromPosition(r.latitude,r.longitude,n,o);for(var s=i.navigatorState.eyePoint.distanceTo(o),l=i.navigatorState.pixelSizeAtDistance(s),d=1e3,p=t();p>c;)d/=e()?5:2,t();for(;p<c/5;)d*=e()?2:5,t();if(p=Math.floor(p),u!==p){u=p;var f=(c-u)/2,g=f+u;h.setAttribute("d","M"+f+",20 L"+f+",30 L"+g+",30 L"+g+",20 M100,30 L100,20"),a.html(d>500?d/1e3+" км":d+" м")}}}var n=(i(14),i(30)),o=i(225);n.listen(n.NAVIGATOR_STATE_CHANGED,r),n.listen(n.LOCATION_CHANGED,r);var s=o.div("scale-widget").appendTo(document.body),a=o.div("text").appendTo(s),l=o.svg({viewBox:"0 0 200 30",width:200,height:20,fill:"none"}).appendTo(s),h=o.path({stroke:"wheat","stroke-width":2.5}).appendTo(l),c=200,u=0},function(t,e,i){function r(){n(p,d).forEach(function(t){var e=p.indexOf(t),i=g.span("search-result-item").html(e+1).click(s.bind(null,e));e===d&&i.classList.add("active"),u.append(i)})}function n(t,e){for(var i=t.slice(e+1).reverse(),r=t.slice(0,e),n=[t[e]];n.length<10&&(r.length&&(n=[r.pop()].concat(n)),i.length&&(n=n.concat([i.pop()])),0!==i.length||0!==r.length););return n}function o(){u.innerHTML="",r(),f.post(f._HIGHLIGHT_FOUND,d)}function s(t){d=t,o()}function a(){d++;var t=p.length-1;d=d>t?t:d,o()}function l(){d--,d=d<0?0:d,o()}function h(){c||(c=f.post(f.CREATE_FORM,{id:m,close:!0,hidden:!0,width:400,height:90,title:"Результаты поиска",left:window.innerWidth/2-200,bottom:50}),c.addButton({action:l,tooltip:"Предыдущий",title:E.prev(),width:30,height:30}),u=g.div("search-result"),c.add(u),c.addButton({action:a,tooltip:"Следующий",title:E.next(),width:30,height:30}))}var c,u,d,p,f=i(30),g=i(225),m="search-form",E=i(242);f.listen(f._SHOW_SEARCH_RESULT,function(t){p=t,d=0,h(),o(),f.post(f.SHOW_FORM,m)})},function(t,e,i){function r(t){l.forEach(function(e){e.update(t)})}function n(t,e){var i=o.div().appendTo(a);i.style.display="inline-block",i.style.width="120px";var r;return i.update=function(n){n[t]&&n[t]!==r&&(r=n[t],i.html(e+": "+r.toFixed(6)))},i}var o=i(225),s=i(30),a=o.div("on-screen-state").appendTo(document.body);a.style.position="fixed",a.style.bottom="10px",a.style.right="250px",a.style.color="wheat";var l=[n("latitude","Ш"),n("longitude","Д")];s.listen(s.NAVIGATOR_STATE_CHANGED,r),s.listen(s.LOCATION_CHANGED,r)},function(t,e,i){"use strict";function r(t,e){return t.b===e.b&&t.a===e.a}function n(t,e){return t.b<e.b||t.b===e.b&&t.a<=e.a}function o(t,e,i){var r=e.b-t.b,n=i.b-e.b;return 0<r+n?r<n?e.a-t.a+r/(r+n)*(t.a-i.a):e.a-i.a+n/(r+n)*(i.a-t.a):0}function s(t,e,i){var r=e.b-t.b,n=i.b-e.b;return 0<r+n?(e.a-i.a)*r+(e.a-t.a)*n:0}function a(t,e){return t.a<e.a||t.a===e.a&&t.b<=e.b}function l(t,e,i){var r=e.a-t.a,n=i.a-e.a;return 0<r+n?r<n?e.b-t.b+r/(r+n)*(t.b-i.b):e.b-i.b+n/(r+n)*(i.b-t.b):0}function h(t,e,i){var r=e.a-t.a,n=i.a-e.a;return 0<r+n?(e.b-i.b)*r+(e.b-t.b)*n:0}function c(t){return n(t.b.a,t.a)}function u(t){return n(t.a,t.b.a)}function d(t,e,i,r){return t=0>t?0:t,i=0>i?0:i,t<=i?0===i?(e+r)/2:e+t/(t+i)*(r-e):r+i/(t+i)*(e-r)}function p(t){var e=v(t.b);return _(e,t.c),_(e.b,t.c),T(e,t.a),e}function f(t,e){var i=!1,r=!1;t!==e&&(e.a!==t.a&&(r=!0,x(e.a,t.a)),e.d!==t.d&&(i=!0,b(e.d,t.d)),y(e,t),r||(_(e,t.a),t.a.c=t),i||(T(e,t.d),t.d.a=t))}function g(t){var e=t.b,i=!1;t.d!==t.b.d&&(i=!0,b(t.d,t.b.d)),t.c===t?x(t.a,null):(t.b.d.a=Z(t),t.a.c=t.c,y(t,Z(t)),i||T(t,t.d)),e.c===e?(x(e.a,null),b(e.d,null)):(t.d.a=Z(e),e.a.c=e.c,y(e,Z(e))),L(t)}function m(t){var e=v(t),i=e.b;return y(e,t.e),e.a=t.b.a,_(i,e.a),e.d=i.d=t.d,e=e.b,y(t.b,Z(t.b)),y(t.b,e),t.b.a=e.a,e.b.a.c=e.b,e.b.d=t.b.d,e.f=t.f,e.b.f=t.b.f,e}function E(t,e){var i=!1,r=v(t),n=r.b;return e.d!==t.d&&(i=!0,b(e.d,t.d)),y(r,t.e),y(n,e),r.a=t.b.a,n.a=e.a,r.d=n.d=t.d,t.d.a=n,i||T(r,t.d),r}function v(t){var e=new J,i=new J,r=t.b.h;return i.h=r,r.b.h=e,e.h=t,t.b.h=i,e.b=i,e.c=e,e.e=i,i.b=e,i.c=i,i.e=e}function y(t,e){var i=t.c,r=e.c;i.b.e=e,r.b.e=t,t.c=r,e.c=i}function _(t,e){var i=e.f,r=new tt(e,i);i.e=r,e.f=r,i=r.c=t;do i.a=r,i=i.c;while(i!==t)}function T(t,e){var i=e.d,r=new Q(e,i);i.b=r,e.d=r,r.a=t,r.c=e.c,i=t;do i.d=r,i=i.e;while(i!==t)}function L(t){var e=t.h;t=t.b.h,e.b.h=t,t.b.h=e}function x(t,e){var i=t.c,r=i;do r.a=e,r=r.c;while(r!==i);i=t.f,r=t.e,r.f=i,i.e=r}function b(t,e){var i=t.a,r=i;do r.d=e,r=r.e;while(r!==i);i=t.d,r=t.b,r.d=i,i.b=r}function S(t){var e=0;return Math.abs(t[1])>Math.abs(t[0])&&(e=1),Math.abs(t[2])>Math.abs(t[e])&&(e=2),e}function w(t,e){t.f+=e.f,t.b.f+=e.b.f}function M(t,e,i){return t=t.a,e=e.a,i=i.a,e.b.a===t?i.b.a===t?n(e.a,i.a)?0>=s(i.b.a,e.a,i.a):0<=s(e.b.a,i.a,e.a):0>=s(i.b.a,t,i.a):i.b.a===t?0<=s(e.b.a,t,e.a):(e=o(e.b.a,t,e.a),t=o(i.b.a,t,i.a),e>=t)}function R(t){t.a.i=null;var e=t.e;e.a.c=e.c,e.c.a=e.a,t.e=null}function A(t,e){g(t.a),t.c=!1,t.a=e,e.i=t}function C(t){var e=t.a.a;do t=ft(t);while(t.a.a===e);return t.c&&(e=E(pt(t).a.b,t.a.e),A(t,e),t=ft(t)),t}function P(t,e,i){var r=new dt;return r.a=i,r.e=z(t.f,e.e,r),i.i=r}function I(t,e){switch(t.s){case 100130:return 0!==(1&e);case 100131:return 0!==e;case 100132:return 0<e;case 100133:return 0>e;case 100134:return 2<=e||-2>=e}return!1}function D(t){var e=t.a,i=e.d;i.c=t.d,i.a=e,R(t)}function N(t,e,i){for(t=e,e=e.a;t!==i;){t.c=!1;var r=pt(t),n=r.a;if(n.a!==e.a){if(!r.c){D(t);break}n=E(e.c.b,n.b),A(r,n)}e.c!==n&&(f(Z(n),n),f(e,n)),D(t),e=r.a,t=r}return e}function O(t,e,i,r,n,o){var s=!0;do P(t,e,i.b),i=i.c;while(i!==r);for(null===n&&(n=pt(e).a.b.c);r=pt(e),i=r.a.b,i.a===n.a;)i.c!==n&&(f(Z(i),i),f(Z(n),i)),r.f=e.f-i.f,r.d=I(t,r.f),e.b=!0,!s&&k(t,e)&&(w(i,n),R(e),g(n)),s=!1,e=r,n=i;e.b=!0,o&&B(t,e)}function V(t,e,i,r,n){var o=[e.g[0],e.g[1],e.g[2]];e.d=null,e.d=t.o?t.o(o,i,r,t.c)||null:null,null===e.d&&(n?t.n||(X(t,100156),t.n=!0):e.d=i[0])}function G(t,e,i){var r=[null,null,null,null];r[0]=e.a.d,r[1]=i.a.d,V(t,e.a,r,[.5,.5,0,0],!1),f(e,i)}function F(t,e,i,r,n){var o=Math.abs(e.b-t.b)+Math.abs(e.a-t.a),s=Math.abs(i.b-t.b)+Math.abs(i.a-t.a),a=n+1;r[n]=.5*s/(o+s),r[a]=.5*o/(o+s),t.g[0]+=r[n]*e.g[0]+r[a]*i.g[0],t.g[1]+=r[n]*e.g[1]+r[a]*i.g[1],t.g[2]+=r[n]*e.g[2]+r[a]*i.g[2]}function k(t,e){var i=pt(e),o=e.a,a=i.a;if(n(o.a,a.a)){if(0<s(a.b.a,o.a,a.a))return!1;if(r(o.a,a.a)){if(o.a!==a.a){var i=t.e,l=o.a.h;if(0<=l){var i=i.b,h=i.d,c=i.e,u=i.c,d=u[l];h[d]=h[i.a],u[h[d]]=d,d<=--i.a&&(1>=d?ct(i,d):n(c[h[d>>1]],c[h[d]])?ct(i,d):ut(i,d)),c[l]=null,u[l]=i.b,i.b=l}else for(i.c[-(l+1)]=null;0<i.a&&null===i.c[i.d[i.a-1]];)--i.a;G(t,Z(a),o)}}else m(a.b),f(o,Z(a)),e.b=i.b=!0}else{if(0>s(o.b.a,a.a,o.a))return!1;ft(e).b=e.b=!0,m(o.b),f(Z(a),o)}return!0}function W(t,e){var i=pt(e),c=e.a,u=i.a,p=c.a,g=u.a,E=c.b.a,v=u.b.a,y=new tt;if(s(E,t.a,p),s(v,t.a,g),p===g||Math.min(p.a,E.a)>Math.max(g.a,v.a))return!1;if(n(p,g)){if(0<s(v,p,g))return!1}else if(0>s(E,g,p))return!1;var _,T,L=E,x=p,b=v,S=g;if(n(L,x)||(_=L,L=x,x=_),n(b,S)||(_=b,b=S,S=_),n(L,b)||(_=L,L=b,b=_,_=x,x=S,S=_),n(b,x)?n(x,S)?(_=o(L,b,x),T=o(b,x,S),0>_+T&&(_=-_,T=-T),y.b=d(_,b.b,T,x.b)):(_=s(L,b,x),T=-s(L,S,x),0>_+T&&(_=-_,T=-T),y.b=d(_,b.b,T,S.b)):y.b=(b.b+x.b)/2,a(L,x)||(_=L,L=x,x=_),a(b,S)||(_=b,b=S,S=_),a(L,b)||(_=L,L=b,b=_,_=x,x=S,S=_),a(b,x)?a(x,S)?(_=l(L,b,x),T=l(b,x,S),0>_+T&&(_=-_,T=-T),y.a=d(_,b.a,T,x.a)):(_=h(L,b,x),T=-h(L,S,x),0>_+T&&(_=-_,T=-T),y.a=d(_,b.a,T,S.a)):y.a=(b.a+x.a)/2,n(y,t.a)&&(y.b=t.a.b,y.a=t.a.a),L=n(p,g)?p:g,n(L,y)&&(y.b=L.b,y.a=L.a),r(y,p)||r(y,g))return k(t,e),!1;if(!r(E,t.a)&&0<=s(E,t.a,y)||!r(v,t.a)&&0>=s(v,t.a,y)){if(v===t.a)return m(c.b),f(u.b,c),e=C(e),c=pt(e).a,N(t,pt(e),i),O(t,e,Z(c),c,c,!0),!0;if(E===t.a){m(u.b),f(c.e,Z(u)),p=i=e,g=p.a.b.a;do p=ft(p);while(p.a.b.a===g);return e=p,p=pt(e).a.b.c,i.a=Z(u),u=N(t,i,null),O(t,e,u.c,c.b.c,p,!0),!0}return 0<=s(E,t.a,y)&&(ft(e).b=e.b=!0,m(c.b),c.a.b=t.a.b,c.a.a=t.a.a),0>=s(v,t.a,y)&&(e.b=i.b=!0,m(u.b),u.a.b=t.a.b,u.a.a=t.a.a),!1}return m(c.b),m(u.b),f(Z(u),c),c.a.b=y.b,c.a.a=y.a,c.a.h=rt(t.e,c.a),c=c.a,u=[0,0,0,0],y=[p.d,E.d,g.d,v.d],c.g[0]=c.g[1]=c.g[2]=0,F(c,p,E,u,0),F(c,g,v,u,2),V(t,c,y,u,!0),ft(e).b=e.b=i.b=!0,!1}function B(t,e){for(var i=pt(e);;){for(;i.b;)e=i,i=pt(i);if(!e.b&&(i=e,e=ft(e),null===e||!e.b))break;e.b=!1;var r,o=e.a,a=i.a;if(r=o.b.a!==a.b.a)t:{r=e;var l=pt(r),h=r.a,c=l.a,u=void 0;if(n(h.b.a,c.b.a)){if(0>s(h.b.a,c.b.a,h.a)){r=!1;break t}ft(r).b=r.b=!0,u=m(h),f(c.b,u),u.d.c=r.d}else{if(0<s(c.b.a,h.b.a,c.a)){r=!1;break t}r.b=l.b=!0,u=m(c),f(h.e,c.b),u.b.d.c=r.d}r=!0}if(r&&(i.c?(R(i),g(a),i=pt(e),a=i.a):e.c&&(R(e),g(o),e=ft(i),o=e.a)),o.a!==a.a)if(o.b.a===a.b.a||e.c||i.c||o.b.a!==t.a&&a.b.a!==t.a)k(t,e);else if(W(t,e))break;o.a===a.a&&o.b.a===a.b.a&&(w(a,o),R(e),g(o),e=ft(i))}}function U(t,e){t.a=e;for(var i=e.c;null===i.i;)if(i=i.c,i===e.c){var i=t,o=e,a=new dt;a.a=o.c.b;var l=i.f,h=l.a;do h=h.a;while(null!==h.b&&!l.c(l.b,a,h.b));var l=h.b,c=pt(l),a=l.a,h=c.a;if(0===s(a.b.a,o,a.a))a=l.a,r(a.a,o)||r(a.b.a,o)||(m(a.b),l.c&&(g(a.c),l.c=!1),f(o.c,a),U(i,o));else{var u=n(h.b.a,a.b.a)?l:c,c=void 0;l.d||u.c?(c=u===l?E(o.c.b,a.e):E(h.b.c.b,o.c).b,u.c?A(u,c):(a=i,l=P(i,l,c),l.f=ft(l).f+l.a.f,l.d=I(a,l.f)),U(i,o)):O(i,l,o.c,o.c,null,!0)}return}if(i=C(i.i),a=pt(i),l=a.a,a=N(t,a,null),a.c===l){var l=a,a=l.c,h=pt(i),c=i.a,u=h.a,d=!1;c.b.a!==u.b.a&&W(t,i),r(c.a,t.a)&&(f(Z(a),c),i=C(i),a=pt(i).a,N(t,pt(i),h),d=!0),r(u.a,t.a)&&(f(l,Z(u)),l=N(t,h,null),d=!0),d?O(t,i,l.c,a,a,!0):(o=n(u.a,c.a)?Z(u):c,o=E(l.c.b,o),O(t,i,o,o.c,o.c,!1),o.b.i.c=!0,B(t,i))}else O(t,i,a.c,l,l,!0)}function j(t,e){var i=new dt,r=p(t.b);r.a.b=mt,r.a.a=e,r.b.a.b=-mt,r.b.a.a=e,t.a=r.b.a,i.a=r,i.f=0,i.d=!1,i.c=!1,i.h=!0,i.b=!1,r=t.f,r=z(r,r.a,i),i.e=r}function K(t){this.a=new q,this.b=t,this.c=M}function z(t,e,i){do e=e.c;while(null!==e.b&&!t.c(t.b,e.b,i));return t=new q(i,e.a,e),e.a.c=t,e.a=t}function q(t,e,i){this.b=t||null,this.a=e||this,this.c=i||this}function H(){this.d=Et,this.p=this.b=this.q=null,this.j=[0,0,0],this.s=100130,this.n=!1,this.o=this.a=this.e=this.f=null,this.m=!1,this.c=this.r=this.i=this.k=this.l=this.h=null}function Y(t,e){if(t.d!==e)for(;t.d!==e;)if(t.d<e)switch(t.d){case Et:X(t,100151),t.u(null);break;case 1:X(t,100152),t.t()}else switch(t.d){case 2:X(t,100154),t.v();break;case 1:X(t,100153),t.w()}}function X(t,e){t.p&&t.p(e,t.c)}function Q(t,e){this.b=t||this,this.d=e||this,this.a=null,this.c=!1}function J(){this.h=this,this.i=this.d=this.a=this.e=this.c=this.b=null,this.f=0}function Z(t){return t.b.e}function $(){this.c=new tt,this.a=new Q,this.b=new J,this.d=new J,this.b.b=this.d,this.d.b=this.b}function tt(t,e){this.e=t||this,this.f=e||this,this.d=this.c=null,this.g=[0,0,0],this.h=this.a=this.b=0}function et(){this.c=[],this.d=null,this.a=0,this.e=!1,this.b=new ot}function it(t){t.d=[];for(var e=0;e<t.a;e++)t.d[e]=e;t.d.sort(function(t){return function(e,i){return n(t[e],t[i])?1:-1}}(t.c)),t.e=!0,at(t.b)}function rt(t,e){if(t.e){var i=t.b,r=++i.a;2*r>i.f&&(i.f*=2,i.c=st(i.c,i.f+1));var n;return 0===i.b?n=r:(n=i.b,i.b=i.c[i.b]),i.e[n]=e,i.c[n]=r,i.d[r]=n,i.h&&ut(i,r),n}return i=t.a++,t.c[i]=e,-(i+1)}function nt(t){if(0===t.a)return ht(t.b);var e=t.c[t.d[t.a-1]];if(0!==t.b.a&&n(lt(t.b),e))return ht(t.b);do--t.a;while(0<t.a&&null===t.c[t.d[t.a-1]]);return e}function ot(){this.d=st([0],33),this.e=[null,null],this.c=[0,0],this.a=0,this.f=32,this.b=0,this.h=!1,this.d[1]=1}function st(t,e){for(var i=Array(e),r=0;r<t.length;r++)i[r]=t[r];for(;r<e;r++)i[r]=0;return i}function at(t){for(var e=t.a;1<=e;--e)ct(t,e);t.h=!0}function lt(t){return t.e[t.d[1]]}function ht(t){var e=t.d,i=t.e,r=t.c,n=e[1],o=i[n];return 0<t.a&&(e[1]=e[t.a],r[e[1]]=1,i[n]=null,r[n]=t.b,t.b=n,0<--t.a&&ct(t,1)),o}function ct(t,e){for(var i=t.d,r=t.e,o=t.c,s=e,a=i[s];;){var l=s<<1;l<t.a&&n(r[i[l+1]],r[i[l]])&&(l+=1);var h=i[l];if(l>t.a||n(r[a],r[h])){i[s]=a,o[a]=s;break}i[s]=h,o[h]=s,s=l}}function ut(t,e){for(var i=t.d,r=t.e,o=t.c,s=e,a=i[s];;){var l=s>>1,h=i[l];if(0===l||n(r[h],r[a])){i[s]=a,o[a]=s;break}i[s]=h,o[h]=s,s=l}}function dt(){this.e=this.a=null,this.f=0,this.c=this.b=this.h=this.d=!1}function pt(t){return t.e.c.b}function ft(t){return t.e.a.b}var gt,mt=4e150,Et=0;gt=H.prototype,gt.x=function(){Y(this,Et)},gt.B=function(t,e){switch(t){case 100142:return;case 100140:switch(e){case 100130:case 100131:case 100132:case 100133:case 100134:return void(this.s=e)}break;case 100141:return void(this.m=!!e);default:return void X(this,100900)}X(this,100901)},gt.y=function(t){switch(t){case 100142:return 0;case 100140:return this.s;case 100141:return this.m;default:X(this,100900)}return!1},gt.A=function(t,e,i){this.j[0]=t,this.j[1]=e,this.j[2]=i},gt.z=function(t,e){var i=e?e:null;switch(t){case 100100:case 100106:this.h=i;break;case 100104:case 100110:this.l=i;break;case 100101:case 100107:this.k=i;break;case 100102:case 100108:this.i=i;break;case 100103:case 100109:this.p=i;break;case 100105:case 100111:this.o=i;break;case 100112:this.r=i;break;default:X(this,100900)}},gt.C=function(t,e){var i=!1,r=[0,0,0];Y(this,2);for(var n=0;3>n;++n){var o=t[n];-1e150>o&&(o=-1e150,i=!0),1e150<o&&(o=1e150,i=!0),r[n]=o}i&&X(this,100155),i=this.q,null===i?(i=p(this.b),f(i,i.b)):(m(i),i=i.e),i.a.d=e,i.a.g[0]=r[0],i.a.g[1]=r[1],i.a.g[2]=r[2],i.f=1,i.b.f=-1,this.q=i},gt.u=function(t){Y(this,Et),this.d=1,this.b=new $,this.c=t},gt.t=function(){Y(this,1),this.d=2,this.q=null},gt.v=function(){Y(this,2),this.d=1},gt.w=function(){Y(this,1),this.d=Et;var t=this.j[0],e=this.j[1],i=this.j[2],o=!1,a=[t,e,i];if(0===t&&0===e&&0===i){for(var e=[-2e150,-2e150,-2e150],l=[2e150,2e150,2e150],i=[],h=[],o=this.b.c,t=o.e;t!==o;t=t.e)for(var d=0;3>d;++d){var p=t.g[d];p<l[d]&&(l[d]=p,h[d]=t),p>e[d]&&(e[d]=p,i[d]=t)}if(t=0,e[1]-l[1]>e[0]-l[0]&&(t=1),e[2]-l[2]>e[t]-l[t]&&(t=2),l[t]>=e[t])a[0]=0,a[1]=0,a[2]=1;else{for(e=0,l=h[t],i=i[t],h=[0,0,0],l=[l.g[0]-i.g[0],l.g[1]-i.g[1],l.g[2]-i.g[2]],d=[0,0,0],t=o.e;t!==o;t=t.e)d[0]=t.g[0]-i.g[0],d[1]=t.g[1]-i.g[1],d[2]=t.g[2]-i.g[2],h[0]=l[1]*d[2]-l[2]*d[1],h[1]=l[2]*d[0]-l[0]*d[2],h[2]=l[0]*d[1]-l[1]*d[0],p=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],p>e&&(e=p,a[0]=h[0],a[1]=h[1],a[2]=h[2]);0>=e&&(a[0]=a[1]=a[2]=0,a[S(l)]=1)}o=!0}for(h=S(a),t=this.b.c,e=(h+1)%3,i=(h+2)%3,h=0<a[h]?1:-1,a=t.e;a!==t;a=a.e)a.b=a.g[e],a.a=h*a.g[i];if(o){for(a=0,o=this.b.a,t=o.b;t!==o;t=t.b)if(e=t.a,!(0>=e.f))do a+=(e.a.b-e.b.a.b)*(e.a.a+e.b.a.a),e=e.e;while(e!==t.a);if(0>a)for(a=this.b.c,o=a.e;o!==a;o=o.e)o.a=-o.a}for(this.n=!1,a=this.b.b,t=a.h;t!==a;t=o)o=t.h,e=t.e,r(t.a,t.b.a)&&t.e.e!==t&&(G(this,e,t),g(t),t=e,e=t.e),e.e===t&&(e!==t&&(e!==o&&e!==o.b||(o=o.h),g(e)),t!==o&&t!==o.b||(o=o.h),g(t));for(this.e=a=new et,o=this.b.c,t=o.e;t!==o;t=t.e)t.h=rt(a,t);for(it(a),this.f=new K(this),j(this,-mt),j(this,mt);null!==(a=nt(this.e));){for(;;){t:if(t=this.e,0===t.a)o=lt(t.b);else if(o=t.c[t.d[t.a-1]],0!==t.b.a&&(t=lt(t.b),n(t,o))){o=t;break t}if(null===o||!r(o,a))break;o=nt(this.e),G(this,a.c,o.c)}U(this,a)}for(this.a=this.f.a.a.b.a.a,a=0;null!==(o=this.f.a.a.b);)o.h||++a,R(o);for(this.f=null,a=this.e,a.b=null,a.d=null,this.e=a.c=null,a=this.b,t=a.a.b;t!==a.a;t=o)o=t.b,t=t.a,t.e.e===t&&(w(t.c,t),g(t));if(!this.n){if(a=this.b,this.m)for(t=a.b.h;t!==a.b;t=o)o=t.h,t.b.d.c!==t.d.c?t.f=t.d.c?1:-1:g(t);else for(t=a.a.b;t!==a.a;t=o)if(o=t.b,t.c){for(t=t.a;n(t.b.a,t.a);t=t.c.b);for(;n(t.a,t.b.a);t=t.e);for(e=t.c.b,i=void 0;t.e!==e;)if(n(t.b.a,e.a)){for(;e.e!==t&&(c(e.e)||0>=s(e.a,e.b.a,e.e.b.a));)i=E(e.e,e),e=i.b;e=e.c.b}else{for(;e.e!==t&&(u(t.c.b)||0<=s(t.b.a,t.a,t.c.b.a));)i=E(t,t.c.b),t=i.b;t=t.e}for(;e.e.e!==t;)i=E(e.e,e),e=i.b}if(this.h||this.i||this.k||this.l)if(this.m){for(a=this.b,o=a.a.b;o!==a.a;o=o.b)if(o.c){this.h&&this.h(2,this.c),t=o.a;do this.k&&this.k(t.a.d,this.c),t=t.e;while(t!==o.a);this.i&&this.i(this.c)}}else{for(a=this.b,o=!!this.l,t=!1,e=-1,i=a.a.d;i!==a.a;i=i.d)if(i.c){t||(this.h&&this.h(4,this.c),t=!0),h=i.a;do o&&(l=h.b.d.c?0:1,e!==l&&(e=l,this.l&&this.l(!!e,this.c))),this.k&&this.k(h.a.d,this.c),h=h.e;while(h!==i.a)}t&&this.i&&this.i(this.c)}if(this.r){for(a=this.b,t=a.a.b;t!==a.a;t=o)if(o=t.b,!t.c){e=t.a,i=e.e,h=void 0;do h=i,i=h.e,h.d=null,null===h.b.d&&(h.c===h?x(h.a,null):(h.a.c=h.c,y(h,Z(h))),l=h.b,l.c===l?x(l.a,null):(l.a.c=l.c,y(l,Z(l))),L(h));while(h!==e);e=t.d,t=t.b,t.d=e,e.b=t}return this.r(this.b),void(this.c=this.b=null)}}this.b=this.c=null},this.libtess={GluTesselator:H,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901,GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111}},H.prototype.gluDeleteTess=H.prototype.x,H.prototype.gluTessProperty=H.prototype.B,H.prototype.gluGetTessProperty=H.prototype.y,H.prototype.gluTessNormal=H.prototype.A,H.prototype.gluTessCallback=H.prototype.z,H.prototype.gluTessVertex=H.prototype.C,H.prototype.gluTessBeginPolygon=H.prototype.u,H.prototype.gluTessBeginContour=H.prototype.t,H.prototype.gluTessEndContour=H.prototype.v,H.prototype.gluTessEndPolygon=H.prototype.w,t.exports=this.libtess},function(t,e,i){"use strict";function r(t,e,i){function o(t,e){var r=t[0],o=t[1];h[r]={connect:function(t){return"function"!=typeof t?void console.error("Bad callback given to connect to signal "+r):(h.__objectSignals__[o]=h.__objectSignals__[o]||[],h.__objectSignals__[o].push(t),void(e||"destroyed"===r||i.exec({type:n.connectToSignal,object:h.__id__,signal:o})))},disconnect:function(t){if("function"!=typeof t)return void console.error("Bad callback given to disconnect from signal "+r);h.__objectSignals__[o]=h.__objectSignals__[o]||[];var s=h.__objectSignals__[o].indexOf(t);return s===-1?void console.error("Cannot find connection of signal "+r+" to "+t.name):(h.__objectSignals__[o].splice(s,1),void(e||0!==h.__objectSignals__[o].length||i.exec({type:n.disconnectFromSignal,object:h.__id__,signal:o})))}}}function s(t,e){var i=h.__objectSignals__[t];i&&i.forEach(function(t){t.apply(t,e)})}function a(t){var e=t[0],r=t[1];h[e]=function(){for(var t,e=[],o=0;o<arguments.length;++o)"function"==typeof arguments[o]?t=arguments[o]:e.push(arguments[o]);i.exec({type:n.invokeMethod,object:h.__id__,method:r,args:e},function(e){if(void 0!==e){var i=h.unwrapQObject(e);t&&t(i)}})}}function l(t){var e=t[0],r=t[1],s=t[2];h.__propertyCache__[e]=t[3],s&&(1===s[0]&&(s[0]=r+"Changed"),o(s,!0)),Object.defineProperty(h,r,{configurable:!0,get:function(){var t=h.__propertyCache__[e];return void 0===t&&console.warn('Undefined value in property cache for property "'+r+'" in object '+h.__id__),t},set:function(t){return void 0===t?void console.warn("Property setter for "+r+" called with undefined value!"):(h.__propertyCache__[e]=t,void i.exec({type:n.setProperty,object:h.__id__,property:e,value:t}))}})}this.__id__=t,i.objects[t]=this,this.__objectSignals__={},this.__propertyCache__={};var h=this;this.unwrapQObject=function(t){if(t instanceof Array){for(var e=new Array(t.length),n=0;n<t.length;++n)e[n]=h.unwrapQObject(t[n]);return e}if(!t||!t["__QObject*__"]||void 0===t.id)return t;var o=t.id;if(i.objects[o])return i.objects[o];if(!t.data)return void console.error("Cannot unwrap unknown QObject "+o+" without data.");var s=new r(o,t.data,i);return s.destroyed.connect(function(){if(i.objects[o]===s){delete i.objects[o];var t=[];for(var e in s)t.push(e);for(var r in t)delete s[t[r]]}}),s.unwrapProperties(),s},this.unwrapProperties=function(){for(var t in h.__propertyCache__)h.__propertyCache__[t]=h.unwrapQObject(h.__propertyCache__[t])},this.propertyUpdate=function(t,e){for(var i in e){var r=e[i];h.__propertyCache__[i]=r}for(var n in t)s(n,t[n])},this.signalEmitted=function(t,e){s(t,e)},e.methods.forEach(a),e.properties.forEach(l),e.signals.forEach(function(t){o(t,!1)});for(var t in e.enums)h[t]=e.enums[t]}var n={signal:1,propertyUpdate:2,init:3,idle:4,debug:5,invokeMethod:6,connectToSignal:7,disconnectFromSignal:8,setProperty:9,response:10},o=function(t,e){if("object"!=typeof t||"function"!=typeof t.send)return void console.error("The QWebChannel expects a transport object with a send function and onmessage callback property. Given is: transport: "+typeof t+", transport.send: "+typeof t.send);var i=this;this.transport=t,this.send=function(t){"string"!=typeof t&&(t=JSON.stringify(t)),i.transport.send(t)},this.transport.onmessage=function(t){var e=t.data;switch("string"==typeof e&&(e=JSON.parse(e)),e.type){case n.signal:i.handleSignal(e);break;case n.response:i.handleResponse(e);break;case n.propertyUpdate:i.handlePropertyUpdate(e);break;default:console.error("invalid message received:",t.data)}},this.execCallbacks={},this.execId=0,this.exec=function(t,e){return e?(i.execId===Number.MAX_VALUE&&(i.execId=Number.MIN_VALUE),t.hasOwnProperty("id")?void console.error("Cannot exec message with property id: "+JSON.stringify(t)):(t.id=i.execId++,i.execCallbacks[t.id]=e,void i.send(t))):void i.send(t)},this.objects={},this.handleSignal=function(t){var e=i.objects[t.object];e?e.signalEmitted(t.signal,t.args):console.warn("Unhandled signal: "+t.object+"::"+t.signal)},this.handleResponse=function(t){return t.hasOwnProperty("id")?(i.execCallbacks[t.id](t.data),void delete i.execCallbacks[t.id]):void console.error("Invalid response message received: ",JSON.stringify(t))},this.handlePropertyUpdate=function(t){for(var e in t.data){var r=t.data[e],o=i.objects[r.object];o?o.propertyUpdate(r.signals,r.properties):console.warn("Unhandled property update: "+r.object+"::"+r.signal)}i.exec({type:n.idle})},this.debug=function(t){i.send({type:n.debug,data:t})},i.exec({type:n.init},function(t){for(var o in t)var s=new r(o,t[o],i);for(var o in i.objects)i.objects[o].unwrapProperties();e&&e(i),i.exec({type:n.idle})})};t.exports={QWebChannel:o}}]);