var e,t,r,a,f,n,l,c,i,d,p,u,h,s,x,y,m,o=(e,t)=>({x:e,y:t}),b=Math,{abs:g,sin:F,cos:w,max:v,min:M,atan2:D,sign:H,hypot:A}=b,B=b.PI,C=B/2,N=2*B,T=(e,t)=>[...Array(0|e)].map((e,r)=>t(r)),I=(e,t,r=1)=>T(e,a=>t(a/(e-1)*r)),L=(e,t,r,a)=>(t=new Uint32Array([0,1,r=a=2,3].map(t=>((e,t,r)=>parseInt(e.substr(t,8),16))(e,8*t))),e=>(a=t[3],t[3]=t[2],t[2]=t[1],t[1]=r=t[0],t[0]^=(a^=a<<11)^a>>>8^r>>>19,t[0]/2**32)),$=(t=1,r=0)=>e()*t+r,k=(e=2,t=0)=>t+$(0|e)|0,E=(e=.5)=>$()>e,P=(e=1)=>$(e)-e/2,R=e=>k(4)*B/2,S=e=>k(8)*B/4,j=e=>e[k(e.length)],U="F2F1DFF2BD1DD94711591812181212#e8d5b9c07a38df3146f5b3490e2430#f3efeff7b32b0c6291b80c09091e05#f1faeee63946a8ccdc457b9d1d3557#dff3e4bca2cd7d73c6684da2171738#dccfa39f8f6544443bc6110f12130b#fff7f4ffc6c6ff2f4ec60a5f820a5f#faf1dcff871fb8000041764b29293d#ccc9a1f0ffcea53f2b60290e280004#ecf39e90a9554f772d31572c132a13#fdf0d5669bbcc1121f780000003049#e0fbfc98c1d9ee6c4d3d5a80293241#fbfffe96031a1b1b1e6d676efaa916#fffcf2ccc5b9503d39252422eb5e28#8ecae6219ebc023047ffb703fb8500#000000FFFFFFdddddd444444888888#25232370798cf5f1eddad2bca99985#ffffff375ba9000000d6d6d6fca311#f4ca55284862d6644a3a8acafffeef#C20F00FFDD22ffffff2374C6000000#e4e1dbD96B0BBF13048C13084465A6#f4ebc5F29F05233479569cc7F20505#001427708d81f4d58dbf06038d0801#8c1c13bf4342e7d7c1a78a7f735751".split("#").map(e=>e.match(/.{6}/g).map(e=>"#"+e)),W=.618,Y=.5/W,Z=f=>{(t=>{e=t})(((e,t=0,r=L(e.substr(2)),a=L(e.substr(34)))=>e=>++t%2?r():a())(f)),T(k(419),$),t=k(24),r=$(),a=k(8),n=j([0,.01,.03,.06]),l=E(.1),c=E(.2),i=E(.7),d=$(10,10)},q=(e,t,r)=>e+(t-e)*r,z=(e,t)=>{let r=w(t),a=F(t);return o(e.x*r+e.y*a,-e.x*a+e.y*r)},G=(e,t,r)=>J(z(J({...e},t,-1),r),t),J=(e,t,r=1)=>(e.x+=t.x*r,e.y+=t.y*r,e),K=(e,t)=>o(w(e)*t,F(e)*t),O=(e,t)=>A(e.x-t.x,e.y-t.y),Q=(e,t)=>D(t.y-e.y,t.x-e.x),V=(e,t,r)=>o(q(e.x,t.x,r),q(e.y,t.y,r)),X=e=>e.reduce((t,r,a)=>t+r.x*(a=e[a+1]||e[0]).y-r.y*a.x,0)/2,_=(e,t)=>({p:e,i:t,a:X(e)}),ee=(e,t)=>e[(t+1)%e.length],te=e=>e.map((t,r)=>[t,ee(e,r)]),re=(e,t,r)=>V(e,t,M(.5,r/O(e,t))),ae=(e,t,r)=>!(e-1e-7<=t&&t<=r+1e-7),fe=(e,t,r,a)=>{a&&e.push({...r},{...a}),t.push({...a||r})},ne=(e,t)=>{let r=[],a=[],f=0;return((e,t)=>{te(e).map(t)})(e,e=>{let n=(([e,t],[r,a])=>((e,t,r,a,f,n,l,c)=>{let i=e*a-t*r,d=f*c-n*l,p=e-r,u=t-a,h=f-l,s=n-c,x=p*s-u*h,y=(i*h-p*d)/x,m=(i*s-u*d)/x;if(isNaN(y+m))return!1;if(e>=r){if(ae(r,y,e))return!1}else if(ae(e,y,r))return!1;if(t>=a){if(ae(a,m,t))return!1}else if(ae(t,m,a))return!1;if(f>=l){if(ae(l,y,f))return!1}else if(ae(f,y,l))return!1;if(n>=c){if(ae(c,m,n))return!1}else if(ae(n,m,c))return!1;return{x:y,y:m}})(e.x,e.y,t.x,t.y,r.x,r.y,a.x,a.y))(t,e);n&&f++,f%2?fe(r,a,e[0],n):fe(a,r,e[0],n)}),f<2?[e]:[r,a]},le=e=>{e[1]&&e.sort((e,t)=>X(t)-X(e)).pop()},ce=(e,t,r,a,f)=>{for(let n=0;n<t.length;n++){let l=[],c=Q(...t[n]),i=K(c+R(),j([$(.02,.01),$(.03,.03),0]));e.map(r=>{if(E(1-a)&&e.length>1||e.length>9)return l.push(r);let c=ne(r,t[n]);E(1-f)&&c[0].map(e=>J(e,i)),l.push(...c)}),E(1-r)&&le(l),e=l}return e},ie=(e,t,r,a,f)=>{let n={x:r,y:a},l=((e,t,r=!1)=>{let[a,f]=e,n=f.x-a.x,l=f.y-a.y,c=((t.x-a.x)*n+(t.y-a.y)*l)/(n*n+l*l);return r&&(c=M(1,v(c,0))),o(a.x+c*n,a.y+c*l)})([e,t],n,!0);return O(l,n)<f},de=(e,t,r,a,f,n)=>{for(let l=0;l<t;l++){let t=f(),l=P(.9-t),c=P(1.5-t),i=!0;for(let e=0;e<u.length&&i;e++){let a=u[e].p||u[e];for(let e=0;e<a.length&&i;e++)ie(a[e],a[(e+1)%a.length],l,c,t*r)&&(i=!1)}if((e&&!i||!e&&i)&&(!n||n(l,c,t)))return a(l,c,t,n&&n(l,c,t))}},pe=(e,t,r)=>z(o(e,t),r),ue=(e,t,r,a,f=0)=>((e,t,r)=>e.map(e=>J(e,{x:t,y:r})))([pe(-r,-a,f),pe(r,-a,f),pe(r,a,f),pe(-r,a,f)],e,t),he=(e,t,r,a)=>{let n=[],l=E(),i=a||k(3,2),d=$(.5,.5),p=$(1.5,.5);for(let e=0;e<i;e++){let t=e/i*r-r/2,a=P(d)*r,f=r/i/2*p*(l?$(.7,.3):1),c=$(d/3*2,d/3)*r;n.push(ue(t,a,f,c*(E(.2)?1:4)))}let u=o(e,t),h=f,s=k(2);return n.map(e=>{let t=s&&k(2)*C,r=h+t;return t&&s--,e.map(e=>z(e,r)).map(e=>J(e,u)).map(e=>c?o(e.x+P(.01),e.y+P(.01)):e)})},se=(e,t,r,a)=>r.map(r=>J(K(r,a(r)),{x:e,y:t})),xe=(e,t,r)=>{let a=T(c?k(3,1):0,e=>{let t=j([2,3,5]),a=$(.01,.001),f=$(99);return e=>r*F(e*t+f)*a});return se(e,t,((e,t,r,a)=>{let f=[];for(let e=0;e<t;e+=$(.05,.03))f.push(e);return f.push(t),f})(0,N),e=>a.reduce((t,r)=>r(e)+t,r))},ye=(e,t,r)=>[...xe(e,t,r),...xe(e,t,r*$(.22,.55)).reverse()],me=(e,t,r)=>[o(e-r,t-r*$(.5,1)),o(e+r,t-r*$(.5,1)),o(e+r,t+r*$(.5,1)),o(e-r,t+r*$(.5,1))],oe=(e,t,r,a,f=0)=>{f=j([C,-C]);let n=c?1+P(.15):1;return se(e,t,[-f,2*B/3-f,-f-2*B/3],e=>r*n)},be=e=>!e.some(e=>(e=>g(e.x)>.5-n||g(e.y)>Y-n)(e)),ge=e=>{p=T(j([2,3,4,5]),e=>{let t=P(.7),r=R()+f;return[z(o(-9,t),r),z(o(9,t),r)]});let t=$(.28,.2),a=E(),c=a?P(.7):0,h=!a&&E(.7)?P(.2):0;u=((e,t,r=0)=>T(t.length/2,e=>[r+=t[2*e],t[2*e+1]]).find(t=>e<t[0])[1])(r,[.3,he,.1,ye,.3,xe,.1,oe,.15,(e,t,r,a,f)=>ue(e,t,r,a,(e=>E()?e+S():S())(f)),.05,me])(h,c,t,t,f),isNaN(u[0].x)||(u=[u]),u=ce((e=>e.map(e=>i&&E()&&e.length<6?((e,t)=>te(te(e)).map(([[e],[r,a]])=>{let f=t();return((e,t,r)=>I(33,a=>V(V(e,t,a),V(t,r,a),a)))(re(r,e,f),r,re(r,a,f))}).flat())(e,()=>W/d):e))(u),p,0,.1,j([.05,.1,.5])),(r<.7||r>.8)&&((u=u.sort((e,t)=>X(e)-X(t))).splice(u.length/2|0,1),u.length>3&&u.splice(1,1),u.length>3&&u.splice(1,1)),de(l,999,1,(e,t,r)=>{let a=ce(he(e,t,r),p.map(([r,a])=>[J({...r},{x:e,y:t}),J({...a},{x:e,y:t})]),j([0,.1]),.1,.5);return u.push(...a)},e=>$(.3,.3)),u=(u=ce(u,[[o(-.5+n,-9),o(-.5+n,9)],[o(.5-n,-9),o(.5-n,9)],[o(-9,-Y+n),o(9,-Y+n)],[o(-9,Y-n),o(9,Y-n)]],0,0,0)).filter(be).sort((e,t)=>X(t)-X(e)).map(_)},Fe=(e,t)=>e.fillStyle=t,we=(e,t,r)=>{Fe(e,r),e.fill(((e,t=!0)=>new Path2D(((e,t=!0)=>"M"+e.map(e=>[e.x,e.y]).join("L")+(t?"Z":""))(e,t)))(t))},ve=e=>e.canvas,Me=e=>ve(e).width,De=e=>{if(u.filter(e=>e.a>.1).length<2||u.filter(e=>e.a>.35).length)return!0;let t=u.reduce((e,t)=>Math.min(e,t.p.reduce((e,t)=>Math.min(e,t.y),9)),9),r=u.reduce((e,t)=>Math.max(e,t.p.reduce((e,t)=>Math.max(e,t.y),-9)),-9),a=u.reduce((e,t)=>Math.min(e,t.p.reduce((e,t)=>Math.min(e,t.x),9)),9),f=u.reduce((e,t)=>Math.max(e,t.p.reduce((e,t)=>Math.max(e,t.x),-9)),-9);if(r<.5||t>-.5)return!0;if(f<.3||a>-.3)return!0;e.clearRect(-4,-4,8,8),u.map(t=>we(e,t.p,"#f0f"));let{width:l,height:c}=e.canvas,i=e.getImageData(0,0,l,c).data,d=0;return T(999,e=>{let t=n*l,r=t+$(l-2*t)|0,a=t+$(c-2*t)|0;i[4*(r+a*l)]>2&&d++}),d/999<.3||d/999>.8||u.length<5},He=(e,t,r)=>T(k(2,1),a=>{let f=[e+a*P(r/2),t+a*P(r/2),r/(a+1)];return xe(...f)}),Ae=e=>e.reduce((t,r)=>J(t,r,1/e.length),o(0,0)),Be=e=>{let t=o(1e9,1e9),r=o(-1e9,-1e9);return e.map(e=>{t.x=M(t.x,e.x),t.y=M(t.y,e.y),r.x=v(r.x,e.x),r.y=v(r.y,e.y)}),[t,r]},Ce=([{x:e,y:t},{x:r,y:a}])=>M(g(e-r),g(t-a)),Ne=e=>{let t=u.map((e,t)=>[e.a,t]).sort((e,t)=>t[0]-e[0]);if(!t.length)return;let r=t[t.length/2|0][1],a=u[r];u.splice(r,1);let f=-Q(...p[0])+e,n=E()?k(33,44):k(11,22),l=I(2*n,e=>[z(o(2,2*e-1),f),z(o(-2,2*e-1),f)]),c=j([0,0,.1,.2]),i=j([0,0,.1]),d=j([0,0,.1]),h=ce([a.p],l,d,c,i);u.push(...h.map(t=>{let r=X(t)<.05&&(0===e||e===B/2)&&E(.93)?B/2:0,a=Ae(t);return t.map(e=>J(z(J(e,a,-1),r),a,1))}).map(e=>{let t=(e=>{let t=Ae(e),r=I(180,r=>{let a=r*B,f=e.map(e=>G(e,t,a));return[Be(f),a]}).sort((e,t)=>Ce(e[0])-Ce(t[0]));return(([{x:e,y:t},{x:r,y:a}])=>[o(e,t),o(r,t),o(r,a),o(e,a)])(r[0][0]).map(e=>G(e,t,-r[0][1]))})(e);return X(t)/X(e)<1.2?t:e}).map((e,t)=>_(e,t+a.i)))},Te=(e,t=k(8))=>{(e=>{f=[0,0,0,B/2,B/2,B/2,$(1,.2)*H(P()),$(.1,.1)*H(P())][e]})(t);let r=1e3;do{ge()}while(De(e)&&--r>0);Ne(C),E(.3)&&de(!1,9999,1.3,(e,t,r,a)=>u.push(...[he,He][k(2)](e,t,r).map((e,t)=>_(e,a.i+t+1))),e=>j([.075,.1,.1]),(e,t)=>u.find(r=>t<0&&(({x:e,y:t},r)=>{let a=!1;for(let f=0,n=r.length-1;f<r.length;n=f++){let l=r[f].x,c=r[f].y,i=r[n].x,d=r[n].y;c>t!=d>t&&e<(i-l)*(t-c)/(d-c)+l&&(a=!a)}return a})({x:e,y:t},r.p))),Ne(0),E()&&Ne(j([B/4+P(.1),0,C]));let a=m.pop();Fe(e,a),e.fillRect(-4,-4,8,8),u.sort((e,t)=>t.a-e.a).filter(e=>e.a>1e-4).map(t=>we(e,t.p,m[t.i%m.length])),m.push(a)},Ie=clearTimeout,Le=setTimeout;newHash=(e,r)=>{Z(e),m=(e=>e.map(e=>[e,$()]).sort((e,t)=>e[1]-t[1]).map(e=>e[0]))(U[t]),Te(r,a)};var $e,ke=e=>s=Le(e=>ke(Te(Pe)),1e3*h),Ee=e=>{if(!x){let e=(x=document.createElement("div")).style;e.textAlign="center",e.position="fixed",e.width="100%",e.top="10px",document.body.append(x)}x.innerHTML=`<span style="padding:0 5px;user-select:none;font:25px Arial;background:#fff">Slideshow ${h?h+" sec":"off"}</span>`,Ie(y),y=Le(()=>x.innerHTML="",2e3)},Pe=((e=1,t=1)=>((e=1,t=1)=>{let r=document.createElement("canvas"),a=innerWidth,f=innerHeight,n=e<a/f,l=r.style;return l.width=n?`calc(100vh*${e})`:"100vw",l.height=n?"100vh":`calc(100vw/${e})`,r.width=(0|(n?f*e:a))*t,r.height=(0|(n?f:a/e))*t,r})(e,t).getContext("2d"))(W,2);(e=>{e.translate(Me(e)/2,(e=>ve(e).height)(e)/2)})($e=Pe),(e=>{e.scale(Me(e),Me(e))})($e),newHash(tokenData.hash,Pe),window.onload=()=>document.body.append(ve(Pe)),Pe.canvas.onpointerdown=e=>{e.button||(e.clientY>innerHeight/2?h?(Ie(s),Ee(h=0)):Te(Pe):(h?h=(h+1)%10:ke(h=1),Ee(!h&&Ie(s))))}