<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>negtra</title>
</head>
<body>
<script src="lib.js"></script>
<script>
    function newArt() {
        program(recreateCanvas(), `

        ${glslVignetteFunction()}

        ${glslGetColorFunction()}

        vec3 netgra(vec2 uv) {

            vec2 p = uv - 0.5;
            p.x *= resolution.x/resolution.y;
            p *= ${rotate2d(rnd(7))};
            float l = length(p);

            p += vec2(${rnd(1)},${rnd(1)});
            p *= ${rnd(2)};

            for (int i = 0; i < ${3 + 2 * rndInt(3)}; i++ ){
                p = abs(p)/dot(p,p);
                p -= float(i) * ${rnd(0.5)};
            }

            float id = p.x + p.y* l* ${1 + rnd(7)};
            if (length(uv-0.3 - vec2(${rnd(0.4)},${rnd(0.4)}))<0.1) id++;
            if (length(uv-0.3 - vec2(${rnd(0.4)},${rnd(0.4)}))<0.2) id++;
            if (length(uv-0.3 - vec2(${rnd(0.4)},${rnd(0.4)}))<0.3) id++;
            if (length(uv-0.3 - vec2(${rnd(0.4)},${rnd(0.4)}))<0.4) id++;

            uv *= ${rotate2d(rnd(7))};
            if (abs(uv.y) > ${rnd(0.5)}) id ++;

            vec3 color1 = getColor(id);
            vec3 color2 = getColor(id + 1.0);
            vec3 color = mix(color1, color2, clamp(0.0, 1.0, fract(uv.x*10.+id)));
            return color;
        }

        void main() {
            vec2 uv = gl_FragCoord.xy/resolution;
            vec3 color;
            color += netgra(uv + vec2(-0.2, -0.2)/resolution);
            color += netgra(uv + vec2(+0.5, -0.2)/resolution);
            color += netgra(uv + vec2(-0.2, +0.2)/resolution);
            color += netgra(uv + vec2(+0.2, +0.2)/resolution);
            color /= 4.;
            color *= vignette(${0.2 + rnd(0.2)});
            gl_FragColor = vec4(color, 1.0);
        }
    `).draw();
    }

    addEventListener('pointerdown', e => (!e || e.button === 0) && newArt());
    newArt();
</script>
</body>
</html>