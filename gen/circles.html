<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SEPAHS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:image" content="thumbnail.gif" />
</head>
<body>
<script src="lib.js"></script>
<script>
    let prog
    function newArt() {
        let d = rnd(5)
        prog = program(recreateCanvas(), `

        ${glslVignetteFunction()}
        ${glslNoise2dFunction()}

        ${glslGetColorFunction()}

vec3 netgra(vec2 uv) {


    float id = ${1 + rnd(7)};
    uv -= 0.5;

    uv.x *= resolution.x/resolution.y;
     uv *= ${rotate2d(rnd(7))};
    if (length(noise2d(uv*${2+rnd(4)}) + uv+0.2 - vec2(${rnd(0.4)},${rnd(0.4)})) < ${rnd(0.5)}) id++;
      uv *= ${rotate2d(rnd(7))};
    if (length(noise2d(uv*${3+rnd(11)}) + uv) < ${rnd(0.1)}) id++;
    if (length(uv+0.2 - vec2(${rnd(0.4)},${rnd(0.4)})) < ${rnd(0.25)}) id++;
    if (length(uv+0.2 - vec2(${rnd(0.4)},${rnd(0.4)})) < ${rnd(0.4)}) id++;
    if (length(uv+0.2 - vec2(${rnd(0.4)},${rnd(0.4)})) < ${rnd(0.6)}) id++;

    uv *= ${rotate2d(rnd(7))};
    if (abs(uv.y) < ${rnd(0.5)}) id += length(uv);

    vec3 color1 = getColor(id);
    vec3 color2 = getColor(id + 1.);
    vec3 color3 = getColor(id - 1.5);

    float len = length(uv+vec2(${rnd(0.4)-0.2},${rnd(0.4)-0.2}));
    len = max(0.2, len);

    float v1 = sin(uv.x*${rnd(5)}+id) + noise2d(uv*${15+rnd(15)}*mod(id, 3.)*len);
    v1 = clamp(0.0, 1.0, v1);

    float v2 = clamp(0.0, 1.0, sin(uv.y*${rnd(5)}+id)+noise2d(uv*${rnd(555)}));


    return mix (color3, mix(color1, color2, v1), v2);
}

void main() {
    vec2 uv = gl_FragCoord.xy/resolution;
    vec3 color;

    color += netgra(uv + vec2(-${rnd(d)}, -${rnd(d)})/resolution);
    color += netgra(uv + vec2(+${rnd(d)}, -${rnd(d)})/resolution);
    color += netgra(uv + vec2(-${rnd(d)}, +${rnd(d)})/resolution);
    color += netgra(uv + vec2(+${rnd(d)}, +${rnd(d)})/resolution);
    color /= 4.;
     color *= vignette(${0.2 + rnd(0.2)});
    gl_FragColor = vec4(color, 1.0);
}

        `);
        prog.draw();

    }

    addEventListener('pointerdown', e => (!e || e.button === 0) && newArt());
    addEventListener('resize', e => prog.draw());
    newArt();
</script>
</body>
</html>