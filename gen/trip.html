<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>trip</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:image" content="thumbnail.gif" />
</head>
<body>
<script src="lib.js"></script>
<script>
    let prog
    function newArt() {
        prog = program(recreateCanvas(), `

        ${glslVignetteFunction()}
        ${glslNoise2dFunction()}
        ${glslGetColorFunction()}

 mat2 rot(float a){
        float cs = cos(a);
        float sn = sin(a);
        return mat2(cs,sn,-sn,cs);
    }

vec3 trip(vec2 uv) {
        float time = ${rnd(1111)};
        vec2 p = uv - vec2(${rnd(1)-0.5},${rnd(1)-0.5});
         uv -= vec2(${rnd(2)-1},${rnd(2)-1});
        for (float i=0.;i<${5+rnd(14)}; i++) {
            uv = abs(uv) - i*0.02 + sin(time)*0.01;
                    uv-= i*${rnd(0.4)}
                        //+atan(uv.y,uv.x)*${rnd(0.1)}
                    ;
            uv *= rot(time*0.1+i);
        }

        float f = abs(uv.x) + abs(uv.y)
            //+ atan(p.y,p.x)/${1+rnd(3)}
            + sin(length(uv))*4.
            ;
        vec3 color1 =  getColor(f*${1+rnd(5)}) ;
        vec3 color2 =  getColor(f*${1+rnd(5)}+1.) ;
        float v = fract(uv.x*15. + p.y*15.) + noise2d(p*443.) ;
        return mix(color1, color2, v);
}

void main() {
    vec2 uv = gl_FragCoord.xy/resolution - 0.5;
    uv.x *= resolution.x/resolution.y;
    vec3 color;
    color += trip(uv + vec2(-0.2, -0.2)/resolution);
    color += trip(uv + vec2(+0.5, -0.2)/resolution);
    color += trip(uv + vec2(-0.2, +0.2)/resolution);
    color += trip(uv + vec2(+0.2, +0.2)/resolution);
    color /= 4.;
    // color *= vignette(${0.2 + rnd(0.2)});
    gl_FragColor = vec4(color, 1.0);
}

        `);
        prog.draw();

    }

    addEventListener('pointerdown', e => (!e || e.button === 0) && newArt());
    addEventListener('resize', e => prog.draw());
    newArt();
</script>
</body>
</html>