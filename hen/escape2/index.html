<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Escape</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:image" content="thumbnail.png" />
</head>
<body>
<style>
    html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        /*overflow: hidden;*/
    }
    canvas {
        width: 100%;
        background: wheat;
    }
    * {
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        -moz-osx-font-smoothing: grayscale;
        -webkit-font-smoothing: antialiased;
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
    }
</style>
<script type="text/javascript">
    const s = 1000;

    document.body.innerHTML += `<canvas id=canvas width=${s} height=${s}></canvas>`;

    const rnd = n => Math.random() * n;
    const ctx = canvas.getContext("2d");

    ctx.lineWidth = 0.2;
    ctx.strokeStyle = "#0001";


    let shape;

    addEventListener('click', () => {
        regenerate();
    })

    regenerate();

    function regenerate(){
        ctx.clearRect(0,0,s,s)
        shape = rnd(3)
        bg();
        bg();
        triangles();
        frame();
        ctx.strokeStyle = `#0001`
        circles(s/2, s/2, s/3, 7);

    }



    function circles(x,y,r,depth){
        ctx.fillStyle = `#fff`;
        if(Math.random()>0.5 && r<s/33) {
            for (let i = 0; i < 333; i++) {
                circle(
                    rnd(rnd(10))+x,
                    rnd(rnd(10))+y,
                    rnd(rnd(10))+r,
                    i
                );
            }
        }


        if(!depth)
            return

        //r-=5

        let cc = rnd(2)|0 + 2;
        for (let i =0; i<cc; i++){

            let a = 6.283*i/cc + rnd(13)
            let x1 = Math.cos(a)*r+x
            let y1 = Math.sin(a)*r+y
            let r1 = r/2
            circles(x1,y1,r1, depth-1)

        }
    }


    function circle(x,y,r, i){

        ctx.beginPath();

        const pts = 3*r|0

        const shift =  rnd(21)
        for (let i = 0; i < pts; i++){

            const a = 6.283 * i/pts +shift

            const rr = r + Math.sin(a*shape)*Math.sqrt(r)+rnd(r/4)

            const xx = x + Math.cos(a)*rr
            const yy = y + Math.sin(a)*rr

            i?ctx.lineTo(xx,yy):
                ctx.moveTo(xx,yy+rnd(rnd(111)));


        }



        if(!i){
            ctx.closePath()
            ctx.fill();
        }
        ctx.stroke();


    }

    function bg(){
        ctx.strokeStyle = `hsla(${rnd(360)},${rnd(100)}%,55%,0.1)`
        const a = rnd(123)
        const px = Math.cos(a)*s*2 + s/2
        const py = Math.sin(a)*s*2 + s/2
        for (let i=0;i<10000;i++) {
            ctx.beginPath();
            ctx.moveTo(
                rnd(s)-px,
                rnd(s)-py,
            )
            ctx.lineTo(
                rnd(s),
                rnd(s)
            )
            ctx.stroke();
        }
    }

    function triangles(){
        for (let i=0;i<33;i++){

            ctx.fillStyle='#fff3'
            ctx.beginPath()
            ctx.moveTo(rnd(s),rnd(s))
            ctx.lineTo(rnd(s),rnd(s))
            ctx.lineTo(rnd(s),rnd(s))
            ctx.fill()
        }
    }

    function frame(){
        // ctx.fillStyle=`hsla(${rnd(360)},97%,95%,0.1)`
        const sss = s/15
        for (let i=0;i<11;i++){


            ctx.beginPath()
            ctx.moveTo(0,0)
            ctx.lineTo(rnd(sss),0)
            ctx.lineTo(rnd(sss),s)
            ctx.lineTo(0,s)
            ctx.fill()

            ctx.beginPath()
            ctx.moveTo(s,0)
            ctx.lineTo(s-rnd(sss),0)
            ctx.lineTo(s-rnd(sss),s)
            ctx.lineTo(s,s)
            ctx.fill()

            ctx.beginPath()
            ctx.moveTo(0,s)
            ctx.lineTo(0,s-rnd(sss))
            ctx.lineTo(s,s-rnd(sss))
            ctx.lineTo(s,s)
            ctx.fill()

            ctx.beginPath()
            ctx.moveTo(0,0)
            ctx.lineTo(0,rnd(sss))
            ctx.lineTo(s,rnd(sss))
            ctx.lineTo(s,0)
            ctx.fill()
        }
    }

</script>
</body>
</html>