<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Invaders</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:image" content="thumbnail.jpg" />
</head>
<body>
<style>
    html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    * {
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        -moz-osx-font-smoothing: grayscale;
        -webkit-font-smoothing: antialiased;
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
    }
</style>
<canvas id="canvas"></canvas>
<script type="text/javascript">
    // const creator = new URLSearchParams(window.location.search).get('creator')
    // const viewer = new URLSearchParams(window.location.search).get('viewer')
    const rnd = n => Math.random() * n
    const sin = x => Math.sin(x)
    const cos = x => Math.cos(x)
    const canvas = document.querySelector('#canvas')
    const ctx = canvas.getContext("2d")

    let s, w, h, shape, dir, col1, col2;

    addEventListener('resize', resize);
    addEventListener('click', regenerate)

    resize();
    regenerate();

    function resize ()  {
        w = canvas.width = innerWidth;
        h = canvas.height = innerHeight;
        s = Math.min(w,h)*devicePixelRatio
    }

    function regenerate() {
        ctx.clearRect(0, 0, w, h)
        col1 = `hsla(${rnd(360)},${rnd(100)}%,75%,0.1)`
        col2 = `hsla(${rnd(360)},${rnd(100)}%,75%,0.1)`
        dir = rnd(6.283)
        ctx.strokeStyle = `hsla(${rnd(360)},${rnd(100)}%,55%,0.02)`
        ctx.lineWidth = devicePixelRatio
        bg(4e4);
        ctx.strokeStyle = `hsla(${rnd(360)},${rnd(100)}%,55%,0.02)`
        bg(4e4);
        ctx.fillStyle='#fff3'
        triangles(33);
        ctx.lineWidth = 5*devicePixelRatio
        planet(11111);
        frame(11);
        ctx.lineWidth = 0.2*devicePixelRatio
        ctx.strokeStyle = "#0002"
        ctx.fillStyle = `#fff`
        things(111, w/2,h/2,s/3,5);
    }

    function things(n, x, y, r, level) {
        shape = rnd(3)
        if (Math.random() > 0.7 && r < 40) {
            for (let i = 0; i < n; i++) {
                thing(
                    rnd(20)+x,
                    rnd(20)+y,
                    rnd(10)+r,
                    i
                );
            }
        }

        if (!level)
            return

        const count = (rnd(2)|0) + 2
        for (let i = 0; i<count; i++){
            const a = 6.283*i/count + rnd(6.283)
            things(
                n,
                cos(a)*r+x,
                sin(a)*r+y,
                r/2,
                level-1
            )
        }
    }

    function thing(x, y ,r, i){
        ctx.beginPath()

        const pts = (3*r) | 0
        const denom = 2 + rnd(4)
        const shift =  rnd(6.283)

        ctx.moveTo(
            x + cos(dir)*rnd(300),
            y + sin(dir)*rnd(300)
        );

        for (let i = 0; i < pts; i++) {
            const a = 6.283 * i/pts +shift
            const ri = r + sin(a*shape)*10
            ctx.lineTo(
                x + cos(a)*ri,
                y + sin(a)*ri
            )
        }

        if (!i) {
            ctx.closePath()
            ctx.fill()
        } else {
            ctx.stroke()
        }
    }

    function bg(n){

        const a = rnd(123)
        const px = cos(a)*s*2 + w/2
        const py = sin(a)*s*2 + h/2
        for (let i=0;i<n;i++) {
            ctx.beginPath();
            ctx.moveTo(
                rnd(w)-px,
                rnd(h)-py,
            )
            ctx.lineTo(
                rnd(w),
                rnd(h)
            )
            ctx.stroke()
        }
    }

    function triangles(n){
        for (let i=0;i<33;i++){
            ctx.beginPath()
            ctx.moveTo(rnd(w),rnd(h))
            ctx.lineTo(rnd(w),rnd(h))
            ctx.lineTo(rnd(w),rnd(h))
            ctx.fill()
        }
    }

    function frame(n){

        const sss = s/15
        for (let i=0;i<n;i++){

            ctx.beginPath()
            ctx.moveTo(0,0)
            ctx.lineTo(rnd(sss),0)
            ctx.lineTo(rnd(sss),h)
            ctx.lineTo(0,h)
            ctx.fill()

            ctx.beginPath()
            ctx.moveTo(w,0)
            ctx.lineTo(w-rnd(sss),0)
            ctx.lineTo(w-rnd(sss),h)
            ctx.lineTo(w,h)
            ctx.fill()

            ctx.beginPath()
            ctx.moveTo(0,h)
            ctx.lineTo(0,h-rnd(sss))
            ctx.lineTo(w,h-rnd(sss))
            ctx.lineTo(w,h)
            ctx.fill()

            ctx.beginPath()
            ctx.moveTo(0,0)
            ctx.lineTo(0,rnd(sss))
            ctx.lineTo(w,rnd(sss))
            ctx.lineTo(w,0)
            ctx.fill()
        }
    }

    function planet(n) {

        const x = rnd(w*2)-1;
        const y = rnd(h/4)+s*3;
        for (let i=0; i<n; i++) {
            ctx.strokeStyle = rnd(1)>0.5 ? col1 : col2
            ctx.beginPath();
            ctx.arc(x+rnd(111), y+rnd(111), rnd(s)+s*1.4, 0, 2 * Math.PI);
            ctx.stroke();
        }
    }

</script>
</body>
</html>